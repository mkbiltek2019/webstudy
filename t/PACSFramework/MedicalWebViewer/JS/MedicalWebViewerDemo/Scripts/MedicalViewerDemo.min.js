var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){a!=Array.prototype&&a!=Object.prototype&&(a[b]=d.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,d,c){if(b){d=$jscomp.global;a=a.split(".");for(c=0;c<a.length-1;c++){var e=a[c];e in d||(d[e]={});d=d[e]}a=a[a.length-1];c=d[a];b=b(c);b!=c&&null!=b&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:b})}};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(d){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;$jscomp.polyfill("Object.setPrototypeOf",function(a){return a||$jscomp.setPrototypeOf},"es6","es5");$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};
$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var d=0,c={next:function(){if(d<a.length){var e=d++;return{value:b(e,a[e]),done:!1}}c.next=function(){return{done:!0,value:void 0}};return c.next()}};c[Symbol.iterator]=function(){return c};return c};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,d,c){var b=this.length||0;0>d&&(d=Math.max(0,b+d));if(null==c||c>b)c=b;c=Number(c);0>c&&(c=Math.max(0,b+c));for(d=Number(d||0);d<c;d++)this[d]=a;return this}},"es6","es3");$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function d(a){return a instanceof e?a:new e(function(c,b){c(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};b.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var c=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){c(a,
0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var c=0;c<a.length;++c){var b=a[c];a[c]=null;try{b()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var e=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var c=this.createResolveAndReject_();try{a(c.resolve,c.reject)}catch(k){c.reject(k)}};e.prototype.createResolveAndReject_=
function(){function a(a){return function(d){b||(b=!0,a.call(c,d))}}var c=this,b=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};e.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof e)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var c=null!=a;break a;case "function":c=!0;break a;default:c=!1}c?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};e.prototype.resolveToNonPromiseObj_=function(a){var c=
void 0;try{c=a.then}catch(k){this.reject_(k);return}"function"==typeof c?this.settleSameAsThenable_(c,a):this.fulfill_(a)};e.prototype.reject_=function(a){this.settle_(2,a)};e.prototype.fulfill_=function(a){this.settle_(1,a)};e.prototype.settle_=function(a,c){if(0!=this.state_)throw Error("Cannot settle("+a+", "+c+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=c;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
0;a<this.onSettledCallbacks_.length;++a)f.asyncExecute(this.onSettledCallbacks_[a]);this.onSettledCallbacks_=null}};var f=new b;e.prototype.settleSameAsPromise_=function(a){var c=this.createResolveAndReject_();a.callWhenSettled_(c.resolve,c.reject)};e.prototype.settleSameAsThenable_=function(a,c){var b=this.createResolveAndReject_();try{a.call(c,b.resolve,b.reject)}catch(l){b.reject(l)}};e.prototype.then=function(a,c){function b(a,c){return"function"==typeof a?function(c){try{d(a(c))}catch(t){f(t)}}:
c}var d,f,g=new e(function(a,c){d=a;f=c});this.callWhenSettled_(b(a,d),b(c,f));return g};e.prototype.catch=function(a){return this.then(void 0,a)};e.prototype.callWhenSettled_=function(a,c){function b(){switch(d.state_){case 1:a(d.result_);break;case 2:c(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?f.asyncExecute(b):this.onSettledCallbacks_.push(b)};e.resolve=d;e.reject=function(a){return new e(function(c,b){b(a)})};e.race=function(a){return new e(function(c,
b){for(var e=$jscomp.makeIterator(a),f=e.next();!f.done;f=e.next())d(f.value).callWhenSettled_(c,b)})};e.all=function(a){var c=$jscomp.makeIterator(a),b=c.next();return b.done?d([]):new e(function(a,e){function f(c){return function(b){g[c]=b;h--;0==h&&a(g)}}var g=[],h=0;do g.push(void 0),h++,d(b.value).callWhenSettled_(f(g.length-1),e),b=c.next();while(!b.done)})};return e},"es6","es3");
$jscomp.polyfill("Promise.prototype.finally",function(a){return a?a:function(a){return this.then(function(b){return Promise.resolve(a()).then(function(){return b})},function(b){return Promise.resolve(a()).then(function(){throw b;})})}},"es9","es3");$jscomp.findInternal=function(a,b,d){a instanceof String&&(a=String(a));for(var c=a.length,e=0;e<c;e++){var f=a[e];if(b.call(d,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,d){return $jscomp.findInternal(this,a,d).v}},"es6","es3");var __extends=this&&this.__extends||function(){var a=function(b,d){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return a(b,d)};return function(b,d){function c(){this.constructor=b}a(b,d);b.prototype=null===d?Object.create(d):(c.prototype=d.prototype,new c)}}(),Controllers;
(function(a){var b=function(){function a(a,b,d,g,h,k){a.title="DIALOGS_ADD_WADO_TITLE";d&&(a.title="DIALOGS_EDIT_WADO_TITLE","string"==typeof d.isDefault&&(d.isDefault="true"==d.isDefault?!0:!1));h("DIALOGS_NOTIFICATION").then(function(a){});h("DIALOGS_ERROR").then(function(a){});a.server=d||new Models.WadoConnection;a.ok=function(){b.close(a.server)};a.cancel=function(){b.dismiss("cancel")}}a.$inject="$scope $modalInstance server blockUI $translate dialogs".split(" ");return a}();a.AddWadoServerController=
b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g){a.item=d||new Models.CodeSequence;a.title=g;a.isFormValid=function(){return a.isCodeValueValid()&&a.isCodeSchemeDesignatorValid()&&a.isCodeMeaningValid()};a.isCodeValueValid=function(){return 0==a.getCodeValueError().length};a.getCodeValueError=function(){var c="",b=a.item.CodeValue.trim();0==b.length&&(c="Value must not be empty.");16<b.length&&(c="Must be less than 16 characters.");return c};a.isCodeSchemeDesignatorValid=function(){return 0==a.getCodeSchemeDesignatorError().length};
a.getCodeSchemeDesignatorError=function(){var c="";16<a.item.CodeSchemeDesignator.trim().length&&(c="Must be less than 16 characters.");return c};a.isCodeMeaningValid=function(){return 0==a.getCodeMeaningError().length};a.getCodeMeaningError=function(){var c="";64<a.item.CodeMeaning.trim().length&&(c="Must be less than 64 characters.");return c};a.ok=function(){b.close(a.item)};a.cancel=function(){b.dismiss("cancel")}}a.$inject=["$scope","$modalInstance","item","title"];return a}();a.CodeSequenceEditorController=
b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g,h,k){d=h.Modality.split("\\");var c=this;this._$scope=a;a.modalities=Utils.get_Modalities();angular.forEach(a.modalities,function(a,c){a.ticked=!1});angular.forEach(d,function(a,b){c.selectModality(a)});a.selectedModalities=[];a.hpDefinition=h;a.extractLaterality=this.extractLaterality.bind(this);a.extractModality=this.extractModality.bind(this);a.extractStudyDescription=this.extractStudyDescription.bind(this);a.extractBodyPartExamined=this.extractBodyPartExamined.bind(this);
a.extractProtocolName=this.extractProtocolName.bind(this);a.deleteSequenceItem=this.deleteSequenceItem.bind(this);a.cancel=function(){b.dismiss("cancel")};a.ok=function(){var c=[];angular.forEach(a.modalities,function(a,b){a.ticked&&c.push(a.name)});h.Modality=c.join("\\");b.close(h)};this.init_grid(a,"PCSOptions","Procedure Code Sequence",DicomHelper.getCodeSequenceList(h.metadata,DicomTag.ProcedureCodeSequence,null),this.PCSSelectionChanged,"ProcedureCodeSequence");this.init_grid(a,"RFROptions",
"Reason For Requested Procedure Code Sequence",DicomHelper.getCodeSequenceList(h.metadata,DicomTag.ReasonForRequestedProcedureCodeSequence,null),this.PCSSelectionChanged,"ReasonForRequestedProcedureCodeSequence");this.init_grid(a,"ARSOptions","Anatomic Region Sequence",DicomHelper.getCodeSequenceList(h.metadata,DicomTag.AnatomicRegionSequence,null),this.ARSSelectionChanged,"AnatomicRegionSequence");this._dataset=k}a.prototype.get_ColumnDefs=function(a){return[{headerName:a,children:[{headerName:"Code Scheme",
field:"CodeSchemeDesignator",width:95,checkboxSelection:!0},{headerName:"Code Value",field:"CodeValue",width:95},{headerName:"Code Meaning",field:"CodeMeaning",width:95},{headerName:"Coding Scheme Version",field:"CodingSchemeVersion",width:125}]}]};a.prototype.init_grid=function(a,b,d,g,h,k){a[b]={groupHeaders:!0,angularCompileHeaders:!0,rowSelection:"multiple",suppressRowClickSelection:!0,enableColResize:!0,columnDefs:this.get_ColumnDefs(d),rowData:g,onGridReady:function(){a[b].api.hideOverlay();
a[b].api.sizeColumnsToFit();this.doSelection(a[b].api,k)}.bind(this),onSelectionChanged:h.bind(this)}};a.prototype.doSelection=function(a,b){var c=this._$scope.hpDefinition[b];c&&0<c.length&&a.forEachNode(function(b,d){var e=b.data;Utils.findFirst(c,function(a){return a.CodeMeaning==e.CodeMeaning&&a.CodeValue==e.CodeValue&&a.CodeSchemeDesignator==e.CodeSchemeDesignator})&&a.selectNode(b)})};a.prototype.ARSSelectionChanged=function(a){this._$scope.hpDefinition.AnatomicRegionSequence=a.selectedRows};
a.prototype.RFRSelectionChanged=function(a){this._$scope.hpDefinition.ReasonForRequestedProcedureCodeSequence=a.selectedRows};a.prototype.PCSSelectionChanged=function(a){this._$scope.hpDefinition.ProcedureCodeSequence=a.selectedRows};a.prototype.extractLaterality=function(){var a=DicomHelper.getDicomTagValue(this._dataset,DicomTag.Laterality);a&&0!=a.length||(a=DicomHelper.getDicomTagValue(this._dataset,DicomTag.ImageLaterality));if(a&&0<a.length)switch(a.toUpperCase()){case "L":this._$scope.hpDefinition.Laterality=
Models.Laterality.Left;break;case "R":this._$scope.hpDefinition.Laterality=Models.Laterality.Right;break;case "B":this._$scope.hpDefinition.Laterality=Models.Laterality.Both;break;case "U":this._$scope.hpDefinition.Laterality=Models.Laterality.Unpaired}};a.prototype.extractModality=function(){var a=DicomHelper.getDicomTagValue(this._dataset,DicomTag.Modality);a&&0<a.length&&this.selectModality(a)};a.prototype.selectModality=function(a){var c=Utils.findFirst(this._$scope.modalities,function(c){return c.name==
a});c&&(c.ticked=!0)};a.prototype.extractStudyDescription=function(){this._$scope.hpDefinition.StudyDescription=DicomHelper.getDicomTagValue(this._dataset,DicomTag.StudyDescription)};a.prototype.deleteSequenceItem=function(a){var c=a.api.getSelectedNodes();0<c.length&&(c=a.rowData.indexOf(c[0].data),a.rowData.splice(c,1),a.api.setRowData(a.rowData))};a.prototype.extractBodyPartExamined=function(){this._$scope.hpDefinition.BodyPartExamined=DicomHelper.getDicomTagValue(this._dataset,DicomTag.BodyPartExamined)};
a.prototype.extractProtocolName=function(){this._$scope.hpDefinition.ProtocolName=DicomHelper.getDicomTagValue(this._dataset,DicomTag.ProtocolName)};a.$inject="$scope $modalInstance $translate authenticationService hpDefinition dataset".split(" ");return a}();a.HPDefinitionSequenceDialogControllerScope=b})(Controllers||(Controllers={}));
(function(a){var b=function(){return function(a,c){this.name=a;this.code=c}}();a.Tag=b;b=function(){function b(a,b,d,g,h,k,l,m,p){this._activeStepIndex=-1;this.multiValueVR="AT CS IS LO PN SH DS FD FL UL US SL SS".split(" ");var c=this;a.steps=[{templateUrl:"views/dialogs/HangingProtocol-Step1.html",title:"Definition"},{templateUrl:"views/dialogs/HangingProtocol-Step2.html",title:"Selection Criteria"},{templateUrl:"views/dialogs/HangingProtocol-Step3.html",title:"Image/Series Selection"},{templateUrl:"views/dialogs/HangingProtocol-Step4.html",
title:"Display Sets"}];this._$modal=k;this._$scope=a;this._dataset=h;this._$translate=d;this._dialogs=p;a.selectedDisplaySetChanged=this.selectedDisplaySetChanged.bind(this);a.selectedImageSetChanged=this.selectedImageSetChanged.bind(this);g.getRoles().success(function(c){a.roles=c.GetRolesResult;null!=a.roles&&0<a.roles.length&&(a.selectedRole=a.roles[0],a.hp.HangingProtocolUserGroupName=a.selectedRole.Name)}).error(function(a){});a.hp=l;a.objectStoreService=m;this.init_HangingProtocolDefinitionGrid(a);
this.init_ImageSetSelectorGrid(a);this.init_TimeBasedImageSetSelectorGrid(a);this.init_FilterOperationsGrid(a);a.selectedRoleChanged=this.selectedRoleChanged.bind(this);a.selectedLevelChanged=this.selectedLevelChanged.bind(this);a.editHPDefinition=this.editHPDefinition.bind(this);a.deleteHPDefinition=this.deleteHPDefinition.bind(this);a.isHPDefinitionSelected=this.isHPDefinitionSelected.bind(this);a.addImageSetSelector=this.addImageSetSelector.bind(this);a.editImageSetSelector=this.editImageSetSelector.bind(this);
a.deleteImageSetSelector=this.deleteImageSetSelector.bind(this);a.isImageSetSelectorSelected=this.isImageSetSelectorSelected.bind(this);a.editTimeBasedImageSets=this.editTimeBasedImageSets.bind(this);a.isTimeBasedImageSetsSelected=this.isTimeBasedImageSetsSelected.bind(this);a.addFilterOperation=this.addFilterOperation.bind(this);a.editFilterOperation=this.editFilterOperation.bind(this);a.mergeFilterOperation=this.mergeFilterOperation.bind(this);a.cloneFilterOperation=this.cloneFilterOperation.bind(this);
a.canMergeFilterOperation=this.canMergeFilterOperation.bind(this);a.deleteFilterOperation=this.deleteFilterOperation.bind(this);a.deleteSimilarFilterOperations=this.deleteSimilarFilterOperations.bind(this);a.isFilterOperationSelected=this.isFilterOperationSelected.bind(this);a.isHangingProtocolNameValid=this.isHangingProtocolNameValid.bind(this);a.getHangingProtocolNameError=this.getHangingProtocolNameError.bind(this);a.isHangingProtocolDescriptionValid=this.isHangingProtocolDescriptionValid.bind(this);
a.isLevelUserGroup=this.isLevelUserGroup.bind(this);a.getHangingProtocolDescriptionError=this.getHangingProtocolDescriptionError.bind(this);a.isFormValid=this.isFormValid.bind(this);a.addMultipleTags=this.addMultipleTags.bind(this);a.addMulitipleImageSetTags=this.addMulitipleImageSetTags.bind(this);a.editImageSetLabel=this.editImageSetLabel.bind(this);a.editDisplaySetLabel=this.editDisplaySetLabel.bind(this);a.falseFunction=this.falseFunction.bind(this);a.trueFunction=this.trueFunction.bind(this);
a.saveHangingProtocol=this.saveHangingProtocol.bind(this);a.getButtonStyle=this.getButtonStyle.bind(this);a.isAdmin=function(){return g.permissions.isAdmin};this.setHangingProtocolLevelOptions();a.modalities=Utils.get_Modalities();0<l.DisplaySets.length&&this.selectedDisplaySetChanged(l.DisplaySets[0]);0<l.ImageSetsSequence.length&&this.selectedImageSetChanged(l.ImageSetsSequence[0]);a.onStepChange=function(){var a=c._$scope.selectedDisplaySet.cell;c._activeStepIndex=this.$getActiveIndex();4==c._activeStepIndex?
a.viewer.layout.highlightedItems.add(a):a.viewer.layout.highlightedItems.clear()};a.filterByImageSetNumber=function(){return function(a){return-1!=a.ImageSetNumber}}}b.prototype.selectedLevelChanged=function(){};b.prototype.selectedRoleChanged=function(a){this._$scope.hp.HangingProtocolUserGroupName=a.Name};b.prototype.editHPDefinition=function(){var c=this,b;this._$modal.open({templateUrl:"views/dialogs/HangingProtocolDefinitionSequence.html",controller:a.HPDefinitionSequenceDialogControllerScope,
backdrop:"static",resolve:{hpDefinition:function(){var a=c._$scope.HPPDOptions.api.getSelectedNodes();return 0<a.length?(b=a[0].data,angular.copy(b)):null},dataset:function(){return c._dataset}}}).result.then(function(a){if("equal"!=Utils.diff(b,a).changed){var d=c._$scope.HPPDOptions.rowData.indexOf(b);-1!=d&&(c._$scope.HPPDOptions.rowData[d]=a,c._$scope.HPPDOptions.api.setRowData(c._$scope.HPPDOptions.rowData),c._$scope.HPPDOptions.api.selectIndex(d))}})};b.prototype.deleteHPDefinition=function(){var a=
this._$scope.HPPDOptions.api.getSelectedNodes();0<a.length&&(a=this._$scope.HPPDOptions.rowData.indexOf(a[0].data),this._$scope.HPPDOptions.rowData.splice(a,1),this._$scope.HPPDOptions.api.setRowData(this._$scope.HPPDOptions.rowData))};b.prototype.isHPDefinitionSelected=function(){return angular.isDefined(this._$scope.HPPDOptions.api)&&0<this._$scope.HPPDOptions.api.getSelectedNodes().length};b.prototype.addImageSetSelector=function(){var c=this;this._$translate("DIALOGS_IMAGESET_SELECTOR_ADD_TITLE").then(function(b){this._$modal.open({templateUrl:"views/dialogs/HPImageSetSelectorEditor.html",
controller:a.HPImageSetSelectorEditorController,backdrop:"static",resolve:{item:function(){var a=new Models.ImageSetSelector;a.SelectorValueNumber=1;a.ImageSetSelectorUsageFlag=Models.ImageSetSelectorUsage.NoMatch;return a},title:function(){return b},dicom:function(){return c._$scope.selectedImageSet.metadata},currentTags:function(){return c.get_currentSelectorTags()}}}).result.then(function(a){c._$scope.HPImageSetSelectorOptions.rowData||(c._$scope.HPImageSetSelectorOptions.rowData=[]);c._$scope.HPImageSetSelectorOptions.rowData.push(a);
c._$scope.HPImageSetSelectorOptions.api.onNewRows();c._$scope.HPImageSetSelectorOptions.api.selectIndex(c._$scope.HPImageSetSelectorOptions.rowData.indexOf(a))})}.bind(this))};b.prototype.editImageSetSelector=function(){var c=this,b;this._$translate("DIALOGS_IMAGESET_SELECTOR_EDIT_TITLE").then(function(d){this._$modal.open({templateUrl:"views/dialogs/HPImageSetSelectorEditor.html",controller:a.HPImageSetSelectorEditorController,backdrop:"static",resolve:{item:function(){b=c._$scope.HPImageSetSelectorOptions.api.getSelectedNodes()[0].data;
return angular.copy(b)},title:function(){return d},dicom:function(){return c._$scope.selectedImageSet.metadata},currentTags:function(){return c.get_currentSelectorTags()}}}).result.then(function(a){if("equal"!=Utils.diff(b,a).changed){var d=c._$scope.HPImageSetSelectorOptions.rowData.indexOf(b);-1!=d&&(c._$scope.HPImageSetSelectorOptions.rowData[d]=a,c._$scope.HPImageSetSelectorOptions.api.setRowData(c._$scope.HPImageSetSelectorOptions.rowData),c._$scope.HPImageSetSelectorOptions.api.selectIndex(d))}})}.bind(this))};
b.prototype.editTimeBasedImageSets=function(){var c=this,b;this._$translate("DIALOGS_TIME_BASED_IMAGE_SETS_EDIT_TITLE").then(function(d){this._$modal.open({templateUrl:"views/dialogs/HPTimeBasedImageSetsEditor.html",controller:a.HPTimeBasedImageSetsEditorController,backdrop:"static",resolve:{item:function(){b=c._$scope.HPTimeBasedImageSetsOptions.api.getSelectedNodes()[0].data;return angular.copy(b)},title:function(){return d}}}).result.then(function(a){if("equal"!=Utils.diff(b,a).changed){var d=
c._$scope.HPTimeBasedImageSetsOptions.rowData.indexOf(b);-1!=d&&(c._$scope.HPTimeBasedImageSetsOptions.rowData[d]=a,c._$scope.HPTimeBasedImageSetsOptions.api.setRowData(c._$scope.HPTimeBasedImageSetsOptions.rowData),c._$scope.HPTimeBasedImageSetsOptions.api.selectIndex(d))}})}.bind(this))};b.prototype.deleteImageSetSelector=function(){var a=this._$scope.HPImageSetSelectorOptions.api.getSelectedNodes();0<a.length&&(a=this._$scope.HPImageSetSelectorOptions.rowData.indexOf(a[0].data),this._$scope.HPImageSetSelectorOptions.rowData.splice(a,
1),this._$scope.HPImageSetSelectorOptions.api.setRowData(this._$scope.HPImageSetSelectorOptions.rowData))};b.prototype.isImageSetSelectorSelected=function(){return angular.isDefined(this._$scope.HPImageSetSelectorOptions.api)&&0<this._$scope.HPImageSetSelectorOptions.api.getSelectedNodes().length};b.prototype.isTimeBasedImageSetsSelected=function(){return angular.isDefined(this._$scope.HPTimeBasedImageSetsOptions.api)&&0<this._$scope.HPTimeBasedImageSetsOptions.api.getSelectedNodes().length};b.prototype.addFilterOperation=
function(){var c=this;this._$translate("DIALOGS_FILTER_OPERATION_ADD_TITLE").then(function(b){this._$modal.open({templateUrl:"views/dialogs/DSFilterOperationEditor.html",controller:a.DSFilterOperationEditorController,backdrop:"static",resolve:{item:function(){var a=new Models.FilterOperation;a.SelectorValueNumber=1;a.FilterByOperator=Models.FilterByOperator.MemberOf;return a},title:function(){return b},dicom:function(){return c._$scope.selectedDisplaySet.metadata},currentTags:function(){return c.get_currentFilterOperationTags()}}}).result.then(function(a){c._$scope.DSFilterOperationsOptions.rowData||
(c._$scope.DSFilterOperationsOptions.rowData=[]);c._$scope.DSFilterOperationsOptions.rowData.push(a);c._$scope.DSFilterOperationsOptions.api.onNewRows();c._$scope.DSFilterOperationsOptions.api.selectIndex(c._$scope.DSFilterOperationsOptions.rowData.indexOf(a))})}.bind(this))};b.prototype.addMultipleTags=function(){var a=this;this.select_tags(function(c){a._$scope.DSFilterOperationsOptions.rowData||(a._$scope.DSFilterOperationsOptions.rowData=[]);for(var b=0;b<c.length;b++){var d=new Models.FilterOperation,
e=c[b];d.SelectorName=e.name;d.WCFSelectorAttribute=e.tag;d.SelectorValueNumber=1;d.FilterByOperator=Models.FilterByOperator.MemberOf;d.ImageSetSelectorUsageFlag=Models.ImageSetSelectorUsage.Match;e.isCodeSequence?(d.WCFSelectorSequencePointer=e.selectorSequencePointer,d.WCFSelectorSequencePointerItems=e.selectorSequencePointerItems,d.SelectorCodeSequenceValue=DicomHelper.getCodeSequenceList(a._$scope.selectedDisplaySet.metadata,e.selectorSequencePointer,e.selectorSequencePointerItems),d.SelectorValue=
d.SelectorCodeSequenceValue&&0<d.SelectorCodeSequenceValue.length?d.SelectorCodeSequenceValue[0].toFullString():""):(d.SelectorValue=e.value,d.SelectorAttributeVr=e.vr,d.SelectorCodeSequenceValue=void 0,d.SelectorValueNumber=1,d.FilterByOperator=Models.FilterByOperator.MemberOf,e.selectorSequencePointer?(d.WCFSelectorSequencePointer=e.selectorSequencePointer,d.SequencePointerName=e.sequencePointerName,d.WCFSelectorSequencePointerItems=e.selectorSequencePointerItems):(d.WCFSelectorSequencePointer=
"",delete d.SequencePointerName));null!=d.SelectorValue&&0<d.SelectorValue.trim().length&&a._$scope.DSFilterOperationsOptions.rowData.push(d)}a._$scope.DSFilterOperationsOptions.api.onNewRows()},this.get_currentFilterOperationTags())};b.prototype.addMulitipleImageSetTags=function(){var a=this;this.select_tags(function(c){a._$scope.HPImageSetSelectorOptions.rowData||(a._$scope.HPImageSetSelectorOptions.rowData=[]);for(var b=0;b<c.length;b++){var d=new Models.ImageSetSelector,e=c[b];d.SelectorName=
e.name;d.WCFSelectorAttribute=e.tag;e.isCodeSequence?(d.WCFSelectorSequencePointer="",d.SelectorCodeSequenceValue=DicomHelper.getCodeSequenceList(a._$scope.selectedImageSet.metadata,e.tag.replace(":",""),null),d.SelectorValue=d.SelectorCodeSequenceValue&&0<d.SelectorCodeSequenceValue.length?d.SelectorCodeSequenceValue[0].toFullString():""):(d.ImageSetSelectorUsageFlag=Models.ImageSetSelectorUsage.Match,d.SelectorValue=e.value,d.SelectorValueNumber=1,d.SelectorCodeSequenceValue=void 0,e.selectorSequencePointer?
(d.WCFSelectorSequencePointer=e.selectorSequencePointer,d.SequencePointerName=e.sequencePointerName):(d.WCFSelectorSequencePointer="",delete d.SequencePointerName));a._$scope.HPImageSetSelectorOptions.rowData.push(d)}a._$scope.HPImageSetSelectorOptions.api.onNewRows()},this.get_currentSelectorTags())};b.prototype.get_currentFilterOperationTags=function(){var a=[];this._$scope.DSFilterOperationsOptions.api.forEachNode(function(c,b){a.push(c.data.WCFSelectorAttribute)});return a};b.prototype.get_currentSelectorTags=
function(){var a=[];this._$scope.HPImageSetSelectorOptions.api.forEachNode(function(c,b){a.push(c.data.WCFSelectorAttribute)});return a};b.prototype.select_tags=function(c,b){var d=this;this._$modal.open({templateUrl:"views/dialogs/TagChooserDialog.html",controller:a.TagChooserController,backdrop:"static",resolve:{dicom:function(){return d._$scope.selectedDisplaySet.metadata},selector:function(){return null},currentTags:function(){return b}}}).result.then(function(a){c(a)})};b.prototype.editFilterOperation=
function(){var c=this,b;this._$translate("DIALOGS_FILTER_OPERATION_EDIT_TITLE").then(function(d){this._$modal.open({templateUrl:"views/dialogs/DSFilterOperationEditor.html",controller:a.DSFilterOperationEditorController,backdrop:"static",resolve:{item:function(){b=c._$scope.DSFilterOperationsOptions.api.getSelectedNodes()[0].data;return angular.copy(b)},title:function(){return d},dicom:function(){return c._$scope.selectedDisplaySet.metadata},currentTags:function(){return c.get_currentSelectorTags()}}}).result.then(function(a){if("equal"!=
Utils.diff(b,a).changed){var d=c._$scope.DSFilterOperationsOptions.rowData.indexOf(b);-1!=d&&(c._$scope.DSFilterOperationsOptions.rowData[d]=a,c._$scope.DSFilterOperationsOptions.api.setRowData(c._$scope.DSFilterOperationsOptions.rowData),c._$scope.DSFilterOperationsOptions.api.selectIndex(d))}})}.bind(this))};b.prototype.deleteFilterOperation=function(){var a=this._$scope.DSFilterOperationsOptions.api.getSelectedNodes();0<a.length&&(a=this._$scope.DSFilterOperationsOptions.rowData.indexOf(a[0].data),
this._$scope.DSFilterOperationsOptions.rowData.splice(a,1),this._$scope.DSFilterOperationsOptions.api.setRowData(this._$scope.DSFilterOperationsOptions.rowData))};b.prototype.deleteSimilarFilterOperations=function(){var a=this._$scope.hp,b=this._$scope.DSFilterOperationsOptions.api.getSelectedNodes();if(0<b.length){b=b[0].data;var d=this._$scope.DSFilterOperationsOptions.rowData.indexOf(b);a.deleteSimilarFilterOperations(b);this._$scope.DSFilterOperationsOptions.api.refreshView();-1!=d&&this._$scope.DSFilterOperationsOptions.api.setRowData(this._$scope.DSFilterOperationsOptions.rowData)}};
b.prototype.cloneFilterOperation=function(){var a=this._$scope.hp,b=this._$scope.DSFilterOperationsOptions.api.getSelectedNodes();0<b.length&&(a.cloneFilterOperation(b[0].data),a.sortFilterOperations())};b.prototype.mergeFilterOperation=function(){var a=this._$scope.hp,b=this._$scope.DSFilterOperationsOptions.api.getSelectedNodes();if(0<b.length){b=b[0].data;var d=this._$scope.DSFilterOperationsOptions.rowData.indexOf(b);a.mergeFilterOperationValues(b)}-1!=d&&this._$scope.DSFilterOperationsOptions.api.setRowData(this._$scope.DSFilterOperationsOptions.rowData)};
b.prototype.canMergeFilterOperation=function(){var a=!1,b=this._$scope.DSFilterOperationsOptions.api.getSelectedNodes();0<b.length&&(a=b[0].data,a=null!=a.SelectorAttributeVr?-1!=this.multiValueVR.indexOf(a.SelectorAttributeVr):!0);return a};b.prototype.falseFunction=function(){return!1};b.prototype.trueFunction=function(){return!0};b.prototype.saveHangingProtocol=function(){var a=Utils.myclone(this._$scope.hp,["cell","metadata"]),b=this._dialogs,d;this._$translate("NOTIFY_SAVE_HP_SUCCESS").then(function(a){d=
a});var g=a.HangingProtocolName+" ("+a.HangingProtocolDescription+")";this._$scope.objectStoreService.StoreHangingProtocol(a).success(function(a){angular.isDefined(a.FaultType)?alert(a.Message):b.notify(d,g)}).error(function(a){alert(a)})};b.prototype.getButtonStyle=function(){return"color: grey"};b.prototype.isFilterOperationSelected=function(){return angular.isDefined(this._$scope.DSFilterOperationsOptions.api)&&0<this._$scope.DSFilterOperationsOptions.api.getSelectedNodes().length};b.prototype.isHangingProtocolNameValid=
function(){var a=this.getHangingProtocolNameError();return Utils.isStringEmpty(a)};b.prototype.getHangingProtocolNameError=function(){var a="",b=this._$scope.hp.HangingProtocolName;Utils.isStringEmpty(b)&&(a="Must have a value.");16<b.trim().length&&(a="Must be 1 to 16 characters.");return a};b.prototype.isHangingProtocolDescriptionValid=function(){var a=this.getHangingProtocolDescriptionError();return Utils.isStringEmpty(a)};b.prototype.isLevelUserGroup=function(){return this._$scope.hp.HangingProtocolLevel==
Models.HangingProtocolLevel.UserGroup};b.prototype.getHangingProtocolDescriptionError=function(){var a="",b=this._$scope.hp.HangingProtocolDescription;Utils.isStringEmpty(b)&&(a="Must have a value.");64<b.trim().length&&(a="Must be 1 to 64 characters.");return a};b.prototype.isFormValid=function(){return this.isHangingProtocolNameValid()&&this.isHangingProtocolDescriptionValid()};b.prototype.init_HangingProtocolDefinitionGrid=function(a){a.HPPDOptions={groupHeaders:!0,angularCompileHeaders:!0,rowSelection:"single",
enableColResize:!0,columnDefs:[{headerName:"Modality",field:"Modality",width:75},{headerName:"Study Description",field:"StudyDescription",width:150},{headerName:"Anatomic Region Sequence",field:"AnatomicRegionSequence",cellRenderer:this.codeSequenceRenderer.bind(this),width:200},{headerName:"Laterality",field:"Laterality",width:100,cellRenderer:this.lateralityRenderer.bind(this)},{headerName:"Procedure Code Sequence",field:"ProcedureCodeSequence",cellRenderer:this.codeSequenceRenderer.bind(this),
width:200},{headerName:"Reason for Requested Procedure",field:"ReasonForRequestedProcedureCodeSequence",cellRenderer:this.codeSequenceRenderer.bind(this),width:200},{headerName:"Body Part Examined",field:"BodyPartExamined",width:200},{headerName:"Protocol Name",field:"ProtocolName",width:200}],rowData:a.hp.HangingProtocolDefinitionSequence,onGridReady:function(){a.HPPDOptions.api.hideOverlay();a.HPPDOptions.rowData&&0<a.HPPDOptions.rowData.length&&a.HPPDOptions.api.selectIndex(0)}}};b.prototype.init_TimeBasedImageSetSelectorGrid=
function(a){a.HPTimeBasedImageSetsOptions={groupHeaders:!0,angularCompileHeaders:!0,rowSelection:"single",enableColResize:!0,suppressNoRowsOverlay:!0,columnDefs:[{headerName:"Time Based Image Sets",children:[{headerName:"#",field:"ImageSetNumber",width:50},{headerName:"Label",field:"ImageSetLabel",width:100},{headerTooltip:"Selector Category",headerName:"Image Set Selector Category",field:"ImageSetSelectorCategory",width:115,cellRenderer:this.imageSetSelectorCategoryRenderer},{headerName:"Relative Time",
field:"RelativeTime",width:110},{headerName:"Relative Time Units",field:"RelativeTimeUnits",width:165,cellRenderer:this.relativeTimeUnitsRenderer},{headerName:"Abstract Prior Value",field:"AbstractPriorValue",width:175},{headerName:"Study Date",field:"StudyDateTime",width:175}]}],rowData:[],onGridReady:function(){a.HPTimeBasedImageSetsOptions.api.hideOverlay()}}};b.prototype.init_ImageSetSelectorGrid=function(a){a.HPImageSetSelectorOptions={groupHeaders:!0,angularCompileHeaders:!0,rowSelection:"single",
enableColResize:!0,suppressNoRowsOverlay:!0,columnDefs:[{headerName:"Image Set Selector",children:[{headerName:"Usage",field:"ImageSetSelectorUsageFlag",width:75,cellRenderer:this.selectorUsageRenderer},{headerName:"Attribute",field:"WCFSelectorAttribute",width:95},{headerName:"Tag Name",field:"SelectorName",width:95},{headerName:"Value",field:"SelectorValue",width:95},{headerName:"Value Index",field:"SelectorValueNumber",width:95},{headerName:"Selector Sequence Pointer",field:"WCFSelectorSequencePointer",
width:215},{headerName:"Sequence Pointer Name",field:"SequencePointerName",width:180}]}],rowData:[],onGridReady:function(){a.HPImageSetSelectorOptions.api.hideOverlay()}}};b.prototype.init_FilterOperationsGrid=function(a){a.DSFilterOperationsOptions={groupHeaders:!0,angularCompileHeaders:!0,rowSelection:"single",enableColResize:!0,suppressNoRowsOverlay:!0,columnDefs:[{headerName:"Filter Operations",children:[{headerName:"Usage",field:"ImageSetSelectorUsageFlag",width:75,cellRenderer:this.selectorUsageRenderer},
{headerName:"Attribute",field:"WCFSelectorAttribute",width:95},{headerName:"Tag Name",field:"SelectorName",width:95},{headerName:"Value",field:"SelectorValue",width:150},{headerName:"Value Index",field:"SelectorValueNumber",width:95},{headerName:"Filter By Operator",field:"FilterByOperator",width:125,cellRenderer:this.filterByOperatorRenderer},{headerName:"Selector Sequence Pointer",field:"WCFSelectorSequencePointer",width:180},{headerName:"Selector Sequence Pointer Items",field:"WCFSelectorSequencePointerItems",
width:180},{headerName:"Sequence Pointer Name",field:"SequencePointerName",width:180}]}],rowData:[],onGridReady:function(){a.DSFilterOperationsOptions.api.hideOverlay();a.DSFilterOperationsOptions.api.setRowData(a.selectedDisplaySet.FilterOperationsSequence)}}};b.prototype.imageSetSelectorCategoryRenderer=function(a){switch(parseInt(a.data.ImageSetSelectorCategory)){case Models.ImageSetSelectorCategory.AbstractPrior:return"Abstract Prior";case Models.ImageSetSelectorCategory.RelativeTime:return"Relative Time"}return""};
b.prototype.relativeTimeUnitsRenderer=function(a){switch(parseInt(a.data.RelativeTimeUnits)){case Models.RelativeTimeUnits.Days:return"Days";case Models.RelativeTimeUnits.Hours:return"Hours";case Models.RelativeTimeUnits.Minutes:return"Minutes";case Models.RelativeTimeUnits.Months:return"Months";case Models.RelativeTimeUnits.Seconds:return"Seconds";case Models.RelativeTimeUnits.Weeks:return"Weeks";case Models.RelativeTimeUnits.Years:return"Years"}return""};b.prototype.selectorUsageRenderer=function(a){switch(parseInt(a.data.ImageSetSelectorUsageFlag)){case Models.ImageSetSelectorUsage.Match:return"Match";
case Models.ImageSetSelectorUsage.NoMatch:return"No Match"}return""};b.prototype.filterByOperatorRenderer=function(a){switch(parseInt(a.data.FilterByOperator)){case Models.FilterByOperator.GreaterOrEqual:return"Greater Or Equal";case Models.FilterByOperator.GreaterThan:return"Greater Than";case Models.FilterByOperator.LessOrEqual:return"Less Or Equal";case Models.FilterByOperator.LessThan:return"Less Than";case Models.FilterByOperator.MemberOf:return"Member Of";case Models.FilterByOperator.NotMemberOf:return"Not Member Of";
case Models.FilterByOperator.RangeExclusive:return"Range Exclusive";case Models.FilterByOperator.RangeInclusive:return"Range Inclusive"}return""};b.prototype.lateralityRenderer=function(a){a=a.data;if(!a.Laterality)return"";switch(parseInt(a.Laterality.toString())){case Models.Laterality.Both:return"Both";case Models.Laterality.Left:return"Left";case Models.Laterality.Right:return"Right";case Models.Laterality.Unpaired:return"Unpaired"}return""};b.prototype.codeSequenceRenderer=function(a){var c=
a.data;return c[a.colDef.field]&&0<c[a.colDef.field].length?this.get_CodeSequenceString(c[a.colDef.field]):""};b.prototype.get_CodeSequenceString=function(a){for(var c="",b=0;b<a.length;b++)c+=a[b].toFullString(),b+1<a.length&&(c+=", ");return c};b.prototype.selectedDisplaySetChanged=function(a){var c=a.cell;c&&4==this._activeStepIndex&&(c.viewer.layout.highlightedItems.clear(),c.viewer.layout.highlightedItems.add(c));angular.isDefined(this._$scope.DSFilterOperationsOptions.api)&&this._$scope.DSFilterOperationsOptions.api.setRowData(a.FilterOperationsSequence);
this._$scope.selectedDisplaySet=a};b.prototype.selectedImageSetChanged=function(a){a&&(this._$scope.HPImageSetSelectorOptions.api?(this._$scope.HPImageSetSelectorOptions.api.setRowData(a.ImageSetSelectorSequence),this._$scope.HPTimeBasedImageSetsOptions.api.sizeColumnsToFit(),this._$scope.HPTimeBasedImageSetsOptions.api.setRowData(a.TimeBasedImageSetsSequence),this._$scope.HPTimeBasedImageSetsOptions.api.sizeColumnsToFit()):(this._$scope.HPImageSetSelectorOptions.rowData=a.ImageSetSelectorSequence,
this._$scope.HPTimeBasedImageSetsOptions.rowData=a.TimeBasedImageSetsSequence));this._$scope.selectedImageSet=a};b.prototype.editImageSetLabel=function(){var c=this;this._$modal.open({templateUrl:"views/dialogs/Prompt.html",controller:a.PromptController,backdrop:"static",resolve:{label:function(){return"Image Set Label"},text:function(){return c._$scope.selectedImageSet.Name}}}).result.then(function(a){a!=c._$scope.selectedImageSet.Name&&(c._$scope.selectedImageSet.Name=a)})};b.prototype.editDisplaySetLabel=
function(){var c=this;this._$modal.open({templateUrl:"views/dialogs/Prompt.html",controller:a.PromptController,backdrop:"static",resolve:{label:function(){return"Display Set Label"},text:function(){return c._$scope.selectedDisplaySet.DisplaySetLabel}}}).result.then(function(a){var b=Utils.findFirst(c._$scope.hp.ImageSetsSequence,function(a){return Utils.findFirst(a.TimeBasedImageSetsSequence,function(a){return a.ImageSetNumber==c._$scope.selectedDisplaySet.ImageSetNumber})?!0:!1});a!=c._$scope.selectedDisplaySet.DisplaySetLabel&&
0<a.length&&(c._$scope.selectedDisplaySet.DisplaySetLabel=a,c._$scope.selectedDisplaySet.CombinedName=a+" - "+b.Name)})};b.prototype.setHangingProtocolLevelOptions=function(){this._$scope.hangingProtocolLevelOptions=[];this._$scope.isAdmin()&&(this._$scope.hangingProtocolLevelOptions.push(new Models.DropDownItem(0,"Manufacturer")),this._$scope.hangingProtocolLevelOptions.push(new Models.DropDownItem(1,"Site")),this._$scope.hangingProtocolLevelOptions.push(new Models.DropDownItem(2,"User Group")));
this._$scope.hangingProtocolLevelOptions.push(new Models.DropDownItem(3,"Single User"));this._$scope.hp.HangingProtocolLevel=Models.HangingProtocolLevel.SingleUser};b.$inject="$scope $modalInstance $translate authenticationService dataset $modal hp objectStoreService dialogs".split(" ");return b}();a.HPDialogControllerScope=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g,h,k){a.title=k;a.label=d;a.input={spacing:parseInt(g),length:parseInt(h)};a.cancel=function(){b.dismiss("cancel")};a.ok=function(){b.close({spacing:a.input.spacing,length:a.input.length})}}a.$inject="$scope $modalInstance label spacing length title".split(" ");return a}();a.GridSettingsController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function b(a,b,d,g,h,k,l){a.operation=g;a.title=h;a.filterByOperatorList=[{value:6,text:"Member Of"},{value:7,text:"Not Member Of"}];this._$scope=a;this._$modal=b;this._dicom=k;this._currentTags=l;a.chooseTag=this.chooseTag.bind(this);a.isSequence=this.isSequence.bind(this);a.isMprPlane=this.isMprPlane.bind(this);a.editCodeSequence=this.editCodeSequence.bind(this);a.isFormValid=function(){return this.isSelectorValueValid()&&this.isSelectorIndexValid()};a.initializeFilterByOperatorList=
this.initializeFilterByOperatorList.bind(this);a.ok=function(){d.close(a.operation)};a.cancel=function(){d.dismiss("cancel")};a.isMprPlane=function(){return"IMAGE_PLANE"==a.operation.FilterByCategory};a.isSelectorAttributeValid=function(){return 0==this.getSelectorAttributeError().length};a.getSelectorAttributeError=function(){var c="";0==a.operation.WCFSelectorAttribute.trim().length&&(c="Value must not be empty.");return c};a.isSelectorValueValid=function(){return 0==this.getSelectorValueError().length};
a.getSelectorValueError=function(){a.operation.SelectorValue.split("\\",5).filter(function(a){return 0!=a.length});a.operation.SelectorValue.split("\\",5);var c="";switch(a.operation.FilterByOperator){case Models.FilterByOperator.RangeInclusive:c=this.verifyCount(a.operation.SelectorValue,2);0==c.length&&(c=Utils.verifyNumeric(a.operation.SelectorValue,2));0==c.length&&(c=this.verifyInequality(a.operation.SelectorValue,!0));break;case Models.FilterByOperator.RangeExclusive:c=this.verifyCount(a.operation.SelectorValue,
2);0==c.length&&(c=Utils.verifyNumeric(a.operation.SelectorValue,2));0==c.length&&(c=this.verifyInequality(a.operation.SelectorValue,!1));break;case Models.FilterByOperator.GreaterOrEqual:c=this.verifyCount(a.operation.SelectorValue,1);0==c.length&&(c=Utils.verifyNumeric(a.operation.SelectorValue,1));break;case Models.FilterByOperator.GreaterThan:c=this.verifyCount(a.operation.SelectorValue,1);0==c.length&&(c=Utils.verifyNumeric(a.operation.SelectorValue,1));break;case Models.FilterByOperator.LessOrEqual:c=
this.verifyCount(a.operation.SelectorValue,1);0==c.length&&(c=Utils.verifyNumeric(a.operation.SelectorValue,1));break;case Models.FilterByOperator.LessThan:c=this.verifyCount(a.operation.SelectorValue,1);0==c.length&&(c=Utils.verifyNumeric(a.operation.SelectorValue,1));break;case Models.FilterByOperator.MemberOf:c=this.verifyCount(a.operation.SelectorValue,0);break;case Models.FilterByOperator.NotMemberOf:c=this.verifyCount(a.operation.SelectorValue,0)}0==c.length&&Utils.isNumericVr(a.operation.SelectorAttributeVr)&&
(c=Utils.verifyNumeric(a.operation.SelectorValue,0));return c};a.verifyCount=this.verifyCount.bind(this);a.verifyInequality=this.verifyInequality.bind(this);a.isSelectorIndexValid=this.isSelectorIndexValid.bind(this);a.getSelectorIndexError=this.getSelectorIndexError.bind(this);this.initializeFilterByOperatorList()}b.prototype.verifyInequality=function(a,b){var c="",d=a.split("\\",5).filter(function(a){return 0!=a.length});2!=d.length&&(c="Must have exactly two values. (Example: 1\\3)");a=parseFloat(d[0]);
if(isNaN(a))return"First value is not a number.";d=parseFloat(d[1]);if(isNaN(d))return"Second value is not a number.";b?a>d&&(c="First value must be less than or equal to Second value. (Example: 1\\3)"):a>=d&&(c="First value must be less than Second value. (Example: 1\\3)");return c};b.prototype.verifyCount=function(a,b){return Utils.verifySelectorCount(a,b)};b.prototype.initializeFilterByOperatorList=function(){this.isMprPlane()||!Utils.isNumericVr(this._$scope.operation.SelectorAttributeVr)?this._$scope.filterByOperatorList=
[{value:6,text:"Member Of"},{value:7,text:"Not Member Of"}]:this._$scope.filterByOperatorList=[{value:0,text:"Range Inclusive"},{value:1,text:"Range Exclusive"},{value:2,text:"Greater Or Equal"},{value:3,text:"Less Or Equal"},{value:4,text:"Greater Than"},{value:5,text:"Less Than"},{value:6,text:"Member Of"},{value:7,text:"Not Member Of"}]};b.prototype.chooseTag=function(){var c=this;this._$modal.open({templateUrl:"views/dialogs/TagChooserDialog.html",controller:a.TagChooserController,backdrop:"static",
resolve:{dicom:function(){return c._dicom},selector:function(){return c._$scope.operation},currentTags:function(){return c._currentTags}}}).result.then(function(a){var b=a.tag==c._$scope.operation.WCFSelectorAttribute;b&&a.hasOwnProperty("selectorSequencePointerItems")&&(b=c._$scope.operation.WCFSelectorSequencePointerItems==a.selectorSequencePointerItems);b||(c._$scope.operation.SelectorName=a.name,c._$scope.operation.WCFSelectorAttribute=a.tag,a.isCodeSequence?(c._$scope.operation.WCFSelectorSequencePointer=
a.selectorSequencePointer,c._$scope.operation.WCFSelectorSequencePointerItems=a.selectorSequencePointerItems,c._$scope.operation.SelectorCodeSequenceValue=DicomHelper.getCodeSequenceList(c._dicom,a.selectorSequencePointer,a.selectorSequencePointerItems),c._$scope.operation.SelectorValue=c._$scope.operation.SelectorCodeSequenceValue&&0<c._$scope.operation.SelectorCodeSequenceValue.length?c._$scope.operation.SelectorCodeSequenceValue[0].toFullString():""):(c._$scope.operation.SelectorValue=a.value,
c._$scope.operation.SelectorAttributeVr=a.vr,c._$scope.operation.SelectorCodeSequenceValue=void 0,a.selectorSequencePointer?(c._$scope.operation.WCFSelectorSequencePointer=a.selectorSequencePointer,c._$scope.operation.SequencePointerName=a.sequencePointerName,c._$scope.operation.WCFSelectorSequencePointerItems=a.selectorSequencePointerItems):(c._$scope.operation.WCFSelectorSequencePointer="",delete c._$scope.operation.SequencePointerName)),c._$scope.initializeFilterByOperatorList())})};b.prototype.isSequence=
function(){return this._$scope.operation.SelectorCodeSequenceValue&&0<this._$scope.operation.SelectorCodeSequenceValue.length};b.prototype.isMprPlane=function(){return null!=this._$scope.operation.FilterByCategory&&"IMAGE_PLANE"==this._$scope.operation.FilterByCategory};b.prototype.editCodeSequence=function(){var c=this;this._$modal.open({templateUrl:"views/dialogs/CodeSequenceEditor.html",controller:a.CodeSequenceEditorController,backdrop:"static",resolve:{item:function(){return angular.copy(c._$scope.operation.SelectorCodeSequenceValue[0])},
title:function(){return"Edit Code Sequence"}}}).result.then(function(a){"equal"!=Utils.diff(c._$scope.operation.SelectorCodeSequenceValue[0],a).changed&&(c._$scope.operation.SelectorCodeSequenceValue=[],c._$scope.operation.SelectorCodeSequenceValue.push(a),c._$scope.operation.SelectorValue=c._$scope.operation.SelectorCodeSequenceValue[0].toFullString())})};b.prototype.isSelectorIndexValid=function(){return!$.isNumeric(this._$scope.operation.SelectorValueNumber)||0>this._$scope.operation.SelectorValueNumber||
9<this._$scope.operation.SelectorValueNumber?!1:!0};b.prototype.getSelectorIndexError=function(){return $.isNumeric(this._$scope.operation.SelectorValueNumber)&&0<=this._$scope.operation.SelectorValueNumber&&9>=this._$scope.operation.SelectorValueNumber?"":"Must be 0 through 9."};b.$inject="$scope $modal $modalInstance item title dicom currentTags".split(" ");return b}();a.DSFilterOperationEditorController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function b(a,b,d,g,h,k,l){a.selector=g;a.title=h;this._$scope=a;this._$modal=b;this._dicom=k;this._currentTags=l;a.chooseTag=this.chooseTag.bind(this);a.isSequence=this.isSequence.bind(this);a.editCodeSequence=this.editCodeSequence.bind(this);a.isFormValid=function(){return this.isSelectorIndexValid()&&this.isSelectorValueValid()};a.ok=function(){d.close(a.selector)};a.cancel=function(){d.dismiss("cancel")};a.isSelectorAttributeValid=function(){return 0==this.getSelectorAttributeError().length};
a.getSelectorAttributeError=function(){var c="";0==a.selector.WCFSelectorAttribute.trim().length&&(c="Value must not be empty.");return c};a.isSelectorValueValid=function(){return 0==this.getSelectorValueError().length};a.getSelectorValueError=function(){a.selector.SelectorValue.split("\\",5).filter(function(a){return 0!=a.length});a.selector.SelectorValue.split("\\",5);var c=Utils.verifySelectorCount(a.selector.SelectorValue,0);0==c.length&&Utils.isNumericVr(a.selector.SelectorAttributeVr)&&(c=Utils.verifyNumeric(a.selector.SelectorValue,
0));return c};a.isSelectorIndexValid=this.isSelectorIndexValid.bind(this);a.getSelectorIndexError=this.getSelectorIndexError.bind(this)}b.prototype.isSelectorIndexValid=function(){return!$.isNumeric(this._$scope.selector.SelectorValueNumber)||0>this._$scope.selector.SelectorValueNumber||9<this._$scope.selector.SelectorValueNumber?!1:!0};b.prototype.getSelectorIndexError=function(){return $.isNumeric(this._$scope.selector.SelectorValueNumber)?"":"Must be 0 through 9."};b.prototype.chooseTag=function(){var c=
this;this._$modal.open({templateUrl:"views/dialogs/TagChooserDialog.html",controller:a.TagChooserController,backdrop:"static",resolve:{dicom:function(){return c._dicom},selector:function(){return c._$scope.selector},currentTags:function(){return c._currentTags}}}).result.then(function(a){a.tag!=c._$scope.selector.WCFSelectorAttribute&&(a.isCodeSequence?(c._$scope.selector.WCFSelectorSequencePointer="",c._$scope.selector.WCFSelectorAttribute=a.tag,c._$scope.selector.SelectorName=a.name,c._$scope.selector.SelectorCodeSequenceValue=
DicomHelper.getCodeSequenceList(c._dicom,a.tag.replace(":",""),null),c._$scope.selector.SelectorValue=c._$scope.selector.SelectorCodeSequenceValue&&0<c._$scope.selector.SelectorCodeSequenceValue.length?c._$scope.selector.SelectorCodeSequenceValue[0].toFullString():""):(c._$scope.selector.WCFSelectorAttribute=a.tag,c._$scope.selector.SelectorValue=a.value,c._$scope.selector.SelectorName=a.name,c._$scope.selector.SelectorAttributeVr=a.vr,c._$scope.selector.SelectorCodeSequenceValue=void 0,a.selectorSequencePointer?
(c._$scope.selector.WCFSelectorSequencePointer=a.selectorSequencePointer,c._$scope.selector.SequencePointerName=a.sequencePointerName):(c._$scope.selector.WCFSelectorSequencePointer="",delete c._$scope.selector.SequencePointerName)))})};b.prototype.isSequence=function(){return this._$scope.selector.SelectorCodeSequenceValue&&0<this._$scope.selector.SelectorCodeSequenceValue.length};b.prototype.editCodeSequence=function(){var c=this;this._$modal.open({templateUrl:"views/dialogs/CodeSequenceEditor.html",
controller:a.CodeSequenceEditorController,backdrop:"static",resolve:{item:function(){return angular.copy(c._$scope.selector.SelectorCodeSequenceValue[0])},title:function(){return"Edit Code Sequence"}}}).result.then(function(a){"equal"!=Utils.diff(c._$scope.selector.SelectorCodeSequenceValue[0],a).changed&&(c._$scope.selector.SelectorCodeSequenceValue=[],c._$scope.selector.SelectorCodeSequenceValue.push(a))})};b.$inject="$scope $modal $modalInstance item title dicom currentTags".split(" ");return b}();
a.HPImageSetSelectorEditorController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g,h){a.timeBasedImageSet=g;a.title=h;this._$scope=a;this._$modal=b;a.oldRelativeTime=[0,0];a.oldAbstractPriorValue=[1,1];a.oldRelativeTimeUnits=Models.RelativeTimeUnits.Days;a.getIsFormValidError=function(){if(a.isRelativeTime()){var c=a.timeBasedImageSet.RelativeTime;if(2!=c.length)return"";if(null==a.timeBasedImageSet.RelativeTimeUnits||0>a.timeBasedImageSet.RelativeTimeUnits||6<a.timeBasedImageSet.RelativeTimeUnits)return"Relative Time Units: Must not be empty";
if(!$.isNumeric(c[0]))return"Relative Time: Minimum must be a number from 0 to 9";if(!$.isNumeric(c[1]))return"Relative Time: Maximum must be a number from 0 to 9";if(c[0]>c[1])return"Relative Time: Maximum must be greater than or equal to Minimum"}else{c=a.timeBasedImageSet.AbstractPriorValue;if(2!=c.length)return"";if(!$.isNumeric(c[0]))return"Abstract Prior Value: Minimum must be -1 (oldest), or 1 to 9";if(!$.isNumeric(c[1]))return"Abstract Prior Value: Maximum must be -1 (oldest) or 1 to 9";if(-1==
c[1])return"";if(-1==c[0]&&-1!=c[1])return"Abstract Prior Value: if Minimum is -1 (oldest), then Maximum must be -1";if(c[0]>c[1])return"Abstract Prior Value: Maximum must be greater than or equal to Minimum"}return""};a.isFormValid=function(){return 0==this.getIsFormValidError().length};a.isRelativeTime=function(){return a.timeBasedImageSet.ImageSetSelectorCategory==Models.ImageSetSelectorCategory.RelativeTime};a.dropDownChanged=function(){a.isRelativeTime()?(a.oldAbstractPriorValue=a.timeBasedImageSet.AbstractPriorValue,
a.timeBasedImageSet.AbstractPriorValue=[],a.timeBasedImageSet.RelativeTime=a.oldRelativeTime,a.timeBasedImageSet.RelativeTimeUnits=a.oldRelativeTimeUnits):(a.oldRelativeTime=a.timeBasedImageSet.RelativeTime,a.oldRelativeTimeUnits=a.timeBasedImageSet.RelativeTimeUnits,a.timeBasedImageSet.RelativeTime=[],a.timeBasedImageSet.RelativeTimeUnits=-1,a.timeBasedImageSet.AbstractPriorValue=a.oldAbstractPriorValue)};a.ok=function(){d.close(a.timeBasedImageSet)};a.cancel=function(){d.dismiss("cancel")};a.isMinimumRelativeValid=
this.isMinimumRelativeValid.bind(this);a.isMaximumRelativeValid=this.isMaximumRelativeValid.bind(this);a.isMinimumAbstractValid=this.isMinimumAbstractValid.bind(this);a.isMaximumAbstractValid=this.isMaximumAbstractValid.bind(this);a.isRelativeValid=this.isRelativeValid.bind(this);a.isAbstractValid=this.isAbstractValid.bind(this);a.getRelativeError=this.getRelativeError.bind(this);a.getAbstractError=this.getAbstractError.bind(this)}a.prototype.isMinimumRelativeValid=function(){if(this._$scope.isRelativeTime()){var a=
this._$scope.timeBasedImageSet.RelativeTime;if(2!=a.length||null==this._$scope.timeBasedImageSet.RelativeTimeUnits||0>this._$scope.timeBasedImageSet.RelativeTimeUnits||6<this._$scope.timeBasedImageSet.RelativeTimeUnits||!$.isNumeric(a[0])||a[0]>a[1])return!1}return!0};a.prototype.isMaximumRelativeValid=function(){return this._$scope.isRelativeTime()&&!$.isNumeric(this._$scope.timeBasedImageSet.RelativeTime[1])?!1:!0};a.prototype.isRelativeValid=function(){return this.isMinimumRelativeValid()&&this.isMaximumRelativeValid()};
a.prototype.getRelativeError=function(){if(this._$scope.isRelativeTime()){var a=this._$scope.timeBasedImageSet.RelativeTime;if(2!=a.length)return"";if(null==this._$scope.timeBasedImageSet.RelativeTimeUnits||0>this._$scope.timeBasedImageSet.RelativeTimeUnits||6<this._$scope.timeBasedImageSet.RelativeTimeUnits)return"Must not be empty";if(!$.isNumeric(a[0]))return"Must be a number from 0 to 9";if(!$.isNumeric(a[1]))return"Maximum must be a number from 0 to 9";if(a[0]>a[1])return"Minimum must be less than or equal to Maximum"}return""};
a.prototype.isMinimumAbstractValid=function(){if(0==this._$scope.isRelativeTime()){var a=this._$scope.timeBasedImageSet.AbstractPriorValue;if(2!=a.length)return!0;if(!$.isNumeric(a[0]))return!1;if(-1==a[1])return!0;if(-1==a[0]&&-1!=a[1]||a[0]>a[1])return!1}return!0};a.prototype.isMaximumAbstractValid=function(){if(0==this._$scope.isRelativeTime()){var a=this._$scope.timeBasedImageSet.AbstractPriorValue;if(!$.isNumeric(a[1])||-1==a[0]&&-1!=a[1])return!1}return!0};a.prototype.isAbstractValid=function(){return this.isMinimumAbstractValid()&&
this.isMaximumAbstractValid()};a.prototype.getAbstractError=function(){if(0==this._$scope.isRelativeTime()){var a=this._$scope.timeBasedImageSet.AbstractPriorValue;if(2!=a.length)return"";if(!$.isNumeric(a[0]))return"Minimum must be -1 (oldest), or 1 to 9";if(!$.isNumeric(a[1]))return"Maximum must be -1 (oldest) or 1 to 9";if(-1==a[1])return"";if(-1==a[0]&&-1!=a[1])return"If Minimum is -1 (oldest), then Maximum must be -1";if(a[0]>a[1])return"Minimum must be less than or equal to Maximum"}return""};
a.$inject=["$scope","$modal","$modalInstance","item","title"];return a}();a.HPTimeBasedImageSetsEditorController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function b(b,d,f,g,h,k,l,m){var c=this,e=!1;this._modal=g;b.selectedServer=null;b.wadoConfig=Models.RemoteConfig.Factory(f.get(OptionNames.RemoteConfig));b.wadoConnections=[];c.filter(b.wadoConfig.servers,b.wadoConnections);b.gridOptions={enableSorting:!0,enableRowSelection:!0,enableRowHeaderSelection:lt.LTHelper.device==lt.LTDevice.mobile||lt.LTHelper.device==lt.LTDevice.tablet,noUnselect:!1,multiSelect:!1,onRegisterApi:function(a){a.selection.on.rowSelectionChanged(b,
function(a){b.selectedServer=a.entity})},columnDefs:[{name:"Friendly Name",field:"title",enableHiding:!1,displayName:"Friendly Name"},{name:"DicomWeb Address",field:"dicomWebRoot",enableHiding:!1,displayName:"DicomWeb Address"},{name:"Uri Address",field:"UriAddress",enableHiding:!1,displayName:"Uri Address"},{name:"Default",field:"isDefault",enableHiding:!1}],data:b.wadoConnections};b.addWadoServer=function(){g.open({templateUrl:"views/dialogs/AddWadoServer.html",controller:a.AddWadoServerController,
backdrop:"static",resolve:{server:function(){}}}).result.then(function(a){for(var d=0;d<b.wadoConfig.servers.length;d++)a.isDefault&&(b.wadoConfig.servers[d].isDefault=!1);b.wadoConfig.servers.push(a);c.filter(b.wadoConfig.servers,b.wadoConnections)})};b.deleteWadoServer=function(){var a=$.grep(b.wadoConfig.servers,function(a,c){return a.id==b.selectedServer.id});0<a.length&&(a=b.wadoConfig.servers.indexOf(a[0]),b.wadoConfig.servers.splice(a,1),b.selectedServer=null,c.filter(b.wadoConfig.servers,
b.wadoConnections))};b.editWadoServer=function(){g.open({templateUrl:"views/dialogs/AddWadoServer.html",controller:a.AddWadoServerController,backdrop:"static",resolve:{server:function(){return b.selectedServer}}}).result.then(function(a){var d=$.grep(b.wadoConfig.servers,function(b,c){return b.id==a.id});if(0<d.length){d=b.wadoConfig.servers.indexOf(d[0]);for(var e=0;e<b.wadoConfig.servers.length;e++)e!=d&&a.isDefault&&(b.wadoConfig.servers[e].isDefault=!1);b.wadoConfig.servers[d]=a;c.filter(b.wadoConfig.servers,
b.wadoConnections)}})};b.save=function(){var a={},d=JSON.stringify(b.wadoConfig);a[OptionNames.RemoteConfig]=d;f.saveDefaultOptions(a).success(function(){f.set(OptionNames.RemoteConfig,d);k.notify(c._notificationTitle,c._saveSuccessMsg);e=!0}).error(function(a){k.error(c._saveFailureMsg+": "+status)})};b.close=function(){d.close(e)};l("NOTIFY_WADOCONFIG_SAVE_SUCCESS").then(function(a){c._saveSuccessMsg=a});l("NOTIFY_WADOCONFIG_SAVE_FAILURE").then(function(a){c._saveFailureMsg=a});l("DIALOGS_NOTIFICATION").then(function(a){c._notificationTitle=
a})}b.prototype.wadoConnections=function(a){var b=new Models.RemoteConfig;b.client=a.client;for(var c=0;c<a.servers.length;c++)"wado"==a.servers[c].type&&b.servers.push(a.servers[c]);return b};b.prototype.filter=function(a,b){0<b.length&&b.splice(0,b.length);for(var c=0;c<a.length;c++)"wado"==a[c].type&&b.push(a[c])};b.$inject="$scope $modalInstance optionsService $modal authenticationService dialogs $translate $timeout".split(" ");return b}();a.RemoteWadoController=b})(Controllers||(Controllers=
{}));
(function(a){var b=function(){return function(a,b,d){this.line=a;this.column=b;this.message=d}}(),d=function(){function a(a,b,c,d,k){this._interval=void 0;this._errorLines=[];this._firstChange=!0;var e=this;a.label=c;a.data={};a.data.text=d;a.readOnly=k;a.editorOptions={lineWrapping:!1,mode:"javascript",autofocus:!0,lineNumbers:!0,extraKeys:{"Ctrl-Q":function(a){a.foldCode(a.getCursor())}},foldGutter:{rangeFinder:new CodeMirror.fold.combine(CodeMirror.fold.brace,CodeMirror.fold.comment)},gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],
readOnly:k};a.gridOptions={rowSelection:"single",suppressNoRowsOverlay:!0,groupHeaders:!0,columnDefs:[{headerName:"Errors",children:[{headerName:"",cellRenderer:Utils.countRenderer,width:29,suppressSizeToFit:!0},{headerName:"Line",field:"line"},{headerName:"Column",field:"column"},{headerName:"Description",field:"message"}]}],onRowSelected:function(a){this.jumpToLine(a.node.data.line-1,a.node.data.column-1)}.bind(this),rowData:null,onGridReady:function(){e._gridApi=a.gridOptions.api;e._gridApi.hideOverlay();
e._gridApi.sizeColumnsToFit()}};a.cancel=function(){b.dismiss("cancel")};a.ok=function(){b.close(a.data.text)};a.hasErrors=function(){return angular.isArray(a.gridOptions.rowData)?0<a.gridOptions.rowData.length:null!=a.gridOptions.rowData};a.codemirrorLoaded=this.codeMirrorLoaded.bind(this)}a.prototype.codeMirrorLoaded=function(a){this._editor=a;this._editor.refresh();this._editor.focus();this._editor.getDoc().setCursor({line:this._editor.getDoc().lineCount(),ch:0});this._editor.on("change",this.onChange.bind(this))};
a.prototype.onChange=function(a,b){this._firstChange&&(this._firstChange=!1,a.getDoc().markClean(),a.getDoc().clearHistory());this._interval&&clearTimeout(this._interval);this._interval=setTimeout(this.update.bind(this),500)};a.prototype.update=function(){for(var a=this._editor.getDoc().getValue();0<this._errorLines.length;)this._editor.removeLineClass(this._errorLines.shift().line-1,"background","errorLine");this._gridApi.setRowData(null);try{var c=esprima.parse(a,{tolerant:!0,loc:!0});for(a=0;a<
c.length;a++){var d=c[a],h=d.lineNumber;this._errorLines.push(new b(h,c.column,d.message));this._editor.addLineClass(h-1,"background","errorLine")}}catch(k){h=k.lineNumber,this._errorLines.push(new b(h,k.column,k.message)),this._editor.addLineClass(h-1,"background","errorLine")}this._gridApi.setRowData(this._errorLines)};a.prototype.jumpToLine=function(a,b){var c=this._editor.charCoords({line:a,ch:b},"local").top,d=this._editor.getScrollerElement().offsetHeight/2;this._editor.scrollTo(null,c-d-5);
this._editor.getDoc().setCursor({line:a,ch:b});this._editor.focus()};a.$inject=["$scope","$modalInstance","label","text","readOnly"];return a}();a.ScriptEditorController=d})(Controllers||(Controllers={}));(function(a){var b=function(){function a(a,b,d,g){a.label=d;a.data={};a.data.text=g;a.cancel=function(){b.dismiss("cancel")};a.ok=function(){b.close(a.data.text)}}a.$inject=["$scope","$modalInstance","label","text"];return a}();a.PromptController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g,h){function c(b,c){b=[];b.hue=100*a.ipVals.hue;b.saturation=10*a.ipVals.saturation;b.intensity=10*a.ipVals.lightness;a.ipApi.applyIPCommand("ChangeHueSaturationIntensity",b)}a.ipVals={hue:0,saturation:0,lightness:0};a.slider={options:{stop:c},hueOptions:{stop:c,min:-180,max:180}};a.frame=h.get_activeCellFrame();a.ipApi={};a.ok=function(){b.close(a.ipVals)};a.cancel=function(){b.dismiss("cancel")};a.change=function(){var b=[];b.hue=100*a.ipVals.hue;
b.saturation=10*a.ipVals.saturation;b.intensity=10*a.ipVals.lightness;a.ipApi.applyIPCommand("ChangeHueSaturationIntensity",b)}}a.$inject=["$scope","$modalInstance","optionsService","eventService","seriesManagerService"];return a}();a.HSLController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d){a.exportOptions=new Models.ExportOptions;a.source={};a.source.value="SelectedImages";a.ok=function(){a.exportOptions.LayoutImageWidth=0;d.close({options:a.exportOptions,source:a.source.value})};a.cancel=function(){d.dismiss("cancel")}}a.$inject=["$scope","optionsService","$modalInstance"];return a}();a.PrintController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g,h,k,l,m,p,n,r){g.get(OptionNames.DateFormat);g.get(OptionNames.TimeFormat);var c=this;b.gridapi=null;b.roles=l;b.role={name:null};this.scope=b;this.patientAccessRightsService=d;this._dialogs=p;b.gridOptions={enableSorting:!0,enableRowSelection:!0,showFooter:!0,modifierKeysToMultiSelect:!1,paginationPageSizes:[25,50,75],paginationPageSize:25,enableFiltering:!0,enableHorizontalScrollbar:r.scrollbars.NEVER,onRegisterApi:function(a){b.gridapi=a;a.pagination.on.paginationChanged(b,
c.paginationChanged.bind(c));a.selection.on.rowSelectionChanged(b,c.rowSelectionChange.bind(c));a.selection.on.rowSelectionChangedBatch(b,c.rowSelectionChangedBatch.bind(c));c.makeReadOnly(!0)},columnDefs:[{name:"Id",field:"ID",enableHiding:!1},{name:"Name",field:"Name",enableHiding:!1},{name:"Sex",field:"Sex",enableHiding:!1,enableFiltering:!1},{name:"Birth Date",field:"BirthDate",enableHiding:!1,enableFiltering:!1}],data:"patients"};h.FindPatients(null).success(function(a){b.patients=a});b.close=
function(){m.close()};b.roleChanged=this.roleChanged.bind(this);b.applyPermissions=this.applyPermissions.bind(this);n("NOTIFY_PERMISSIONS_SAVED").then(function(a){this._saveSuccessMsg=a}.bind(this));n("NOTIFY_PERMISSIONS_FAILED").then(function(a){this._saveFailureMsg=a}.bind(this));n("DIALOGS_NOTIFICATION").then(function(a){this._notificationTitle=a}.bind(this))}a.prototype.roleChanged=function(a){this.scope.gridapi.selection.clearSelectedRows();null!=a?(this.makeReadOnly(!1),this.patientAccessRightsService.GetRoleAccess(a).then(function(a){this.grantedPermissions=
[];for(var b=0;b<a.data.length;b++)this.grantedPermissions.push(a.data[b].PatientId);this.updatePermissions()}.bind(this),function(a){})):this.makeReadOnly(!0)};a.prototype.applyPermissions=function(){this.patientAccessRightsService.GrantRolePatients(this.scope.role.name,this.grantedPermissions).then(function(a){this._dialogs.notify(this._notificationTitle,this._saveSuccessMsg)}.bind(this),function(a){this._dialogs.error(this._saveFailureMsg+": "+a)}.bind(this))};a.prototype.updatePermissions=function(){angular.forEach(this.scope.gridapi.grid.rows,
function(a,b){var c=a.entity;0<$.grep(this.grantedPermissions,function(a,b){return a==c.ID}).length&&this.scope.gridapi.selection.selectRow(c)},this)};a.prototype.paginationChanged=function(a,b){this.updatePermissions()};a.prototype.rowSelectionChange=function(a,b){angular.isDefined(b)&&(a.isSelected?this.addPermission(this.scope.role.name,a.entity.ID):this.removePermission(this.scope.role.name,a.entity.ID))};a.prototype.rowSelectionChangedBatch=function(a,b){b=a.length;for(var c=0;c<b;c++)a[c].isSelected?
this.addPermission(this.scope.role.name,a[c].entity.ID):this.removePermission(this.scope.role.name,a[c].entity.ID)};a.prototype.addPermission=function(a,b){0==$.grep(this.grantedPermissions,function(a,c){return a==b}).length&&this.grantedPermissions.push(b)};a.prototype.removePermission=function(a,b){a=$.grep(this.grantedPermissions,function(a,c){return a==b});1==a.length&&(a=this.grantedPermissions.indexOf(a[0]),this.grantedPermissions.splice(a,1))};a.prototype.makeReadOnly=function(a){var b=this.scope.gridapi.core.getVisibleRows(this.scope.gridapi.grid);
0==b.length?setTimeout(function(){this.makeReadOnly(a)}.bind(this),250):angular.forEach(b,function(b,c){b.isSelected=!1;b.enableSelection=!a},this)};a.$inject="$rootScope $scope patientAccessRightsService optionsService queryArchiveService authenticationService roles $modalInstance dialogs $translate uiGridConstants".split(" ");return a}();a.RolePatientsAccessController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b){a.edit={};a.isEnabled=function(){var a=window.localStorage.getItem("leadmedicalwebviewertheme");var b=document.getElementById("darkThemeCheckBox");switch(a){case "dark":b.checked=!0;break;case "light":b.checked=!1;break;default:b.checked=!b.checked}};a.ok=function(){if(document.getElementById("darkThemeCheckBox").checked){window.localStorage.setItem("leadmedicalwebviewertheme","dark");var a=document.getElementById("theme_css");a.href="css/darktheme.css"}else window.localStorage.setItem("leadmedicalwebviewertheme",
"light"),a=document.getElementById("theme_css"),a.href="css/theme-light.css";b.close("ok")}}a.$inject=["$scope","$modalInstance"];return a}();a.UISettingsController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g,h,k){a.enabled=!0;a.player={};a.cancelVisiblity=!1;a.progresscurrent=0;a.totalProgressValue=0;a.countTo=0;a.countFrom=0;a.totalCountTo=0;a.text={current:"",total:""};a.progressBarVisiblity=!1;a.browseDisabled=!1;a.subProgressForTotal=0;a.currentTotalProgress=0;a.fileCount=0;var c,e=function(a){var b="";a=new Uint8Array(a);var c=a.byteLength,d=c%3;c-=d;for(var e,f,g,h,k=0;k<c;k+=3)h=a[k]<<16|a[k+1]<<8|a[k+2],e=(h&16515072)>>18,f=(h&258048)>>12,g=(h&
4032)>>6,h&=63,b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[f]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[g]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[h];1==d?(h=a[c],b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(h&252)>>2]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(h&3)<<4]+"=="):2==d&&(h=a[c]<<8|a[c+1],b+=
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(h&64512)>>10]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(h&1008)>>4]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(h&15)<<2]+"=");return b},f=0,n=new (function(){function a(){this._eventHandlers={}}a.prototype.addEventListener=function(a,b){this._eventHandlers[a]=this._eventHandlers[a]||[];this._eventHandlers[a].push(b)};a.prototype.clearEventListener=function(a){this._eventHandlers[a].clear()};
a.prototype.checkEventListener=function(a){return 0<this._eventHandlers[a].length};a.prototype.dispatchEvent=function(a,b,c){c(a,b)};a.prototype.dispatchAll=function(a,b){var c=this._eventHandlers[a];if(c)for(var d=0;d<c.length;d+=1)this.dispatchEvent(a,b,c[d])};return a}()),r,q=function(b){var c=new FileReader,d=$.Deferred();f=0;c.onloadend=function(c){2===c.target.readyState&&(c=e(c.target.result),k.UploadDicomImage(c,"start","").then(function(c){r=c.data;f+=4E4;a.countTo=a.progresscurrent=f>=b.size?
100:100*f/b.size>>0;a.subProgressForTotal=a.progresscurrent/a.fileCount;a.totalCountTo=a.totalProgressValue=a.currentTotalProgress+Math.ceil(a.subProgressForTotal);f>=b.size?d.resolve("success_done"):d.resolve("success_more")}))};var g=f+4E4;g>b.size&&(g=b.size);g=b.slice(f,g);c.readAsArrayBuffer(g);return d.promise()},t=function(b){var c=new FileReader,d=$.Deferred();c.onloadend=function(c){2===c.target.readyState&&(c=e(c.target.result),k.UploadDicomImage(c,"append",r).then(function(c){f+=4E4;a.countTo=
a.progresscurrent=f>=b.size?100:100*f/b.size>>0;a.subProgressForTotal=a.progresscurrent/a.fileCount;a.totalCountTo=a.totalProgressValue=a.currentTotalProgress+Math.ceil(a.subProgressForTotal);f>=b.size?d.resolve("success_done"):d.resolve("success_more")}))};var g=f+4E4;g>b.size&&(g=b.size);g=b.slice(f,g);c.readAsArrayBuffer(g);return d.promise()},y=function(b,d){var e=b[d],f="";a.fileCount=b.length;a.progressBarVisiblity=!0;a.cancelVisiblity=!0;a.browseDisabled=!0;a.text.current=e.name;var g=$.Deferred();
n.addEventListener("onStateChanged",function(a,b){if(c)n.clearEventListener("FileUploaded");else switch(b){case "success_more":t(e).done(function(a){"success_more"===a?n.dispatchAll("onStateChanged","success_more"):n.dispatchAll("onStateChanged","success_done")}).fail(function(){alert("couldn't upload the file")});break;case "success_done":k.UploadDicomImage(null,"done",r).then(function(a){n.clearEventListener("onStateChanged");a.data.hasOwnProperty("FaultType")&&"Exception"==a.data.FaultType&&(f=
a.data.Message);g.resolve("file uploaded",f)});break;case "error_fail":alert("Error uploading file!")}});a.currentTotalProgress=100*d/b.length>>0;a.totalCountTo=a.totalProgressValue=a.currentTotalProgress+Math.ceil(a.subProgressForTotal);a.text.total="Uploading "+(d+1)+" / "+b.length;q(e).done(function(a){"success_more"===a?n.dispatchAll("onStateChanged","success_more"):n.dispatchAll("onStateChanged","success_done")});return g.promise()},w,x=!1,u="",A=0;a.previous=function(b){w=0;c=!1;x=!0;A=0;u=
"";0!=b.length&&(n.addEventListener("FileUploaded",function(d,e){""!=e&&(0==A&&(u="File ["+b[w].name+"] "+e),A++);w++;c?n.clearEventListener("FileUploaded"):w>=b.length?(x=!1,n.clearEventListener("FileUploaded"),a.progressBarVisiblity=!1,a.cancelVisiblity=!1,a.browseDisabled=!1,d="",d=0<A?"Total Files Uploaded: "+(w-A)+" of "+w+"\n"+u:"Total Files Uploaded: "+w,alert(d)):y(b,w).then(function(a,b){n.dispatchAll("FileUploaded",b)})}),y(b,w).then(function(a,b){n.dispatchAll("FileUploaded",b)}))};a.close=
function(){c=!0;x||b.dismiss("cancel")};a.cancel=function(){c=!0;a.progressBarVisiblity=!1;a.cancelVisiblity=!1;x=a.browseDisabled=!1;document.getElementById("inputFile").value=null;k.UploadDicomImage("","cancel","").then(function(a){alert("Canceled")})};g.subscribe(EventNames.ActiveSeriesChanged,function(a,b){})}a.$inject="$scope $modalInstance seriesManagerService eventService safeApply objectStoreService".split(" ");return a}();a.UploadFileController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g,h,k,l,m,p,n,r,q){g.get(OptionNames.DateFormat);g.get(OptionNames.TimeFormat);var c=this;b.gridapi=null;b.users=l;b.user={name:null};this.scope=b;this._patientAccessRightsService=d;this._authenticationService=k;this._dialogs=p;this.rolePatients=[];this._uiGridConstants=r;this._patientsBock=q.instances.get("patientsBlockUI");b.gridOptions={appScopeProvider:b,enableSorting:!0,enableRowSelection:!0,showFooter:!0,modifierKeysToMultiSelect:!1,paginationPageSizes:[25,
50,75],paginationPageSize:25,enableFiltering:!0,enableHorizontalScrollbar:r.scrollbars.NEVER,onRegisterApi:function(a){b.gridapi=a;a.pagination.on.paginationChanged(b,c.paginationChanged.bind(c));a.selection.on.rowSelectionChanged(b,c.rowSelectionChange.bind(c));a.selection.on.rowSelectionChangedBatch(b,c.rowSelectionChangedBatch.bind(c));c.makeReadOnly()},columnDefs:[{name:"Id",field:"ID",enableHiding:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-class="{\'em\':row.enableSelection===false && row.grid.appScope.user.name!=null}" title="TOOLTIP">{{COL_FIELD CUSTOM_FILTERS}}</div>'},
{name:"Name",field:"Name",enableHiding:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-class="{\'em\':row.enableSelection===false && row.grid.appScope.user.name!=null}" title="TOOLTIP">{{COL_FIELD CUSTOM_FILTERS}}</div>'},{name:"Sex",field:"Sex",enableHiding:!1,enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-class="{\'em\':row.enableSelection===false && row.grid.appScope.user.name!=null}" title="TOOLTIP">{{COL_FIELD CUSTOM_FILTERS}}</div>'},{name:"Birth Date",field:"BirthDate",
enableHiding:!1,enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-class="{\'em\':row.enableSelection===false && row.grid.appScope.user.name!=null}" title="TOOLTIP">{{COL_FIELD CUSTOM_FILTERS}}</div>'}],data:"patients"};h.FindPatients(null).success(function(a){b.patients=a});b.close=function(){m.close()};b.userChanged=this.userChanged.bind(this);b.applyPermissions=this.applyPermissions.bind(this);n("NOTIFY_PERMISSIONS_SAVED").then(function(a){this._saveSuccessMsg=a}.bind(this));
n("NOTIFY_PERMISSIONS_FAILED").then(function(a){this._saveFailureMsg=a}.bind(this));n("DIALOGS_NOTIFICATION").then(function(a){this._notificationTitle=a}.bind(this))}a.prototype.userChanged=function(a){var b=this;this.scope.gridapi.selection.clearSelectedRows();null!=a?this._authenticationService.isAdmin(a).success(function(c){this.rolePatients=[];c?b.makeReadOnly():b._authenticationService.getUserRoles(a).success(function(c){0<c.length?b._patientAccessRightsService.GetRolesAccess(c).then(function(c){for(var d=
c.data.length,e=0;e<d;e++){var f=c.data[e].PatientId;-1==b.rolePatients.indexOf(f)&&b.rolePatients.push(f)}b.getPermissions(a)},function(c){b.getPermissions(a)}):b.getPermissions(a)}).error(function(){b.getPermissions(a)})}):this.makeReadOnly()};a.prototype.getPermissions=function(a){this._patientAccessRightsService.GetUserAccess(a).then(function(a){this.grantedPermissions=[];for(var b=0;b<a.data.length;b++)this.grantedPermissions.push(a.data[b].PatientId);this.updateSelection();this.updatePermissions()}.bind(this),
function(a){})};a.prototype.applyPermissions=function(){this._patientAccessRightsService.GrantUserPatients(this.scope.user.name,this.grantedPermissions).then(function(a){this._dialogs.notify(this._notificationTitle,this._saveSuccessMsg)}.bind(this),function(a){this._dialogs.error(this._saveFailureMsg+": "+a)}.bind(this))};a.prototype.updatePermissions=function(){angular.forEach(this.scope.gridapi.grid.rows,function(a,b){var c=a.entity;0<$.grep(this.grantedPermissions,function(a,b){return a==c.ID}).length&&
this.scope.gridapi.selection.selectRow(c)},this)};a.prototype.paginationChanged=function(a,b){this.updateSelection();this.updatePermissions()};a.prototype.rowSelectionChange=function(a,b){angular.isDefined(b)&&(a.isSelected?this.addPermission(this.scope.user.name,a.entity.ID):this.removePermission(this.scope.user.name,a.entity.ID))};a.prototype.rowSelectionChangedBatch=function(a,b){b=a.length;for(var c=0;c<b;c++)a[c].isSelected?this.addPermission(this.scope.user.name,a[c].entity.ID):this.removePermission(this.scope.user.name,
a[c].entity.ID)};a.prototype.updateSelection=function(){var a=this.scope.gridapi.core.getVisibleRows(this.scope.gridapi.grid);angular.forEach(a,function(a,b){b=-1!=this.rolePatients.indexOf(a.entity.ID);a.isSelected=b;a.enableSelection=!b},this)};a.prototype.makeReadOnly=function(a){var b=this.scope.gridapi.core.getVisibleRows(this.scope.gridapi.grid);0==b.length||a?setTimeout(function(){this.makeReadOnly()}.bind(this),250):angular.forEach(b,function(a,b){a.isSelected=!1;a.enableSelection=!1},this)};
a.prototype.addPermission=function(a,b){0==$.grep(this.grantedPermissions,function(a,c){return a==b}).length&&this.grantedPermissions.push(b)};a.prototype.removePermission=function(a,b){a=$.grep(this.grantedPermissions,function(a,c){return a==b});1==a.length&&(a=this.grantedPermissions.indexOf(a[0]),this.grantedPermissions.splice(a,1))};a.$inject="$rootScope $scope patientAccessRightsService optionsService queryArchiveService authenticationService users $modalInstance dialogs $translate uiGridConstants blockUI".split(" ");
return a}();a.UserPatientsAccessController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g,h,k,l){this._unknownString="Unknown";var c=this;this._dateFormat=d.get(OptionNames.DateFormat);this._timeFormat=d.get(OptionNames.TimeFormat);this._$scope=a;this._selector=k;l=[];a.gridOptions={columnDefs:[{headerName:"Tag",field:"tag",width:150,cellRenderer:{renderer:"group",innerRenderer:this.innerCellRenderer.bind(this),checkbox:!0}},{headerName:"Name",field:"name",width:250},{headerName:"Value",field:"value",width:250}],rowData:this.buildData(h,
[],l),rowSelection:k?"single":"multiple",rowsAlreadyGrouped:!0,suppressRowClickSelection:!0,enableColResize:!0,groupSelectsChildren:!1,icons:{groupExpanded:'<i class="fa fa-minus-square-o"/>',groupContracted:'<i class="fa fa-plus-square-o"/>'},onGridReady:function(){a.gridOptions.api.hideOverlay();k&&k.WCFSelectorAttribute&&0<k.WCFSelectorAttribute.length&&setTimeout(function(){c.selectCurrentTag()},500)},onSelectionChanged:this.selectionChanged.bind(this),onRowSelected:this.rowSelected.bind(this)};
a.ok=function(){var d=a.gridOptions.api.getSelectedNodes();if(k){var e=c.sequenceCheck(d[0]);b.close(e.data)}else{for(var f=[],g=0;g<d.length;g++)e=c.sequenceCheck(d[g]),e=Utils.myclone(e.data,["children"]),f.push(e);b.close(f)}};a.cancel=function(){b.dismiss("cancel")}}a.prototype.containsCodeValue=function(a){if(null==a)return!1;for(var b=0;b<a.children.length;b++){var c=a.children[b].data.tag;c=c.replace(":","");if(c==DicomTag.CodeValue)return!0}return!1};a.prototype.isCodeSequence=function(a,
b){var c=a.data;if(-1!=c.name.indexOf("Code Sequence"))return!0;if("SQ"!=c.vr||0==a.children.length)return!1;if(this.containsCodeValue(a.children[0]))return!0;b=parseInt(b);if(isNaN(b))return!1;--b;return 0==b||a.children.length<=b?!1:this.containsCodeValue(a.children[b])?!0:!1};a.prototype.getSelectorSequencePointer=function(a){for(var b="";null!=a;){var c=a.data;null!=c&&c.tag!=DicomTag.Item&&(b=0==b.length?c.tag:c.tag+"\\"+b);a=a.parent}return b};a.prototype.getSelectorSequencePointerItems=function(a){for(var b=
"";null!=a;){var c=a.data;null!=c&&c.tag==DicomTag.Item&&(c=c.name.replace("Item ",""),b=0==b.length?c:c+"\\"+b);a=a.parent}return b};a.prototype.findNodeSequenceTag=function(a){if(null==a)return null;for(;"SQ"!=a.data.vr&&null!=a.parent;)a=a.parent;return a};a.prototype.findNodeItemTag=function(a){if(null==a)return null;if("SQ"==a.data.vr)return a=null!=a.children&&0<a.children.length?a.children[0]:null;for(;a.data.tag!=DicomTag.Item&&null!=a.parent;)a=a.parent;return a};a.prototype.sequenceCheck=
function(a){var b=null,c=a;var d=this.findNodeSequenceTag(a);var h=this.findNodeItemTag(a);null!=h&&(b=h.data.name.replace("Item ",""));var k=!1;if("SQ"==a.data.vr||a.data.tag==DicomTag.Item)k=this.isCodeSequence(d,b),c=d;var l=c.data;k?(l.isCodeSequence=!0,l.children=a.children):(delete l.isCodeSequence,delete l.children);l.itemNumber=null==b?null:parseInt(b);null!=d&&(l.selectorSequencePointer=this.getSelectorSequencePointer(h),l.sequencePointerName=d.data.name,l.selectorSequencePointerItems=this.getSelectorSequencePointerItems(h));
return c};a.prototype.selectCurrentTag=function(){var a=this;this._$scope.gridOptions.api.forEachNode(function(b,c){b.data.tag!=a._selector.WCFSelectorAttribute||b.parent||(a._$scope.gridOptions.api.selectNode(b),a._$scope.gridOptions.api.ensureIndexVisible(c))})};a.prototype.innerCellRenderer=function(a){return"SQ"==a.data.vr?'&nbsp;<span><i class="fa fa-tags" style="color: blue"></i>&nbsp;'+a.data.tag+"</span>":'&nbsp;<span><i class="fa fa-tag" style="color: blue"></i>&nbsp;'+a.data.tag+"</span>"};
a.prototype.isValidSelectorVR=function(a,b){return a==DicomTag.Item?!0:"AT"==b||"CS"==b||"IS"==b||"LO"==b||"LT"==b||"PN"==b||"SH"==b||"ST"==b||"UT"==b||"DS"==b||"FD"==b||"FL"==b||"UL"==b||"US"==b||"SL"==b||"SS"==b||"UI"==b||"SQ"==b};a.prototype.buildData=function(a,b,d){for(var c in a){var e=c.substr(0,4)+":"+c.substr(4),f=new Models.DicomData(Utils.splitCamelCaseToString(a[c].keyword),e),l=new Models.DicomTagRow(f);if(this.isValidSelectorVR(c,a[c].vr)){f.name||(f.name=this._unknownString);f.vr=a[c].vr;
if("PN"==a[c].vr)f.value=DicomHelper.getPatientNameFromTag(a[c]);else if("SQ"!=a[c].vr){var m=DicomHelper.getConvertValue(a[c]);"DA"==a[c].vr&&m&&(m=new Date(DicomHelper.parseDicomDate(m)),m=m.toString(this._dateFormat));"TM"==a[c].vr&&m&&(m=Date.today().at(DicomHelper.parseDicomTime(m)),m=m.toString(this._timeFormat));f.value=m}else if(a[c].Value&&0<a[c].Value.length){m=a[c].Value.length;l.group=!0;l.expanded=!1;for(var p=0;p<m;p++)f=new Models.DicomData("Item "+(p+1).toString(),"FFFEE000"),f=new Models.DicomTagRow(f),
f.group=!0,f.expanded=!1,l.children.push(f),this.buildData(a[c].Value[p],f.children,d)}(d&&0==d.length||d&&0<d.length&&-1==d.indexOf(e))&&b.push(l)}}return b};a.prototype.getDateTime=function(){return(new Date).toString(this._dateFormat+" "+this._timeFormat)};a.prototype.rowSelected=function(a){};a.prototype.selectionChanged=function(){};a.$inject="$scope $modalInstance optionsService $translate dicom selector currentTags".split(" ");return a}();a.TagChooserController=b})(Controllers||(Controllers=
{}));
(function(a){var b=function(){function a(a,b,d,g,h,k,l,m){this._unknownString="Unknown";this.GetVolume=function(a){switch(a){case lt.Controls.Medical.VolumeType.VRT:case lt.Controls.Medical.VolumeType.MIP:return"Volume";case lt.Controls.Medical.VolumeType.MPR:return"MPR"}};this._$scope=a;var c=this;a.source=new Models.Settings3DOptions;a.range=new Models.ValueRange;a.range.ValueMaximum=parseInt(m.information.maxValue.toString());a.range.ValueMinimum=parseInt(m.information.minValue.toString());a.source.volumeType=
this.GetVolume(m.volumeType);a.source.lowResQuality=m.volume.lowResQuality;a.source.showClippingFrame=m.volume.enableClippingFrame;a.source.showCrossLines=m.MPR.enableCrossLines;a.source.projectionMethod=m.projection;a.source.showRotationCube=m.showRotationCube;a.source.showVolumeBorder=m.showVolumeBorder;a.source.resizeFactor=m.resizeFactor;a.ok=function(){var a={};a.IsoThreshold=c._$scope.source.isoThreshold;a.LowResQuality=c._$scope.source.lowResQuality;a.ProjectionMethod=c._$scope.source.projectionMethod;
a.ShowClippingFrame=c._$scope.source.showClippingFrame;a.ShowMPRCrossLines=c._$scope.source.showCrossLines;a.ShowRotationCube=c._$scope.source.showRotationCube;a.ShowVolumeBorder=c._$scope.source.showVolumeBorder;m.resizeFactor=c._$scope.source.resizeFactor;a.AxialPosition=-1;a.SagittalPosition=-1;a.CoronalPosition=-1;g.close(a)};a.cancel=function(){g.dismiss("cancel")};a.isSelectorIndexValid=this.isSelectorIndexValid.bind(this);a.getSelectorIndexError=this.getSelectorIndexError.bind(this);a.getIsoThresholdError=
this.getIsoThresholdError.bind(this);a.isFormValid=function(){return this.isSelectorIndexValid()};a.getSelectorValueError=function(){return"error test"}}a.prototype.getIsoThresholdError=function(){var a=this._$scope.source.isoThreshold;return $.isNumeric(a)?a<this._$scope.range.ValueMinimum||a>=this._$scope.range.ValueMaximum?"value must be betweren ("+this._$scope.range.ValueMinimum+") and ( "+this._$scope.range.ValueMaximum+" )":"":"invalid value, must be numerical"};a.prototype.getSelectorIndexError=
function(){var a=this._$scope.source.lowResQuality;return $.isNumeric(a)?0>a||1<a?"value must be btween 0 and 1":"":"invalid value, must be numerical"};a.prototype.isSelectorIndexValid=function(){var a=this._$scope.source.isoThreshold,b=this._$scope.source.lowResQuality;return a<this._$scope.range.ValueMinimum||a>=this._$scope.range.ValueMaximum||0>b||1<b?!1:!0};a.$inject="$scope eventService toolbarService $modalInstance optionsService objectRetrieveService $translate cell".split(" ");return a}();
a.Settings3DController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g,h,k){a.settings=angular.copy(g);a.ok=function(){d.close(a.settings)};a.apply=function(){var b=k.get_activeCell();b instanceof lt.Controls.Medical.Cell3D?(b.information.windowWidth=a.settings.width,b.information.windowCenter=a.settings.center,b.updateWindowLevelValues()):b.get_linked()?k.enumerateFrames(b,function(c,d){k.withinVisibleRange(b,d)&&c.setWindowLevel(a.settings.width,a.settings.center)}):h.setWindowLevel(a.settings.width,a.settings.center)};
a.cancel=function(){d.dismiss("cancel")};a.reset=function(){a.settings.width=g.originalWindowLevelWidth;a.settings.center=g.originalWindowLevelCenter}}a.$inject="$scope optionsService $modalInstance settings currentFrame seriesService".split(" ");return a}();a.WindowLevelCustomController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g,h,k,l,m){this._notificationTitle="Notify";this._errorMessage="Error getting template list";this._$scope=a;l("DIALOGS_NOTIFICATION").then(function(a){this._notificationTitle=a}.bind(this));l("DIALOGS_TEMPLATE_ERROR_GET").then(function(a){this._errorMessage=a}.bind(this));a.ok=function(){d.close(a.layout)};a.cancel=function(){d.dismiss("cancel")};a.isRowValid=this.isRowValid.bind(this);a.getIsRowValidError=this.getIsRowValidError.bind(this);a.isColumnValid=
this.isColumnValid.bind(this);a.getIsColumnValidError=this.getIsColumnValidError.bind(this);a.isFormValid=this.isFormValid.bind(this);a.layout={rows:g.rows,columns:g.columns,custom:null}}a.prototype.isRowValid=function(){return""==this.getIsRowValidError()};a.prototype.getIsRowValidError=function(){return this._$scope.layout?$.isNumeric(this._$scope.layout.rows)?0>=this._$scope.layout.rows?"Must be greater than 0":"":"Must be numeric":""};a.prototype.isColumnValid=function(){return""==this.getIsColumnValidError()};
a.prototype.getIsColumnValidError=function(){return this._$scope.layout?$.isNumeric(this._$scope.layout.columns)?0>=this._$scope.layout.columns?"Must be greater than 0":"":"Must be numeric":""};a.prototype.isFormValid=function(){return this.isRowValid()&&this.isColumnValid()};a.$inject="$scope optionsService $modalInstance layout templateService dialogs $translate authenticationService".split(" ");return a}();a.SeriesLayoutController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function b(a,b,d,g,h,k,l,m,p,n,r,q,t,y,w,x){function c(){b.warning&&(b.warning.close(),b.warning=null);b.timedout&&(b.timedout.close(),b.timedout=null)}this._newString="New";this._templateString="Template";this._errorTitle="Notification";this._notifyTitle="Error";this._updateMessage="Template successfully updated";this._addMessage="New template successfully added";this._toolbarKey="BE0855F9-9BA9-4068-A7B9-AEC8D5F8FA17";a=Utils.get_spacingSize();var e=this,f=Utils.debounce(function(){b.layoutApi.get_state("west").isClosed||
b.layoutApi.openPane("west")},250);h&&0<h.length&&h.sort(function(a,b){return a.Frames.length-b.Frames.length});var I=l.subscribe(EventNames.ToolbarCreated,function(a,b){t.disable("SaveTemplate"+e._toolbarKey);t.enable("NewTemplate"+e._toolbarKey,function(){return e.canAdd()});t.enable(["DrawTemplateBox"+e._toolbarKey,"DeleteTemplateBox"+e._toolbarKey],function(){return e.canDraw()});t.enable("DeleteTemplate"+e._toolbarKey,function(){return e._authenticationService.hasPermission(PermissionNames.CanDeleteTemplates)});
t.enable("RenameTemplate"+e._toolbarKey,function(){return e.canDraw()});t.enable("ImportTemplates"+e._toolbarKey,function(){return p.hasPermission(PermissionNames.CanImportTemplates)});t.enable("ExportTemplates"+e._toolbarKey,function(){return p.hasPermission(PermissionNames.CanExportTemplates)});t.enable(["ToggleGrid"+e._toolbarKey,"ToggleSnapToGrid"+e._toolbarKey],function(){return e._authenticationService.hasPermission(PermissionNames.CanEditTemplates)});t.enable(e._alignmentActions,function(){return!1});
t.press("SelectTemplateBox"+e._toolbarKey);I();e.setToggleGridState();e.setToggleSnapToGridState()});l.subscribe(EventNames.TemplatesImported,this.templatesImported.bind(this));this._authenticationService=p;this._templateEditorService=d;this._templateService=n;this._toolbarService=t;this._dialogs=r;this._$window=w;b.idleWait=q.get(OptionNames.IdleWarningDuration);this._dateFormat=q.get(OptionNames.DateFormat);this._timeFormat=q.get(OptionNames.TimeFormat);d.templateEditController=this;m("NEW").then(function(a){this.newString=
a}.bind(this));m("TEMPLATE").then(function(a){this.templateString=a}.bind(this));m("DIALOGS_NOTIFICATION").then(function(a){this._notifyTitle=a}.bind(this));m("DIALOGS_ERROR").then(function(a){this._errorTitle=a}.bind(this));m("DIALOGS_TEMPLATE_ADDED").then(function(a){this._addMessage=a}.bind(this));m("DIALOGS_TEMPLATE_UPDATE").then(function(a){this._updateMessage=a}.bind(this));this._scope=b;this._modal=k;this._isDirty=!1;this.initializeToolbar();b.layoutConfig={applyDemoStyles:!0,scrollToBookmarkOnLoad:!1,
spacing_closed:a,spacing_open:a,livePaneResizing:!1,north__size:"auto",north__resizable:!1,north__showOverflowOnHover:!0,west__size:lt.LTHelper.device==lt.LTDevice.tablet?"30%":lt.LTHelper.device==lt.LTDevice.mobile?"60%":"20%",west__initClosed:!1};b.layoutApi={};b.editorApi={};b.layout={};b.templates=h;b.editorConfig={keepDrawing:!0,editorMode:EditorMode.Select,editAfterDraw:!1,onSelectedItemsChanged:this.onSelectedItemsChanged.bind(this),onFrameChanged:this.onFrameChanged.bind(this),borderSize:q.get(OptionNames.TemplateBorderSize),
borderColor:q.get(OptionNames.TemplateBorderColor),backgroundColor:q.get(OptionNames.TemplateBackgroundColor),foreColor:q.get(OptionNames.TemplateForeColor),boundsNotification:q.get(OptionNames.TemplateBoundsNotification)};l.subscribe(EventNames.CenterPaneResized,function(a,b){"mainCenter"==b.args.element.attr("id")&&f()});b.onSelect=this.onSelect.bind(this);b.onNewTemplate=this.onNewTemplate.bind(this);b.onCopyTemplate=this.onCopyTemplate.bind(this);b.loadTemplate=this.loadTemplate.bind(this);b.onPropertyChanged=
this.onPropertyChanged.bind(this);b.onPropertyClicked=this.onPropertyClicked.bind(this);b.onNewFrame=this.onNewFrame.bind(this);b.onExitEditor=function(){g.path("/")};0<b.templates.length&&(this.load(b.templates[0]),angular.isDefined(b.currentTemplate)&&(this._scope.cancelMove=this._scope.currentTemplate.BuiltIn));b.canSave=this.canSave.bind(this);b.canDraw=this.canDraw.bind(this);b.canAdd=this.canAdd.bind(this);this._timerId=null;this._optionsService=q;b.$watch("windowDimensions",function(a,c){b.layoutApi&&
(b.layoutApi.refresh?b.layoutApi.refresh():setTimeout(function(){b.layoutApi.refresh();b.layoutApi.openPane("west")},1E3))});b.$on("$idleStart",function(){b.warning=k.open({templateUrl:"warning-dialog.html",windowClass:"modal-danger"})});b.$on("$idleEnd",function(){c()});b.$on("$idleTimeout",function(){c();x.unwatch();p.logout()})}Object.defineProperty(b.prototype,"currentTemplateName",{get:function(){return this._scope.currentTemplate.Name},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"currentTemplateId",{get:function(){return this._scope.currentTemplate.Id},enumerable:!0,configurable:!0});b.prototype.initializeToolbar=function(){var a=new Models.Toolbar;this._scope.toolbars=[];a.name="Template";this._alignmentActions=[];this.addToolbarItem(a,"NewTemplate","OnNewTemplate","New Template","NewTemplate","New");this.addToolbarItem(a,"SaveTemplate","OnSaveTemplate","Save Template","SaveTemplate","Save");this.addToolbarItem(a,"RenameSeperator","","","","","seperator");this.addToolbarItem(a,
"RenameTemplate","OnRenameTemplate","Rename Template","RenameTemplate","Rename");this.addToolbarItem(a,"CopyTemplate","OnCopyTemplate","Copy Template","CopyTemplate","Copy");this.addToolbarItem(a,"DeleteTemplate","OnDeleteTemplate","Delete Template","DeleteTemplate","Delete");this.addToolbarItem(a,"GridSeperator","","","","","seperator");this.addToolbarItem(a,"ConfigureGrid","OnConfigureGrid","Configure Grid","Configure","Configure");this.addToolbarItem(a,"ToggleGrid","OnToggleGrid","Toggle Grid",
"ToggleGrid","Grid");this.addToolbarItem(a,"ToggleSnapToGrid","OnToggleSnapToGrid","Toggle Snap to Grid","SnapToGrid","Snap");this.addToolbarItem(a,"SelectSeperator","","","","","seperator");this.addToolbarItem(a,"SelectTemplateBox","OnSelectBox","Select Box","SelectTemplateBox","Select Box");this.addToolbarItem(a,"DrawTemplateBox","OnDrawBox","Draw Box","DrawTemplateBox","Draw Box");this.addToolbarItem(a,"DeleteTemplateBox","OnDeleteBox","Delete Box","DeleteTemplateBox","Delete Box");this.addToolbarItem(a,
"AlignmentSeperator","","","","","seperator");this.addToolbarItem(a,"AlignLeft","OnAlignLeft","Align Left","AlignLeft","Align left");this._alignmentActions.push("AlignLeft"+this._toolbarKey);this.addToolbarItem(a,"AlignRight","OnAlignRight","Align Right","AlignRight","Align right");this._alignmentActions.push("AlignRight"+this._toolbarKey);this.addToolbarItem(a,"AlignCenter","OnAlignCenter","Align Center","AlignCenter","Align center");this._alignmentActions.push("AlignCenter"+this._toolbarKey);this.addToolbarItem(a,
"AlignTop","OnAlignTop","Align Top","AlignTop","Align top");this._alignmentActions.push("AlignTop"+this._toolbarKey);this.addToolbarItem(a,"AlignBottom","OnAlignBottom","Align Bottom","AlignBottom","Align bottom");this._alignmentActions.push("AlignBottom"+this._toolbarKey);this.addToolbarItem(a,"AlignMiddle","OnAlignMiddle","Align Middle","AlignMiddle","Align middle");this._alignmentActions.push("AlignMiddle"+this._toolbarKey);this.addToolbarItem(a,"SameWidth","OnMakeSameWidth","Make Same Width",
"MakeSameWidth","Same Width");this._alignmentActions.push("SameWidth"+this._toolbarKey);this.addToolbarItem(a,"SameHeight","OnMakeSameHeight","Make Same Height","MakeSameHeight","Same Height");this._alignmentActions.push("SameHeight"+this._toolbarKey);this.addToolbarItem(a,"SameSize","OnMakeSameSize","Make Same Size","MakeSameSize","Same Size");this._alignmentActions.push("SameSize"+this._toolbarKey);this.addToolbarItem(a,"ExportSeperator","","","","","seperator");this.addToolbarItem(a,"ExportTemplates",
"OnExportTemplates","Export All Templates","ExportTemplates","Export");this.addToolbarItem(a,"ImportTemplates","OnImportTemplates","Import Templates","ImportTemplates","Import");this.addToolbarItem(a,"ReturnToViewer","OnReturnToViewer","Return to viewer","RotateCounterClock","Return");this._scope.toolbars.push(a)};b.prototype.addToolbarItem=function(a,b,d,g,h,k,l){var c=new Models.ToolbarItem;c.id=b;c.action=d;c.tooltip=g;c.cssIconClass=h;c.type=l||"button";c.caption=k;a.items.push(c)};b.prototype.onSelect=
function(){this._scope.editorConfig.editorMode=EditorMode.Select;this._toolbarService.press("SelectTemplateBox"+this._toolbarKey);this._toolbarService.unpress("DrawTemplateBox"+this._toolbarKey)};b.prototype.onDraw=function(){this._scope.editorConfig.editorMode=EditorMode.Draw;this._toolbarService.unpress("SelectTemplateBox"+this._toolbarKey);this._toolbarService.press("DrawTemplateBox"+this._toolbarKey)};b.prototype.onDeleteSelectedFrames=function(){var a=this._templateEditorService.selectedFrames;
if(this._scope.currentTemplate.Frames&&a)for(var b=a.length,d=0;d<b;d++){var g=this._scope.currentTemplate.Frames.indexOf(a[d]);-1!=g&&this._scope.currentTemplate.Frames.splice(g,1)}};b.prototype.saveTemplate=function(a){var b=this;0==this._scope.currentTemplate.Frames.length?alert("Template is Empty, it will not be saved."):this._isNew?this._templateService.AddTemplate(this._scope.currentTemplate).then(function(){b._isNew&&(b._isNew=!1,delete b._scope.currentTemplate.isNew);b._isDirty=!1;b.checkSave();
angular.isDefined(a)&&a();b._dialogs.notify(b._notifyTitle,b._addMessage)},function(a){}):this._templateService.UpdateTemplate(this._scope.currentTemplate).then(function(c){c.data.FaultType?c.data.Message&&alert(c.data.Message):(b._isDirty=!1,angular.isDefined(a)&&a(),b.checkSave(),b._dialogs.notify(b._notifyTitle,b._updateMessage))},function(a){})};b.prototype.setNewTemplateProperties=function(a){this._scope.currentTemplate=a;this._scope.currentTemplate.isNew=!0;this._scope.templates.push(this._scope.currentTemplate);
this._templateEditorService.selectedFrames=[];this._scope.selectedFrames=[];this._scope.cancelMove=!1;this._isDirty=this._isNew=!0;this.checkSave();this.setTemplateProperties();this._toolbarService.enable(["DrawTemplateBox"+this._toolbarKey,"DeleteTemplateBox"+this._toolbarKey],function(){return this.canDraw()}.bind(this));this._toolbarService.enable(["DeleteTemplateBox"+this._toolbarKey],function(){return this.canDraw()&&0<(this._selectedFrames&&this._selectedFrames.length)}.bind(this));this.onSelect()};
b.prototype.setCloneTemplateProperties=function(a){this._scope.currentTemplate=a;this._scope.currentTemplate.isNew=!0;this._scope.templates.push(this._scope.currentTemplate);this._scope.currentTemplate.Frames&&0<this._scope.currentTemplate.Frames.length?(this._templateEditorService.selectedFrames=[this._scope.currentTemplate.Frames[0]],this._scope.selectedFrames=this._templateEditorService.selectedFrames,this.setFrameProperties(this._scope.selectedFrames[0])):this.setTemplateProperties();this._toolbarService.enable(["DrawTemplateBox"+
this._toolbarKey],function(){return this.canDraw()}.bind(this));this._originalTemplate=angular.copy(a);this._isDirty=this._isNew=!0;this.checkSave();this.onSelect()};b.prototype.onNewTemplate=function(){var a=new Models.Template(this._newString+" "+this._templateString+" "+this.getDateTime());this.setNewTemplateProperties(a)};b.prototype.onCopyTemplate=function(){var a=new Models.Template("Copy  "+this.getDateTime()),b=this._scope.currentTemplate;a.Modality=b.Modality;a.Comments=b.Comments;a.AutoMatching=
b.AutoMatching;a.BuiltIn=!1;a.Hidden=!1;a.Availability=Models.TemplateAvailability.SeriesAndStudy;for(var d=0;d<this._scope.currentTemplate.Frames.length;d++){var g=b.Frames[d],h=new Models.Frame(g.Position);h.FrameNumber=g.FrameNumber;h.SequenceNumber=g.SequenceNumber;h.Rotation=g.Rotation;h.ImageComments=g.ImageComments;h.Script=g.Script;h.Flip=g.Flip;h.Reverse=g.Reverse;h.Invert=g.Invert;h.HorizontalJustification=g.HorizontalJustification;h.VerticalJustification=g.VerticalJustification;h.PresentationSizeMode=
g.PresentationSizeMode;h.Magnification=g.Magnification;a.Frames.push(h)}this.setCloneTemplateProperties(a)};b.prototype.canSave=function(){return this._isDirty};b.prototype.canDraw=function(){return null!=this._scope.currentTemplate&&!this._scope.currentTemplate.BuiltIn&&this._authenticationService.hasPermission(PermissionNames.CanEditTemplates)};b.prototype.canAdd=function(){return this._authenticationService.hasPermission(PermissionNames.CanAddTemplates)};b.prototype.loadTemplate=function(a){if(this._scope.currentTemplate!=
a){if(angular.isDefined(this._scope.currentTemplate.isNew)&&0==this._scope.currentTemplate.Frames.length){var b=this._scope.templates.indexOf(this._scope.currentTemplate);this._scope.templates.splice(b,1);this.load(a)}this._isDirty?this.confirmSave(function(b){b?this.saveTemplate(function(){angular.isDefined(this._scope.currentTemplate.isNew)&&delete this._scope.currentTemplate.isNew;this.load(a)}.bind(this)):this.load(a)}.bind(this)):this.load(a)}};b.prototype.deleteCurrentTemplate=function(){var a=
this._scope.templates.indexOf(this._scope.currentTemplate);-1!=a&&this._scope.templates.splice(a,1);--a;0>a&&(a=0);0<this._scope.templates.length&&this.load(this._scope.templates[a])};b.prototype.onAlignLeft=function(){this.getAutomation().alignLefts();this._scope.editorApi.updatePositions()};b.prototype.onAlignRight=function(){this.getAutomation().alignRights();this._scope.editorApi.updatePositions()};b.prototype.onAlignCenter=function(){this.getAutomation().alignCenters();this._scope.editorApi.updatePositions()};
b.prototype.onAlignTop=function(){this.getAutomation().alignTops();this._scope.editorApi.updatePositions()};b.prototype.onAlignBottom=function(){this.getAutomation().alignBottoms();this._scope.editorApi.updatePositions()};b.prototype.onAlignMiddle=function(){this.getAutomation().alignMiddles();this._scope.editorApi.updatePositions()};b.prototype.onMakeSameWidth=function(){this.getAutomation().makeSameWidth();this._scope.editorApi.updatePositions()};b.prototype.onMakeSameHeight=function(){this.getAutomation().makeSameHeight();
this._scope.editorApi.updatePositions()};b.prototype.onMakeSameSize=function(){this.getAutomation().makeSameSize();this._scope.editorApi.updatePositions()};b.prototype.onToggleGrid=function(){this.getAutomation().manager.snapToGridOptions.showGrid=!this.getAutomation().manager.snapToGridOptions.showGrid;this.setToggleGridState();this.getAutomation().invalidate(lt.LeadRectD.empty);this._optionsService.saveUserOption(OptionNames.ShowGrid,this.getAutomation().manager.snapToGridOptions.showGrid).success(function(){this._optionsService.set(OptionNames.ShowGrid,
this.getAutomation().manager.snapToGridOptions.showGrid)}.bind(this)).error(function(a,b){})};b.prototype.setToggleGridState=function(){this.getAutomation().manager.snapToGridOptions.showGrid?this._toolbarService.press("ToggleGrid"+this._toolbarKey):this._toolbarService.unpress("ToggleGrid"+this._toolbarKey)};b.prototype.onToggleSnapToGrid=function(){this.getAutomation().manager.snapToGridOptions.enableSnap=!this.getAutomation().manager.snapToGridOptions.enableSnap;this.setToggleSnapToGridState();
this._optionsService.saveUserOption(OptionNames.SnapToGrid,this.getAutomation().manager.snapToGridOptions.enableSnap).success(function(){this._optionsService.set(OptionNames.SnapToGrid,this.getAutomation().manager.snapToGridOptions.enableSnap)}.bind(this)).error(function(a,b){})};b.prototype.setToggleSnapToGridState=function(){this.getAutomation().manager.snapToGridOptions.enableSnap?this._toolbarService.press("ToggleSnapToGrid"+this._toolbarKey):this._toolbarService.unpress("ToggleSnapToGrid"+this._toolbarKey)};
b.prototype.onReturnToViewer=function(){this._isDirty?this.confirmSave(function(a){a?this.saveTemplate(function(){angular.isDefined(this._scope.currentTemplate.isNew)&&delete this._scope.currentTemplate.isNew;this.reload()}.bind(this)):this.reload()}.bind(this)):this.reload()};b.prototype.reload=function(){sessionStorage.setItem("AuthCode",this._authenticationService.authenticationCode);this._$window.location.reload()};b.prototype.get_GetLineSpacing=function(){return this.getAutomation().manager.snapToGridOptions.lineSpacing};
b.prototype.get_GridLength=function(){return this.getAutomation().manager.snapToGridOptions.gridLength};b.prototype.set_LineSpacing=function(a){a!=this.getAutomation().manager.snapToGridOptions.lineSpacing&&(this.getAutomation().manager.snapToGridOptions.lineSpacing=a,this.getAutomation().invalidate(lt.LeadRectD.empty))};b.prototype.set_GridLength=function(a){a!=this.getAutomation().manager.snapToGridOptions.gridLength&&(this.getAutomation().manager.snapToGridOptions.gridLength=a,this.getAutomation().invalidate(lt.LeadRectD.empty))};
b.prototype.getAutomation=function(){return this._scope.editorApi.getAutomation()};b.prototype.load=function(a){this._scope.currentTemplate=a;this._scope.cancelMove=this._scope.currentTemplate.BuiltIn||!this._authenticationService.hasPermission(PermissionNames.CanEditTemplates);this._scope.currentTemplate.Frames&&0<this._scope.currentTemplate.Frames.length?(this._templateEditorService.selectedFrames=[this._scope.currentTemplate.Frames[0]],this._scope.selectedFrames=this._templateEditorService.selectedFrames,
this.setFrameProperties(this._scope.selectedFrames[0])):this.setTemplateProperties();this._toolbarService.enable(["DrawTemplateBox"+this._toolbarKey],function(){return this.canDraw()}.bind(this));this._originalTemplate=angular.copy(a);this._isDirty=!1};b.prototype.onSelectedItemsChanged=function(a){var b=!1;0==a.length||1<a.length?(this.setTemplateProperties(),1<a.length&&(b=!0)):(this.setFrameProperties(a[0]),b=!0,this._scope.editorConfig.editorMode==EditorMode.Draw&&(this._scope.editorConfig.editorMode=
EditorMode.Select,this._toolbarService.press("SelectTemplateBox"+this._toolbarKey),this._toolbarService.unpress("DrawTemplateBox"+this._toolbarKey)));this._toolbarService.enable(["DeleteTemplateBox"+this._toolbarKey],function(){return this.canDraw()&&b}.bind(this));this._templateEditorService.selectedFrames=a;1<a.length?null==this._timerId&&(this._timerId=setInterval(this.onCheckAlignment.bind(this),500)):null!=this._timerId&&(clearInterval(this._timerId),this._timerId=null,this._toolbarService.enable(this._alignmentActions,
function(){return!1}))};b.prototype.onCheckAlignment=function(){var a=this.getAutomation();if(a.currentEditObject instanceof lt.Annotations.Engine.AnnSelectionObject){var b=a.currentEditObject,d=!this._scope.currentTemplate.BuiltIn&&this._authenticationService.hasPermission(PermissionNames.CanEditTemplates);this._toolbarService.enable(this._alignmentActions,function(){return null!=b.alignmentTarget&&d})}};b.prototype.onFrameChanged=function(a,b){this._isDirty=!0;this.checkSave()};b.prototype.onPropertyClicked=
function(b,d){var c=this;"Auto Match"==b&&this._modal.open({templateUrl:"views/dialogs/ScriptEditor.html",controller:a.ScriptEditorController,backdrop:"static",size:"lg",resolve:{label:function(){return"Script"},text:function(){return c._scope.currentTemplate.AutoMatching?c._scope.currentTemplate.AutoMatching:"//following is an auto generated sample script \n//template will be applied automatically if the series number matches \nvar ars = dicom['00200011'];//series number tag \nvar success = false; \nif (ars && ars.Value && ars.Value.length > 0) { \nvar _val = ars.Value[0];\nsuccess = _val == 'series_number_here';//have the to-be-matched series number here \n} \nsuccess == true"},
readOnly:function(){return!1}}}).result.then(function(a){c._scope.currentTemplate.AutoMatching!=a&&(c._scope.currentTemplate.AutoMatching=a,c._isDirty=!0,c.checkSave(),c.setTemplateProperties())})};b.prototype.onPropertyChanged=function(a,b){this._isDirty=!0;switch(a){case "Rotation":this._templateEditorService.selectedFrames[0].Rotation=this.getRotationValue(b);break;case "Comments":0<this._templateEditorService.selectedFrames.length?this._templateEditorService.selectedFrames[0].ImageComments=b:
this._scope.currentTemplate.Comments=b;break;case "Auto Match":this._scope.currentTemplate.AutoMatching=b;break;case "Auto Match Id":this._scope.currentTemplate.AutoMatching="//following is an auto generated sample script \n//template will be applied automatically if the series number matches \nvar ars = dicom['00200011'];//series number tag \nvar success = false; \nif (ars && ars.Value && ars.Value.length > 0) { \nvar _val = ars.Value[0];\nsuccess = _val == '"+b+"';//have the to-be-matched series number here \n} \nsuccess == true";
break;case "Name":this._scope.currentTemplate.Name=b;break;case "Availability":this._scope.currentTemplate.Availability=this.set_availability(b);break;case "SequenceNumber":this._templateEditorService.selectedFrames[0].SequenceNumber=b;break;case "FrameNumber":this._templateEditorService.selectedFrames[0].FrameNumber=b;break;case "Modality":this._scope.currentTemplate.Modality=this.getModalityInfo(b);break;case "Flip":this._templateEditorService.selectedFrames[0].Flip=Utils.toBoolean(b,!1);break;
case "Reverse":this._templateEditorService.selectedFrames[0].Reverse=Utils.toBoolean(b,!1);break;case "Invert":this._templateEditorService.selectedFrames[0].Invert=Utils.toBoolean(b,!1);break;case "Horizontal Justification":this._templateEditorService.selectedFrames[0].HorizontalJustification=this.set_horizontalJustification(b);break;case "Vertical Justification":this._templateEditorService.selectedFrames[0].VerticalJustification=this.set_verticalJustification(b);break;case "Presentation Size Mode":this._templateEditorService.selectedFrames[0].PresentationSizeMode=
this.set_presentationSizeMode(b);break;case "Magnification":this._templateEditorService.selectedFrames[0].Magnification=b}this.checkSave()};b.prototype.onNewFrame=function(a){this._isDirty=!0;this.checkSave()};b.prototype.renameTemplate=function(a){var b=this._scope.currentTemplate.Name;this._scope.currentTemplate.Name=a;(this._isDirty=b!=a)&&this.setTemplateProperties();this.checkSave()};b.prototype.checkSave=function(){this._toolbarService.enable("SaveTemplate"+this._toolbarKey,function(){return this._isDirty}.bind(this))};
b.prototype.setTemplateProperties=function(){if(this._scope.currentTemplate){var a=[],b=!this._scope.currentTemplate.BuiltIn&&this._authenticationService.hasPermission(PermissionNames.CanEditTemplates);var d=this.addProperty("Template","input","","","",this._scope.currentTemplate.Name,"Name");d.enabled=b;a.push(d);d=this.addProperty("Template","input","","","",this._scope.currentTemplate.CreateDate,"Created");d.enabled=b;a.push(d);d=this.addProperty("Template","cdrop","",this._templateEditorService.getModalityDescriptions(),
"",this.getModality(this._scope.currentTemplate.Modality),"Modality");d.enabled=b;a.push(d);d=this.addProperty("Template","input","","","",null!=this._scope.currentTemplate.Comments?this._scope.currentTemplate.Comments:"","Comments");d.enabled=b;a.push(d);d=this.addProperty("Template","cdrop","","Not Available|Series Only|Study Only|Series and Study","",this.get_availability(this._scope.currentTemplate.Availability),"Availability");d.enabled=!0;a.push(d);d=this.addProperty("Template","dialog","",
"","",this._scope.currentTemplate.AutoMatching?"script":"(empty)","Auto Match");d.enabled=!0;a.push(d);d=this.addProperty("Template","input","","","",this.parseAutoMatchId(this._scope.currentTemplate.AutoMatching),"Auto Match Id");d.enabled=!0;a.push(d);this._scope.propertyGridItems=a;this._scope.$$phase||this._scope.$digest()}};b.prototype.parseAutoMatchId=function(a){if(!a)return"";var b=a.indexOf("success = _val == '");if(-1==b)return"";b+=19;var c=a.indexOf("'",b);return-1==c||c<=b?"":a.slice(b,
c)};b.prototype.updateSelectedFrameProperties=function(){this._scope.propertyGridItems[1].value="hello"};b.prototype.setFrameProperties=function(a){var b=[],c=!this._scope.currentTemplate.BuiltIn&&this._authenticationService.hasPermission(PermissionNames.CanEditTemplates);a.readOnly=this._scope.currentTemplate.BuiltIn;var d=this.addProperty("Template Frames","num","","","",a.SequenceNumber,"SequenceNumber");d.enabled=c;b.push(d);d=this.addProperty("Template Frames","num","","","",a.FrameNumber,"FrameNumber");
d.enabled=c;b.push(d);d=this.addProperty("Template Frames","cdrop","","0\u00b0|90\u00b0|180\u00b0|270\u00b0","",Utils.getRotation(a.Rotation),"Rotation");d.enabled=c;b.push(d);d=this.addProperty("Template Frames","cdrop","","true|false","",a.Flip.toString(),"Flip");d.enabled=c;b.push(d);d=this.addProperty("Template Frames","cdrop","","true|false","",a.Reverse.toString(),"Reverse");d.enabled=c;b.push(d);d=this.addProperty("Template Frames","cdrop","","true|false","",a.Invert.toString(),"Invert");d.enabled=
c;b.push(d);d=this.addProperty("Template Frames","cdrop","","Left|Center|Right","",this.get_horizontalJustification(a.HorizontalJustification),"Horizontal Justification");d.enabled=c;b.push(d);d=this.addProperty("Template Frames","cdrop","","Top|Center|Bottom","",this.get_verticalJustification(a.VerticalJustification),"Vertical Justification");d.enabled=c;b.push(d);d=this.addProperty("Template Frames","cdrop","","Scale To Fit|True Size|Magnify","",this.get_presentationSizeMode(a.PresentationSizeMode),
"Presentation Size Mode");d.enabled=c;b.push(d);d=this.addProperty("Template Frames","num","","","",a.Magnification,"Magnification");d.enabled=c;b.push(d);d=this.addProperty("Template Frames","input","","","",null!=a.ImageComments?a.ImageComments:"","Comments");d.enabled=c;b.push(d);this._scope.propertyGridItems=b;this._scope.$$phase||this._scope.$digest()};b.prototype.getModality=function(a){var b=a.split("|"),c=this._templateEditorService.getModalities();if(0==b.length)return a;a=1==b.length?$.grep(c,
function(a,c){return a.classType==b[0]}):$.grep(c,function(a,c){return a.classType==b[0]&&a.description==b[1]});if(0<a.length)return a[0].name+":"+a[0].description};b.prototype.getModalityInfo=function(a){var b=a.split(":");a=this._templateEditorService.getModalities();if(2==b.length&&(a=$.grep(a,function(a,c){return a.name==b[0]&&a.description==b[1]}),0<a.length)){var c=a[0].classType;a[0].saveDescription&&(c+="|"+a[0].description);return c}return""};b.prototype.addProperty=function(a,b,d,g,h,k,
l){var c=new PropertyGridItem;c.groupName=a;c.rowType=b;c.cssName=d;c.dropFields=g;c.isSubGroup=h;c.value=k;c.propertyName=l;c.enabled=!0;return c};b.prototype.getRotationValue=function(a){switch(a){case "180\u00b0":return Models.FrameRotation.Rotate180;case "270\u00b0":return Models.FrameRotation.Rotate270;case "90\u00b0":return Models.FrameRotation.Rotate90}return Models.FrameRotation.None};b.prototype.getAnatomicDescriptionItem=function(a,b,d){return a.AnatomicDescription?a.AnatomicDescription[b]?
a.AnatomicDescription[b].toString():d:d};b.prototype.getLaterality=function(a){if(!a.AnatomicDescription)return"NONE";switch(a.AnatomicDescription.Laterality){case Models.Laterality.Left:return"Left";case Models.Laterality.Right:return"Right";case Models.Laterality.Both:return"Both"}return"Unknown"};b.prototype.get_horizontalJustification=function(a){switch(a){case Models.FrameHorizontalJustification.Left:return"LEFT";case Models.FrameHorizontalJustification.Right:return"RIGHT";default:return"CENTER"}};
b.prototype.set_horizontalJustification=function(a){switch(a){case "LEFT":return Models.FrameHorizontalJustification.Left;case "RIGHT":return Models.FrameHorizontalJustification.Right;default:return Models.FrameHorizontalJustification.Center}};b.prototype.get_verticalJustification=function(a){switch(a){case Models.FrameVerticalJustification.Top:return"TOP";case Models.FrameVerticalJustification.Bottom:return"BOTTOM";default:return"CENTER"}};b.prototype.set_verticalJustification=function(a){switch(a){case "TOP":return Models.FrameVerticalJustification.Top;
case "BOTTOM":return Models.FrameVerticalJustification.Bottom;default:return Models.FrameVerticalJustification.Center}};b.prototype.get_availability=function(a){switch(a){case Models.TemplateAvailability.None:return"Not Available";case Models.TemplateAvailability.Series:return"Series Only";case Models.TemplateAvailability.Study:return"Study Only";case Models.TemplateAvailability.SeriesAndStudy:return"Series and Study";default:return"Series Only"}};b.prototype.set_availability=function(a){switch(a){case "Not Available":return Models.TemplateAvailability.None;
case "Series Only":return Models.TemplateAvailability.Series;case "Study Only":return Models.TemplateAvailability.Study;case "Series and Study":return Models.TemplateAvailability.SeriesAndStudy;default:return Models.TemplateAvailability.Series}};b.prototype.get_presentationSizeMode=function(a){switch(a){case Models.FramePresentationSizeMode.Magnify:return"Magnify";case Models.FramePresentationSizeMode.TrueSize:return"True Size";default:return"Scale To Fit"}};b.prototype.set_presentationSizeMode=function(a){switch(a){case "Magnify":return Models.FramePresentationSizeMode.Magnify;
case "True Size":return Models.FramePresentationSizeMode.TrueSize;default:return Models.FramePresentationSizeMode.ScaleToFit}};b.prototype.confirmSave=function(b){var c=this;this._modal.open({templateUrl:"views/dialogs/Confirmation.html",controller:a.ConfirmDialogControllerScope,backdrop:"static",resolve:{data:function(){return{header:"Template Changed",msg:"Do you want to save changes"}}}}).result.then(function(a){if("cancel"!=a){if("no"==a){var d=c._scope.templates.indexOf(c._scope.currentTemplate);
-1!=d&&(c._scope.templates[d]=c._originalTemplate)}b("yes"==a)}})};b.prototype.templatesImported=function(a,b){0<this.getDiff(b.args.templates,this._scope.templates).length&&(b.args.templates.forEach(function(a){this._scope.templates.push(a)}.bind(this)),angular.isDefined(this._scope.currentTemplate)||this.load(this._scope.templates[0]))};b.prototype.getDiff=function(a,b){var c={};b.forEach(function(a){return c[a.Id]=a});return a.filter(function(a){return!(a.Id in c)})};b.prototype.getDateTime=function(){return(new Date).toString(this._dateFormat+
" "+this._timeFormat)};b.$inject="$rootScope $scope templateEditorService $location templates $modal eventService $translate authenticationService templateService dialogs optionsService toolbarService $timeout $window $idle".split(" ");return b}();a.TemplateEditorController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g){a.header=angular.isDefined(g.header)?g.header:d.instant("DIALOGS_NOTIFICATION");a.msg=angular.isDefined(g.msg)?g.msg:d.instant("DIALOGS_NOTIFICATION_MSG");a.icon=angular.isDefined(g.icon)?g.icon:"fa fa-info";a.no=function(){b.close("no")};a.yes=function(){b.close("yes")};a.cancel=function(){b.dismiss("cancel")}}a.$inject=["$scope","$modalInstance","$translate","data"];return a}();a.ConfirmDialogControllerScope=b})(Controllers||(Controllers={}));
commangular.command("OnNewTemplate",["templateEditorService",function(a){return{execute:function(){a.templateEditController.onNewTemplate()}}}]);commangular.command("OnCopyTemplate",["templateEditorService",function(a){return{execute:function(){a.templateEditController.onCopyTemplate()}}}]);commangular.command("OnSaveTemplate",["templateEditorService",function(a){return{execute:function(){a.templateEditController.saveTemplate()}}}]);
commangular.command("OnRenameTemplate",["templateEditorService","$modal",function(a,b){return{execute:function(){b.open({templateUrl:"views/dialogs/Prompt.html",controller:Controllers.PromptController,backdrop:"static",resolve:{label:function(){return"Rename Template"},text:function(){return a.templateEditController.currentTemplateName}}}).result.then(function(b){a.templateEditController.renameTemplate(b)})}}}]);commangular.command("OnDeleteBox",["templateEditorService",function(a){return{execute:function(){a.templateEditController.onDeleteSelectedFrames()}}}]);
commangular.command("OnDeleteTemplate",["templateEditorService","templateService","$translate","dialogs",function(a,b,d,c){return{execute:function(){var e=a.templateEditController.currentTemplateId,f="Notification",g="Confirmation",h="This will delete the selected template.\nAre you sure?",k="Current template successfully deleted";d("DIALOGS_NOTIFICATION").then(function(a){f=a}.bind(this));d("DIALOGS_ERROR").then(function(a){}.bind(this));d("DIALOGS_TEMPLATE_DELETE").then(function(a){k=a}.bind(this));
d("DIALOGS_CONFIRMATION_TITLE").then(function(a){g=a}.bind(this));d("DIALOGS_TEMPLATE_DELETE_CONFIRMATION").then(function(a){h=a}.bind(this));c.confirm(g,h).result.then(function(d){b.DeleteTemplate(e).success(function(){a.templateEditController.deleteCurrentTemplate();c.notify(f,k)}).error(function(a){c.error(f,a)})})}}}]);commangular.command("OnSelectBox",["templateEditorService",function(a){return{execute:function(){a.templateEditController.onSelect()}}}]);
commangular.command("OnDrawBox",["templateEditorService",function(a){return{execute:function(){a.templateEditController.onDraw()}}}]);commangular.command("OnExportTemplates",["templateService",function(a){return{execute:function(){a.ExportAllTemplates()}}}]);commangular.command("OnImportTemplates",["templateEditorService","$modal",function(a,b){return{execute:function(){b.open({templateUrl:"views/dialogs/Upload.html",controller:Controllers.UploadController,backdrop:"static"})}}}]);
commangular.command("OnAlignLeft",["templateEditorService",function(a){return{execute:function(){a.templateEditController.onAlignLeft()}}}]);commangular.command("OnAlignRight",["templateEditorService",function(a){return{execute:function(){a.templateEditController.onAlignRight()}}}]);commangular.command("OnAlignCenter",["templateEditorService",function(a){return{execute:function(){a.templateEditController.onAlignCenter()}}}]);commangular.command("OnAlignTop",["templateEditorService",function(a){return{execute:function(){a.templateEditController.onAlignTop()}}}]);
commangular.command("OnAlignBottom",["templateEditorService",function(a){return{execute:function(){a.templateEditController.onAlignBottom()}}}]);commangular.command("OnAlignMiddle",["templateEditorService",function(a){return{execute:function(){a.templateEditController.onAlignMiddle()}}}]);commangular.command("OnMakeSameWidth",["templateEditorService",function(a){return{execute:function(){a.templateEditController.onMakeSameWidth()}}}]);
commangular.command("OnMakeSameHeight",["templateEditorService",function(a){return{execute:function(){a.templateEditController.onMakeSameHeight()}}}]);commangular.command("OnMakeSameSize",["templateEditorService",function(a){return{execute:function(){a.templateEditController.onMakeSameSize()}}}]);
commangular.command("OnConfigureGrid",["templateEditorService","$modal","optionsService","authenticationService",function(a,b,d,c){return{execute:function(){b.open({templateUrl:"views/dialogs/GridSettings.html",controller:Controllers.GridSettingsController,backdrop:"static",resolve:{label:function(){return{spacing:"Line Spacing",length:"Grid Length"}},spacing:function(){var b=d.get(OptionNames.GridSpacing);b||(b=a.templateEditController.get_GetLineSpacing());return b},length:function(){var b=d.get(OptionNames.GridLength);
b||(b=a.templateEditController.get_GridLength());return b},title:function(){return"Grid Settings"}}}).result.then(function(b){var c=d.get(OptionNames.GridSpacing),e=d.get(OptionNames.GridLength);c!=b.spacing&&(a.templateEditController.set_LineSpacing(b.spacing),d.saveUserOption(OptionNames.GridSpacing,b.spacing).success(function(){d.set(OptionNames.GridSpacing,b.spacing)}).error(function(a,b){}));e!=b.length&&(a.templateEditController.set_GridLength(b.length),d.saveUserOption(OptionNames.GridLength,
b.length).success(function(){d.set(OptionNames.GridLength,b.length)}).error(function(a,b){}))})}}}]);commangular.command("OnToggleGrid",["templateEditorService",function(a){return{execute:function(){a.templateEditController.onToggleGrid()}}}]);commangular.command("OnToggleSnapToGrid",["templateEditorService",function(a){return{execute:function(){a.templateEditController.onToggleSnapToGrid()}}}]);commangular.command("OnReturnToViewer",["templateEditorService",function(a){return{execute:function(){a.templateEditController.onReturnToViewer()}}}]);
(function(a){var b=function(){function a(a,b,d,g,h,k,l){this.notifyTitle="Notification";this.errorTitle="Error";this.successMessage="Templates successfully imported";k("DIALOGS_NOTIFICATION").then(function(a){this.notifyTitle=a}.bind(this));k("DIALOGS_ERROR").then(function(a){this.errorTitle=a}.bind(this));k("DIALOGS_TEMPLATES_IMPORTED").then(function(a){this.successMessage=a}.bind(this));a.file="";a.uploadFile=this.uploadFile.bind(this);a.ok=function(){b.close()};this._Upload=d;this._templateService=
g;this._eventService=h;this._dialogs=l}a.prototype.uploadFile=function(a){var b=this;this._templateService.ImportTemplates(this._Upload,a).success(function(a,c,d,e){1==a.length&&"GetImportTemplatesError_0F649AC6-0D07-49EA-906C-413256B8A43E"==a[0].Id?b._dialogs.error(b.errorTitle,"Import Failed: "+a[0].Name):(b._eventService.publish(EventNames.TemplatesImported,{templates:a}),b._dialogs.notify(b.notifyTitle,b.successMessage))}).error(function(a,c,d,e,l,m,p,n){b._dialogs.error(b.errorTitle,a)})};a.$inject=
"$scope $modalInstance Upload templateService eventService $translate dialogs".split(" ");return a}();a.UploadController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g,h){var c=this;this._authenticationService=d;this._dialogs=g;a.curPassword="";a.password="";a.confirmPassword="";a.resetPassword=$.proxy(this.resetPassword,this);h("DIALOGS_NOTIFICATION").then(function(a){c._notifyTitle=a});h("DIALOGS_ERROR").then(function(a){c._errorTitle=a});this._scope=a}a.prototype.resetPassword=function(a,b){var c=this;this._authenticationService.validatePassword(b).success(function(d){0==d.length?c._authenticationService.resetCurrentPassword(a,
b).success(function(a){a?c._dialogs.notify(c._notifyTitle,"Password changed successfully."):c._dialogs.error(c._errorTitle,"Failed to change password, make sure the current password is correct.")}).error(function(a){c._dialogs.error(c._errorTitle,a)}):c._dialogs.error(c._errorTitle,d)}).error(function(a){c._dialogs.error(c._errorTitle,a)})};a.$inject="$scope optionsService authenticationService dialogs $translate $timeout".split(" ");return a}();a.UpdatePasswordController=b})(Controllers||(Controllers=
{}));String.prototype.format||(String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,d){return"undefined"!=typeof a[d]?a[d]:b})});var lt;
(function(a){(function(b){(function(b){var c;(function(a){a[a.SinglePage=0]="SinglePage";a[a.MultiPage=1]="MultiPage"})(c=b.AutomationControlMultiContainerMode||(b.AutomationControlMultiContainerMode={}));var d=function(){function b(){var b=this;this._multiContainerMode=c.SinglePage;this.handleGotFocus=function(){b.automationGotFocus.invoke(b,a.LeadEventArgs.empty)};this.automationPointerDown=a.LeadEvent.create(this,"automationPointerDown");this.automationPointerMove=a.LeadEvent.create(this,"automationPointerMove");
this.automationPointerUp=a.LeadEvent.create(this,"automationPointerUp");this.automationDoubleClick=a.LeadEvent.create(this,"automationDoubleClick");this.automationEnabledChanged=a.LeadEvent.create(this,"automationEnabledChanged");this.automationLostFocus=a.LeadEvent.create(this,"automationLostFocus");this.automationGotFocus=a.LeadEvent.create(this,"automationGotFocus");this.automationSizeChanged=a.LeadEvent.create(this,"automationSizeChanged");this.imageViewer_ItemChanged=function(c,d){switch(d.get_reason()){case a.Controls.ImageViewerItemChangedReason.url:case a.Controls.ImageViewerItemChangedReason.image:case a.Controls.ImageViewerItemChangedReason.imageChanged:case a.Controls.ImageViewerItemChangedReason.size:case a.Controls.ImageViewerItemChangedReason.transform:null!=
b.automationTransformChanged&&b.automationTransformChanged.invoke(b,a.LeadEventArgs.empty),null!=b.automationSizeChanged&&b.automationSizeChanged.invoke(b,a.LeadEventArgs.empty)}};this.imageViewer_ActiveItemChanged=function(a,c){b.syncActiveItemContainer(!0)};this.automationObject_ActiveContainerChanged=function(a,c){b.syncActiveItemContainer(!1)};this.automationTransformChanged=a.LeadEvent.create(this,"automationTransformChanged");this.imageViewer_TransformChanged=function(c,d){null!=b.automationTransformChanged&&
b.automationTransformChanged.invoke(b,a.LeadEventArgs.empty)};this.automationUseDpiChanged=a.LeadEvent.create(this,"automationUseDpiChanged");this.imageViewer_PropertyChanged=function(c,d){switch(d.propertyName){case "UseDpi":null!=b.automationUseDpiChanged&&b.automationUseDpiChanged.invoke(b,a.LeadEventArgs.empty)}};this.automationAntiAlias=!1;this.renderingEngine=null;this.imageViewer_PostRender=function(d,e){d=b.renderingEngine;if(null!=d){var f=!1;null!=b.automationObject&&null!=b.automationObject.manager&&
(f=b.automationObject.manager.userMode==a.Annotations.Engine.AnnUserMode.run);var g=e.get_context(),h=g.msImageSmoothingEnabled;try{if(b.get_automationAntiAlias()?g.msImageSmoothingEnabled||(g.msImageSmoothingEnabled=!0):g.msImageSmoothingEnabled&&(g.msImageSmoothingEnabled=!1),null!=b.automationGetContainersCallback){var k=b.automationGetContainersCallback().toArray();if(null!=k)switch(b._multiContainerMode){case c.MultiPage:for(var r=0;r<k.length;r++)if(r<b._imageViewer.get_items().get_count()){var q=
k[r];var t=b._imageViewer.get_items().get_item(r),y=b.automationObject.getContainerInvalidRect(q,!0),w=!y.get_isEmpty();!w&&b._imageViewer.getItemViewBounds(t,a.Controls.ImageViewerItemPart.item,!0).isEmpty||a.Annotations.JavaScript.ImageViewerAutomationControl.renderContainer(e,d,q,f)}break;default:if(null!=b._imageViewer.activeItem&&!b._imageViewer.getItemViewBounds(b._imageViewer.activeItem,a.Controls.ImageViewerItemPart.item,!0).isEmpty)for(r=0;r<k.length;r++)q=k[r],y=b.automationObject.getContainerInvalidRect(q,
!0),(w=!y.get_isEmpty())&&a.Annotations.JavaScript.ImageViewerAutomationControl.renderContainer(e,d,q,f)}}else q=b._container,null!=q&&a.Annotations.JavaScript.ImageViewerAutomationControl.renderContainer(e,d,q,f)}finally{g.msImageSmoothingEnabled!==h&&(g.msImageSmoothingEnabled=h)}}};this.automationContainerIndex=-1;this.automationDataProvider=new a.Annotations.Engine.AnnDataProvider}Object.defineProperty(b.prototype,"multiContainerMode",{get:function(){return this._multiContainerMode},set:function(a){this._multiContainerMode=
a},enumerable:!0,configurable:!0});b.prototype.dispose=function(){this.unHook()};Object.defineProperty(b.prototype,"imageViewer",{get:function(){return this._imageViewer},set:function(a){this._imageViewer!=a&&(this.unHook(),this._imageViewer=a,this.hook())},enumerable:!0,configurable:!0});b.prototype.hook=function(){null!=this._imageViewer&&(this._imageViewer.add_propertyChanged(this.imageViewer_PropertyChanged),this._imageViewer.add_itemChanged(this.imageViewer_ItemChanged),this._imageViewer.add_activeItemChanged(this.imageViewer_ActiveItemChanged),
this._imageViewer.add_transformChanged(this.imageViewer_TransformChanged),this._imageViewer.add_postRender(this.imageViewer_PostRender),this._imageViewer.get_interactiveService().add_tap(this.handleGotFocus))};b.prototype.unHook=function(){null!=this._imageViewer&&(this._imageViewer.remove_propertyChanged(this.imageViewer_PropertyChanged),this._imageViewer.remove_itemChanged(this.imageViewer_ItemChanged),this._imageViewer.remove_activeItemChanged(this.imageViewer_ActiveItemChanged),this._imageViewer.remove_transformChanged(this.imageViewer_TransformChanged),
this._imageViewer.remove_postRender(this.imageViewer_PostRender),this._imageViewer.get_interactiveService().remove_tap(this.handleGotFocus),null!=this.automationObject&&this.automationObject.remove_activeContainerChanged(this.automationObject_ActiveContainerChanged))};b.prototype.get_automationObject=function(){return this.automationObject};b.prototype.set_automationObject=function(a){this.automationObject=a;null!=this.automationObject&&this.automationObject.remove_activeContainerChanged(this.automationObject_ActiveContainerChanged);
this.automationObject=a;null!=this.automationObject&&this.automationObject.add_activeContainerChanged(this.automationObject_ActiveContainerChanged)};b.prototype.add_automationPointerDown=function(a){this.automationPointerDown.add(a)};b.prototype.remove_automationPointerDown=function(a){this.automationPointerDown.remove(a)};b.prototype.add_automationPointerMove=function(a){this.automationPointerMove.add(a)};b.prototype.remove_automationPointerMove=function(a){this.automationPointerMove.remove(a)};
b.prototype.add_automationPointerUp=function(a){this.automationPointerUp.add(a)};b.prototype.remove_automationPointerUp=function(a){this.automationPointerUp.remove(a)};b.prototype.add_automationDoubleClick=function(a){this.automationDoubleClick.add(a)};b.prototype.remove_automationDoubleClick=function(a){this.automationDoubleClick.remove(a)};b.prototype.onAutomationPointerDown=function(a){null!=this.automationPointerDown&&this.automationPointerDown.invoke(this,a)};b.prototype.onAutomationPointerMove=
function(a){null!=this.automationPointerMove&&this.automationPointerMove.invoke(this,a)};b.prototype.onAutomationPointerUp=function(a){null!=this.automationPointerUp&&this.automationPointerUp.invoke(this,a)};b.prototype.onAutomationDoubleClick=function(a){null!=this.automationDoubleClick&&this.automationDoubleClick.invoke(this,a)};b.prototype.get_automationDpiX=function(){return null!=this._imageViewer?this._imageViewer.get_screenDpi().get_width():96};b.prototype.get_automationDpiY=function(){return null!=
this._imageViewer?this._imageViewer.get_screenDpi().get_height():96};b.prototype.get_automationScaleFactor=function(){return 1};b.prototype.get_automationRotateAngle=function(){return 0};b.prototype.get_isAutomationEventsHooked=function(){return!1};b.prototype.set_isAutomationEventsHooked=function(a){};b.prototype.get_automationEnabled=function(){return!0};b.prototype.add_automationEnabledChanged=function(a){this.automationEnabledChanged.add(a)};b.prototype.remove_automationEnabledChanged=function(a){this.automationEnabledChanged.remove(a)};
b.prototype.onEnabledChanged=function(b){null!=this.automationEnabledChanged&&this.automationEnabledChanged.invoke(this,a.LeadEventArgs.empty)};b.prototype.add_automationLostFocus=function(a){this.automationLostFocus.add(a)};b.prototype.remove_automationLostFocus=function(a){this.automationLostFocus.remove(a)};b.prototype.add_automationGotFocus=function(a){this.automationGotFocus.add(a)};b.prototype.remove_automationGotFocus=function(a){this.automationGotFocus.remove(a)};b.prototype.add_automationSizeChanged=
function(a){this.automationSizeChanged.add(a)};b.prototype.remove_automationSizeChanged=function(a){this.automationSizeChanged.remove(a)};b.prototype.syncActiveItemContainer=function(a){if(null!=this.automationObject&&null!=this._imageViewer){var b=this._imageViewer.get_items().get_count(),c=this.automationObject.get_containers().get_count();0!=b&&b==c&&(b=this._imageViewer.get_items().indexOf(this._imageViewer.get_activeItem()),c=-1,null!=this.automationObject.get_activeContainer()&&(c=this.automationObject.get_containers().indexOf(this.automationObject.get_activeContainer())),
b!=c&&(a?-1!=b&&this.automationObject.set_activeContainer(this.automationObject.get_containers().get_item(b)):-1!=c&&this._imageViewer.set_activeItem(this._imageViewer.get_items().get_item(c))))}};b.prototype.getItemForCurrentContainer=function(){if(null==this._imageViewer)return null;if(-1!=this.automationContainerIndex)switch(this._multiContainerMode){case c.MultiPage:return 0<=this.automationContainerIndex&&this.automationContainerIndex<this._imageViewer.get_items().get_count()?this._imageViewer.get_items().get_item(this.automationContainerIndex):
null;default:return this._imageViewer.activeItem}else return this._imageViewer.activeItem};b.prototype.getCurrentContainer=function(){return null!=this.automationObject&&-1!=this.automationContainerIndex?this.automationObject.get_containers().get_item(this.automationContainerIndex):null};b.prototype.get_automationTransform=function(){var b=this.getItemForCurrentContainer();this.getCurrentContainer();return null!=b?this._imageViewer.getItemImageTransformWithDpi(b,!1):a.LeadMatrix.identity};b.prototype.add_automationTransformChanged=
function(a){this.automationTransformChanged.add(a)};b.prototype.remove_automationTransformChanged=function(a){this.automationTransformChanged.remove(a)};b.prototype.get_automationUseDpi=function(){return null!=this._imageViewer&&this._imageViewer.get_useDpi()};b.prototype.add_automationUseDpiChanged=function(a){this.automationUseDpiChanged.add(a)};b.prototype.remove_automationUseDpiChanged=function(a){this.automationUseDpiChanged.remove(a)};b.prototype.get_automationXResolution=function(){var a=this.getItemForCurrentContainer();
return null!=a?a.get_resolution().get_width():96};b.prototype.get_automationYResolution=function(){var a=this.getItemForCurrentContainer();return null!=a?a.get_resolution().get_height():96};b.prototype.automationInvalidate=function(a){null!=this._imageViewer&&this._imageViewer.invalidate(a)};b.prototype.get_automationAntiAlias=function(){return this.automationAntiAlias};b.prototype.set_automationAntiAlias=function(b){this.automationAntiAlias=b;this._imageViewer&&this._imageViewer.invalidate(a.LeadRectD.empty)};
b.prototype.get_renderingEngine=function(){return this.renderingEngine};b.prototype.set_renderingEngine=function(a){this.renderingEngine=a};b.renderContainer=function(a,b,c,d){var e=a.get_context();a=a.get_clipRectangle();b.attach(c,e);try{var f=c.mapper.rectToContainerCoordinates(a);b.render(f,d)}finally{b.detach()}};b.prototype.get_automationGetContainersCallback=function(){return this.automationGetContainersCallback};b.prototype.set_automationGetContainersCallback=function(a){this.automationGetContainersCallback=
a};b.prototype.get_automationContainerIndex=function(){return this.automationContainerIndex};b.prototype.set_automationContainerIndex=function(a){this.automationContainerIndex=a};b.prototype.automationAttach=function(a){this._container=a};b.prototype.automationDetach=function(){this._container=null};b.prototype.get_automationDataProvider=function(){return this.automationDataProvider};b.prototype.set_automationDataProvider=function(a){this.automationDataProvider=a};b.prototype.get_automationScrollOffset=
function(){return null!=this._imageViewer?this._imageViewer.get_scrollOffset():a.LeadPointD.create(0,0)};return b}();b.ImageViewerAutomationControl=d})(b.JavaScript||(b.JavaScript={}))})(a.Annotations||(a.Annotations={}))})(lt||(lt={}));agGrid.initialiseAgGridWithAngular1(angular);
var app=angular.module("MedicalWebViewer","controllers services directives filters ui.bootstrap ngAnimate ngRoute angular-loading-bar ngIdle blockUI colorpicker.module dialogs.main ngSanitize pascalprecht.translate commangular cfp.hotkeys ui.slider ui.grid ui.grid.selection ui.grid.expandable ui.grid.autoResize ui.grid.pinning ui.grid.autoResize ui.grid.pagination agGrid ngFileUpload ui.codemirror angularNumberPicker multiStepForm isteven-multi-select ngPatternRestrict".split(" ")),controllers=angular.module("controllers",
[]),services=angular.module("services",[]),directives=angular.module("directives",[]),filters=angular.module("filters",[]),providers=angular.module("providers",[]),commangularProvider,_jsFileCorePath="Scripts/LEADTOOLS/Leadtools.ImageProcessing.Core.js",_jsFileCoreColorPath="Scripts/LEADTOOLS/Leadtools.ImageProcessing.Color.js";
app.config(["app.config","$routeProvider","$locationProvider","cfpLoadingBarProvider","$idleProvider","blockUIConfigProvider","dialogsProvider","$translateProvider","$commangularProvider","$httpProvider","$keepaliveProvider","$controllerProvider",function(a,b,d,c,e,f,g,h,k,l,m,p){function n(b,c,d){b.get(OptionNames.EnableIdleTimeout)&&(e.idleDuration(b.get(OptionNames.IdleTimeout)),e.warningDuration(b.get(OptionNames.IdleWarningDuration)),c.watch());m.http("HeartBeat.html");d.start();a.runAsEval?
lt.RasterSupport.setLicenseUri("https://demo.leadtools.com/licenses/v200/LEADTOOLSEVAL.txt","EVAL",function(){lt.RasterSupport.kernelExpired?alert("No LEADTOOLS License\n\nYour license file is missing, invalid or expired. LEADTOOLS will not function. Please contact LEAD Sales for information on obtaining a valid license."):lt.LTHelper.log("LEADTOOLS client license set successfully")}):lt.RasterSupport.setLicenseUri(null,null,function(){lt.RasterSupport.kernelExpired?(alert("No license was found!\n\nYour license file is missing, invalid or expired. This web application will not function."),
$.removeCookie("User",{path:"/"}),$.removeCookie("Pass",{path:"/"}),window.location.reload()):lt.LTHelper.log("License was set successfully")})}function r(a){function b(a){commangularProvider.mapTo(a).asSequence().add(a)}commangularProvider&&(a=a.getCommands(),angular.forEach(a,function(a,b){commangularProvider.mapTo(a).asSequence().add(a)}));b("Compare");b("OnNewTemplate");b("OnCopyTemplate");b("OnSaveTemplate");b("OnRenameTemplate");b("OnDeleteTemplate");b("OnConfigureGrid");b("OnToggleGrid");b("OnToggleSnapToGrid");
b("OnSelectBox");b("OnDrawBox");b("OnDeleteBox");b("OnExportTemplates");b("OnImportTemplates");b("OnAlignLeft");b("OnAlignRight");b("OnAlignCenter");b("OnAlignTop");b("OnAlignBottom");b("OnAlignMiddle");b("OnMakeSameWidth");b("OnMakeSameHeight");b("OnMakeSameSize");b("OnReturnToViewer")}c.includeSpinner=!1;commangularProvider=k;p.allowGlobals();l.interceptors.push("authInterceptor");b.when("/",{templateUrl:"views/medicalviewer.html",controller:Controllers.MedicalWebViewerController,caseInsensitiveMatch:!0,
resolve:{getOptions:["$q","sharedPropertiesService","optionsService","$http","$idle","toolbarService","auditLogService","$keepalive",function(a,b,c,d,e,f,g,h){var k=a.defer();c.GetUserOptions(function(a){n(c,e,h);r(f);g.log_launch();k.resolve(a)},function(a,b,d,f){n(c,e,h);k.resolve(null)});return k.promise}]}}).when("/login",{templateUrl:"views/login.html",caseInsensitiveMatch:!0,controller:Controllers.LoginController,resolve:{getOptions:["$q","sharedPropertiesService","optionsService","$http","$idle",
"toolbarService","auditLogService","$keepalive",function(a,b,c,d,e,f,g,h){var k=a.defer();c.GetUserOptions(function(a){k.resolve(a)},function(a,b,c,d){k.resolve(null)});return k.promise}],loggedIn:["$q","authenticationService","eventService",function(a,b,c){LogUtils.DebugLog("--- $routeProvider [/login]");if(!b.isAuthenticated()){var d=a.defer();a=$.cookie("User");var e=$.cookie("Pass"),f=sessionStorage.getItem("AuthCode");c.subscribe("AuthenticationService/AuthenticationFailed",function(a,b){d.resolve(!1)});
c.subscribe("AuthenticationService/AuthenticationSuccess",function(a,b){d.resolve(!0)});if(null!=f&&0<f.length)sessionStorage.removeItem("AuthCode"),b.getAuthenticationInfo(f,"").success(function(a){b.autologin(a.UserName,f);return d.promise}).error(function(a){LogUtils.DebugLog("getAuthenticationInfo error")});else if(a&&0<a.length&&e&&0<e.length)return b.login(a,e,!1),d.promise}}]}}).when("/login/autologin/:externalControlPort/:token*",{templateUrl:"views/login.html",caseInsensitiveMatch:!0,controller:Controllers.LoginController,
resolve:{loggedIn:["$q","authenticationService","eventService","sharedPropertiesService","$route",function(a,b,c,d,e){LogUtils.DebugLog("--- $routeProvider [/login/autologin]");if(!b.isAuthenticated()){var f=a.defer();$.cookie("User");$.cookie("Pass");c.subscribe("AuthenticationService/AuthenticationFailed",function(a,b){d.SetExternalControlMode(!1);f.resolve(!1)});c.subscribe("AuthenticationService/AuthenticationSuccess",function(a,b){d.SetExternalControlMode(!0);f.resolve(!0)});LogUtils.DebugLog("   calling getAuthenticationInfo: ");
LogUtils.DebugLog("   $route.current.params.token: "+e.current.params.token);var g;b.getAuthenticationInfo(e.current.params.token,"").success(function(a){g=a;d.SetToken(e.current.params.token);a=Number(e.current.params.externalControlPort);d.SetPort(a);d.SetPolling(0!=a);b.autologin(g.UserName,e.current.params.token);return f.promise}).error(function(a){LogUtils.DebugLog("getAuthenticationInfo error")})}}]}}).when("/login/automate/:token*",{templateUrl:"views/login.html",caseInsensitiveMatch:!0,controller:Controllers.LoginController,
resolve:{loggedIn:["$q","authenticationService","eventService","sharedPropertiesService","$route",function(a,b,c,d,e){LogUtils.DebugLog("--- $routeProvider [/automate]");if(!b.isAuthenticated()){var f=a.defer();c.subscribe("AuthenticationService/AuthenticationFailed",function(a,b){d.SetAutoMode(!1);f.resolve(!1)});c.subscribe("AuthenticationService/AuthenticationSuccess",function(a,b){d.SetAutoMode(!0);f.resolve(!0)});LogUtils.DebugLog("   calling getAuthenticationInfo: ");LogUtils.DebugLog("   $route.current.params.token: "+
e.current.params.token);var g;b.getAuthenticationInfo(e.current.params.token,"").success(function(a){g=a;d.SetToken(e.current.params.token);d.SetPolling(!0);b.autologin(g.UserName,e.current.params.token);return f.promise}).error(function(a){LogUtils.DebugLog("getAuthenticationInfo error")})}}]}}).when("/login/auto/:protocol/:token*",{templateUrl:"views/login.html",caseInsensitiveMatch:!0,controller:Controllers.LoginController,resolve:{loggedIn:["$q","authenticationService","eventService","sharedPropertiesService",
"$route",function(a,b,c,d,e){LogUtils.DebugLog("--- $routeProvider [/automate-v2.0]");if(!b.isAuthenticated()){var f=a.defer();c.subscribe("AuthenticationService/AuthenticationFailed",function(a,b){d.SetAutoMode(!1);f.resolve(!1)});c.subscribe("AuthenticationService/AuthenticationSuccess",function(a,b){d.SetAutoMode(!0);f.resolve(!0)});LogUtils.DebugLog("   calling tempAuthenticate: ");LogUtils.DebugLog("   $route.current.params.protocol: "+e.current.params.protocol);LogUtils.DebugLog("   $route.current.params.token: "+
e.current.params.token);var g;b.tempAuthenticate(e.current.params.token,e.current.params.protocol).success(function(a){g=a;d.SetToken(a.Cookie);d.SetPolling(!0);b.autologin(g.UserName,a.Cookie);return f.promise}).error(function(a){LogUtils.DebugLog("tempAuthenticate error");a&&(a.Message?alert(a.Message):alert(a))})}}]}}).when("/login/implicit/:protocol/:token*",{templateUrl:"views/login.html",caseInsensitiveMatch:!0,controller:Controllers.LoginController,resolve:{loggedIn:["$q","authenticationService",
"eventService","sharedPropertiesService","$route",function(a,b,c,d,e){LogUtils.DebugLog("--- $routeProvider [/automate-v2.0]");if(!b.isAuthenticated()){var f=a.defer();c.subscribe("AuthenticationService/AuthenticationFailed",function(a,b){d.SetAutoMode(!1);f.resolve(!1)});c.subscribe("AuthenticationService/AuthenticationSuccess",function(a,b){d.SetAutoMode(!0);f.resolve(!0)});LogUtils.DebugLog("   calling implicitAuthenticate: ");LogUtils.DebugLog("   $route.current.params.protocol: "+e.current.params.protocol);
LogUtils.DebugLog("   $route.current.params.token: "+e.current.params.token);var g;b.implicitAuthenticate(e.current.params.token,e.current.params.protocol).success(function(a){g=a;d.SetToken(a.Cookie);b.autologin(g.UserName,a.Cookie);return f.promise}).error(function(a){LogUtils.DebugLog("implicitAuthenticate error");a&&(a.Message?alert(a.Message):alert(a));d.SetAutoMode(!1);f.resolve(!1);$.removeCookie("User",{path:"/"});$.removeCookie("Pass",{path:"/"});sessionStorage.removeItem("AuthCode");window.location.href=
window.location.href.split("/#")[0]})}}]}}).when("/templateEditor",{templateUrl:"views/TemplateEditorView.html",controller:Controllers.TemplateEditorController,caseInsensitiveMatch:!0,resolve:{templates:["$q","templateService","optionsService",function(a,b,c){var d=a.defer();b.GetAllTemplates().success(function(a){d.resolve(a)}).error(function(){d.resolve(null)});return d.promise}]}}).otherwise({redirectTo:function(a,b){LogUtils.DebugLog("--- $routeProvider [otherwise]: "+b+"--\x3e /login");return"/login"}});
f.autoBlock(!1);f.delay(0);f.message("Please wait...");g.useBackdrop("static");g.useEscClose(!1);g.useCopy(!1);g.setSize("sm");h.useStaticFilesLoader({prefix:"languages/",suffix:".json"});h.preferredLanguage("en-US")}]);app.factory("safeApply",[function(a){return function(a,d){var b=a.$root.$$phase;"$apply"==b||"$digest"==b?d&&a.$eval(d):d?a.$apply(d):a.$apply()}}]);
app.factory("authInterceptor",["$q","$injector",function(a,b){return{response:function(a){if("application/xml; charset=utf-8"===a.headers()["content-type"]&&a.data.FaultType&&a.data.Message&&"ServiceAuthenticationException"===a.data.FaultType&&"Timed-out"===a.data.Message){var c=b.get("authenticationService");alert("Your session with the server has been timed-out.");c.logout()}return a}}}]);app.factory("dataCache",function(){var a={data:{},add:function(b,d){a[b]=d}};return a});
function addPreload(a){var b=document.createElement("link");b.setAttribute("rel","preload");b.setAttribute("as","style");b.setAttribute("href",a);"undefined"!=typeof b&&document.getElementsByTagName("head")[0].appendChild(b)}function addCss(a){var b=document.createElement("link");b.setAttribute("rel","stylesheet");b.setAttribute("type","text/css");b.setAttribute("href",a);"undefined"!=typeof b&&document.getElementsByTagName("head")[0].appendChild(b)}
function loadCss(){lt.LTHelper.device==lt.LTDevice.mobile?(addCss("css/m.toolbar.css"),addPreload("css/toolbarSVG.css"),addCss("css/toolbarSVG.css"),addCss("css/m.app.css")):(addCss("css/toolbar.css"),addPreload("css/toolbarSVG.css"),addCss("css/toolbarSVG.css"));if(lt.LTHelper.device==lt.LTDevice.tablet){var a=document.createElement("style");a.type="text/css";a.innerHTML=".ui-jqgrid tr.jqgrow td {height: 55px;}";document.getElementsByTagName("head")[0].appendChild(a)}}
app.run(["$rootScope","$location","authenticationService","sharedPropertiesService","$window","app.config","dialogs","optionsService","$templateCache",function(a,b,d,c,e,f,g,h,k){var l=document.getElementById("mainView");switch(window.localStorage.getItem("leadmedicalwebviewertheme")){case "dark":c=document.getElementById("theme_css");c.href="css/darktheme.css";break;case "light":c=document.getElementById("theme_css");c.href="css/theme-light.css";break;default:c=document.getElementById("theme_css"),
c.href="css/darktheme.css"}a.Title=f.title;a.windowDimensions={width:e.outerWidth,height:e.outerHeight};angular.element(e).bind("resize",function(){l.style.height=window.innerHeight+"px";a.windowDimensions={width:e.outerWidth,height:e.outerHeight};a.$apply("windowDimensions")});loadCss();l.style.height=window.innerHeight+"px";a.$on("$locationChangeStart",function(c,e,f){LogUtils.DebugLog("*** $locationChangeStart: next: "+e+",  current: "+f);f=-1<b.path().indexOf("/login");d.isAuthenticated()||f?
d.isAuthenticated()&&-1!=e.indexOf("/login")&&"/"==a.previousPath&&(confirm("Navigating back will automatically log you out.  Would you like to continue?")?d.logout():c.preventDefault()):(LogUtils.DebugLog("*** changing $location.path()--\x3e/login"),b.path("/login"))});a.$on("$locationChangeSuccess",function(c){a.previousPath=b.path()});a.$on("$viewContentLoaded",function(){var a=document.getElementById("ltTabWrapper");a&&(a.style.width="100%")});k.put("template/typeahead/typeahead-popup.html",'<ul class="dropdown-menu" ng-show="isOpen()" ng-style="{top: position.top+\'px\', left: position.left+\'px\'}" style="display: block;" role="listbox" aria-hidden="{{!isOpen()}}">\n    <li ng-repeat="match in matches track by $index" ng-class="{active: isActive($index) }" ng-mouseenter="selectActive($index)" ng-click="selectMatch($index)" role="option" id="{{match.id}}">\n        <div typeahead-match index="$index" match="match" query="query" template-url="templateUrl"></div>\n    </li>\n</ul>');
k.put("ui-grid/expandableTopRowHeader","<div />")}]);var EditorMode;(function(a){a.Select=0;a.Draw=1})(EditorMode||(EditorMode={}));var TemplateEditor;(function(a){var b=function(){return function(){this.editAfterDraw=!1;this.editorMode=EditorMode.Draw;this.backgroundColor="lightgray";this.borderColor="red";this.borderSize=0;this.onSelectedItemsChanged=null;this.boundsNotification=!0;this.foreColor="white"}}();a.Config=b})(TemplateEditor||(TemplateEditor={}));
directives.directive("templateEditor",["eventService","$rootScope","$timeout","templateEditorService","$modal","optionsService",function(a,b,d,c,e,f){return{restrict:"A",require:"ngModel",scope:{editorApi:"=?",config:"=",selectedItems:"=",cancelMove:"=",onNewFrame:"&"},link:function(a,b,k,l){function g(){B.defaultCurrentObjectId=a.config.editorMode==EditorMode.Draw?lt.Annotations.Engine.AnnObject.textObjectId:lt.Annotations.Engine.AnnObject.selectObjectId;F.currentObjectId=B.defaultCurrentObjectId}
function h(a,b,c,d){a=y(a.Id);a.labels.rotation&&(a.labels.rotation.text=n(d));B.invalidateObject(a);return d}function n(a){return a==Models.FrameRotation.None?"":Utils.getRotation(a)}function r(a,b,c,d){a=y(a.Id);b=a.labels.frameNumber;angular.isDefined(b)&&(b.text=d.toString(),B.invalidateObject(a));return d}function q(a,b){var c={};b.forEach(function(a){return c[a.Id]=a});return a.filter(function(a){return!(a.Id in c)})}function t(a){a.forEach(function(a,b){b=y(a.Id);null!=b&&B.container.children.remove(b);
a.unwatch("Rotation");a.unwatch("SequenceNumber")});0<a.length&&(B.container.selectionObject.selectedObjects.clear(),B.invalidateContainer(B.container))}function y(a){var b=B.container.children.toArray().filter(function(b,c){return b.tag==a});return 0<b.length?b[0]:null}function w(a){var b=l.$modelValue.filter(function(b,c){return b.Id==a});return 0<b.length?b[0]:null}function x(a){a.forEach(function(a,b){u(a)});B.invalidate(lt.LeadRectD.empty)}function u(b){var c=G(b.Position),d=null;d=B.container.children.toArray().filter(function(a,
c){return a.tag==b.Id});0<d.length?d=d[0]:(d=F.objects.get_item(1).objectTemplate.clone(),d.tag=b.Id,-1==b.FrameNumber&&(b.FrameNumber=M()),-1==b.SequenceNumber&&(b.SequenceNumber=L()),d.text=b.Script,B.container.children.add(d));null!=d&&(d.set_rect(c),d.labels.frameNumber||A(d,b),null==a.selectedItems||1!=a.selectedItems.length||a.selectedItems[0].Id!=b.Id||d.isSelected||B.selectObject(d))}function A(b,c){var d=new lt.Annotations.Engine.AnnLabel;d.text=c.FrameNumber.toString();d.foreground=lt.Annotations.Engine.AnnSolidColorBrush.create(a.config.foreColor);
d.isVisible=!0;d.restrictionMode=lt.Annotations.Engine.AnnLabelRestriction.restrictToObjectBounds;var e=P.measureString(d.text,d.font).height;d.originalPosition=lt.LeadPointD.create(0,e);d.positionMode=lt.Annotations.Engine.AnnLabelPositionMode.relativeToObject;b.labels.frameNumber=d;d=new lt.Annotations.Engine.AnnLabel;d.text=n(c.Rotation);d.foreground=lt.Annotations.Engine.AnnSolidColorBrush.create(a.config.foreColor);d.isVisible=!0;d.restrictionMode=lt.Annotations.Engine.AnnLabelRestriction.restrictToObjectBounds;
d.originalPosition=lt.LeadPointD.create(0,b.bounds.height-e);d.positionMode=lt.Annotations.Engine.AnnLabelPositionMode.relativeToObject;b.labels.rotation=d}function G(a){var b=lt.LeadRectD.create(0,0,B.container.size.width,B.container.size.height);var c=Utils.transformRectangle(O,b,a.leftTop);var d=c.x;var e=c.y;c=Utils.transformRectangle(O,b,a.rightBottom);return lt.LeadRectD.create(d,e,c.x-d,Math.abs(c.y-e))}function I(){var a=B.container,c=lt.LeadSizeD.create($(b).width(),$(b).height());K.onSizeChanged();
null!=a&&(a.size=a.mapper.sizeToContainerCoordinates(c));angular.isDefined(l.$modelValue)&&S(l.$modelValue)}function D(b,c){if(c.object instanceof lt.Annotations.Engine.AnnTextObject){var d=c.object;if(c.operation==lt.Annotations.Engine.AnnEditDesignerOperation.move&&c.operationStatus==lt.Annotations.Engine.AnnDesignerOperationStatus.start&&a.cancelMove)c.cancel=!0;else{c.operation==lt.Annotations.Engine.AnnEditDesignerOperation.moveThumb&&c.operationStatus==lt.Annotations.Engine.AnnDesignerOperationStatus.working&&
d.labels.rotation&&(b=P.measureString(d.labels.rotation.text,d.labels.rotation.font).height,d.labels.rotation.originalPosition=lt.LeadPointD.create(0,d.bounds.bottom-b));if(c.operation==lt.Annotations.Engine.AnnEditDesignerOperation.move&&c.operationStatus==lt.Annotations.Engine.AnnDesignerOperationStatus.working){b=d.bounds;var e=b.left;var f=b.top;if(0<b.width&&a.config.boundsNotification)if(0>e||0>f||0>B.container.size.height-b.bottom||0>B.container.size.width-b.right){var g=function(){if(null!=
d.stroke.strokeDashArray){var a=d.stroke.strokeDashOffset;100<a&&(a=0);d.stroke.strokeDashOffset=a+1;B.invalidateObject(d);setTimeout(function(){g()},10)}};d.stroke.strokeThickness=lt.LeadLengthD.create(3);d.stroke.strokeDashArray=[5,5,2,5];g()}else null!=d.stroke.strokeDashArray&&(d.stroke.strokeThickness=lt.LeadLengthD.create(a.config.borderSize),d.stroke.strokeDashArray=null)}c.operation!=lt.Annotations.Engine.AnnEditDesignerOperation.move&&c.operation!=lt.Annotations.Engine.AnnEditDesignerOperation.moveThumb||
c.operationStatus!=lt.Annotations.Engine.AnnDesignerOperationStatus.end||(z(d),a.config.boundsNotification&&null!=d.stroke.strokeDashArray&&(d.stroke.strokeThickness=lt.LeadLengthD.create(a.config.borderSize),d.stroke.strokeDashArray=null))}}}function z(a){var b=l.$modelValue.filter(function(b,c){return a.tag==b.Id});0<b.length&&(b[0].Position=E(a.rect))}function E(a){var b=new Models.FramePosition;b.leftTop=new lt.LeadPointD;b.leftTop.x=a.left/B.container.size.width;b.leftTop.y=1-a.top/B.container.size.height;
b.rightBottom=new lt.LeadPointD;b.rightBottom.x=b.leftTop.x+a.width/B.container.size.width;b.rightBottom.y=b.leftTop.y-a.height/B.container.size.height;return b}function M(){var a=J("FrameNumber");return N(a)}function L(){var a=J("SequenceNumber");return N(a)}function J(a){for(var b=[],c=0;c<l.$modelValue.length;c++){var d=l.$modelValue[c];-1!=d[a]&&b.push(d[a])}return b.sort(function(a,b){return a>b?1:a<b?-1:0})}function N(a){for(var b=0;b<a.length;b++){var c=b+1;if(a[b]!=c)return a.splice(b,0,c),
a.length=10,c}return b+1}k=new lt.Controls.ImageViewerCreateOptions($(b)[0]);var K=new lt.Controls.ImageViewer(k),P=new lt.Annotations.Rendering.AnnHtml5RenderingEngine,F=lt.Annotations.Automation.AnnAutomationManager.create(P);k=new lt.Annotations.JavaScript.ImageViewerAutomationControl;var Q=new lt.Annotations.JavaScript.AutomationInteractiveMode,B=new lt.Annotations.Automation.AnnAutomation(F,k),H=new TemplateEditor.Config,O={left:0,top:1,width:1,height:-1},S=Utils.debounce(x,350);c.automation=
B;a.config=$.extend(H,a.config);K.items.get_item(0).imageSize=lt.LeadSizeD.create(1,1);(function(b){b=b.get_objects();var c=new lt.Annotations.Automation.AnnAutomationObject;c.set_id(lt.Annotations.Engine.AnnObject.selectObjectId);c.set_name("Select");c.set_drawDesignerType(lt.Annotations.Designers.AnnRectangleDrawDesigner);c.set_editDesignerType(lt.Annotations.Designers.AnnSelectionEditDesigner);c.set_runDesignerType(null);var d=new lt.Annotations.Engine.AnnSelectionObject;d.set_stroke(lt.Annotations.Engine.AnnStroke.create(lt.Annotations.Engine.AnnSolidColorBrush.create("darkgreen"),
lt.LeadLengthD.create(2)));c.set_objectTemplate(d);b.add(c);c=new lt.Annotations.Automation.AnnAutomationObject;c.set_id(lt.Annotations.Engine.AnnObject.textObjectId);c.set_name("Text");c.set_drawDesignerType(lt.Annotations.Designers.AnnRectangleDrawDesigner);c.set_editDesignerType(lt.Annotations.Designers.AnnTextEditDesigner);c.set_runDesignerType(lt.Annotations.Designers.AnnRunDesigner);c.useRotateThumbs=!1;d=new lt.Annotations.Engine.AnnTextObject;d.fill=lt.Annotations.Engine.AnnSolidColorBrush.create(a.config.backgroundColor);
d.text="";d.stroke=lt.Annotations.Engine.AnnStroke.create(lt.Annotations.Engine.AnnSolidColorBrush.create(a.config.borderColor),lt.LeadLengthD.create(a.config.borderSize));c.set_objectTemplate(d);b.add(c)})(F);(function(a){var b=new lt.Annotations.Rendering.AnnRectangleThumbStyle,c=new lt.Annotations.Rendering.AnnEllipseThumbStyle,d=new lt.Annotations.Rendering.AnnEllipseThumbStyle;lt.LTHelper.device==lt.LTDevice.desktop?b.set_size(lt.LeadSizeD.create(80,80)):b.set_size(lt.LeadSizeD.create(160,160));
b.set_stroke(lt.Annotations.Engine.AnnStroke.create(lt.Annotations.Engine.AnnSolidColorBrush.create("black"),lt.LeadLengthD.create(1)));b.set_fill(lt.Annotations.Engine.AnnSolidColorBrush.create("rgba(173, 216, 230, 1)"));c.isVisible=!1;d.isVisible=!1;for(var e in a){var f=a[e];f.set_locationsThumbStyle(b);f.set_rotateCenterThumbStyle(c);f.set_rotateGripperThumbStyle(d)}})(F.renderingEngine.renderers);k.imageViewer=K;Q.automationControl=k;K.defaultInteractiveMode=Q;B.add_currentDesignerChanged(function(a,
b){B.currentDesigner instanceof lt.Annotations.Designers.AnnTextEditDesigner&&B.currentDesigner.add_edit(D)});B.add_beforeObjectChanged(function(a,b){if(b.changeType==lt.Annotations.Automation.AnnObjectChangedType.deleted)for(a=0;a<b.objects.count;a++){var c=b.objects.get_item(a),d=l.$modelValue.filter(function(a){return a.Id==c.tag});0<d.length&&l.$modelValue.splice(l.$modelValue.indexOf(d[0]),1)}});B.add_afterObjectChanged(function(b,c){b=c.objects.count;c.changeType==lt.Annotations.Automation.AnnObjectChangedType.picture&&
B.invalidate(lt.LeadRectD.empty);for(var d=0;d<b;d++)if(c.objects.item(d)instanceof lt.Annotations.Engine.AnnSelectionObject)for(var e=c.objects.item(d),f=e.selectedObjects.count,g=0;g<f;g++){var h=e.selectedObjects.item(g),k=w(h.tag);k&&(h=E(h.rect),k.Position=h,a.config.onFrameChanged(k,c))}else if(a.config.onFrameChanged&&(h=c.objects.item(d),k=w(h.tag)))a.config.onFrameChanged(k,c)});B.add_selectedObjectsChanged(function(b,c){b=B.container.get_selectionObject().get_selectedObjects();if(0<b.count&&
a.config.onSelectedItemsChanged){c=[];for(var d=0;d<b.count;d++){var e=b.item(d);e=w(e.tag);c.push(e)}a.config.onSelectedItemsChanged(c)}else if(a.selectedItems=null,a.config.onSelectedItemsChanged)a.config.onSelectedItemsChanged([])});B.add_draw(function(b,c){c.operationStatus==lt.Annotations.Engine.AnnDesignerOperationStatus.end&&c.object instanceof lt.Annotations.Engine.AnnTextObject&&(b=c.object,null==b.tag&&(c=E(b.rect),c=new Models.Frame(c),b.tag=c.Id,b.text=f.get(OptionNames.DefaultScript),
c.FrameNumber=M(),c.SequenceNumber=L(),A(b,c),l.$modelValue.push(c),a.onNewFrame({frame:c})))});B.add_editText(function(b,c){e.open({templateUrl:"views/dialogs/ScriptEditor.html",controller:Controllers.ScriptEditorController,backdrop:"static",size:"lg",resolve:{label:function(){return"Script"},text:function(){return c.textObject.text},readOnly:function(){return w(c.textObject.tag).readOnly}}}).result.then(function(b){if(c.textObject.text!=b&&(c.get_textObject().set_text(b),B.get_automationControl().automationInvalidate(lt.LeadRectD.empty),
a.config.onFrameChanged)){var d=w(c.textObject.tag);d.Script=b;a.config.onFrameChanged(d,null)}})});g();B.active=!0;F.editObjectAfterDraw=a.config.editAfterDraw;F.restrictDesigners=!0;F.snapToGridOptions.showGrid=!0;F.snapToGridOptions.enableSnap=!0;F.enableObjectsAlignment=!0;(function(){var a=f.get(OptionNames.SnapToGrid);void 0!=a&&(F.snapToGridOptions.enableSnap=a);a=f.get(OptionNames.ShowGrid);void 0!=a&&(F.snapToGridOptions.showGrid=a);if(a=f.get(OptionNames.GridLength))F.snapToGridOptions.gridLength=
parseInt(a);if(a=f.get(OptionNames.GridSpacing))F.snapToGridOptions.lineSpacing=parseInt(a)})();new lt.Annotations.JavaScript.AutomationManagerHelper(F,"");lt.Annotations.Engine.Utils.checkModifierKey=lt.Annotations.JavaScript.AutomationManagerHelper.checkModifierKey;F.multiSelectModifierKey=lt.Annotations.Engine.AnnKeys.control;$(b).resize(function(){I();d(function(){I()},800)});a.editorApi=a.editorApi||{};a.cancelMove=a.cancelMove||!1;a.editorApi.resize=function(){I();d(function(){I()},800)};a.editorApi.getAutomation=
function(){return B};a.editorApi.updatePositions=function(){for(var b=B.container.selectionObject,c=b.selectedObjects.count,d=0;d<c;d++){var e=b.selectedObjects.item(d),f=w(e.tag);f&&(e=E(e.rect),f.Position=e,a.config.onFrameChanged(f,lt.Annotations.Automation.AnnAfterObjectChangedEventArgs.empty))}};a.$watch(function(){return l.$modelValue},function(a,b){a&&(a.forEach(function(a,b){angular.isDefined(a.isWatching)&&a.isWatching.Rotation||(a.watch("Rotation",h),a.watch("FrameNumber",r))}),t(q(b,a)),
a instanceof Array&&x(a))},!0);a.$watch("config",function(b,c){if(angular.isDefined(c)&&(b=Utils.diff(b,c),"equal"!=b.changed)){b=b.value;for(var d in b)if(b.hasOwnProperty(d)&&"equal"!=b[d].changed)switch(d){case "editorMode":g();break;case "editAfterDraw":F.editObjectAfterDraw=a.config.editAfterDraw}}},!0);a.$watch("selectedItems",function(a,b){if(angular.isDefined(a)&&null!=a){b=a.length;for(var c=new lt.Annotations.Engine.AnnObjectCollection,d=0;d<b;d++){var e=y(a[d].Id);null!=e&&c.add(e)}0<c.count&&
B.selectObjects(c)}})}}}]);
var SharedPropertiesService=function(){function a(){this._externalControlMode=this._autoMode=!1;this._authenticationToken="";this._port=0;this._polling=!0}a.prototype.GetExternalControlMode=function(){return this._externalControlMode};a.prototype.SetExternalControlMode=function(a){this._externalControlMode=a};a.prototype.GetAutoMode=function(){return this._autoMode};a.prototype.SetAutoMode=function(a){this._autoMode=a};a.prototype.GetToken=function(){return this._authenticationToken};a.prototype.SetToken=
function(a){this._authenticationToken=a};a.prototype.GetPort=function(){return this._port};a.prototype.SetPort=function(a){this._port=a};a.prototype.GetPolling=function(){return this._polling};a.prototype.SetPolling=function(a){this._polling=a};return a}();services.service("sharedPropertiesService",SharedPropertiesService);var HttpStatus;
(function(a){a.ACCEPTED=202;a.BAD_GATEWAY=502;a.BAD_REQUEST=400;a.CONFLICT=409;a.CONTINUE=100;a.CREATED=201;a.EXPECTATION_FAILED=417;a.FORBIDDEN=403;a.GATEWAY_TIMEOUT=504;a.GONE=410;a.HTTP_VERSION_NOT_SUPPORTED=505;a.INSUFFICIENT_SPACE_ON_RESOURCE=419;a.INSUFFICIENT_STORAGE=507;a.INTERNAL_SERVER_ERROR=500;a.LENGTH_REQUIRED=411;a.LOCKED=423;a.METHOD_FAILURE=420;a.METHOD_NOT_ALLOWED=405;a.MOVED_PERMANENTLY=301;a.MOVED_TEMPORARILY=302;a.MULTI_STATUS=207;a.MULTIPLE_CHOICES=300;a.NO_CONTENT=204;a.NON_AUTHORITATIVE_INFORMATION=
203;a.NOT_ACCEPTABLE=406;a.NOT_FOUND=404;a.NOT_IMPLEMENTED=501;a.NOT_MODIFIED=304;a.OK=200;a.PARTIAL_CONTENT=206;a.PAYMENT_REQUIRED=402;a.PRECONDITION_FAILED=412;a.PROCESSING=102;a.PROXY_AUTHENTICATION_REQUIRED=407;a.REQUEST_TIMEOUT=408;a.REQUEST_TOO_LONG=413;a.REQUEST_URI_TOO_LONG=414;a.REQUESTED_RANGE_NOT_SATISFIABLE=416;a.RESET_CONTENT=205;a.SEE_OTHER=303;a.SERVICE_UNAVAILABLE=503;a.SWITCHING_PROTOCOLS=101;a.TEMPORARY_REDIRECT=307;a.UNAUTHORIZED=401;a.UNPROCESSABLE_ENTITY=422;a.UNSUPPORTED_MEDIA_TYPE=
415;a.USE_PROXY=305})(HttpStatus||(HttpStatus={}));
var Dictionary=function(){function a(){this._dictionary=Object.create(null)}a.prototype.setData=function(a,d){this._dictionary[a]=d};a.prototype.getData=function(a){return this._dictionary[a]};a.prototype.containsKey=function(a){return this._dictionary.hasOwnProperty(a)};a.prototype.removeData=function(a){delete this._dictionary[a]};return a}(),Utils=function(){function a(){}a.clearAllShutter=function(a){var b=a.parentCell.automation,c=a.shutter.objects,e,f=c.count,g=a.container;for(e=0;e<f;e++)g.children.remove(c.get_item(e));
a.get_shutter().get_objects().clear();b.automationControl.automationInvalidate(lt.LeadRectD.empty)};a.getSortableDate=function(a){var b=a.indexOf(" "),c=a.substring(0,b),e=a.substring(b+1,a.lastIndexOf(" ")),f=c.indexOf("/"),g=c.lastIndexOf("/");b=c.substring(g+1,a.length);var h=c.substring(f+1,g);c=c.substring(0,f);if(""==b.trim())return"";f=e.indexOf(":");g=e.lastIndexOf(":");var k=parseInt(e.substring(0,f));f=e.substring(f+1,g);e=e.substring(g+1,e.length);"pm"==a.substring(a.lastIndexOf(" ")+1,
a.length).toLowerCase().trim()?k+=12:12==k&&(k=0);return b+""+c+h+k+f+e};a.toBoolean=function(a,d){if(void 0==a)return d;a=a.toString().toLowerCase();return"true"==a||"yes"==a||"y"==a||"on"==a||"+"==a?!0:"false"==a||"no"==a||"n"==a||"off"==a||"-"==a?!1:d};a.get_thumbnailUrl=function(a){var b=angular.element(document.getElementById("app")).injector(),c=b.get("optionsService"),e=b.get("authenticationService");b=b.get("app.config");return c.get(OptionNames.ShowSearchThumbnails)?(b=b.urls.serviceUrl+
b.urls.objectRetrieveLocalServiceName,b=b+"/GetSeriesThumbnail?"+("auth="+encodeURIComponent(e.authenticationCode)),b+="&study="+a.StudyInstanceUID,b+="&series="+a.InstanceUID,b+="&cx="+c.get(OptionNames.SeriesThumbnailWidth),b+="&cy="+c.get(OptionNames.SeriesThumbnailHeight)):""};a.nameFormatter=function(a){return a?a.replace(/\^/g,", ").toUpperCase():a};a.dateFormatter=function(a,d){var b=Date.parse(a);if(null==b){if(angular.isDefined(a)&&null!=a&&0==a.length)return a;b=new Date(a)}return b?b.toString(d):
a};a.countRenderer=function(a){return a.rowIndex+1};a.hyperlinkCountRenderer=function(a){return"<a href='javascript:void(0)' ng-click='onViewStudy(data)'> "+(a.rowIndex+1).toString()+"</a>"};a.hyperlinkPatientIdRenderer=function(a){return"<a href='javascript:void(0)' ng-click='onViewStudy(data)' title='View Study'> "+a.data.Patient.ID+"</a>"};a.has_mrtiRenderer=function(a){var b=document.createElement("span"),c=document.createTextNode(a.rowIndex+1);b.appendChild(c);a.data.CompleteMRTI||(b.style.fontWeight=
"bold",b.style.color="red");return b};a.clearMrti=function(a,d,c){};a.GetDateLength=function(a){this.canvas||(this.canvas=document.createElement("canvas"));var b=this.canvas.getContext("2d");b.font="14px Arial";return b.measureText(a).width+10};a.dateRendererMultiLines=function(b){var d=angular.element(document.getElementById("app")).injector().get("optionsService");d.get(OptionNames.DateFormat);d.get(OptionNames.TimeFormat);d=a.dateRenderer(b);var c=d.indexOf(" ");b=d.substring(0,c);d=d.substring(c+
1,d.length);return"<span style='font-family: arial; font-size: 100%;'>"+b+"</span> <br> <span style='font-family: arial; font-size: 80%;'>"+d+"</span>"};a.sortableDateRenderer=function(a){angular.element(document.getElementById("app")).injector();a=a.value;if(""==a.trim())return"";a=a.split("_",20);var b="AM",c=parseInt(a[3]);0==c&&(c=12);12<c&&(c-=12,b="PM");return a[1]+"/"+a[2]+"/"+a[0]+" "+c+":"+a[4]+":"+a[5]+" "+b};a.dateRenderer=function(b){var d=angular.element(document.getElementById("app")).injector().get("optionsService"),
c=d.get(OptionNames.DateFormat);d=d.get(OptionNames.TimeFormat);return a.dateFormatter(b.value,c+" "+d)};a.thumbnailRenderer=function(b){var d=document.createElement("span"),c=document.createElement("img");c.src=a.get_thumbnailUrl(b.data);c.style.maxWidth="100%";c.style.maxHeight="100%";c.style.display="block";c.style.margin="0 auto";d.appendChild(c);return d};a.mrtiRenderer=function(a){if(!a.data.CompleteMRTI){var b=document.createElement("i");document.createElement("span");var c=UUID.generate();
b.style.maxWidth="100%";b.style.maxHeight="100%";b.style.display="block";b.style.margin="0 auto";b.style.verticalAlign="middle";a.data.element=b;$(b).attr("id",c);a.data.mrtiCell=c;$(b).addClass("fa fa-hourglass fa-fw");return b}return null};a.createButton=function(a){var b=document.createElement("button");$(b).addClass("btn btn-default");b.appendChild(a);return b};a.dateComparator=function(a,d){return a||d?a?d?new Date(a)-new Date(d):1:-1:0};a.patientIDComparator=function(a,d){return a||d?a?d?new Date(a)-
new Date(d):1:-1:0};a.createLeadRect=function(a,d,c,e){return lt.LeadRectD.create(a,d,Math.abs(c-a),Math.abs(e-d))};a.clone=function(b){return a.myclone(b,null)};a.myclone=function(b,d){if(!b||"object"!=typeof b||"[object Function]"===Object.prototype.toString.call(b))return b;if(b.nodeType&&"cloneNode"in b)return b.cloneNode(!0);if(b instanceof Date)return new Date(b.getTime());if(b instanceof RegExp)return new RegExp(b);var c;if(b instanceof Array){var e=[];var f=0;for(c=b.length;f<c;++f)f in b&&
e.push(a.myclone(b[f],d))}else e=b.constructor?new b.constructor:{};f=a.myclone;var g;c={};for(g in b){var h=!1;var k,l=null==d?0:d.length;for(k=0;k<l;k++)g==d[k]&&(h=!0);h||(h=b[g],g in e&&(e[g]===h||g in c&&c[g]===h)||(e[g]=f?f(h,d):h))}return e};a.get_httpStatusText=function(a){null==this.statusCodes&&(this.statusCodes={},this.statusCodes[HttpStatus.ACCEPTED]="Accepted",this.statusCodes[HttpStatus.BAD_GATEWAY]="Bad Gateway",this.statusCodes[HttpStatus.BAD_REQUEST]="Bad Request",this.statusCodes[HttpStatus.CONFLICT]=
"Conflict",this.statusCodes[HttpStatus.CONTINUE]="Continue",this.statusCodes[HttpStatus.CREATED]="Created",this.statusCodes[HttpStatus.EXPECTATION_FAILED]="Expectation Failed",this.statusCodes[HttpStatus.FORBIDDEN]="Forbidden",this.statusCodes[HttpStatus.GATEWAY_TIMEOUT]="Gateway Timeout",this.statusCodes[HttpStatus.GONE]="Gone",this.statusCodes[HttpStatus.HTTP_VERSION_NOT_SUPPORTED]="HTTP Version Not Supported",this.statusCodes[HttpStatus.INSUFFICIENT_SPACE_ON_RESOURCE]="Insufficient Space on Resource",
this.statusCodes[HttpStatus.INSUFFICIENT_STORAGE]="Insufficient Storage",this.statusCodes[HttpStatus.INTERNAL_SERVER_ERROR]="Server Error",this.statusCodes[HttpStatus.LENGTH_REQUIRED]="Length Required",this.statusCodes[HttpStatus.LOCKED]="Locked",this.statusCodes[HttpStatus.METHOD_FAILURE]="Method Failure",this.statusCodes[HttpStatus.METHOD_NOT_ALLOWED]="Method Not Allowed",this.statusCodes[HttpStatus.MOVED_PERMANENTLY]="Moved Permanently",this.statusCodes[HttpStatus.MOVED_TEMPORARILY]="Moved Temporarily",
this.statusCodes[HttpStatus.MULTI_STATUS]="Multi-Status",this.statusCodes[HttpStatus.MULTIPLE_CHOICES]="Multiple Choices",this.statusCodes[HttpStatus.NO_CONTENT]="No Content",this.statusCodes[HttpStatus.NON_AUTHORITATIVE_INFORMATION]="Non Authoritative Information",this.statusCodes[HttpStatus.NOT_ACCEPTABLE]="Not Acceptable",this.statusCodes[HttpStatus.NOT_FOUND]="Not Found",this.statusCodes[HttpStatus.NOT_IMPLEMENTED]="Not Implemented",this.statusCodes[HttpStatus.NOT_MODIFIED]="Not Modified",this.statusCodes[HttpStatus.OK]=
"OK",this.statusCodes[HttpStatus.PARTIAL_CONTENT]="Partial Content",this.statusCodes[HttpStatus.PAYMENT_REQUIRED]="Payment Required",this.statusCodes[HttpStatus.PRECONDITION_FAILED]="Precondition Failed",this.statusCodes[HttpStatus.PROCESSING]="Processing",this.statusCodes[HttpStatus.PROXY_AUTHENTICATION_REQUIRED]="Proxy Authentication Required",this.statusCodes[HttpStatus.REQUEST_TIMEOUT]="Request Timeout",this.statusCodes[HttpStatus.REQUEST_TOO_LONG]="Request Entity Too Large",this.statusCodes[HttpStatus.REQUEST_URI_TOO_LONG]=
"Request-URI Too Long",this.statusCodes[HttpStatus.REQUESTED_RANGE_NOT_SATISFIABLE]="Requested Range Not Satisfiable",this.statusCodes[HttpStatus.RESET_CONTENT]="Reset Content",this.statusCodes[HttpStatus.SEE_OTHER]="See Other",this.statusCodes[HttpStatus.SERVICE_UNAVAILABLE]="Service Unavailable",this.statusCodes[HttpStatus.SWITCHING_PROTOCOLS]="Switching Protocols",this.statusCodes[HttpStatus.TEMPORARY_REDIRECT]="Temporary Redirect",this.statusCodes[HttpStatus.UNAUTHORIZED]="Unauthorized",this.statusCodes[HttpStatus.UNPROCESSABLE_ENTITY]=
"Unprocessable Entity",this.statusCodes[HttpStatus.UNSUPPORTED_MEDIA_TYPE]="Unsupported Media Type",this.statusCodes[HttpStatus.USE_PROXY]="Use Proxy");if(this.statusCodes.hasOwnProperty(a))return this.statusCodes[a];throw"Status code does not exist: "+a;};a.get_splitterSize=function(){var a=navigator.userAgent.toLowerCase();return lt.LTHelper.device==lt.LTDevice.tablet||-1<a.indexOf("tablet pc")&&-1==a.indexOf("windows nt 10.0")?21:lt.LTHelper.device==lt.LTDevice.mobile?27:7};a.get_spacingSize=function(){return this.isTabletOrMobile()?
10:6};a.isTabletOrMobile=function(){return lt.LTHelper.device==lt.LTDevice.mobile||lt.LTHelper.device==lt.LTDevice.tablet};a.isNumber=function(a,d){if(a){var b=d.getAttribute("max")?d.getAttribute("max").length:null;a=a.which?a.which:a.keyCode;return 190!=a&&189!=a&&109!=a&&31<a&&(48>a||57<a)&&(96>a||105<a)&&(37>a||40<a)&&110!=a&&8!=a&&46!=a?!1:b&&d.value.length>=b&&47<a?!1:!0}};a.debounce=function(a,d,c){var b;return function(){var e=this,g=arguments,h=c&&!b;clearTimeout(b);b=setTimeout(function(){b=
null;c||a.apply(e,g)},d);h&&a.apply(e,g)}};a.transformRectangle=function(a,d,c){var b=new lt.LeadPointD;b.x=(c.x-a.left)/a.width*d.width+d.left;b.y=(c.y-a.top)/a.height*d.height+d.top;return b};a.diff=function(b,d){if(b===d)return{changed:"equal",value:b};for(var c={},e=!0,f=Object.keys(b),g=0,h=f.length;g<h;g++){var k=f[g];if(d.hasOwnProperty(k))if(b[k]===d[k])c[k]={changed:"equal",value:b[k]};else{var l=typeof b[k],m=typeof d[k];!b[k]||!d[k]||"object"!=l&&"function"!=l||"object"!=m&&"function"!=
m?(e=!1,c[k]={changed:"primitive change",removed:b[k],added:d[k]}):(l=a.diff(b[k],d[k]),"equal"==l.changed?c[k]={changed:"equal",value:b[k]}:(e=!1,c[k]=l))}else e=!1,c[k]={changed:"removed",value:b[k]}}f=Object.keys(d);g=0;for(h=f.length;g<h;g++)k=f[g],b.hasOwnProperty(k)||(e=!1,c[k]={changed:"added",value:d[k]});return e?{value:b,changed:"equal"}:{changed:"object change",value:c}};a.accessProperty=function(a,d,c){c=c||d.split(".");return 1<c.length?(d=c.shift(),null==a[d]?null:angular.isDefined(a[d])?
this.accessProperty(a[d],null,c):void 0):a[c.toString()]||void 0};a.roundNumber=function(a,d){return parseFloat(a.toFixed(d))};a.getPosition=function(a,d,c){var b=new Models.FramePosition;b.leftTop=new lt.LeadPointD;b.leftTop.x=a.left/d;b.leftTop.y=1-a.top/c;b.rightBottom=new lt.LeadPointD;b.rightBottom.x=b.leftTop.x+a.width/d;b.rightBottom.y=b.leftTop.y-a.height/c;return b};a.getRotation=function(a){switch(a){case Models.FrameRotation.Rotate180:return"180\u00b0";case Models.FrameRotation.Rotate270:return"270\u00b0";
case Models.FrameRotation.Rotate90:return"90\u00b0"}return"0\u00b0"};a.resetSeriesArrangement=function(a,d){d=Math.min(d.length,a.layout.get_items().get_count());for(var b=0;b<d;b++)a.layout.get_items().get_item(b).set_position(b);var e=a.get_emptyDivs().get_items().get_count();for(b=0;b<e;b++)a.get_emptyDivs().get_items().get_item(b).set_position(b+d)};a.rearrangeSeries=function(b,d){b.layout.beginUpdate();for(var c=b.get_emptyDivs().get_items().get_count(),e=0;e<c;e++){var f=b.get_emptyDivs().get_items().get_item(e).get_position();
b.get_emptyDivs().get_items().get_item(e).set_bounds(a.createLeadRect(d[f][0],d[f][1],d[f][2],d[f][3]));b.get_emptyDivs().get_items().get_item(e).onSizeChanged()}c=Math.min(d.length,b.layout.get_items().get_count());for(e=0;e<c;e++)f=b.layout.get_items().get_item(e).get_position(),b.layout.get_items().get_item(e).set_bounds(a.createLeadRect(d[f][0],d[f][1],d[f][2],d[f][3])),b.layout.get_items().get_item(e).onSizeChanged();for(c=b.layout.get_items().get_count();e<c;e++)b.layout.get_items().get_item(e).set_bounds(a.createLeadRect(0,
0,0,0));b.layout.endUpdate()};a.get_seriesLayout=function(a){var b=angular.element(document.getElementById("app")).injector().get("seriesManagerService").get_layout(a.seriesInstanceUID,a.divID);if(b&&0<b.Boxes.length){b=a.imageViewer;var c=b.items.count,e=b.get_items(),f=a.frames;a=a.framesMappingIndex;b=new Models.Layout;for(var g=0;g<c;g++){var h=e.item(g),k=e.get_item(g);h&&(h=a&&-1!=a[g]?f.item(a[g]):f.item(g),h.Instance&&(h=new Models.ImageBox(h.Instance.SOPInstanceUID),k=k.bounds,h.Position=
new Models.FramePosition(k.topLeft,k.bottomRight),b.Boxes.push(h)))}}return b};a.createViewerLayout=function(b,d,c){var e={},f=d.Frames.length,g=b.imageViewer,h=angular.element(document.getElementById("app")).injector().get("optionsService").get(OptionNames.EmptyCellBackgroundColor);d.Frames.sort(function(a,b){return a.SequenceNumber-b.SequenceNumber});c=angular.isDefined(c)?c:!0;g.beginUpdate();try{b.set_arrangement(1);b.framesMappingIndex=[];b.updateSubCellCount(f);b.templateId=d.Id;for(var k=0;k<
f;k++){var l=g.get_items().get_item(k);var m=a.createLeadRect(d.Frames[k].Position.leftTop.x,1-d.Frames[k].Position.leftTop.y,d.Frames[k].Position.rightBottom.x,1-d.Frames[k].Position.rightBottom.y);l.set_bounds(m);l.backColor=h;l.attachedFrame&&(l.attachedFrame=null);l.templateFrame=d.Frames[k];e[k]=-1;delete l.isMapped;l.add_frameAttached(function(b,c){c.frame&&c.subCell.templateFrame&&(b=c.subCell.templateFrame,a.rotateFrame(c.frame,b),b.Flip&&!c.frame.flipped&&(c.frame.flipped=b.Flip),b.Reverse&&
!c.frame.reversed&&(c.frame.reversed=b.Reverse),c.frame.mrtiInfo&&b.Invert&&!c.frame.inverted&&(c.frame.inverted=b.Invert),a.subCell_setPresentationMode(c.subCell))})}c&&(b.framesMappingIndex=e)}finally{c&&(g.endUpdate(),b.onSizeChanged())}};a.subCell_setPresentationMode=function(a){if(a.templateFrame){var b=a.templateFrame;b.PresentationSizeMode==Models.FramePresentationSizeMode.ScaleToFit?a.attachedFrame.zoom(lt.Controls.Medical.MedicalViewerSizeMode.fit,1):b.PresentationSizeMode==Models.FramePresentationSizeMode.TrueSize?
a.attachedFrame.zoom(lt.Controls.Medical.MedicalViewerSizeMode.trueSize,1):b.PresentationSizeMode==Models.FramePresentationSizeMode.Magnify&&1!=b.Magnification&&a.attachedFrame.zoom(a.attachedFrame.get_scaleMode(),a.attachedFrame.get_scale()*b.Magnification)}};a.rotateFrame=function(a,d){if(d.Rotation!=Models.FrameRotation.None){var b=0;switch(d.Rotation){case Models.FrameRotation.Rotate90:b=90;break;case Models.FrameRotation.Rotate180:b=180;break;case Models.FrameRotation.Rotate270:b=270}0!=b&&(d=
a.get_rotateAngle(),d!=b&&a.set_rotateAngle(d+b))}};a.isInstanceInFrame=function(a,d){if(a.Script){var b=function(a,b){a.setProperty(b,"alert",a.createNativeFunction(function(b){b=b?b.toString():"";return a.createPrimitive(alert(b))}));a.setProperty(b,"dicomJSON",a.createPrimitive(JSON.stringify(d.metadata)))};try{var e=new Interpreter("var dicom = JSON.parse(dicomJSON);"+a.Script,b);e.run();return e.value?e.value.toBoolean():!1}catch(f){console.log(f)}}return d.instanceNumber==a.FrameNumber};a.executeScript=
function(a,d){if(a){var b=function(a,b){a.setProperty(b,"alert",a.createNativeFunction(function(b){b=b?b.toString():"";return a.createPrimitive(alert(b))}));a.setProperty(b,"dicomJSON",a.createPrimitive(d))};try{var e=new Interpreter("var dicom = JSON.parse(dicomJSON);"+a,b);e.run();return e.value?e.value.toBoolean():!1}catch(f){console.log(f)}}return!1};a.findFirst=function(a,d,c){for(var b,f=0,g=a.length;f<g;f++)if(b=a[f],d.call(c,b,f,a))return b;return null};a.findAll=function(a,d,c){for(var b=
[],f=0,g=a.length;f<g;f++)d.call(c,a[f],f,a)&&b.push(a[f]);return b};a.insert=function(a,d,c){d=0>d?this.length+d:d;return a.substring(0,d)+c+a.substring(d)};a.longToDicomTag=function(a){a="00000000"+a.toString(16);var b=a.length;a=a.substring(b-8,b);return a=this.insert(a,4,":")};a.isValidNumber=function(a){return!isNaN(parseFloat(a))&&isFinite(a)};a.get_Modalities=function(){var a=[];a.push({name:"CR",description:"Computed Radiography"});a.push({name:"CT",description:"Computed Tomography"});a.push({name:"MR",
description:"Magnetic Resonance"});a.push({name:"NM",description:"Nuclear Medicine"});a.push({name:"US",description:"Ultrasound"});a.push({name:"OT",description:"Other"});a.push({name:"BI",description:"Biomagnetic imaging"});a.push({name:"DG",description:"Diaphanography"});a.push({name:"ES",description:"Endoscopy"});a.push({name:"LS",description:"Laser surface scan"});a.push({name:"PT",description:"Positron emission tomography (PET)"});a.push({name:"RG",description:"Radiographic imaging (conventional film/screen)"});
a.push({name:"TG",description:"Thermography"});a.push({name:"XA",description:"X-Ray Angiographyy"});a.push({name:"RF",description:"Radio Fluoroscopy"});a.push({name:"DX",description:"Digital Radiography"});a.push({name:"MG",description:"Mammography"});a.push({name:"IO",description:"Intra-oral Radiography"});a.push({name:"PX",description:"Panoramic X-Ray"});a.push({name:"GM",description:"General Microscopy"});a.push({name:"SM",description:"Slide Microscopy"});a.push({name:"XC",description:"External-camera Photography"});
return a};a.is_equal=function(b,d){if(typeof b!==typeof d)return!1;if("function"===typeof b)return b.toString()===d.toString();if(b instanceof Object&&d instanceof Object){if(a.count_props(b)!==a.count_props(d))return!1;var c;for(c in b){var e=a.is_equal(b[c],d[c]);if(!e)return!1}return!0}return b===d};a.count_props=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};a.splitCamelCaseToString=function(a){return a?a.replace(/(^[a-z]+)|[0-9]+|[A-Z][a-z]+|[A-Z]+(?=[A-Z][a-z]|[0-9])/g,
function(a,b){b&&(a=a[0].toUpperCase()+a.substr(1));return a+" "}).trim():""};a.Contains=function(a,d){for(var b=0;b<a.length;b++)if(a[b].id==d.id)return!0;return!1};a.RemoveDuplicates=function(b,d){for(var c=[],e=0;e<d.length;e++)a.Contains(b,d[e])||c.push(d[e]);return c};a.GetNumericPrefix=function(a){return 1==a?"1st":2==a?"2nd":3==a?"3rd":a.toString()+"th"};a.isArrayNumeric=function(a){for(var b=0;b<a.length;b++)if(0==$.isNumeric(a[b]))return!1;return!0};a.verifyNumeric=function(b,d){b=b.split("\\",
5).filter(function(a){return 0!=a.length});var c="";0==d&&(d=b.length);a.isArrayNumeric(b)||(c=1<d?"Values must be numeric. (Example: 1\\3)":"Value must be numeric");return c};a.isNumericVr=function(a){var b=!1;switch(a){case "DS":case "FL":case "FD":case "IS":case "SL":case "SS":case "UL":case "US":b=!0}return b};a.isStringEmpty=function(a){if(null==a||0==a.trim().length)return!0};a.verifySelectorCount=function(a,d){var b=a.split("\\",5).filter(function(a){return 0!=a.length});a=a.split("\\",5).length-
1;b=b.length;var e="";if(0==d)0==b&&(e="Must have at least one value.");else if(b!=d||a!=d-1)e=2==d?"Must have exactly two values. (Example: 1\\3)":1==d?"Must have exactly one value.":"Must have exactly "+d.toString()+" values.";return e};a.statusCodes=null;a.canvas=null;a.countit=0;return a}(),functionCache={};
$.tmplParse=function(a,b){a=/\W/.test(a)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):functionCache[a]=functionCache[a]||$.template(a);return b?a(b):a};
function AssociativeArray(){var a=this;this.Size=function(){var b=0,d;for(d in a)"Size"!=d&&a.hasOwnProperty(d)&&null!=a[d]&&b++;return b}}
Object.prototype.watch||Object.defineProperty(Object.prototype,"watch",{enumerable:!1,configurable:!0,writable:!1,value:function(a,b){var d=this[a],c=d,e=function(){return c},f=function(e){d=c;return c=b.call(this,this,a,d,e)};delete this[a]&&Object.defineProperty(this,a,{get:e,set:f,enumerable:!0,configurable:!0});this.isWatching||(this.isWatching={});this.isWatching[a]=!0}});
Object.prototype.unwatch||Object.defineProperty(Object.prototype,"unwatch",{enumerable:!1,configurable:!0,writable:!1,value:function(a,b){var d=this[a];this.isWatching&&delete this.isWatching[a];delete this[a];void 0==b&&(b=d);this[a]=b}});var DragDrop;
(function(a){var b=function(){function a(){}a.MSEventsHelper=function(){var b=lt.LTHelper.OS==lt.LTOS.windows&&lt.LTHelper.device==lt.LTDevice.mobile;-1!=window.navigator.userAgent.toLocaleLowerCase().indexOf("windows nt 6.2")||b||a.msPointerEnabled?(a.pointerDown="MSPointerDown",a.pointerUp="MSPointerUp",a.pointerCancel="MSPointerCancel",a.pointerMove="MSPointerMove"):(a.pointerDown="pointerdown",a.pointerUp="pointerup",a.pointerCancel="pointercancel",a.pointerMove="pointermove")};a.msPointerEnabled=
lt.LTHelper.msPointerEnabled;a.ctor=a.MSEventsHelper();return a}();(function(){return function(){}})();var d=function(){function a(){}a.fillEvent=function(a,c){var d={x:0,y:0,isTouchEvent:!1};if(a.type===b.pointerDown||a.type===b.pointerMove||a.type===b.pointerUp||a.type===b.pointerCancel)d.isTouchEvent=!0,d.x=parseInt(a.pageX,10),d.y=parseInt(a.pageY,10),a.type===b.pointerDown&&("preventMouseEvent"in a&&a.preventMouseEvent(),"preventManipulation"in a&&a.preventManipulation());else{if("MSGestureChange"===
a.type||"MSGestureEnd"===a.type)return null;if("touchstart"===a.type||"touchmove"===a.type||"touchend"===a.type||"touchcancel"===a.type){d.isTouchEvent=!0;var e="changedTouches"in a;var f=e?a.changedTouches.length:a.touches.length;f=Math.min(lt.LTHelper.supportsMultiTouch?2:1,f);0===f?(d.x=c.x,d.y=c.y):e?(d.x=a.changedTouches[0].pageX,d.y=a.changedTouches[0].pageY):(d.x=a.touches[0].pageX,d.y=a.touches[0].pageY)}else d.isTouchEvent=!1,d.x=parseInt(a.pageX,10),d.y=parseInt(a.pageY,10)}return d};a.startListening=
function(a,c,d){if(b.msPointerEnabled=d)a.addEventListener(b.pointerDown,c.onDown,!1),a.addEventListener(b.pointerMove,c.onMove,!1),a.addEventListener(b.pointerUp,c.onUp,!1),a.addEventListener(b.pointerCancel,c.onUp,!1);if(lt.LTHelper.browser==lt.LTBrowser.edge||lt.LTHelper.browser==lt.LTBrowser.internetExplorer)a.style.touchAction="none",a.style.msTouchAction="none",a.style["touch-action"]="none",a.style["-ms-touch-action"]="none";lt.LTHelper.supportsTouch&&!d&&(a.addEventListener("touchstart",c.onDown,
!1),a.addEventListener("touchmove",c.onMove,!1),a.addEventListener("touchend",c.onUp,!1),a.addEventListener("touchcancel",c.onUp,!1));lt.LTHelper.supportsMouse&&!d&&(a.addEventListener("mousedown",c.onDown,!1),document.addEventListener("mouseup",c.onUp,!1));a.addEventListener("dragstart",c.onDragStart,!1);a.addEventListener("dragend",c.onDragEnd,!1)};a.stopListening=function(a,c,d){d&&(a.removeEventListener(b.pointerDown,c.onDown,!1),a.removeEventListener(b.pointerMove,c.onMove,!1),a.removeEventListener(b.pointerUp,
c.onUp,!1),a.removeEventListener(b.pointerCancel,c.onUp,!1));lt.LTHelper.supportsTouch&&!d&&(a.removeEventListener("touchstart",c.onDown,!1),a.removeEventListener("touchmove",c.onMove,!1),a.removeEventListener("touchend",c.onUp,!1),a.removeEventListener("touchcancel",c.onUp,!1));lt.LTHelper.browser==lt.LTBrowser.edge&&d&&(a.style.touchAction="");lt.LTHelper.supportsMouse&&(d||a.removeEventListener("mousedown",c.onDown,!1));a.removeEventListener("dragstart",c.onDragStart,!1);a.removeEventListener("dragend",
c.onDragEnd,!1)};return a}(),c=function(){return function(){this.isDragging=!1;this.element=null;this.location=lt.LeadPointD.empty;this.placeholders=null;this.targetsHit=[]}}(),e=function(){function a(a){if(!a)throw"No options provided";if(!a.sources||0==a.sources.length)throw"No array of element sources provided";this._msPointerEnabled=lt.LTHelper.msPointerEnabled;lt.LTHelper.browser===lt.LTBrowser.edge&&(this._msPointerEnabled=!1);this._options=a;this._state=new c}a.prototype.start=function(){var a=
this,b=[];this._options.sources.forEach(function(c,e){e=a.setCallbacks(c);b.push(e);d.startListening(c,e,a._msPointerEnabled)});this._callbacks=b};a.prototype.addTargets=function(a){var b=this;if(!a)throw"targetElements cannot be null";if(!a.length)throw"targetElements must be an array";a.forEach(function(a){-1===b._options.targets.indexOf(a)&&b._options.targets.push(a)})};a.prototype.removeTargets=function(a){if(!a)throw"targetElements cannot be null";if(!a.length)throw"targetElements must be an array";
for(var b=[],c=[],d=0,e=a.length;d<this._options.targets.length&&0<e;d++){var f=this._options.targets[d];-1===a.indexOf(f)?(b.push(f),-1!==this._state.targetsHit.indexOf(f)&&c.push(f)):$(f).removeClass(this._options.hitTargetClassName)}this._options.targets=b;this._state.targetsHit=c};a.prototype.dispose=function(){var a=this;this._options.sources.forEach(function(b,c){d.stopListening(b,a._callbacks[c],a._msPointerEnabled)});this._state=this._callbacks=null};a.prototype.setCallbacks=function(a){var b=
{onDown:null,onMove:null,onUp:null,onDragStart:null,onDragEnd:null},c=this,e=this._state,f=this._options;b.onDown=function(b){document.addEventListener("mousemove",c._callbacks[0].onMove,!1);document.addEventListener("drag",c._callbacks[0].onMove,!1);b.preventDefault();b=d.fillEvent(b,e.location);if(!e.isDragging){e.isDragging=!0;e.element=a;e.location=lt.LeadPointD.create(b.x,b.y);if(f.onMouseDown)f.onMouseDown(c,e.element);e.placeholders=[];f.sources.concat(f.anchors).forEach(function(a){var b=
$(a),c=b.position(),d=b.offset();lt.LeadPointD.create(c.left,c.top);c=lt.LeadSizeD.create(b.outerWidth(),b.outerHeight());if(a instanceof HTMLImageElement){var g=document.createElement("canvas");g.width=c.width;g.height=c.height;g.getContext("2d").drawImage(a,0,0,g.width,g.height);g=$(g)}else g=$(document.createElement("div"));g.addClass(f.placeHolderClassName);var h={position:b.css("position"),display:b.css("display"),top:parseInt(b.css("top"),10),left:parseInt(b.css("left"),10)};g.css({position:h.position,
display:h.display,width:c.width,height:c.height,"z-index":100});g.get(0).innerHTML=a.innerHTML;g.data("dragdrop",h);g.data("dragdropbase",a);g.insertAfter(a);e.placeholders.push(g);b.detach();$(document.body).append(b);b.css({position:"fixed",top:d.top,left:d.left,width:c.width,height:c.height,opacity:.5,"z-index":2E4,"-webkit-transform":"translateZ(10px)","-moz-transform":"translateZ(10px)","-o-transform":"translateZ(10px)",transform:"translateZ(10px)"})})}};b.onMove=function(a){a.preventDefault();
var b=d.fillEvent(a,e.location);if(e.isDragging){var g=lt.LeadPointD.create(b.x-e.location.x,b.y-e.location.y);e.location=lt.LeadPointD.create(b.x,b.y);f.sources.concat(f.anchors).forEach(function(a){a=$(a);var b=a.position();b=lt.LeadPointD.create(b.left-parseInt(a.css("margin-left"),10),b.top-parseInt(a.css("margin-top"),10));lt.LeadSizeD.create(a.outerWidth(),a.outerHeight());a.css({top:b.y+g.y,left:b.x+g.x})});var h=[];f.targets.forEach(function(a){var c=$(a),d=c.offset();d=lt.LeadPointD.create(d.left,
d.top);var e=lt.LeadSizeD.create(c.outerWidth(),c.outerHeight());b.x>d.x&&b.x<d.x+e.width&&b.y>d.y&&b.y<d.y+e.height?(c.addClass(f.hitTargetClassName),h.push(a)):c.removeClass(f.hitTargetClassName)});if(0<h.length)if(h.length!==e.targetsHit.length){if(f.onTargetHit)f.onTargetHit(c,e.element,h)}else if(!h.every(function(a){return-1!==e.targetsHit.indexOf(a)}))f.onTargetHit(c,e.element,h);e.targetsHit=h}};b.onUp=function(a){document.removeEventListener("mousemove",c._callbacks[0].onMove,!1);document.removeEventListener("drag",
c._callbacks[0].onMove,!1);a.preventDefault();d.fillEvent(a,e.location);if(e.isDragging){e.placeholders.forEach(function(a){var b=a.data("dragdrop"),c=a.data("dragdropbase");c=$(c);c.detach();c.insertAfter(a);a.remove();c.css({opacity:1,"z-index":0,"-webkit-transform":"","-moz-transform":"","-o-transform":"",transform:""});c.css(b)});if(0<e.targetsHit.length)f.onTargetUp(c,e.element,e.targetsHit);e.element=null;e.isDragging=!1;e.placeholders=null;e.location=lt.LeadPointD.empty;e.targetsHit=[];f.targets.forEach(function(a){$(a).removeClass(f.hitTargetClassName)})}};
b.onDragStart=b.onDown;b.onDragEnd=b.onUp;return b};return a}();a.DragDropBinding=e})(DragDrop||(DragDrop={}));var OptionNames;
(function(a){a.CaptureInfoTextRectFillColor="CaptureInfoTextRectFillColor";a.CaptureInfoTextColor="CaptureInfoTextColor";a.EmptyCellBackgroundColor="EmptyCellBackgroundColor";a.ShowPacsQuery="ShowPacsQuery";a.BlockWhileLoading="BlockWhileLoading";a.EnablePatientIdAutoComplete="EnablePatientIdAutoComplete";a.EnablePatientNameAutoComplete="EnablePatientNameAutoComplete";a.Toolbar="Toolbar";a.DisabledToolbarItems="DisabledToolbarItems";a.DateFormat="DateFormat";a.TimeFormat="TimeFormat";a.SeriesThumbnailWidth=
"SeriesThumbnailWidth";a.SeriesThumbnailHeight="SeriesThumbnailHeight";a.ShowSearchThumbnails="ShowSearchThumbnails";a.DerivedSeriesDescriptionText="DerivedSeriesDescriptionText";a.Derived3DSeriesDescriptionText="Derived3DSeriesDescriptionText";a.DerivedPanoramicSeriesDescriptionText="DerivedPanoramicSeriesDescriptionText";a.EnableSeriesNumberEdit="EnableSeriesNumberEdit";a.EnableProtocolNameEdit="EnableProtocolNameEdit";a.EnableAuditLog="EnableAuditLog";a.LogUserActivity="LogUserActivity";a.LogUserSecurity=
"LogUserSecurity";a.LogSettingChanges="LogSettingChanges";a.LogSecuritySettingChanges="LogSecuritySettingChanges";a.PatientIdMask="PatientIdMask";a.IssuerOfPatientID="IssuerOfPatientID";a.AutoStartCapture="AutoStartCapture";a.ConfirmWorklistSelection="ConfirmWorklistSelection";a.AllowOnlyWorklistQuery="AllowOnlyWorklistQuery";a.EnableModalityWorklistQuery="EnableModalityWorklistQuery";a.TimelinePosition="TimelinePosition";a.SelectedBorderColor="SelectedBorderColor";a.UnSelectedBorderColor="UnSelectedBorderColor";
a.SelectedSubCellBorderColor="SelectedSubCellBorderColor";a.DentalMode="DentalMode";a.SinglePatientMode="SinglePatientMode";a.EnableIdleTimeout="EnableIdleTimeout";a.IdleTimeout="IdleTimeout";a.IdleWarningDuration="IdleWarningDuration";a.SingleSeriesMode="SingleSeriesMode";a.ShowFrameBorder="ShowFrameBorder";a.OverlaySettings="OverlaySettings";a.Toolbars="Toolbars";a.AnnotationStrokeColor="AnnotationStrokeColor";a.AnnotationTextColor="AnnotationTextColor";a.AnnotationHiliteColor="AnnotationHiliteColor";
a.DefaultSeriesRowCount="DefaultSeriesRowCount";a.DefaultSeriesColumnCount="DefaultSeriesColumnCount";a.HideOverlays="HideOverlays";a.RemoteConfig="RemoteConfig";a.MaxStudyResults="MaxStudyResults";a.MaxSeriesResults="MaxSeriesResults";a.MaxPatientResults="MaxPatientResults";a.SearchOtherPatientIds="SearchOtherPatientIds";a.EnablePatientRestriction="EnablePatientRestriction";a.TemplateBorderColor="TemplateBorderColor";a.TemplateBackgroundColor="TemplateBackgroundColor";a.TemplateBorderSize="TemplateBorderSize";
a.TemplateBoundsNotification="TemplateBoundsNotification";a.TemplateForeColor="TemplateForeColor";a.DefaultScript="DefaultScript";a.GridSpacing="GridSpacing";a.GridLength="GridLength";a.SnapToGrid="SnapToGrid";a.ShowGrid="ShowGrid";a.CustomStudyLayout="CustomStudyLayout";a.AutoLoadHangingProtocol="AutoLoadHangingProtocol";a.LazyLoadingThreshold="LazyLoadingThreshold";a.LazyLoadingMobileThreshold="LazyLoadingMobileThreshold";a.LazyLoadingBuffer="LazyLoadingBuffer";a.HideCustomLayouts="HideCustomLayouts";
a.ShowStudyTimeLine="ShowStudyTimeLine";a.LinkImages="LinkImages";a.SplitSeries="SplitSeries";a.StackSingleFrames="StackSingleFrames";a.UseMedicoreLogo="UseMedicoreLogo";a.MPRRenderSide="MprRenderSide";a.RenderingMethod="RenderingMethod";a.CaptureSize="CaptureSize";a.CaptureLayout="CaptureLayout";a.EnableOkta="EnableOktaSignIn";a.EnableShibboleth="EnableShibbolethSignIn";a.EnableCaching="EnableCaching"})(OptionNames||(OptionNames={}));
var OptionsService=function(){function a(a,d,c,e,f){this._httpService=c;this._eventService=f;this._authenticationService=d;this._optionsServiceUrl=a.urls.serviceUrl+a.urls.optionsServiceName;this.InitializeOptions()}a.prototype.InitializeOptions=function(){this._objectDictionary={};this.set(OptionNames.CaptureInfoTextColor,"#000000");this.set(OptionNames.CaptureInfoTextRectFillColor,"#DCDCDC");this.set(OptionNames.EmptyCellBackgroundColor,"#0F0F0F");this.set(OptionNames.DerivedSeriesDescriptionText,
"(D)");this.set(OptionNames.DerivedPanoramicSeriesDescriptionText,"(Derived Panoramic)");this.set(OptionNames.Derived3DSeriesDescriptionText,"(Derived 3D)");this.set(OptionNames.ShowSearchThumbnails,!1);this.set(OptionNames.SeriesThumbnailWidth,"50");this.set(OptionNames.SeriesThumbnailHeight,"50");this.set(OptionNames.EnableAuditLog,!1);this.set(OptionNames.LogUserActivity,!1);this.set(OptionNames.LogUserSecurity,!1);this.set(OptionNames.LogSettingChanges,!1);this.set(OptionNames.LogSecuritySettingChanges,
!1);this.set(OptionNames.PatientIdMask,"");this.set(OptionNames.IssuerOfPatientID,"");this.set(OptionNames.AutoStartCapture,!0);this.set(OptionNames.ConfirmWorklistSelection,!1);this.set(OptionNames.AllowOnlyWorklistQuery,!1);this.set(OptionNames.EnableModalityWorklistQuery,!1);this.set(OptionNames.TimelinePosition,"left");this.set(OptionNames.SelectedBorderColor,"#FF0000");this.set(OptionNames.UnSelectedBorderColor,"#000000");this.set(OptionNames.SelectedSubCellBorderColor,"#000000");this.set(OptionNames.DentalMode,
!1);this.set(OptionNames.SinglePatientMode,!1);this.set(OptionNames.EnableIdleTimeout,!0);this.set(OptionNames.IdleTimeout,30);this.set(OptionNames.IdleWarningDuration,30);this.set(OptionNames.SingleSeriesMode,!1);this.set(OptionNames.ShowFrameBorder,!0);this.set(OptionNames.AnnotationStrokeColor,"#FF0000");this.set(OptionNames.AnnotationTextColor,"#FF0000");this.set(OptionNames.AnnotationHiliteColor,"#FF0000");this.set(OptionNames.DefaultSeriesRowCount,2);this.set(OptionNames.DefaultSeriesColumnCount,
2);this.set(OptionNames.DateFormat,"MM/d/yyyy");this.set(OptionNames.TimeFormat," hh:mm:ss tt");this.set(OptionNames.RemoteConfig,"");this.set(OptionNames.MaxStudyResults,0);this.set(OptionNames.MaxSeriesResults,0);this.set(OptionNames.MaxPatientResults,0);this.set(OptionNames.SearchOtherPatientIds,!1);this.set(OptionNames.EnablePatientRestriction,!1);this.set(OptionNames.TemplateBackgroundColor,"#000000");this.set(OptionNames.TemplateBorderColor,"#FF0000");this.set(OptionNames.TemplateBorderSize,
2);this.set(OptionNames.TemplateBoundsNotification,!0);this.set(OptionNames.TemplateForeColor,"#FFFFFF");this.set(OptionNames.DefaultScript,"true;");this.set(OptionNames.LazyLoadingThreshold,100);this.set(OptionNames.LazyLoadingMobileThreshold,25);this.set(OptionNames.LazyLoadingBuffer,5);this.set(OptionNames.StackSingleFrames,!0);this.set(OptionNames.ShowStudyTimeLine,!1);this.set(OptionNames.LinkImages,!0);this.set(OptionNames.MPRRenderSide,"Server Side");this.set(OptionNames.RenderingMethod,"Hardware Software");
this.set(OptionNames.EnableOkta,!1);this.set(OptionNames.EnableShibboleth,!1);this.set(OptionNames.EnableCaching,!1);this.set(OptionNames.CaptureSize,1024);this.set(OptionNames.CaptureLayout,!0)};a.prototype.set=function(a,d){this._objectDictionary[a]=d};a.prototype.get=function(a){return this._objectDictionary[a]};a.prototype.has=function(a){return this._objectDictionary.hasOwnProperty(a)};a.prototype.should=function(a){return this.has(a)&&1==this.get(a)};a.prototype.GetUserOptions=function(a,d){switch(window.localStorage.getItem("leadmedicalwebviewertheme")){case "dark":var b=
document.getElementById("theme_css");b.href="css/darktheme.css";break;case "light":b=document.getElementById("theme_css");b.href="css/theme-light.css";break;default:b=document.getElementById("theme_css"),b.href="css/darktheme.css"}b="auth="+encodeURIComponent(this._authenticationService.authenticationCode);var e=this;return this._httpService.get(this._optionsServiceUrl+"/GetUserOptions?"+b+"&r="+Date.now()).success(function(b){$.each(b,function(a,b){b.Key?e._objectDictionary[b.Key]=Utils.toBoolean(b.Value,
b.Value):e._objectDictionary[a]=Utils.toBoolean(b,b)});e.set(OptionNames.EnableShibboleth,!1);e._authenticationService.user?e._authenticationService.getUserRoles(e._authenticationService.user).success(function(c){var f=c[0];e.getRoleOption(f,OptionNames.Toolbar+"_main").success(function(c){if(c&&0<c.length){var g=OptionNames.Toolbar+"_main";e._objectDictionary[g]=Utils.toBoolean(g,c);e.getRoleOption(f,OptionNames.DisabledToolbarItems+"_main").success(function(c){if(c&&0<c.length){var d=OptionNames.DisabledToolbarItems+
"_main";e._objectDictionary[d]=Utils.toBoolean(d,c)}a(b)}).error(function(a,b,c,e){d(a,b,c,e)})}else a(b)}).error(function(a,b,c,e){d(a,b,c,e)})}).error(function(a,b,c,e){d(a,b,c,e)}):a(b)}).error(function(a,b,c,e){d(a,b,c,e)})};a.prototype.dictionaryToWCFArray=function(a){var b=[],c;for(c in a)b.push({Key:c,Value:a[c]});return b};a.prototype.saveDefaultOptions=function(a){a=this.dictionaryToWCFArray(a);return this._httpService.post(this._optionsServiceUrl+"/SaveDefaultOptions",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,
options:a}))};a.prototype.saveRoleOptions=function(a,d){d=this.dictionaryToWCFArray(d);return this._httpService.post(this._optionsServiceUrl+"/SaveRoleOptions",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,role:a,options:d}))};a.prototype.getRoleOption=function(a,d){return this._httpService.post(this._optionsServiceUrl+"/GetRoleOption",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,role:a,optionName:d}))};a.prototype.saveUserOption=
function(a,d){return this._httpService.post(this._optionsServiceUrl+"/SaveUserOption",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,optionName:a,optionValue:d}))};a.$inject=["app.config","authenticationService","$http","$location","eventService"];return a}();services.service("optionsService",OptionsService);var PermissionNames;
(function(a){a.CanChangeServerSettings="CanChangeServerSettings";a.CanDeleteFromDatabase="CanDeleteFromDatabase";a.CanEmptyDatabase="CanEmptyDatabase";a.CanCalibrateMonitor="CanCalibrateMonitor";a.CanDeleteAnnotations="CanDeleteAnnotations";a.CanDeleteDownloadInfo="CanDeleteDownloadInfo";a.CanDownloadImages="CanDownloadImages";a.CanManageAccessRight="CanManageAccessRight";a.CanManageRoles="CanManageRoles";a.CanManageUsers="CanManageUsers";a.CanQuery="CanQuery";a.CanQueryPACS="CanQueryPACS";a.CanRetrieve=
"CanRetrieve";a.CanStore="CanStore";a.CanStoreAnnotations="CanStoreAnnotations";a.CanViewAnnotations="CanViewAnnotations";a.CanExport="CanExport";a.CanManageRemotePACS="CanManageRemotePACS";a.CanEditTemplates="CanEditTemplates";a.CanDeleteTemplates="CanDeleteTemplates";a.CanModifyBuiltInTemplates="CanModifyBuiltInTemplates";a.CanAddTemplates="CanAddTemplates";a.CanViewTemplates="CanViewTemplates";a.CanImportTemplates="CanImportTemplates";a.CanExportTemplates="CanExportTemplates";a.CanSaveStructuredDisplay=
"CanSaveStructuredDisplay";a.CanSaveHangingProtocol="CanSaveHangingProtocol";a.CanDeleteCache="CanDeleteCache"})(PermissionNames||(PermissionNames={}));
var UserCredentials=function(){function a(){}Object.defineProperty(a.prototype,"userName",{get:function(){return this._userName},set:function(a){this._userName=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"password",{get:function(){return this._password},set:function(a){this._password=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"userData",{get:function(){return this._userData},set:function(a){this._userData=a},enumerable:!0,configurable:!0});return a}(),
CookieOptions=function(){return function(){}}(),AuthenticationService=function(){function a(a,d,c,e,f){this._httpService=d;this._eventService=e;this._locationService=c;this._window=f;this.authenticationMessage=this.authenticationCode="";this._authUrl=a.urls.serviceUrl+a.urls.authenticationServiceName;this._permissions={}}Object.defineProperty(a.prototype,"permissions",{get:function(){return this._permissions},enumerable:!0,configurable:!0});a.prototype.isAuthenticated=function(){return 0<this.authenticationCode.length};
Object.defineProperty(a.prototype,"authenticationMessage",{get:function(){return this._authenticationMessage},set:function(a){this._authenticationMessage=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"authenticationCode",{get:function(){return this._authenticationCode},set:function(a){this._authenticationCode=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"user",{get:function(){return this._user},enumerable:!0,configurable:!0});a.prototype.refreshPermissions=
function(){var a=$.Deferred(),d=this,c=d.user;d._permissions.isAdmin=!1;d._permissions={};d.getUserPermissions(c).error(function(b,c){d.authenticationMessage=b.Message;d._eventService.publish("AuthenticationService/AuthenticationFailed",b.Message);a.resolve("refreshPermissions_fail")}).success(function(b){for(var e=b.length,g=0;g<e;g++){var h=b[g],k=h.indexOf(".");-1!=k&&(h=h.substr(k+1));d._permissions[h]=!0}d.isAdmin(c).error(function(){d._permissions.isAdmin=!1}).success(function(a){d._permissions.isAdmin=
a});a.resolve("refreshPermissions_success")});return a.promise()};a.prototype.login=function(a,d,c){var b=this;a||(a="");d||(d="");return this._httpService.post(this._authUrl+"/AuthenticateUser",{userName:a,password:d,userData:""}).error(function(a,c){if("string"===typeof a&&0==a.length)a=b.authenticationMessage="HTTP Error ("+c+"): "+Utils.get_httpStatusText(c);else if(a)if(a.hasOwnProperty("ExceptionMessage"))a=b.authenticationMessage=a.ExceptionMessage;else if(a.hasOwnProperty("Message"))a=b.authenticationMessage=
a.Message;else{if(c=window.open("","_blank"))c.focus(),c.document.write(a),c.focus();a="Error"}else a="Web service is down";b._eventService.publish("AuthenticationService/AuthenticationFailed",a)}).then(function(e){if(e.status!=HttpStatus.OK)b.authenticationMessage=e.statusText?e.statusText:"Unknown error: "+e.status,b._eventService.publish("AuthenticationService/AuthenticationFailed",e.statusText);else if(e.data.Message)b.authenticationMessage=e.data.Message,b._eventService.publish("AuthenticationService/AuthenticationFailed",
e.data.Message);else{if(c){var f=new Date,h=new CookieOptions;f.setMonth(f.getMonth()+1);h.expires=f;h.path="/";$.cookie("User",a,h);$.cookie("Pass",d,h)}b._user=a;b.authenticationCode=e.data.toString();b._permissions.isAdmin=!1;b.getUserPermissions(a).error(function(a,c){b.authenticationMessage=a.Message;b._eventService.publish("AuthenticationService/AuthenticationFailed",a.Message)}).success(function(c){for(var d=c.length,f=0;f<d;f++){var g=c[f],h=g.indexOf(".");-1!=h&&(g=g.substr(h+1));b._permissions[g]=
!0}b.isAdmin(a).error(function(){b._permissions.isAdmin=!1}).success(function(a){b._permissions.isAdmin=a;b._eventService.publish("AuthenticationService/AuthenticationSuccess",e);b._locationService.path("/")})})}})};a.prototype.autologin=function(a,d){var b=this;b._user=a;b.authenticationCode=d;b._permissions.isAdmin=!1;b.getUserPermissions(a).error(function(a,c){b.authenticationMessage=a.Message;b._eventService.publish("AuthenticationService/AuthenticationFailed",a.Message)}).success(function(c){for(var d=
c.length,e=0;e<d;e++){var h=c[e],k=h.indexOf(".");-1!=k&&(h=h.substr(k+1));b._permissions[h]=!0}b.isAdmin(a).error(function(){b._permissions.isAdmin=!1}).success(function(a){b._permissions.isAdmin=a;b._eventService.publish("AuthenticationService/AuthenticationSuccess",null);b._locationService.path("/")})})};a.prototype.getAuthenticationInfo=function(a,d){return this._httpService.post(this._authUrl+"/GetAuthenticationInfo",JSON.stringify({authenticationCookie:a,calibration:d}))};a.prototype.tempAuthenticate=
function(a,d){return this._httpService.post(this._authUrl+"/tempAuthenticate",JSON.stringify({cookie:a,protocol:d}))};a.prototype.implicitAuthenticate=function(a,d){return this._httpService.post(this._authUrl+"/ImplicitAuthenticate",JSON.stringify({cookie:a,protocol:d}))};a.prototype.logout=function(){var a=this.user,d=this._authenticationCode;$.removeCookie("User",{path:"/"});$.removeCookie("Pass",{path:"/"});this._authenticationCode=this._user="";this._eventService.publish(EventNames.Logout,{user:a,
authenticationCode:d});this._window.location.reload()};a.prototype.logoutError=function(a){var b=this.user,c=this._authenticationCode;$.removeCookie("User",{path:"/"});$.removeCookie("Pass",{path:"/"});this._authenticationCode=this._user="";this._eventService.publish(EventNames.Logout,{user:b,authenticationCode:c});this._window.location.reload();a&&alert(a)};a.prototype.getUserPermissions=function(a){return this._httpService.get(this._authUrl+"/GetUserPermissions?name="+a+"&rnd="+(new Date).getTime())};
a.prototype.isAdmin=function(a){a="auth="+encodeURIComponent(this._authenticationCode)+"&userName="+a;return this._httpService.get(this._authUrl+"/IsAdmin?"+a+"&r="+Date.now())};a.prototype.getRolesNames=function(){return this._httpService.post(this._authUrl+"/GetRolesNames",null)};a.prototype.hasPermission=function(a){return this._permissions?this.permissions[a]||this.permissions.isAdmin:!1};a.prototype.createUser=function(a,d,c){return this._httpService.post(this._authUrl+"/CreateUser",JSON.stringify({authenticationCookie:this._authenticationCode,
userName:a,password:d,userType:c}))};a.prototype.createRole=function(a,d){return this._httpService.post(this._authUrl+"/CreateRole",JSON.stringify({authenticationCookie:this._authenticationCode,role:{AssignedPermissions:null,Description:d,Name:a}}))};a.prototype.getRoles=function(){return this._httpService.post(this._authUrl+"/GetRoles",JSON.stringify({authenticationCookie:this._authenticationCode}))};a.prototype.deleteRole=function(a){return this._httpService.post(this._authUrl+"/DeleteRole",JSON.stringify({authenticationCookie:this._authenticationCode,
roleName:a}))};a.prototype.getPermissions=function(){return this._httpService.post(this._authUrl+"/GetPermissions",JSON.stringify({authenticationCookie:this._authenticationCode}))};a.prototype.updateRolePermissions=function(a,d){return this._httpService.post(this._authUrl+"/UpdateRolePermissions",JSON.stringify({authenticationCookie:this._authenticationCode,role:{AssignedPermissions:d,Description:null,Name:a}}))};a.prototype.getAllUsers=function(){var a="auth="+encodeURIComponent(this._authenticationCode)+
"&rnd="+(new Date).getTime();return this._httpService.get(this._authUrl+"/GetAllUsers?"+a)};a.prototype.deleteUser=function(a,d){return this._httpService.post(this._authUrl+"/DeleteUser",JSON.stringify({authenticationCookie:this._authenticationCode,userName:a,userData:d}))};a.prototype.resetPassword=function(a,d,c){return this._httpService.post(this._authUrl+"/ResetPassword",JSON.stringify({authenticationCookie:this._authenticationCode,userName:a,newPassword:d,userData:c}))};a.prototype.resetCurrentPassword=
function(a,d){return this._httpService.post(this._authUrl+"/ChangePassword",JSON.stringify({authenticationCookie:this._authenticationCode,userName:"",oldPassword:a,newPassword:d}))};a.prototype.validatePassword=function(a,d){return this._httpService.post(this._authUrl+"/ValidatePassword",JSON.stringify({password:a,userData:d}))};a.prototype.getUserRoles=function(a,d){a={username:a,userData:d};return this._httpService.post(this._authUrl+"/GetUserRoles?rnd="+(new Date).getTime(),JSON.stringify(a))};
a.prototype.grantRole=function(a,d,c){return this._httpService.post(this._authUrl+"/GrantRole",JSON.stringify({authenticationCookie:this._authenticationCode,username:a,role:d,userData:c}))};a.prototype.denyRole=function(a,d,c){return this._httpService.post(this._authUrl+"/DenyRole",JSON.stringify({authenticationCookie:this._authenticationCode,username:a,role:d,userData:c}))};a.prototype.grantPermission=function(a,d,c){return this._httpService.post(this._authUrl+"/GrantPermission",JSON.stringify({authenticationCookie:this._authenticationCode,
username:a,permission:d,userData:c}))};a.prototype.denyPermission=function(a,d,c){return this._httpService.post(this._authUrl+"/DenyPermission",JSON.stringify({authenticationCookie:this._authenticationCode,username:a,permission:d,userData:c}))};a.$inject=["app.config","$http","$location","eventService","$window"];return a}();services.service("authenticationService",AuthenticationService);
var QueryArchiveService=function(){function a(a,d,c,e){this._http=c;this._authenticationService=d;this._queryLocalUrl=a.urls.serviceUrl+a.urls.queryLocalServiceName;this._threedLocalUrl=a.urls.threeDserviceUrl?a.urls.threeDserviceUrl+a.urls.threeDServiceName:a.urls.serviceUrl+a.urls.threeDServiceName}a.prototype.FindPatients=function(a,d){a={authenticationCookie:this._authenticationService.authenticationCode,options:a,extraOptions:{UserData:parseInt(d||"0")}};return this._http.post(this._queryLocalUrl+
"/FindPatients",JSON.stringify(a))};a.prototype.UploadDicomImage=function(a,d){return this._http.post(this._queryLocalUrl+"/UploadDicomImage",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,dicomData:a,createFile:d}))};a.prototype.FindStudies=function(a,d){a={authenticationCookie:this._authenticationService.authenticationCode,options:a,extraOptions:{UserData:parseInt(d||"0")}};return this._http.post(this._queryLocalUrl+"/FindStudies",JSON.stringify(a))};a.prototype.isDate=
function(a){return-1!=a.toLowerCase().indexOf("date")||-1!=a.toLowerCase().indexOf("time")?!0:!1};a.prototype.FindSeries=function(a,d){a={authenticationCookie:this._authenticationService.authenticationCode,options:a,extraOptions:{UserData:parseInt(d||"0")}};var b=this;return this._http.post(this._queryLocalUrl+"/FindSeries",JSON.stringify(a,function(a,c){return"string"==typeof c&&b.isDate(a)&&(a=new Date(c),"Invalid Date"!=a)?a.toUTCString():c}))};a.prototype.FindPresentationState=function(a){a="auth="+
encodeURIComponent(this._authenticationService.authenticationCode)+"&series="+a;return this._http.get(this._queryLocalUrl+"/FindPresentationState?"+a)};a.prototype.KeepAlive=function(a){return this._http.post(this._threedLocalUrl+"/KeepAlive",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,id:a}))};a.prototype.Start3DObject=function(a,d,c,e){return this._http.post(this._threedLocalUrl+"/Create3DObject",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,
options:a,id:d,renderingType:c,extraOptions:{UserData2:e}}))};a.prototype.CheckProgress=function(a){return this._http.post(this._threedLocalUrl+"/CheckProgress",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,id:a}))};a.prototype.Get3DSettings=function(a,d){return this._http.post(this._threedLocalUrl+"/Get3DSettings",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,id:d,options:a}))};a.prototype.Update3DSettings=function(a,d){return this._http.post(this._threedLocalUrl+
"/Update3DSettings",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,id:d,options:a}))};a.prototype.Get3DImage=function(){return this._threedLocalUrl+"/Get3DImage?auth="+encodeURIComponent(this._authenticationService.authenticationCode)};a.prototype.GetPanoramic3DImage=function(){return this._threedLocalUrl+"/GetPanoramicImage?auth="+encodeURIComponent(this._authenticationService.authenticationCode)};a.prototype.Close3DImage=function(a){return this._http.post(this._threedLocalUrl+
"/End3DObject",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,id:a}))};a.prototype.FindInstances=function(a,d){return this._http.post(this._queryLocalUrl+"/FindInstances",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,options:a,extraOptions:{UserData2:d}}))};a.prototype.ElectStudyTimeLineInstances=function(a,d){return this._http.post(this._queryLocalUrl+"/ElectStudyTimeLineInstances",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,
options:a,userData:d||null}))};a.prototype.FindHangingProtocols=function(a,d){return this._http.post(this._queryLocalUrl+"/FindHangingProtocols",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,studyInstanceUID:a,userData:d||null}))};a.prototype.AutoComplete=function(a,d){a="auth="+encodeURIComponent(this._authenticationService.authenticationCode)+"&key="+a+"&term="+d;return this._http.get(this._queryLocalUrl+"/AutoComplete?"+a,{cache:!1})};a.$inject=["app.config",
"authenticationService","$http"];return a}();services.service("queryArchiveService",QueryArchiveService);
var ObjectRetrieveService=function(){function a(a,d,c,e){this._http=c;this._authenticationService=d;this._retrieveLocalUrl=a.urls.serviceUrl+a.urls.objectRetrieveLocalServiceName;this._threedLocalUrl=a.urls.threeDserviceUrl?a.urls.threeDserviceUrl+a.urls.threeDServiceName:a.urls.serviceUrl+a.urls.threeDServiceName}a.prototype.GetImageUrl=function(a,d,c){var b="";d&&c&&(b="&cx="+d+"&cy="+c);return this._retrieveLocalUrl+"/GetImage?auth="+encodeURIComponent(this._authenticationService.authenticationCode)+
"&instance="+a.Instance.SOPInstanceUID+"&frame="+a.FrameNumber+"&bp=0&qf=0&mime=image/jpeg"+b};a.prototype.GetDicomImageDataAsPngURL=function(a,d,c,e,f,g){f.functions=g||null;a="auth="+encodeURIComponent(this._authenticationService.authenticationCode)+"&study="+a+"&series="+d+"&instance="+c+"&frame="+e+"&data="+JSON.stringify(f);return this._retrieveLocalUrl+"/GetDicomImageDataAsPNG?"+a};a.prototype.GetMPRFrame=function(a,d,c){return this._threedLocalUrl+"/GetMPRImage?auth="+encodeURIComponent(this._authenticationService.authenticationCode)+
"&id="+a+"&mprType="+d+"&index="+c};a.prototype.GetImageUrlPreprocessed=function(a,d,c,e,f){var b={},h="",k="";d&&c&&(h="&cx="+d+"&cy="+c);f&&(k="&r="+Date.now());b.width=0;b.height=0;b.functions=e;return this._retrieveLocalUrl+"/GetImage?auth="+encodeURIComponent(this._authenticationService.authenticationCode)+"&instance="+a.Instance.SOPInstanceUID+"&frame="+a.FrameNumber+h+"&data="+JSON.stringify(b)+k};a.prototype.GetSeriesLayout=function(a,d){a="auth="+encodeURIComponent(this._authenticationService.authenticationCode)+
"&seriesinstanceUID="+a+"&data="+d+"&r="+Date.now();return this._http.get(this._retrieveLocalUrl+"/GetSeriesLayout?"+a)};a.prototype.GetPatientStructuredDisplay=function(a,d){a="auth="+encodeURIComponent(this._authenticationService.authenticationCode)+"&patientID="+a+"&data="+d+"&r="+Date.now();return this._http.get(this._retrieveLocalUrl+"/GetPatientStructuredDisplay?"+a)};a.prototype.GetStudyLayout=function(a,d){a="auth="+encodeURIComponent(this._authenticationService.authenticationCode)+"&studyInstanceUID="+
a+"&data="+d+"&r="+Date.now();return this._http.get(this._retrieveLocalUrl+"/GetStudyLayout?"+a)};a.prototype.GetPresentationInfo=function(a){a="auth="+encodeURIComponent(this._authenticationService.authenticationCode)+"&series="+a;return this._http.get(this._retrieveLocalUrl+"/GetPresentationInfo?"+a)};a.prototype.GetDicomJSON=function(a,d,c){a="auth="+encodeURIComponent(this._authenticationService.authenticationCode)+"&study="+a+"&series="+d+"&instance="+c;return this._http.get(this._retrieveLocalUrl+
"/GetDicomJSON?"+a,{headers:{"Content-Type":"application/json"}})};a.prototype.UploadAnnotations=function(a){return this._http.post(this._retrieveLocalUrl+"/UploadAnnotations",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,data:a}))};a.prototype.DownloadImageUrl=function(a,d,c,e,f,g,h){c=c&&e?"&cx="+c+"&cy="+e:"&cx=0&cy=0";h=void 0==h?"":h;return this._retrieveLocalUrl+"/DownloadImage?auth="+encodeURIComponent(this._authenticationService.authenticationCode)+"&instance="+
a.Instance.SOPInstanceUID+"&frame="+a.FrameNumber+"&bp=0&qf=0"+c+"&annotationFileName="+encodeURIComponent(d)+"&xDpi="+f+"&yDpi="+g+"&data="+h};a.prototype.GetPresentationAnnotations=function(a,d){a="auth="+encodeURIComponent(this._authenticationService.authenticationCode)+"&instance="+a+"&data="+d;return this._http.get(this._retrieveLocalUrl+"/GetPresentationAnnotations?"+a,{headers:{"Content-Type":"application/xml"}})};a.prototype.GetAudioGroupsCount=function(a){return this._http.post(this._retrieveLocalUrl+
"/GetAudioGroupsCount",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,sopInstanceUID:a}))};a.prototype.GetSeriesStacks=function(a,d){a="auth="+encodeURIComponent(this._authenticationService.authenticationCode)+"&seriesinstanceUID="+a+"&data="+d;return this._http.get(this._retrieveLocalUrl+"/GetSeriesStacks?"+a)};a.prototype.GetHangingProtocol=function(a,d){a="auth="+encodeURIComponent(this._authenticationService.authenticationCode)+"&instance="+a+"&data="+d+"&r="+
Date.now();return this._http.get(this._retrieveLocalUrl+"/GetHangingProtocol?"+a)};a.prototype.GetHangingProtocolInstances=function(a,d,c,e,f){return this._http.post(this._retrieveLocalUrl+"/GetHangingProtocolInstances",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,hangingProtocolSOP:a,patientID:d,studyInstanceUID:c,studyDateMostRecent:e,userData:f}))};a.prototype.BuildAudioUrl=function(a,d,c){return this._retrieveLocalUrl+"/GetAudio?auth="+encodeURIComponent(this._authenticationService.authenticationCode)+
"&instance="+a+"&group="+d+"&mime="+encodeURIComponent(c)};a.prototype.ClearCache=function(){return this._http.post(this._retrieveLocalUrl+"/ClearCache",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode}))};a.$inject=["app.config","authenticationService","$http"];return a}();services.service("objectRetrieveService",ObjectRetrieveService);
var ObjectStoreService=function(){function a(a,d,c,e){this._http=c;this._authenticationService=d;this._storeLocalUrl=a.urls.serviceUrl+a.urls.objectStoreLocalServiceName}a.prototype.UploadDicomImage=function(a,d,c){return this._http.post(this._storeLocalUrl+"/UploadDicomImage",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,dicomData:a,status:d,fileName:c}))};a.prototype.StoreSecondaryCapture=function(a,d,c,e,f){return this._http.post(this._storeLocalUrl+"/StoreSecondaryCapture",
JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,EncodedCapture:a,OriginalSOPInstance:d,SeriesNumber:c,SeriesDescription:e,ProtocolName:f}))};a.prototype.DeleteAnnotations=function(a,d){return this._http.post(this._storeLocalUrl+"/DeletePresentationState",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,sopInstanceUID:a,userData:d||null}))};a.prototype.StoreAnnotations=function(a,d,c,e){return this._http.post(this._storeLocalUrl+
"/StoreAnnotations",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,seriesInstanceUID:a,annotationData:d,description:c,userData:e||null}))};a.prototype.StoreStudyLayout=function(a,d,c){return this._http.post(this._storeLocalUrl+"/StoreStudyLayout",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,studyInstanceUID:a,studyLayout:d,userData:c||null},function(a,b){return b instanceof lt.LeadPointD?(a=Utils.roundNumber(b.x,7),b=Utils.roundNumber(b.y,
7),{x:a,y:b}):b}))};a.prototype.DeleteStudyLayout=function(a,d){return this._http.post(this._storeLocalUrl+"/DeleteStudyLayout",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,studyInstanceUID:a,userData:d||null}))};a.prototype.StoreHangingProtocol=function(a,d){return this._http.post(this._storeLocalUrl+"/StoreHangingProtocol",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,hangingProtocol:a,userData:d||null},function(a,b){return b instanceof
lt.LeadPointD?(a=Utils.roundNumber(b.x,7),b=Utils.roundNumber(b.y,7),{x:a,y:b}):"WCFHangingProtocolCreationDateTime"==a&&(a=new Date(b),"Invalid Date"!=a)?a.toUTCString():b}))};a.$inject=["app.config","authenticationService","$http"];return a}();services.service("objectStoreService",ObjectStoreService);
var PatientService=function(){function a(a,d,c,e){this._http=c;this._authenticationService=d;this._patientServiceUrl=a.urls.serviceUrl+a.urls.patientServiceName}a.prototype.AddPatient=function(a){return this._http.post(this._patientServiceUrl+"/AddPatient",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,info:a,userData:null}))};a.prototype.UpdatePatient=function(a){return this._http.post(this._patientServiceUrl+"/UpdatePatient",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,
info:a,extraOptions:null}))};a.prototype.DeletePatient=function(a){return this._http.post(this._patientServiceUrl+"/DeletePatient",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,patientId:a,extraOptions:null}))};a.$inject=["app.config","authenticationService","$http"];return a}(),PatientInfo=function(){return function(a,b,d,c,e,f){this.PatientId=a;this.Name=b;this.BirthDate=d;this.Sex=c;this.Comments=e;this.EthnicGroup=f}}(),PersonName=function(){function a(){for(var a=
[],d=0;d<arguments.length;d++)a[d]=arguments[d];this.Suffix=this.Prefix=this.Middle=this.Last=this.First="";1<=a.length&&(this.Last=a[0]);2<=a.length&&(this.First=a[1]);3<=a.length&&(this.Middle=a[2]);4<=a.length&&(this.Prefix=a[3]);5<=a.length&&(this.Suffix=a[4]);this.sep="^"}a.prototype.getDicomName=function(){return this.Last.trim()+this.sep+this.First.trim()+this.sep+this.Middle.trim()+this.sep+this.Prefix.trim()+this.sep+this.Suffix.trim()};a.getPersonName=function(b){var d=new a;b=b.split("^");
1<=b.length&&(d.Last=b[0]);2<=b.length&&(d.First=b[1]);3<=b.length&&(d.Middle=b[2]);4<=b.length&&(d.Prefix=b[3]);5<=b.length&&(d.Suffix=b[4]);return d};return a}();services.service("patientService",PatientService);var WebViewerCommandNames;(function(a){a.LOAD_SERIES="LoadSeriesCommand";a.LOAD_SERIES_EXT="LoadSeriesCommandExt";a.SET_SERIES_VIEWER_MODE="SetSeriesViewerModeCommand";a.ALIVE="ALIVE";a.SUBSCRIBE="SubscribeToEventsCommand"})(WebViewerCommandNames||(WebViewerCommandNames={}));
var WebViewerMessage=function(){function a(){this._params=[]}a.prototype.get_Command=function(){return this._cmd};a.prototype.get_Params=function(){return this._params};a.prototype.Parse=function(b){var d=b.split("?");2===d.length&&(this._cmd=d[0],this._params=a.ParseQueryString(b))};a.SendCommand=function(a,d,c){d.postMessage(a.toString(),c)};a.ParseQueryString=function(a){a=a.split("?");var b=[];if(a&&2==a.length)a=a[1].split("&");else return b;if(1==a.length&&""===a[0])return b;for(var c=a.length;c--;){var e=
a[c].split("="),f=decodeURIComponent(e[0]);e=decodeURIComponent(e[1]);f&&f.length&&(b[f]=e)}return b};return a}(),Models;(function(a){var b=function(){return function(){}}();a.PatientQueryOptions=b;var d=function(){return function(){}}();a.StudyQueryOptions=d;var c=function(){return function(){}}();a.SeriesQueryOptions=c;var e=function(){return function(){this.PatientsOptions=new b;this.StudiesOptions=new d;this.SeriesOptions=new c}}();a.QueryOptions=e})(Models||(Models={}));
var WebViewerCommandHandlerService=function(){function a(a,d,c){var b=angular.element(document.getElementById("app")).injector();this._queryArchiveService=b.get("queryArchiveService");this._objectRetrieveService=b.get("objectRetrieveService");this._objectStoreService=b.get("objectStoreService");this._patientService=b.get("patientService");this._optionsService=b.get("optionsService");this._authenticationToken=d;this._authenticationService=a;this._authenticationService.authenticationCode=d;this._viewerWindow=
c}a.prototype.SendCommand=function(a,d,c){d.postMessage(JSON.stringify(a),c)};a.prototype.Authenticate=function(a,d,c,e){return $.ajax({type:"POST",contentType:"application/json",url:"http://"+location.host+"/MedicalViewerServiceWcf20/AuthenticationService.svc/AuthenticateUser",data:JSON.stringify({userName:a,password:d,userData:null}),error:c,success:e})};a.prototype.LogOut=function(){this._authenticationService.logout();this.Close()};a.prototype.LogOutError=function(a){this._authenticationService.logoutError(a);
this.Close()};a.prototype.Close=function(){this._viewerWindow===window?window.open("","_self").close():this._viewerWindow&&this._viewerWindow.close()};a.prototype.isDental=function(){return this._optionsService.get(OptionNames.DentalMode)};a.prototype.FindPatient=function(a,d,c,e){var b=this,g=new Models.QueryOptions;g.PatientsOptions.PatientID=a;g.PatientsOptions.PatientName="";g.StudiesOptions.AccessionNumber="";g.StudiesOptions.ReferDoctorName="";g.StudiesOptions.ModalitiesInStudy=[];"All"===d?
this._queryArchiveService.FindPatients(g).then(e,c):(a=this._optionsService.get(OptionNames.MaxStudyResults),this._queryArchiveService.FindStudies(g,a).then(function(a){b.onSearchStudiesError(a);c(a)},$.proxy(e,this)))};a.prototype.FindPatientFromSeries=function(a,d,c,e){var b=this,g=new Models.QueryOptions;g.SeriesOptions.SeriesInstanceUID=a;"All"===d?this._queryArchiveService.FindPatients(g).then(e,c):(a=this._optionsService.get(OptionNames.MaxStudyResults),this._queryArchiveService.FindStudies(g,
a).then(function(a){b.onSearchStudiesError(a);c(a)},$.proxy(e,this)))};a.prototype.UpdatePatient=function(a,d,c){var b=this;this._patientService.UpdatePatient(a).then(c,function(a){b.onUpdatePatientError(a);d(a)})};a.prototype.DeletePatient=function(a,d,c){var b=this;this._patientService.DeletePatient(a).then(c,function(a){b.onDeletePatientError(a);d(a)})};a.prototype.AddPatient=function(a,d,c){var b=this;this._patientService.AddPatient(a).then(c,function(a){b.onAddPatientError(a);d(a)})};a.prototype.onSearchStudiesSuccess=
function(a){LogUtils.DebugLog(a)};a.prototype.onSearchStudiesError=function(a){LogUtils.DebugLog("Failed to find series: "+a)};a.prototype.onUpdatePatientError=function(a){LogUtils.DebugLog("Failed to update patient: "+a)};a.prototype.onDeletePatientError=function(a){LogUtils.DebugLog("Failed to delete patient: "+a)};a.prototype.onAddPatientError=function(a){LogUtils.DebugLog("Failed to add patient: "+a)};a.prototype.onAuthenticationError=function(a,d,c){alert("failed to authenticate user: "+c)};
a.prototype.onAuthenticationSuccess=function(a){alert("authentication success");this._authenticationToken=a};a.prototype.onFindStudiesError=function(a,d,c){alert("Failed to query for studies: "+c)};a.FilterPresentationState=function(a){for(var b=[],c=a.length;c--;)if("PR"==a[c].Modality){var e=a.splice(c,1);e=e[0];b.push(e.InstanceUID)}return b};a.prototype.FilterSeriesInstances=function(a,d){for(var b=a.length;b--;)-1!=d.indexOf(a[b].SeriesInstanceUID)&&a.splice(b,1)};a.prototype.FindSeriesExt=function(b,
d,c,e,f){var g=new Models.QueryOptions,h=this._optionsService.get(OptionNames.MaxStudyResults);g.PatientsOptions.PatientID=b;g.StudiesOptions.StudyInstanceUID=d;g.SeriesOptions.SeriesInstanceUID=c;this._queryArchiveService.FindSeries(g,h).then(function(b){a.FilterPresentationState(b.data);null!==f&&f(b)},e)};a.prototype.GetInstanceImageURL=function(a,d){var b={FrameNumber:1,Instance:{}};b.Instance.SOPInstanceUID=a;a=this._objectRetrieveService.GetImageUrl(b,1024,1024);null!=d&&d(a)};a.prototype.ShowSeriesInstanceExt=
function(a,d,c,e){var b={};b.name=WebViewerCommandNames.LOAD_SERIES_EXT;b.seriesArray=JSON.stringify(a);b.seriesSelected=JSON.stringify(d);b.style=e;this.SendCommand(b,this._viewerWindow,"*");null!=c&&c()};a.prototype.SetSeriesViewerMode=function(a){};a.$inject=["authenticationService","webViewerAuthenticationToken","viewerWindow"];return a}(),ExternalCommandNames;
(function(a){a.LogOut="LogOut";a.Close="Close";a.FindPatient="FindPatient";a.FindPatients="FindPatient";a.ShowPatient="ShowPatient";a.ShowStudy="ShowStudy";a.ShowSeries="ShowSeries";a.ShowInstance="ShowInstance";a.GetCurrentPatient="GetCurrentPatient";a.SearchImage="SearchImage";a.GetImage="GetImage";a.AddPatient="AddPatient";a.DeletePatient="DeletePatient";a.UpdatePatient="UpdatePatient";a.EndAssociation="EndAssociation";a.AddUser="AddUser";a.UpdateUser="UpdateUser";a.DeleteUser="DeleteUser"})(ExternalCommandNames||
(ExternalCommandNames={}));var TabTypes;(function(a){a.None=-1;a.Search=0;a.Viewer=1;a.UserQueue=2;a.Compare=3})(TabTypes||(TabTypes={}));
(function(a){var b=function(){function a(a){this._id=a;this.controller=this.templateUrl=this.title="";this.active=!1;this._type=TabTypes.None;this._canDelete=!1;this._data={};this._visible=!0;this._itemCount=0;this._engineDictionary={}}Object.defineProperty(a.prototype,"showStudyTimeLine",{get:function(){return this._showStudyTimeLine},set:function(a){this._showStudyTimeLine=a},enumerable:!0,configurable:!0});a.prototype.handle_engine3DData=function(a,b,d,g,h,k,l){l=l.get(OptionNames.RenderingMethod);
l=-1!=l.indexOf("Hardware")?0:1;switch(b.type){case lt.Controls.Medical.Requested3DDataType.create3DObject:d.Start3DObject(g,h,l,k).then(function(b){"Success"!=b.data&&(a.status=lt.Controls.Medical.Object3DStatus.error,a.errorMessage=b.data.Message?b.data.Message:b.data)});break;case lt.Controls.Medical.Requested3DDataType.creationProgress:d.CheckProgress(h).then(function(b){isNaN(b.data)?(a.status=lt.Controls.Medical.Object3DStatus.error,a.errorMessage=b.data.Message?b.data.Message:b.data):100!=
a.progress&&(a.progress=parseInt(b.data))});break;case lt.Controls.Medical.Requested3DDataType.keepServerObjectAlive:d.KeepAlive(h);break;case lt.Controls.Medical.Requested3DDataType.delete3DObject:d.Close3DImage(h)}};a.prototype.DeleteUnusedengine=function(a){a=a.layout.get_items();var b,c=a.get_count(),d={},h;for(h in this._engineDictionary)d[h]=this._engineDictionary[h];for(b=0;b<c;b++){var k=a.get_item(b);var l=this.getRealId(k.divID);k.divID!=l&&delete d[l]}for(h in d)this._engineDictionary[h].end(),
delete this._engineDictionary[h]};a.prototype.AddnewEngine=function(a,b,d,g,h){var c=this.getRealId(a),e=this;this._engineDictionary[c]||(a=new lt.Controls.Medical.Object3DEngine(c),this._engineDictionary[c]=a,a.add_request3DData(function(a,f){e.handle_engine3DData(a,f,b,d,c,g,h)}));return this._engineDictionary[c]};a.prototype.getRealId=function(a){var b=a.lastIndexOf("_");return-1==b?a:a.substr(0,b)};a.prototype.RemoveEngineIfUnused=function(a){a=this.getRealId(a);this._engineDictionary[a]&&(this._engineDictionary[a]=
new lt.Controls.Medical.Object3DEngine(a));return this._engineDictionary[a]};Object.defineProperty(a.prototype,"engineDictionary",{get:function(){return this._engineDictionary},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"title",{get:function(){return this._title},set:function(a){this._title=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"templateUrl",{get:function(){return this._templateUrl},set:function(a){this._templateUrl=a},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"controller",{get:function(){return this._controller},set:function(a){this._controller=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"active",{get:function(){return this._active},set:function(a){this._active=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"type",{get:function(){return this._type},set:function(a){this._type=
a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"canDelete",{get:function(){return this._canDelete},set:function(a){this._canDelete=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"visible",{get:function(){return this._visible},set:function(a){this._visible=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"itemCount",{get:function(){return this._itemCount},set:function(a){this._itemCount=a},enumerable:!0,configurable:!0});return a}();a.Tab=b})(Models||(Models={}));var TabDataKeys;(function(a){a.Linked="Linked";a.TagToggle="TagToggle";a.ViewController="ViewController";a.PatientId="PatientId";a.CompareInstances="CompareInstances";a.AnnotationVisiblity="AnnotationVisiblity";a.LaunchingStudy="LaunchingStudy";a.searchViewerController="SearchViewerController"})(TabDataKeys||(TabDataKeys={}));
var TabService=function(){function a(){this._tabs=[];this._activeTab=0;this._tabDictionary=new Dictionary}Object.defineProperty(a.prototype,"activeTab",{get:function(){return this._activeTab},set:function(a){var b=this._tabs[a];null!=b&&(b.active=!0,this._activeTab=a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"tabs",{get:function(){return this._tabs},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"selectedTab",{get:function(){if(-1!=this.activeTab)return this.get_allTabs()[this._activeTab]},
enumerable:!0,configurable:!0});a.prototype.add_tab=function(a,d,c,e,f){var b=new Models.Tab(a);f=f||TabTypes.None;b.title=d;b.templateUrl=c;b.controller=e;b.type=f;b.itemCount=0;b.showStudyTimeLine=!1;this._tabDictionary.setData(b.id,new Dictionary);this._tabs.push(b);this.set_tabData(a,TabDataKeys.TagToggle,!0);return b};a.prototype.find_tab=function(a){var b;$.each(this._tabs,function(c,d){if(d.id==a)return b=d,!1});return b};a.prototype.select_tab=function(a){a=this.find_tab(a);null!=a&&(a.active=
!0,this._activeTab=this._tabs.indexOf(a))};a.prototype.get_allTabs=function(){return this._tabs};a.prototype.delete_tab=function(a){var b=this.find_tab(a);null!=b&&(b=this._tabs.indexOf(b),this._tabs.splice(b,1),this._tabDictionary.removeData(a))};a.prototype.find_tabsByType=function(a){var b=[];$.each(this._tabs,function(c,d){d.type==a&&b.push(d)});return b};a.prototype.set_tabData=function(a,d,c){null!=this.find_tab(a)&&(a=this._tabDictionary.getData(a))&&a.setData(d,c)};a.prototype.get_tabData=
function(a,d){if(null!=this.find_tab(a)&&(a=this._tabDictionary.getData(a)))return a.getData(d)};a.prototype.findTabByKey=function(a,d){var b=null,e=this;$.each(this._tabs,function(c,g){if((c=e._tabDictionary.getData(g.id))&&c.getData(a)==d)return b=g,!1});return b};a.prototype.getActiveViewer=function(){if(-1!=this.activeTab){var a=this.get_allTabs()[this.activeTab];if(a=this.get_tabData(a.id,TabDataKeys.ViewController))return a.getViewer()}};a.prototype.getWindowLayout=function(){if(-1!=this.activeTab){var a=
this.get_allTabs()[this.activeTab];if(a=this.get_tabData(a.id,TabDataKeys.ViewController))if(a=a.getViewer(),a=document.getElementById(a.divId),null!=a.parentElement&&null!=a.parentElement.parentElement)return a.parentElement.parentElement.parentElement}};return a}();services.service("tabService",TabService);var LogUtils;(function(a){a.DebugLog=function(a){}})(LogUtils||(LogUtils={}));var GenericActionStatus;
(function(a){a.Success="Success";a.Failed="failed"})(GenericActionStatus||(GenericActionStatus={}));
var ExternalCommandHandlerService=function(){function a(a,d,c){this._externalControlEnabled=!1;this._externalControlPort=0;this._controller=this._externalControlAssociationToken=this._webViewerAuthenticationToken=null;this._shouldStopPolling=!1;this._sharedPropertiesService=a;this._authenticationService=d;this._tabService=c}a.prototype.onUpdatePatientError=function(a,d,c){LogUtils.DebugLog("UpdatePatientError: "+d);this.notifyActionStatus(ExternalCommandNames.UpdatePatient,a.statusText)};a.prototype.onDeletePatientError=
function(a,d,c){LogUtils.DebugLog("DeletePatientError: "+d);this.notifyActionStatus(ExternalCommandNames.DeletePatient,a.statusText)};a.prototype.onAddPatientError=function(a,d,c){LogUtils.DebugLog("AddPatientError: "+d);this.notifyActionStatus(ExternalCommandNames.AddPatient,a.statusText)};a.prototype.onShowSeriesError=function(a,d,c){LogUtils.DebugLog("FindSeriesExtError: "+d);this.notifyActionStatus(ExternalCommandNames.ShowSeries,a.statusText)};a.prototype.onFindPatientError=function(a,d,c){LogUtils.DebugLog("FindPatienError: "+
d);this.notifyActionStatus(ExternalCommandNames.FindPatient,a.statusText)};a.prototype.onFindPatientFromSeriesError=function(a,d,c){LogUtils.DebugLog("onFindPatientFromSeriesError: "+d);this.notifyActionStatus("FindPatientFromSeries",a.statusText)};a.prototype.onReceivePatientNameError=function(a,d,c){LogUtils.DebugLog("ReceivePatientNameError: "+d);this.notifyActionStatus("ReceivePatientName",a.statusText)};a.prototype.encodeDate=function(a){a=a.replace(/\//g,".");a=a.replace(/:/g,"!");return a=
a.replace(/ /g,"_")};a.prototype.sendImageInfo=function(a,d,c,e,f){a=this.GetExternalControlServiceRoot()+"ReceiveImageInfo/true/"+a+"/"+d+"/"+c+"/"+e+"/"+f+"/"+this._externalControlAssociationToken;LogUtils.DebugLog(a);this.NoCacheAjax_GET(a,function(){LogUtils.DebugLog("Image Info Sent")},$.proxy(this.onHandleRequestError,this))};a.prototype.notifyImageSearchNoneFound=function(){var a=this.GetExternalControlServiceRoot()+"ReceiveImageInfo/false/e/e/e/e/e/"+this._externalControlAssociationToken;
LogUtils.DebugLog(a);this.NoCacheAjax_GET(a,function(){LogUtils.DebugLog("Notified no image info found")},$.proxy(this.onHandleRequestError,this))};a.prototype.notifyActionStatus=function(a,d){!0===this._externalControlEnabled?(a=this.GetExternalControlServiceRoot()+"ReceiveGenericActionStatus/"+d+"/"+this._externalControlAssociationToken,LogUtils.DebugLog(a),this.NoCacheAjax_GET(a,function(){LogUtils.DebugLog("Action status notification sent- status: "+d)},function(){LogUtils.DebugLog("notifyActionStatus Failed")})):
(a=JSON.stringify({externalControlAssociationToken:this._externalControlAssociationToken,commandName:a,commandResult:d}),null!=window.opener&&window.opener.postMessage(a,"*"))};a.prototype.LogoutNotify=function(a){!0===this._externalControlEnabled?(a=this.GetExternalControlServiceRoot()+"LogoutNotify/"+a,this.NoCacheAjax_GET(a,{},{})):this.notifyActionStatus(ExternalCommandNames.LogOut,a)};a.prototype.IsExternalControlEnabled=function(){return this._externalControlEnabled};a.prototype.Initialize=
function(){var a=this._sharedPropertiesService.GetExternalControlMode();var d=this._sharedPropertiesService.GetPolling();var c=this._sharedPropertiesService.GetToken();""!=c&&(this._webViewerAuthenticationToken=c);a?(this._externalControlPort=this._sharedPropertiesService.GetPort(),this._shouldStopPolling=!d,d?this.EstablishExternalControl():this._controller=new WebViewerCommandHandlerService(this._authenticationService,this._webViewerAuthenticationToken,window)):(this._externalControlEnabled=!1,
LogUtils.DebugLog("Normal Mode"))};a.prototype.GetExternalControlServiceRoot=function(){return"http://localhost:"+this._externalControlPort+"/ExternalCommandQueueService/"};a.prototype.EstablishExternalControl=function(){LogUtils.DebugLog("Establishing External Control...");this.NoCacheAjax_GET(this.GetExternalControlServiceRoot()+"RequestExternalControl",$.proxy(this.onRequestExternalControlSuccess,this),$.proxy(this.onHandleRequestError,this))};a.prototype.onRequestExternalControlSuccess=function(a){a.Accepted?
(this._externalControlEnabled=!0,this._externalControlAssociationToken=a.Token,LogUtils.DebugLog("External Control Established - token: "+this._externalControlAssociationToken),this.NoCacheAjax_GET(this.GetExternalControlServiceRoot()+"GetViewerAuthenticationToken/"+this._externalControlAssociationToken,$.proxy(this.onGetViewerAuthenticationTokenSuccess,this),$.proxy(this.onHandleRequestError,this))):LogUtils.DebugLog("External Control Request Denied")};a.prototype.onGetViewerAuthenticationTokenSuccess=
function(a){this._webViewerAuthenticationToken=a;this._controller=new WebViewerCommandHandlerService(this._authenticationService,this._webViewerAuthenticationToken,window);this.PollForCommands()};a.prototype.onHandleRequestError=function(a,d,c){this._externalControlEnabled=!1;LogUtils.DebugLog("External Control Error: "+d+" - "+c)};a.prototype.NoCacheAjaxParams_POST=function(a,d,c,e){d=JSON.stringify(d);$.ajax({url:a,crossDomain:!1,type:"POST",data:d,contentType:"application/json",dataType:"json",
cache:!1,success:c,error:e})};a.prototype.NoCacheAjax_GET=function(a,d,c){$.ajax({url:a,crossDomain:!0,type:"GET",dataType:"json",cache:!1,success:d,error:c})};a.prototype.NoCacheAjax_POST=function(a,d,c){JSON.stringify(d);$.ajax({url:a,crossDomain:!0,type:"POST",dataType:"json",contentType:"application/json",cache:!1,data:JSON.stringify(d),success:c})};a.prototype.PollForCommands=function(){if(!this._shouldStopPolling){var a=this.GetExternalControlServiceRoot()+"HasCommands/"+this._externalControlAssociationToken;
this.NoCacheAjax_GET(a,$.proxy(this.HasCommandsRequestSuccess,this),$.proxy(this.onHandleRequestError,this))}};a.prototype.HasCommandsRequestSuccess=function(a){a?(a=this.GetExternalControlServiceRoot()+"GetCommands/"+this._externalControlAssociationToken,LogUtils.DebugLog(a),this.NoCacheAjax_GET(a,$.proxy(this.onGetCommandsRequestSuccess,this),$.proxy(this.onHandleRequestError,this))):setTimeout($.proxy(this.PollForCommands,this),500)};a.prototype.onGetCommandsRequestSuccess=function(a){for(var b=
0;b<a.length;++b)this.ProcessCommand(a[b]);this.PollForCommands()};a.prototype.GetInvalidArgumentsErrorString=function(a){return a+": Invalid Arguments"};a.prototype.MyReceivePatientInfo=function(a,d){var b=this;d=d[0];var e=null,f=null,g=null,h=null,k=null,l=null,m=null,p=m=null;d.hasOwnProperty("Patient")?(e=d.Patient.Name,f=d.Patient.BirthDate,g=d.Patient.Comments,h=d.Patient.ID,k=d.Patient.Sex,l=d.Patient.EthnicGroup):(d.hasOwnProperty("Name")&&(e=d.Name),d.hasOwnProperty("BirthDate")&&(f=d.BirthDate),
d.hasOwnProperty("Comments")&&(g=d.Comments),d.hasOwnProperty("ID")&&(h=d.ID),d.hasOwnProperty("Sex")&&(k=d.Sex),d.hasOwnProperty("EthnicGroup")&&(l=d.EthnicGroup));null!=e?(m={PatientId:h,Name:e,BirthDate:f,Sex:k,EthnicGroup:l,Comments:g},p={externalControlAssociationToken:this._externalControlAssociationToken,patientInfo:m},m=null,!0===this._externalControlEnabled?(m=this.GetExternalControlServiceRoot()+"ReceivePatientInfo",this.NoCacheAjaxParams_POST(m,p,function(c,d,e){LogUtils.DebugLog("Patient Name sent");
b.notifyActionStatus(a,GenericActionStatus.Success)},function(a,c,d){LogUtils.DebugLog("ReceivePatientInfo: Error");b.onReceivePatientNameError(a,c,d)})):(p.commandName=a,p.commandResult=GenericActionStatus.Success,d=JSON.stringify(p),window.opener.postMessage(d,"*"))):this.notifyActionStatus(a,GenericActionStatus.Success)};a.prototype.ProcessCommand=function(a){var b=this,c=null,e=c=null,f=null,g=null;if(a.Name===ExternalCommandNames.LogOut)b._controller.LogOut();else if(a.Name===ExternalCommandNames.Close)b._controller.Close();
else if(a.Name===ExternalCommandNames.FindPatient)e=a.Args[0],c=a.Args[1],b._controller.FindPatient(e,c,this.onFindPatientError,function(c){0<c.data.length?b.MyReceivePatientInfo(a.Name,c.data):b.notifyActionStatus(a.Name,"PatientId does not exist: "+e)});else if(a.Name===ExternalCommandNames.ShowPatient)null==a.Args||1!==a.Args.length&&2!==a.Args.length?(c=b.GetInvalidArgumentsErrorString(a.Name),LogUtils.DebugLog(c),b.notifyActionStatus(a.Name,c)):(e=a.Args[0],2===a.Args.length&&(g=a.Args[1]),b._controller.FindSeriesExt(e,
null,null,b.onFindPatientError,function(c){for(var d=0;d<c.data.length&&!(b._controller.ShowSeriesInstanceExt(c.data,c.data[d],null,g),b._controller.isDental()&&1<c.data.length);d++);b.notifyActionStatus(a.Name,GenericActionStatus.Success)}));else if(a.Name===ExternalCommandNames.ShowStudy)null==a.Args||1!==a.Args.length?(c=b.GetInvalidArgumentsErrorString(a.Name),LogUtils.DebugLog(c),b.notifyActionStatus(a.Name,c)):b._controller.FindSeriesExt(null,a.Args[0],null,b.onFindPatientError,function(c){for(var d=
0;d<c.data.length;d++)b._controller.ShowSeriesInstanceExt(c.data,c.data[d],null,null);b.notifyActionStatus(a.Name,GenericActionStatus.Success)});else if(a.Name===ExternalCommandNames.ShowSeries)null==a.Args||1!==a.Args.length?(c=b.GetInvalidArgumentsErrorString(a.Name),LogUtils.DebugLog(c),b.notifyActionStatus(a.Name,c)):b._controller.FindSeriesExt(null,null,a.Args[0],b.onShowSeriesError,function(c){b._controller.ShowSeriesInstanceExt(c.data,c.data[0],function(){b.notifyActionStatus(a.Name,GenericActionStatus.Success)},
null)});else if(a.Name===ExternalCommandNames.GetCurrentPatient){c="All";var h=null,k=null,l=null;h=this._tabService.get_allTabs()[this._tabService.activeTab];null==h?b.notifyActionStatus(a.Name,"There are no loaded instances."):(h=this._tabService.get_tabData(h.id,TabDataKeys.ViewController),null!=h&&(k=h.getViewer()),null!=k&&(l=k.layout.get_selectedItems().get_item(0)),null==l?b.notifyActionStatus(a.Name,"There are no selected instances."):(k=l.get_seriesInstanceUID(),b._controller.FindPatientFromSeries(k,
c,b.onFindPatientFromSeriesError,function(c){0<c.data.length?b.MyReceivePatientInfo(a.Name,c.data):b.notifyActionStatus(a.Name,"Current patient does not exist")})))}else if(a.Name===ExternalCommandNames.GetImage){var m=a.Args[0];""===m?(c=b.GetExternalControlServiceRoot()+"ReceiveImageURL?url="+encodeURIComponent("")+"&token="+this._externalControlAssociationToken,LogUtils.DebugLog(c),b.NoCacheAjax_POST(c,null,function(){LogUtils.DebugLog("Empty Image URL Sent")})):b._controller.GetInstanceImageURL(m,
function(c){!0===b._externalControlEnabled?(c=b.GetExternalControlServiceRoot()+"ReceiveImageURL?url="+encodeURIComponent(c)+"&token="+b._externalControlAssociationToken,LogUtils.DebugLog(c),b.NoCacheAjax_POST(c,null,function(){LogUtils.DebugLog("Image URL Sent")})):(c=JSON.stringify({externalControlAssociationToken:b._externalControlAssociationToken,url:c,sopInstanceUID:m,commandName:a.Name,commandResult:GenericActionStatus.Success}),window.opener.postMessage(c,"*"))})}else a.Name===ExternalCommandNames.AddPatient?
null==a.Args?(c=b.GetInvalidArgumentsErrorString(a.Name),LogUtils.DebugLog(c),b.notifyActionStatus(a.Name,c)):(f={},f.PatientId=a.Args[0],f.Name=a.Args[1],f.Sex=a.Args[2],f.BirthDate=a.Args[3],f.EthnicGroup=a.Args[4],f.Comments=a.Args[5],b._controller.AddPatient(f,b.onAddPatientError,function(c){c.data?b.notifyActionStatus(a.Name,GenericActionStatus.Success):b.notifyActionStatus(a.Name,"PatientId Already Exists: "+f.PatientId)})):a.Name===ExternalCommandNames.DeletePatient?null==a.Args||1!==a.Args.length?
(c=b.GetInvalidArgumentsErrorString(a.Name),LogUtils.DebugLog(c),b.notifyActionStatus(a.Name,c)):(e=a.Args[0],b._controller.FindPatient(e,"All",b.onFindPatientError,function(c){0<c.data.length?b._controller.DeletePatient(e,b.onDeletePatientError,function(c){c?b.notifyActionStatus(a.Name,GenericActionStatus.Success):b.notifyActionStatus(a.Name,"Failed to delete patient: "+e)}):b.notifyActionStatus(a.Name,"PatientId does not exist: "+e)})):a.Name===ExternalCommandNames.UpdatePatient?(f={},f.PatientId=
a.Args[0],f.Name=a.Args[1],f.Sex=a.Args[2],f.BirthDate=a.Args[3],f.EthnicGroup=a.Args[4],f.Comments=a.Args[5],b._controller.UpdatePatient(f,b.onUpdatePatientError,function(c){b.notifyActionStatus(a.Name,GenericActionStatus.Success)})):a.Name===ExternalCommandNames.EndAssociation&&(b._shouldStopPolling=!0)};a.$inject=["sharedPropertiesService","authenticationService","tabService"];return a}();services.service("externalCommandHandlerService",ExternalCommandHandlerService);var ViewerMessageRecieverModule;
(function(a){function b(){new e;window.opener&&window.opener.window.postMessage(WebViewerCommandNames.ALIVE,"*")}var d=function(){return function(){}}();a.CommandClass=d;if("function"!=typeof window.onload)window.onload=function(){b()};else{var c=window.onload;window.onload=function(){c();b()}}var e=function(){function a(){LogUtils.DebugLog("WebViewerMessageReceiver Constructor called");window.onmessage=this.onMessageReceived;var b=angular.element(document.getElementById("app")).injector();a._eventService=
b.get("eventService");a._dataService=b.get("dataService");a._externalCommandHandlerService=b.get("externalCommandHandlerService");a._seriesManagerService=b.get("seriesManagerService")}a.CreateCommand=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];c=new d;c.Args=[];if(0==arguments.length)return c;c.Name=a;for(var e=0;e<b.length;e++)c.Args[e]=b[e];return c};a.prototype.onMessageReceived=function(b){var c=JSON.parse(b.data),d=new WebViewerMessage;d.Parse(b.data);switch(c.name){case ExternalCommandNames.ShowPatient:case ExternalCommandNames.ShowStudy:case ExternalCommandNames.ShowSeries:case ExternalCommandNames.ShowInstance:case ExternalCommandNames.GetImage:c=
a.CreateCommand(c.name,c.arg1);a._externalCommandHandlerService.ProcessCommand(c);break;case ExternalCommandNames.GetCurrentPatient:c=a.CreateCommand(c.name);a._externalCommandHandlerService.ProcessCommand(c);break;case WebViewerCommandNames.LOAD_SERIES_EXT:b=JSON.parse(c.seriesArray);d=JSON.parse(c.seriesSelected);a.seriesLoaderExt(b,d,c.style);break;case WebViewerCommandNames.SET_SERIES_VIEWER_MODE:d.get_Params();SetSeriesViewerMode(c.args.mode,-1);break;case WebViewerCommandNames.SUBSCRIBE:a.EventsDispatcher(b.source,
d);break;default:alert("Unknown message received")}};a.seriesLoaderExt=function(b,c,d){a._dataService.set_Series(b);a._seriesManagerService.currentLoadingSeries=c;a._seriesManagerService.currentPatientSeries=b;a._eventService.publish(EventNames.SeriesSelected,{study:b,series:c,style:d})};a.EventsDispatcher=function(a,b){function c(b,c){a.postMessage("Series Loaded: Series UID="+c,"*")}function d(b,c){a.postMessage("Presentation State Created: SOP UID="+c.SOPInstanceUID,"*")}function e(b,c){a.postMessage("Presentation State Deleted: SOP UID="+
c.SOPInstanceUID,"*")}function f(b,c){a.postMessage("Derived Image Created: SOP UID="+c,"*")}function g(b,c){a.postMessage("Image Exported: SOP UID="+c,"*")}b=b.get_Params();var h=b[SubscribeToEventsCmdParams.PARAM_PresentationStateCreated],q=b[SubscribeToEventsCmdParams.PARAM_PresentationStateDeleted],t=b[SubscribeToEventsCmdParams.PARAM_DerivedImageCreated],y=b[SubscribeToEventsCmdParams.PARAM_ImageExported];b[SubscribeToEventsCmdParams.PARAM_LoadSeries]&&EventBroker.add_seriesLoaded(c);h&&EventBroker.add_presentationStateCreated(d);
q&&EventBroker.add_presentationStateDeleted(e);t&&EventBroker.add_derivedImageCreated(f);y&&EventBroker.add_imageExported(g)};return a}();a.WebViewerMessageReceiver=e})(ViewerMessageRecieverModule||(ViewerMessageRecieverModule={}));
var AutoService=function(){function a(a,d,c,e){this._automationEnabled=!1;this._controller=this._webViewerAuthenticationToken=null;this._shouldStopPolling=!1;this._sharedPropertiesService=a;this._authenticationService=d;this._tabService=c;this._autoServiceUrl=e.urls.serviceUrl+e.urls.autoServiceName}a.prototype.reportCmdError=function(b,d){this._automationEnabled&&(b=this._autoServiceUrl+"/ReportCommandStatus?token="+encodeURIComponent(this._webViewerAuthenticationToken)+"&cmdid="+encodeURIComponent(b)+
"&status="+encodeURIComponent(a.cmdStatus.failed)+"&message="+encodeURIComponent(d),this.GETVoid(b))};a.prototype.reportCmdSuccess=function(b){this._automationEnabled&&(b=this._autoServiceUrl+"/ReportCommandStatus?token="+encodeURIComponent(this._webViewerAuthenticationToken)+"&cmdid="+encodeURIComponent(b)+"&status="+encodeURIComponent(a.cmdStatus.succeeded)+"&message=null",this.GETVoid(b))};a.prototype.Initialize=function(){this._sharedPropertiesService.GetAutoMode()?(this._automationEnabled=!0,
this._webViewerAuthenticationToken=this._sharedPropertiesService.GetToken(),this._shouldStopPolling=!this._sharedPropertiesService.GetPolling(),this._controller=new WebViewerCommandHandlerService(this._authenticationService,this._webViewerAuthenticationToken,window),this.CheckAutomation()):(this._automationEnabled=!1,LogUtils.DebugLog("Normal Mode"))};a.prototype.LogoutNotify=function(a){this._automationEnabled&&(a=this._autoServiceUrl+"/Logout?token="+encodeURIComponent(this._webViewerAuthenticationToken)+
"&reason="+encodeURIComponent(a),this.GETVoid(a))};a.prototype.onHandleRequestError=function(a,d,c){this._automationEnabled=!1;LogUtils.DebugLog("External Control Error: "+d+" - "+c)};a.prototype.GET=function(a,d,c){$.ajax({url:a,crossDomain:!0,type:"GET",dataType:"json",cache:!1,success:d,error:c})};a.prototype.GETVoid=function(a){$.ajax({url:a,crossDomain:!0,type:"GET",dataType:"json",cache:!1})};a.prototype.CheckAutomation=function(){var a=this._autoServiceUrl+"/IsAutomated?token="+encodeURIComponent(this._webViewerAuthenticationToken);
LogUtils.DebugLog(a);this.GET(a,$.proxy(this.onCheckAutomationSuccess,this),$.proxy(this.onHandleRequestError,this));this.PollForCommands()};a.prototype.onCheckAutomationSuccess=function(a){a&&this.PollForCommands()};a.prototype.PollForCommands=function(){if(!this._shouldStopPolling){var a=this._autoServiceUrl+"/GetAndRemoveCommands?token="+encodeURIComponent(this._webViewerAuthenticationToken);LogUtils.DebugLog(a);this.GET(a,$.proxy(this.onGetCommandsRequestSuccess,this),$.proxy(this.onHandleRequestError,
this))}};a.prototype.onGetCommandsRequestSuccess=function(a){var b=!0;if(a)for(var c=0;c<a.length;++c)b=!1,this.ProcessCommand(a[c]);b?setTimeout($.proxy(this.PollForCommands,this),5E3):setTimeout($.proxy(this.PollForCommands,this),500)};a.prototype.GetInvalidArgumentsErrorString=function(a){return a+": Invalid Arguments"};a.prototype.ProcessCommand=function(a){var b=this,c=null,e=null,f=null,g=a.Item1;e=a.Item2;c=JSON.parse(a.Item3);e===ExternalCommandNames.LogOut?b._controller.LogOut():e===ExternalCommandNames.Close?
b._controller.Close():e===ExternalCommandNames.ShowPatient?c?(e=c.patientID,f=c.style,b._controller.FindSeriesExt(e,null,null,function(a,c,d){b.reportCmdError(g,a.statusText);b._controller.LogOut()},function(a){if(0==a.data.length)b.reportCmdError(g,"Patient was not found"),b._controller.LogOutError("Patient was not found");else{for(var c=0;c<a.data.length&&!(b._controller.ShowSeriesInstanceExt(a.data,a.data[c],null,f),b._controller.isDental()&&1<a.data.length);c++);b.reportCmdSuccess(g)}})):(c=b.GetInvalidArgumentsErrorString(e),
LogUtils.DebugLog(c),b.reportCmdError(g,c),b._controller.LogOut()):e===ExternalCommandNames.ShowStudy?null==a.Args||1!==a.Args.length?(c=b.GetInvalidArgumentsErrorString(e),LogUtils.DebugLog(c),b.reportCmdError(g,c)):b._controller.FindSeriesExt(null,a.Args[0],null,function(a,c,d){b.reportCmdError(g,a.statusText)},function(a){for(var c=0;c<a.data.length;c++)b._controller.ShowSeriesInstanceExt(a.data,a.data[c],null,null);b.reportCmdSuccess(g)}):e===ExternalCommandNames.ShowSeries?null==a.Args||1!==
a.Args.length?(c=b.GetInvalidArgumentsErrorString(e),LogUtils.DebugLog(c),b.reportCmdError(g,c)):b._controller.FindSeriesExt(null,null,a.Args[0],function(a,c,d){b.reportCmdError(g,a.statusText)},function(a){b._controller.ShowSeriesInstanceExt(a.data,a.data[0],function(){b.reportCmdSuccess(g)},null)}):e===ExternalCommandNames.EndAssociation&&(b._shouldStopPolling=!0)};a.$inject=["sharedPropertiesService","authenticationService","tabService","app.config"];a.cmdStatus={succeeded:"Succeeded",failed:"Failed"};
return a}();services.service("autoService",AutoService);
var ModalityItem=function(){return function(a,b){this.metadata=a;this.Modality=b;this.AnatomicRegionSequence=[];this.ProcedureCodeSequence=[];this.ReasonForRequestedProcedureCodeSequence=[]}}(),HangingProtocolHelper=function(){function a(){}a.get_HangingProtocol=function(b,d,c){var e=new Models.HangingProtocol,f=angular.element(document.getElementById("app")).injector().get("authenticationService"),g=a.get_ModalityItemsInView(b),h=DicomHelper.getDicomTagValue(c,DicomTag.StudyDescription);c=DicomHelper.getDicomTagValue(c,
DicomTag.Modality);e.HangingProtocolName=null==h?c:(c+" "+h).substring(0,16);e.HangingProtocolDescription=h;null==e.HangingProtocolDescription&&(e.HangingProtocolDescription=e.HangingProtocolName);e.HangingProtocolLevel=Models.HangingProtocolLevel.Site;e.HangingProtocolCreator=f.user;e.WCFHangingProtocolCreationDateTime=new Date;for(f=0;f<g.length;f++)h=new Models.HangingProtocolDefinition,h.Modality=g[f].Modality,h.StudyDescription=g[f].StudyDescription,h.ProcedureCodeSequence=g[f].ProcedureCodeSequence,
h.AnatomicRegionSequence=g[f].AnatomicRegionSequence,h.ReasonForRequestedProcedureCodeSequence=g[f].ReasonForRequestedProcedureCodeSequence,h.BodyPartExamined=g[f].BodyPartExamined,h.ProtocolName=g[f].ProtocolName,h.metadata=g[f].metadata,e.HangingProtocolDefinitionSequence.push(h);e.HangingProtocolUserIdentificationCodeSequence=[];e.NumberOfPriorsReferenced=0;this.get_ImageSets(b,d,e);e.NumberOfScreens=1;this.setNominalScreenDefinitionSequence(e);e.PartialDataDisplayHandling=Models.PartialDataDisplayHandling.MaintainLayout;
b.cellsArrangement==lt.Controls.Medical.CellsArrangement.grid&&(e.Rows=b.gridLayout.rows,e.Columns=b.gridLayout.columns);return e};a.ConvertToHorizontalAlignmentType=function(a){var b=lt.Controls.Medical.HorizontalAlignmentType.middle;switch(a){case Models.FrameHorizontalJustification.Center:b=lt.Controls.Medical.HorizontalAlignmentType.middle;break;case Models.FrameHorizontalJustification.Left:b=lt.Controls.Medical.HorizontalAlignmentType.left;break;case Models.FrameHorizontalJustification.Right:b=
lt.Controls.Medical.HorizontalAlignmentType.right}return b};a.ConvertToFrameHorizontalJustication=function(a){var b=Models.FrameHorizontalJustification.Center;switch(a){case lt.Controls.Medical.HorizontalAlignmentType.middle:b=Models.FrameHorizontalJustification.Center;break;case lt.Controls.Medical.HorizontalAlignmentType.left:b=Models.FrameHorizontalJustification.Left;break;case lt.Controls.Medical.HorizontalAlignmentType.right:b=Models.FrameHorizontalJustification.Right}return b};a.ConvertToVerticalAlignmentType=
function(a){var b=lt.Controls.Medical.VerticalAlignmentType.middle;switch(a){case Models.FrameVerticalJustification.Center:b=lt.Controls.Medical.VerticalAlignmentType.middle;break;case Models.FrameVerticalJustification.Bottom:b=lt.Controls.Medical.VerticalAlignmentType.bottom;break;case Models.FrameVerticalJustification.Top:b=lt.Controls.Medical.VerticalAlignmentType.top}return b};a.ConvertToFrameVerticalJustication=function(a){var b=Models.FrameVerticalJustification.Center;switch(a){case lt.Controls.Medical.VerticalAlignmentType.middle:b=
Models.FrameVerticalJustification.Center;break;case lt.Controls.Medical.VerticalAlignmentType.top:b=Models.FrameVerticalJustification.Top;break;case lt.Controls.Medical.VerticalAlignmentType.bottom:b=Models.FrameVerticalJustification.Bottom}return b};a.GetCellMprTypeSelectorValue=function(a){var b="";switch(a){case lt.Controls.Medical.CellMPRType.axial:b="TRANSVERSE";break;case lt.Controls.Medical.CellMPRType.sagittal:b="SAGITTAL";break;case lt.Controls.Medical.CellMPRType.coronal:b="CORONAL";break;
case lt.Controls.Medical.CellMPRType.none:b=""}return b};a.getTimeBasedImageSetLabel=function(a,d){d=d.replace("Image Set","");d=d.trim();return a+" "+d};a.get_ImageSets=function(b,d,c){var e=b.layout.items.count,f=d=1,g={};a.split_cells(b);for(var h=1,k=0;k<e;k++){var l=b.layout.items.item(k);if(0<l.frames.count){var m=l.frames.item(0),p=a.get_activeFrame(l),n=m.metadata;null!=n&&(h=DicomHelper.getDicomTagValue(n,DicomTag.PixelSpacing));if(m=Utils.findFirst(c.DisplaySets,function(a){return(a=a.cell)?
a.derivatives.contains(l):!1}))n=new Models.DisplaySet,n.DisplaySetNumber=d,n.DisplaySetLabel="Display Set "+d,n.DisplaySetPresentationGroup=1,n.ImageSetNumber=m.ImageSetNumber,m=a.get_cellImageBox(l,f),n.Boxes.push(m),this.setFilterOperationsMpr(n,l),this.setSortingOperationsMpr(n,l),this.setReformattingOptions(n,l,h),this.setDisplaySetPatientOrientation(p,n),n.DisplaySetHorizontalJustification=this.ConvertToFrameHorizontalJustication(p.horizontalAlignment),n.DisplaySetVerticalJustification=this.ConvertToFrameVerticalJustication(p.verticalAlignment),
n.VoiType=this.get_voiType(l),n.cell=l,f++,d++,c.DisplaySets.push(n);else if(n){var r=DicomHelper.getDicomTagValue(n,DicomTag.Modality);var q=DicomHelper.getDicomTagValue(n,DicomTag.BodyPartExamined);var t;m=a.get_cellImageBox(l,f);DicomHelper.getDicomTagValue(n,DicomTag.StudyInstanceUID);q||(q="");0==q.length&&(t=DicomHelper.getDicomTagValue(n,DicomTag.StudyDescription));t||(t="");DicomHelper.getStudyDateTimeString(n,!0,!0);var y=DicomHelper.getStudyDateTime(n,!0),w=DicomHelper.getDicomTagValue(n,
DicomTag.SOPClassUID),x=!1;"1.2.840.10008.5.1.4.1.1.104.1"==w&&(x=!0);var u=r+"|"+w;if(g[u])var A=g[u];else A=new Models.ImageSet,A.metadata=n,g[u]=A,A.Name=r,x&&(A.Name+=" PDF"),0<q.length&&(A.Name=A.Name+" ["+q+"]"),A.Name+=" Image Set ",c.ImageSetsSequence.push(A);0==A.ImageSetSelectorSequence.length&&(q=new Models.ImageSetSelector,q.ImageSetSelectorUsageFlag=Models.ImageSetSelectorUsage.NoMatch,q.WCFSelectorAttribute=Utils.insert(DicomTag.Modality,4,":"),q.SelectorValueNumber=1,q.SelectorValue=
r,q.SelectorName="Modality",A.ImageSetSelectorSequence.push(q),0!=w.length&&(q=new Models.ImageSetSelector,q.ImageSetSelectorUsageFlag=Models.ImageSetSelectorUsage.NoMatch,q.WCFSelectorAttribute=Utils.insert(DicomTag.SOPClassUID,4,":"),q.SelectorValueNumber=1,q.SelectorValue=w,q.SelectorName="SOP Class UID",A.ImageSetSelectorSequence.push(q)));A.UpdateImageSelectorItem(n,DicomTag.BodyPartExamined,"Body Part Examined");A.UpdateImageSelectorItem(n,DicomTag.Laterality,"Laterality");A.UpdateImageSelectorItem(n,
DicomTag.ProtocolName,"Protocol Name");A.UpdateImageSelectorItem(n,DicomTag.StudyDescription,"Study Description");A.UpdateImageSelectorItem(n,DicomTag.ImageLaterality,"Image Laterality");r=A.FindTimeBasedImageSetNumber(y);0==r&&(r=c.getNextImageSetNumber(),r=A.AddTimeBasedImageSet(y,r));n=new Models.DisplaySet;p&&(n.metadata=p.metadata);n.DisplaySetNumber=d;n.DisplaySetLabel="Display Set "+d;n.DisplaySetPresentationGroup=1;n.ImageSetNumber=r;n.Boxes.push(m);a.checkFilterOperations(n);a.checkSortingOperations(n,
l);this.setDisplaySetPatientOrientation(p,n);n.DisplaySetHorizontalJustification=this.ConvertToFrameHorizontalJustication(p.horizontalAlignment);n.DisplaySetVerticalJustification=this.ConvertToFrameVerticalJustication(p.verticalAlignment);n.VoiType=this.get_voiType(l);n.ShowGrayscaleInverted=this.get_invertedFlag(l);n.ShowImageTrueSizeFlag=this.get_showImageTrueSize(l);n.ShowGraphicAnnotationFlag=this.get_annotationFlag(l);n.ShowPatientDemographicsFlag=l.overlayTextVisible;c.getTimeBasedImageSetLabel(n.ImageSetNumber);
n.cell=l;f++;d++;c.DisplaySets.push(n)}}}for(k=0;k<c.ImageSetsSequence.length;k++)for(c.ImageSetsSequence[k].TimeBasedImageSetsSequence.sort(function(a,b){return-1*a.StudyDateTime.compareTo(b.StudyDateTime)}),e=0;e<c.ImageSetsSequence[k].TimeBasedImageSetsSequence.length;e++)t=c.ImageSetsSequence[k].TimeBasedImageSetsSequence[e],0==e?(t.ImageSetSelectorCategory=Models.ImageSetSelectorCategory.RelativeTime,t.RelativeTime.push(0),t.RelativeTime.push(0),t.RelativeTimeUnits=Models.RelativeTimeUnits.Minutes,
t.ImageSetLabel=this.getTimeBasedImageSetLabel("Current",c.ImageSetsSequence[k].Name)):(t.ImageSetSelectorCategory=Models.ImageSetSelectorCategory.AbstractPrior,t.AbstractPriorValue.push(e),t.AbstractPriorValue.push(e),g=Utils.GetNumericPrefix(e),t.ImageSetLabel=this.getTimeBasedImageSetLabel(g+" Prior",c.ImageSetsSequence[k].Name));c.updateDisplaySetCombinedName();c.NumberOfPriorsReferenced=c.getNumberOfPriorsReferenced();c.updateImageSetSelectorValues();this.setReferenceLine(b,c);this.setSynchronizedScrolling(b,
c);this.setSynchronizedScrollingMprDerived(b,c);e=b.emptyDivs.items.count;for(k=0;k<e;k++)t=b.emptyDivs.items.item(k),n=new Models.DisplaySet,n.DisplaySetNumber=d++,n.DisplaySetLabel="Display Set "+n.DisplaySetNumber,n.ImageSetNumber=-1,m=a.get_emptyCellImageBox(t,f++),n.Boxes.push(m),c.DisplaySets.push(n),n.DisplaySetPatientOrientation=null,n.ShowGrayscaleInverted=this.get_invertedFlag(l),n.ShowImageTrueSizeFlag=this.get_showImageTrueSize(l)};a.get_activeFrame=function(a){if(a){var b=angular.element(document.getElementById("app")).injector().get("seriesManagerService").get_activeSubCellIndex(a);
return a.imageViewer.items.get_item(b).attachedFrame}return null};a.get_allValues=function(a,d){var b=null,e=a.frames.count,f=a.frames.get_item(0);f.hasOwnProperty(d)&&(b=f[d]);if(null==b)return null;for(var g=1;g<e;g++)if(f=a.frames.get_item(g),!f.hasOwnProperty(d)||b!=f[d])return null;return b};a.get_voiType=function(a){var b=null;a=this.get_allValues(a,"currentCustomWindowlevel");null!=a&&a.hasOwnProperty("VoiType")&&(b=a.VoiType);return b==Models.VoiType.Undefined?null:b};a.get_invertedFlag=function(a){return this.get_allValues(a,
"_inverted")};a.get_showImageTrueSize=function(a){return this.get_allValues(a,"_sizeMode")==lt.Controls.Medical.MedicalViewerSizeMode.trueSize?!0:null};a.get_annotationFlag=function(a){return a.automation.activeContainer.isVisible};a.setReformattingOptions=function(a,d,c){a.ReformattingOperationType=Models.ReformattingOperationType.Mpr;a.ReformattingThickness=1;a.ReformattingInterval=c;a.ReformattingOperationInitialViewDirection=d.mprType};a.checkFilterOperations=function(b){var d=b.metadata,c=DicomHelper.get_allValues(d,
DicomTag.ImageType),e;if(!DicomHelper.IsDicomImage(d)&&(e=DicomHelper.getDicomTagValue(d,DicomTag.SOPClassUID))){var f=a.get_FilterOperation(DicomTag.SOPClassUID,1,e);f.SelectorName="SOP Class UID";f.SelectorAttributeVr="UI";b.FilterOperationsSequence.push(f)}3<=c.length&&((e=0===$.trim(c[2]).length)?(e=0===$.trim(c[3]).length,e||(f=a.get_FilterOperation(DicomTag.ImageType,4,c[3]),f.SelectorName="Image Type",f.SelectorAttributeVr="CS",b.FilterOperationsSequence.push(f))):(f=a.get_FilterOperation(DicomTag.ImageType,
3,c[2]),f.SelectorName="Image Type",f.SelectorAttributeVr="CS",b.FilterOperationsSequence.push(f)));(e=DicomHelper.getDicomTagValue(d,DicomTag.ContrastBolusAgent))&&("string"!=typeof e||"string"==typeof e&&0<e.length)&&(f=a.get_FilterOperation(DicomTag.ContrastBolusAgent,1,e),f.SelectorName="Contrast/Bolus Agent",f.SelectorAttributeVr="LO",b.FilterOperationsSequence.push(f));(e=DicomHelper.getDicomTagValue(d,DicomTag.ScanningSequence))&&("string"!=typeof e||"string"==typeof e&&0<e.length)&&(f=a.get_FilterOperation(DicomTag.ScanningSequence,
1,e),f.SelectorName="Scanning Sequence",f.SelectorAttributeVr="CS",b.FilterOperationsSequence.push(f));if(e=DicomHelper.getDicomTagValue(d,DicomTag.EchoNumber))f=a.get_FilterOperation(DicomTag.EchoNumber,1,e),f.SelectorName="Echo Numbers",f.SelectorAttributeVr="IS",b.FilterOperationsSequence.push(f);e||(e=DicomHelper.getDicomTagValue(d,DicomTag.ProtocolName))&&("string"!=typeof e||"string"==typeof e&&0<e.length)&&(f=a.get_FilterOperation(DicomTag.ProtocolName,1,e),f.SelectorName="Protocol Name",f.SelectorAttributeVr=
"LO",b.FilterOperationsSequence.push(f));if(e=DicomHelper.getDicomTagValue(d,DicomTag.ViewPosition))f=a.get_FilterOperation(DicomTag.ViewPosition,1,e),f.SelectorName="View Position",f.SelectorAttributeVr="CS",b.FilterOperationsSequence.push(f);if(e=DicomHelper.getDicomTagValue(d,DicomTag.Laterality))f=a.get_FilterOperation(DicomTag.Laterality,1,e),f.SelectorName="Laterality",f.SelectorAttributeVr="CS",b.FilterOperationsSequence.push(f);if(e=DicomHelper.getDicomTagValue(d,DicomTag.ImageLaterality))f=
a.get_FilterOperation(DicomTag.ImageLaterality,1,e),f.SelectorName="Image Laterality",f.SelectorAttributeVr="CS",b.FilterOperationsSequence.push(f)};a.checkSortingOperations=function(a,d){if(0<d.derivatives.count)this.setSortingOperationsMpr(a,d);else{var b=[];d=d.sortingOperationsSequence;null!=d&&(d.forEach(function(a){var c=new Models.SortingOperations;c.Convert(a);b.push(c)}),0<b.length&&(a.SortingOperationsSequence=b))}};a.setNominalScreenDefinitionSequence=function(a){a.NominalScreenDefinitionSequence=
[];var b=new Models.NominalScreenDefinition;b.NumberOfHorizontalPixels=1024;b.NumberOfVerticalPixels=768;b.DisplayEnvironmentSpatialPosition=[0,1,1,0];b.ScreenMinimumColorBitDepth=8;a.NominalScreenDefinitionSequence.push(b)};a.setFilterOperationsMpr=function(a,d){var b=new Models.FilterOperation;b.SelectorName="Image Plane";b.FilterByCategory="IMAGE_PLANE";b.SelectorAttributeVr="CS";b.SelectorValue=this.GetCellMprTypeSelectorValue(d.mprType);b.FilterByOperator=Models.FilterByOperator.MemberOf;a.FilterOperationsSequence.push(b)};
a.setSortingOperationsMpr=function(a,d){d=[];var b=new Models.SortingOperations;b.SortByCategory=Models.SortByCategory.AlongAxis;b.SortingDirection=Models.SortingDirection.Increasing;d.push(b);0<d.length&&(a.SortingOperationsSequence=d)};a.setDisplaySetPatientOrientation=function(a,d){d.DisplaySetPatientOrientation=null;void 0!=a.targetOrientation&&(d.DisplaySetPatientOrientation=a.targetOrientation)};a.get_FilterOperation=function(a,d,c){var b=new Models.FilterOperation;b.WCFSelectorAttribute=Utils.insert(a,
4,":");b.SelectorValueNumber=d;b.SelectorValue=c;b.FilterByOperator=Models.FilterByOperator.MemberOf;return b};a.get_ModalityItemsInView=function(a){for(var b=[],c=a.layout.items.count,e=0;e<c;e++){var f=a.layout.items.item(e);if(0<f.frames.count&&(f=f.frames.item(0),f.metadata)){var g=DicomHelper.getDicomTagValue(f.metadata,DicomTag.Modality),h=DicomHelper.getCodeSequenceList(f.metadata,DicomTag.AnatomicRegionSequence,null),k=DicomHelper.getCodeSequenceList(f.metadata,DicomTag.ProcedureCodeSequence,
null),l=DicomHelper.getCodeSequenceList(f.metadata,DicomTag.ReasonForRequestedProcedureCodeSequence,null),m=DicomHelper.getDicomTagValue(f.metadata,DicomTag.StudyDescription),p=DicomHelper.getDicomTagValue(f.metadata,DicomTag.BodyPartExamined),n=DicomHelper.getDicomTagValue(f.metadata,DicomTag.ProtocolName);if(0<k.length||0<l.length)m="";else if(p&&0<p.length||n&&0<n.length)m="";var r=Utils.findFirst(b,function(a){return a.Modality==g&&a.StudyDescription==m&&Utils.is_equal(a.AnatomicRegionSequence,
h)&&Utils.is_equal(a.ProcedureCodeSequence,k)&&Utils.is_equal(a.ReasonForRequestedProcedureCodeSequence,l)});r||(r=new ModalityItem(f.metadata,g),r.AnatomicRegionSequence=h,r.ProcedureCodeSequence=k,r.ReasonForRequestedProcedureCodeSequence=l,r.StudyDescription=m,r.BodyPartExamined=p,r.ProtocolName=n,b.push(r))}}return b};a.get_emptyCellImageBox=function(b,d){var c=new Models.ImageBox;c.Position=a.get_position(b.bounds);c.ImageBoxNumber=d;b.parent.viewer.cellsArrangement==lt.Controls.Medical.CellsArrangement.grid&&
(c.RowPosition=b.rowPosition,c.ColumnPosition=b.columnsPosition,c.NumberOfRows=b.numberOfRows,c.NumberOfColumns=b.numberOfColumns);c.ImageBoxLayoutType=Models.ImageBoxLayoutType.Single;return c};a.get_cellScrollType=function(a,d){if(null!=a&&null!=d)switch(a.scrollType){default:case lt.Controls.Medical.ScrollType.none:d.ImageBoxScrollDirection=Models.ScrollDirection.None;d.ImageBoxSmallScrollType=Models.ScrollType.None;d.ImageBoxLargeScrollType=Models.ScrollType.None;d.ImageBoxSmallScrollAmount=1;
d.ImageBoxLargeScrollAmount=1;break;case lt.Controls.Medical.ScrollType.normal:d.ImageBoxScrollDirection=Models.ScrollDirection.Vertical;d.ImageBoxSmallScrollType=Models.ScrollType.Image;d.ImageBoxLargeScrollType=Models.ScrollType.Image;d.ImageBoxSmallScrollAmount=1;d.ImageBoxLargeScrollAmount=1;break;case lt.Controls.Medical.ScrollType.row:d.ImageBoxScrollDirection=Models.ScrollDirection.Vertical;d.ImageBoxSmallScrollType=Models.ScrollType.RowColumn;d.ImageBoxLargeScrollType=Models.ScrollType.RowColumn;
d.ImageBoxSmallScrollAmount=1;d.ImageBoxLargeScrollAmount=1;break;case lt.Controls.Medical.ScrollType.column:d.ImageBoxScrollDirection=Models.ScrollDirection.Horizontal;d.ImageBoxSmallScrollType=Models.ScrollType.RowColumn;d.ImageBoxLargeScrollType=Models.ScrollType.RowColumn;d.ImageBoxSmallScrollAmount=1;d.ImageBoxLargeScrollAmount=1;break;case lt.Controls.Medical.ScrollType.page:d.ImageBoxScrollDirection=Models.ScrollDirection.Vertical,d.ImageBoxSmallScrollType=Models.ScrollType.Page,d.ImageBoxLargeScrollType=
Models.ScrollType.Page,d.ImageBoxSmallScrollAmount=1,d.ImageBoxLargeScrollAmount=1}};a.ConvertToHangingProtocolCineOptions=function(a){if(null==a)return null;var b=null,c=a.get_loop();switch(a.get_direction()){case lt.Controls.Medical.PlayingDirection.forward:b=c?Models.PlaybackSequencing.Looping:Models.PlaybackSequencing.Stop;break;case lt.Controls.Medical.PlayingDirection.sweep:b=c?Models.PlaybackSequencing.Sweeping:Models.PlaybackSequencing.SweepingStop;break;case lt.Controls.Medical.PlayingDirection.backward:b=
c?Models.PlaybackSequencing.Backward:Models.PlaybackSequencing.BackwardStop;break;case lt.Controls.Medical.PlayingDirection.shuffle:b=c?Models.PlaybackSequencing.Shuffle:Models.PlaybackSequencing.ShuffleStop}return b};a.ConvertToCellCinePlayer=function(a,d){if(null!=d&&null!=d.Boxes&&0!=d.Boxes.length){d=d.Boxes[0];if(null==d.PreferredPlaybackSequencing||null==d.RecommendedDisplayFrameRate)return null;a=a.get_cinePlayer();if(null!=a)switch(a.set_FPS(d.RecommendedDisplayFrameRate),d.PreferredPlaybackSequencing){case Models.PlaybackSequencing.Looping:a.set_loop(!0);
a.set_direction(lt.Controls.Medical.PlayingDirection.forward);break;case Models.PlaybackSequencing.Sweeping:a.set_loop(!0);a.set_direction(lt.Controls.Medical.PlayingDirection.sweep);break;case Models.PlaybackSequencing.Stop:a.set_loop(!1);a.set_direction(lt.Controls.Medical.PlayingDirection.forward);break;case Models.PlaybackSequencing.SweepingStop:a.set_loop(!1);a.set_direction(lt.Controls.Medical.PlayingDirection.sweep);break;case Models.PlaybackSequencing.Backward:a.set_loop(!0);a.set_direction(lt.Controls.Medical.PlayingDirection.backward);
break;case Models.PlaybackSequencing.BackwardStop:a.set_loop(!1);a.set_direction(lt.Controls.Medical.PlayingDirection.backward);break;case Models.PlaybackSequencing.Shuffle:a.set_loop(!0);a.set_direction(lt.Controls.Medical.PlayingDirection.shuffle);break;case Models.PlaybackSequencing.ShuffleStop:a.set_loop(!1),a.set_direction(lt.Controls.Medical.PlayingDirection.shuffle)}}};a.get_CineOptions=function(a,d){null!=a.cinePlayer&&(d.PreferredPlaybackSequencing=this.ConvertToHangingProtocolCineOptions(a.cinePlayer),
d.RecommendedDisplayFrameRate=a.cinePlayer.FPS)};a.ConvertToScrollType=function(a){var b=lt.Controls.Medical.ScrollType.normal;if(null==a||null==a.Boxes||0==a.Boxes.length)return b;a=a.Boxes[0];switch(a.ImageBoxSmallScrollType){case Models.ScrollType.None:b=lt.Controls.Medical.ScrollType.none;break;case Models.ScrollType.Image:b=lt.Controls.Medical.ScrollType.normal;break;case Models.ScrollType.RowColumn:b=a.ImageBoxScrollDirection==Models.ScrollDirection.Vertical?lt.Controls.Medical.ScrollType.row:
lt.Controls.Medical.ScrollType.column;break;case Models.ScrollType.Page:b=lt.Controls.Medical.ScrollType.page}return b};a.get_cellImageBox=function(b,d){var c=new Models.ImageBox,e=angular.element(document.getElementById("app")).injector().get("seriesManagerService").get_instances(b.seriesInstanceUID,b.divID),f=b.selectedItem;f||(f=b.imageViewer.items.item(0));c.Position=a.get_position(b.bounds);c.ImageBoxNumber=d;b.viewer.cellsArrangement==lt.Controls.Medical.CellsArrangement.grid&&(c.RowPosition=
b.rowPosition,c.ColumnPosition=b.columnsPosition,c.NumberOfRows=b.numberOfRows,c.NumberOfColumns=b.numberOfColumns);for(d=0;d<b.frames.count;d++){var g=b.frames.item(d);angular.isDefined(g.Instance)&&c.referencedSOPInstanceUID.push(g.Instance.SOPInstanceUID)}b.arrangement==lt.Controls.Medical.FrameArrangement.grid&&(1<b.gridLayout.columns||1<b.gridLayout.rows)&&(c.ImageBoxTileHorizontalDimension=b.gridLayout.columns,c.ImageBoxTileVerticalDimension=b.gridLayout.rows,this.get_cellScrollType(b,c));angular.isDefined(f.horizontalAlignment)&&
(c.HorizontalJustification=f.horizontalAlignment);angular.isDefined(f.verticalAlignment)&&(c.VerticalJustification=f.verticalAlignment);angular.isDefined(b.frames.item(b.currentOffset).Instance)&&(c.FirstFrame=new Models.FirstFrame,c.FirstFrame.SOPClassUID=b.frames.item(b.currentOffset).Instance.SOPClassUID,c.FirstFrame.SOPInstanceUID=b.frames.item(b.currentOffset).Instance.SOPInstanceUID,c.FirstFrame.FrameNumber=b.currentOffset+1);f&&f.attachedFrame&&(d=f.attachedFrame.get_wlRenderer())&&(g=d.originalWindowLevelWidth,
f.attachedFrame.windowCenter!=d.originalWindowLevelCenter||f.attachedFrame.windowWidth!=g)&&(c.WindowWidth=f.attachedFrame.windowWidth,c.WindowCenter=f.attachedFrame.windowCenter);b.arrangement==lt.Controls.Medical.FrameArrangement.grid&&(1<c.ImageBoxTileHorizontalDimension||1<c.ImageBoxTileVerticalDimension)?c.ImageBoxLayoutType=Models.ImageBoxLayoutType.Tiled:1==e.length&&1<e[0].NumberOfFrames?c.ImageBoxLayoutType=Models.ImageBoxLayoutType.Cine:1==e.length?c.ImageBoxLayoutType=Models.ImageBoxLayoutType.Single:
1<e.length&&(c.ImageBoxLayoutType=Models.ImageBoxLayoutType.Stack);this.get_CineOptions(b,c);return c};a.split_cells=function(b){b=b.layout.items.toArray();var d=angular.element(document.getElementById("app")).injector().get("seriesManagerService"),c={};if(1<b.length){c=b.reduce(function(a,b){var c=d.get_seriesInfo(b.seriesInstanceUID);if(c){c=c.Modality;var e="";if(0<b.frames.count){var f=b.frames.item(0).metadata;f||(f=b.generator.frames.item(0).metadata);f&&((e=DicomHelper.getDicomTagValue(f,DicomTag.BodyPartExamined))||
(e=""));0==e.length&&((f=DicomHelper.getDicomTagValue(f,DicomTag.StudyDescription))||(f=""),e+=f)}a[c+e]||(a[c+e]=[]);a[c+e].push(b)}return a},{});for(var e in c)c.hasOwnProperty(e)&&a.sort_cells(c[e])}return c};a.sort_cells=function(b){b.sort(function(b,c){if(0<b.frames.count&&0<c.frames.count){var d=b.frames.item(0).metadata,f=c.frames.item(0).metadata;if(d&&f){var g=DicomHelper.getDicomTagValue(d,DicomTag.StudyDate),h=DicomHelper.getDicomTagValue(f,DicomTag.StudyDate);d=DicomHelper.getDicomTagValue(d,
DicomTag.StudyTime);f=DicomHelper.getDicomTagValue(f,DicomTag.StudyTime);g=a.combine_datetime(g,d);h=a.combine_datetime(h,f);b.studyDate=g;c.studyDate=h;return h.compareTo(g)}}else{if(0==b.frames.count&&0<c.frames.count)return-1;if(0<b.frames.count&&0==c.frames.count)return 1}return 0})};a.sort_series=function(b){b.sort(function(b,c){if(0<b.frames.count&&0<c.frames.count){var d=b.frames.item(0).metadata,f=c.frames.item(0).metadata;if(d&&f){var g=DicomHelper.getDicomTagValue(d,DicomTag.StudyDate),
h=DicomHelper.getDicomTagValue(f,DicomTag.StudyDate);d=DicomHelper.getDicomTagValue(d,DicomTag.StudyTime);f=DicomHelper.getDicomTagValue(f,DicomTag.StudyTime);g=a.combine_datetime(g,d);h=a.combine_datetime(h,f);b.studyDate=g;c.studyDate=h;return h.compareTo(g)}}else{if(0==b.frames.count&&0<c.frames.count)return-1;if(0<b.frames.count&&0==c.frames.count)return 1}return 0})};a.combine_datetime=function(a,d){return a&&d?new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),d.getUTCHours(),d.getUTCMinutes(),
d.getUTCSeconds()):a&&!d?a:d};a.get_position=function(a){var b=new Models.FramePosition;b.leftTop=new lt.LeadPointD;b.leftTop.x=a.topLeft.x;b.leftTop.y=Math.abs(a.topLeft.y-1);b.rightBottom=new lt.LeadPointD;b.rightBottom.x=b.leftTop.x+a.width;b.rightBottom.y=b.leftTop.y-a.height;return b};a.get_PrimaryCell=function(b,d){b=b.layout.items.toArray();1<b.length&&a.sort_cells(b);return b[0]};a.setReferenceLine=function(a,d){if(a.showReferenceLine||a.showFirstAndLastReferenceLine){var b=d.DisplaySets,
e=[];angular.forEach(a.matchedCells,function(a){var c=new Models.NavigationIndicator;c.NavigationDisplaySet=null;c.ReferenceDisplaySets=[];angular.forEach(a,function(a){var d=Utils.findFirst(b,function(b){return a==b.cell});d&&c.ReferenceDisplaySets.push(d.DisplaySetNumber)});0<c.ReferenceDisplaySets.length&&e.push(c)});0<e.length&&(d.NavigationIndicatorSequence=e)}};a.setSynchronizedScrolling=function(a,d){if(a.enableSynchronization){var b=d.DisplaySets,e=[];angular.forEach(a.matchedCells,function(a){var c=
new Models.SynchronizedScrolling;c.DisplaySetScrollingGroup=[];angular.forEach(a,function(a){var d=Utils.findFirst(b,function(b){return a==b.cell});d&&c.DisplaySetScrollingGroup.push(d.DisplaySetNumber)});0<c.DisplaySetScrollingGroup.length&&e.push(c)});0<e.length&&(d.SynchronizedScrollingSequence=e)}};a.GetCellDisplaySet=function(a,d){return Utils.findFirst(d.DisplaySets,function(b){return a==b.cell})};a.setSynchronizedScrollingMprDerived=function(a,d){for(var b=a.layout.items.count,e=0;e<b;e++){var f=
a.layout.items.item(e);if(0<f.frames.count&&0<f.derivatives.count){null==d.SynchronizedScrollingSequence&&(d.SynchronizedScrollingSequence=[]);var g=new Models.SynchronizedScrolling;g.DisplaySetScrollingGroup=[];d.SynchronizedScrollingSequence.push(g);var h=this.GetCellDisplaySet(f,d);null!=h&&g.DisplaySetScrollingGroup.push(h.DisplaySetNumber);for(h=0;h<f.derivatives.count;h++){var k=this.GetCellDisplaySet(f.derivatives.get_item(h),d);null!=k&&g.DisplaySetScrollingGroup.push(k.DisplaySetNumber)}}}};
return a}(),SeriesLayout=function(){return function(){this.Boxes=[];this.TemplateId=""}}(),StructuredDisplayHelper=function(){function a(){}a.getPosition=function(a){var b=new Models.FramePosition;b.leftTop=new lt.LeadPointD;b.leftTop.x=a.topLeft.x;b.leftTop.y=Math.abs(a.topLeft.y-1);b.rightBottom=new lt.LeadPointD;b.rightBottom.x=b.leftTop.x+a.width;b.rightBottom.y=b.leftTop.y-a.height;return b};a.getSeriesLayout=function(a){for(var b=a.imageViewer.items,c=new SeriesLayout,e=0;e<b.count;e++){var f=
b.item(e),g=new Models.ImageBox;a.imageViewer.convertBoundsToView(f.bounds,!1);g.Position=this.getPosition(f.bounds);null!=f.attachedFrame&&angular.isDefined(f.attachedFrame.Instance)&&g.referencedSOPInstanceUID.push(f.attachedFrame.Instance.SOPInstanceUID);c.Boxes.push(g)}if(0<c.Boxes.length)return c.TemplateId="",angular.isDefined(a.templateId)&&(c.TemplateId=a.templateId),c};return a}();
(function(a){var b=function(){function a(){this.CodeMeaning=this.CodingSchemeVersion=this.CodeSchemeDesignator=this.CodeValue=""}a.prototype.toString=function(){return this.CodeMeaning};a.prototype.toFullString=function(){var a="["+this.CodeValue+","+this.CodeSchemeDesignator+","+this.CodeMeaning;this.CodingSchemeVersion&&0<this.CodingSchemeVersion.length&&(a+=","+this.CodingSchemeVersion);return a+"]"};return a}();a.CodeSequence=b;var d=function(){return function(){this.Name="";this.AnatomicRegionSequence=
new b;this.AnatomicRegionModifierSequence=new b;this.Laterality=0}}();a.AnatomicDescription=d;var c=function(){return function(a){this.Position=a;this.Id=UUID.genV4().toString();this.SequenceNumber=this.FrameNumber=-1;this.Rotation=e.None;this.ImageComments="";this.AnatomicDescription=new d;this.Script="";this.Invert=this.Reverse=this.Flip=!1;this.HorizontalJustification=f.Center;this.VerticalJustification=g.Center;this.PresentationSizeMode=h.ScaleToFit;this.Magnification=1}}();a.Frame=c;c=function(){return function(a){this.Id=
UUID.genV4().toString();this.Name=a;this.CreateDate=new Date;this.AutoMatching=this.Comments=this.Modality="";this.Hidden=this.BuiltIn=!1;this.Frames=[];this.Availability=k.SeriesAndStudy}}();a.Template=c;c=function(){return function(a,b){this.leftTop=a;this.rightBottom=b}}();a.FramePosition=c;var e;(function(a){a[a.None=0]="None";a[a.Rotate90=1]="Rotate90";a[a.Rotate180=2]="Rotate180";a[a.Rotate270=3]="Rotate270"})(e=a.FrameRotation||(a.FrameRotation={}));var f;(function(a){a[a.Left=0]="Left";a[a.Center=
1]="Center";a[a.Right=2]="Right"})(f=a.FrameHorizontalJustification||(a.FrameHorizontalJustification={}));var g;(function(a){a[a.Top=0]="Top";a[a.Center=1]="Center";a[a.Bottom=2]="Bottom"})(g=a.FrameVerticalJustification||(a.FrameVerticalJustification={}));(function(a){a[a.Left=0]="Left";a[a.Right=1]="Right";a[a.Both=2]="Both";a[a.Unpaired=3]="Unpaired"})(a.Laterality||(a.Laterality={}));var h;(function(a){a[a.ScaleToFit=0]="ScaleToFit";a[a.TrueSize=1]="TrueSize";a[a.Magnify=2]="Magnify"})(h=a.FramePresentationSizeMode||
(a.FramePresentationSizeMode={}));var k;(function(a){a[a.None=0]="None";a[a.Series=1]="Series";a[a.Study=2]="Study";a[a.SeriesAndStudy=3]="SeriesAndStudy"})(k=a.TemplateAvailability||(a.TemplateAvailability={}))})(Models||(Models={}));
var Modality=function(){return function(a,b,d,c){this.name=a;this.description=b;this.classType=d;this.saveDescription=c}}(),TemplateEditorService=function(){function a(){this._modalities=[];this.initializeModalities()}Object.defineProperty(a.prototype,"automation",{get:function(){return this._automation},set:function(a){this._automation=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"selectedFrames",{get:function(){return this._selectedFrames},set:function(a){this._selectedFrames=
a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"templateEditController",{get:function(){return this._templateController},set:function(a){this._templateController=a},enumerable:!0,configurable:!0});a.prototype.loadTemplates=function(){return null};a.prototype.deleteSelectedAnnotations=function(){null!=this._automation&&this._automation.canDeleteObjects&&this._automation.deleteSelectedObjects()};a.prototype.loadBW2=function(){var a=[];a.push(new Models.Frame(new Models.FramePosition(lt.LeadPointD.create(.06,
.75),lt.LeadPointD.create(.45,.25))));a.push(new Models.Frame(new Models.FramePosition(lt.LeadPointD.create(.55,.75),lt.LeadPointD.create(.94,.25))));return a};a.prototype.initializeModalities=function(){this._modalities.push(new Modality("IO","Intra Oral X-Ray","DXIntraoralImageStorageProcessing"));this._modalities.push(new Modality("SC","Secondary Capture","SCImageStorage"));this._modalities.push(new Modality("VL","Endoscopy","VLEndoscopicImageStorage",!0));this._modalities.push(new Modality("VL",
"Microscopy","VLMicroscopicImageStorage",!0));this._modalities.push(new Modality("VL","Photography","VLPhotographicImageStorage",!0));this._modalities.push(new Modality("DX","Panaromic","DXImageStoragePresentation",!0));this._modalities.push(new Modality("DX","Cephalometric","DXImageStoragePresentation",!0));this._modalities.push(new Modality("DX","General","DXImageStoragePresentation",!0));this._modalities.push(new Modality("DX","Skull","DXImageStoragePresentation",!0));this._modalities.push(new Modality("MG",
"Mammography","DXMammographyImageStorageProcessing"));this._modalities.push(new Modality("CR","Computed Radiography","CRImageStorage"))};a.prototype.getModalityDescriptions=function(){for(var a="NONE",d=this._modalities.length,c=0;c<d;c++)a+="|"+this._modalities[c].name+":"+this._modalities[c].description;return a};a.prototype.getModalities=function(){return this._modalities};return a}();services.service("templateEditorService",TemplateEditorService);
var TemplateService=function(){function a(a,d,c){this._http=c;this._authenticationService=d;this._templateServiceUrl=a.urls.serviceUrl+a.urls.templateServiceName;this._currentStudyLayout=null}Object.defineProperty(a.prototype,"currentStudyLayout",{get:function(){return this._currentStudyLayout},set:function(a){this._currentStudyLayout=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"currentHangingProtocol",{get:function(){return this._currentHangingProtocol},set:function(a){this._currentHangingProtocol=
a},enumerable:!0,configurable:!0});a.prototype.GetAnatomicDescriptions=function(a){return this._http.get(this._templateServiceUrl+"/GetAnatomicDescriptions?auth="+encodeURIComponent(this._authenticationService.authenticationCode)+"&data="+JSON.stringify(a))};a.prototype.GetAllTemplates=function(a){return this._http.get(this._templateServiceUrl+"/GetAllTemplates?auth="+encodeURIComponent(this._authenticationService.authenticationCode)+"&data="+JSON.stringify(a)+"&r="+Date.now())};a.prototype.AddTemplate=
function(a){a=angular.copy(a);return this._http.post(this._templateServiceUrl+"/AddTemplate",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,template:a,userData:null},this.templateReplacer))};a.prototype.UpdateTemplate=function(a){a=angular.copy(a);return this._http.post(this._templateServiceUrl+"/UpdateTemplate",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,template:a,userData:null},this.templateReplacer))};a.prototype.DeleteTemplate=
function(a){return this._http.post(this._templateServiceUrl+"/DeleteTemplate",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,templateId:a,userData:null},this.templateReplacer))};a.prototype.ExportAllTemplates=function(){var a=this._templateServiceUrl+"/ExportAllTemplates?auth="+encodeURIComponent(this._authenticationService.authenticationCode);OpenUrl(a,!0)};a.prototype.ImportTemplates=function(a,d){return a.upload({url:this._templateServiceUrl+"/ImportTemplates",
file:d,fields:{auth:this._authenticationService.authenticationCode}})};a.prototype.templateReplacer=function(a,d){return(0<=a.toLowerCase().indexOf("create")||0<=a.toLowerCase().indexOf("date"))&&"string"==typeof d&&(a=new Date(d),"Invalid Date"!=a)?a.toUTCString():d instanceof lt.LeadPointD?(a=Utils.roundNumber(d.x,7),d=Utils.roundNumber(d.y,7),{x:a,y:d}):d};a.$inject=["app.config","authenticationService","$http"];return a}();services.service("templateService",TemplateService);
function emptyFunction(a){a.currentTarget.style.backgroundColor="mouseleave"==a.type?"rgba(255, 255, 255, 0.0)":"rgba(255, 255, 255, 0.5)"}function ShowStudyTimeLine(a,b,d){d!=b.studyTimeLineVisible&&(b.studyTimeLineVisible=d,a.showStudyTimeLine=d,b.toggleView("south",!0,!1))}var currentInteractiveIcon={},currentInteractiveMode={},currentIcon={},currentIconPressed={},currentIconDisabled={},currentIconDisabledPressed={},parentDiv,testDiv;
function PressButton(a,b,d,c){""==d||b&&currentIcon[b.id]&&currentIcon[b.id].id==d||(null!=d&&(angular.isUndefined(c)||c)&&a.press(d),null!=currentIcon[b.id]&&(a=a.isEnabled(currentIcon[b.id].id),$(currentInteractiveIcon[b.id]).addClass(a?currentIcon[b.id].original:currentIconDisabled[b.id]),$(currentInteractiveIcon[b.id]).removeClass(a?currentIconPressed[b.id]:currentIconDisabledPressed[b.id])),currentIcon[b.id]={},a=$("#"+d+"_icon").attr("original-id"),currentInteractiveIcon[b.id]="#"+d+"_icon",
currentIcon[b.id].id=d,currentIcon[b.id].original=a,currentIconPressed[b.id]=a+"Pressed",currentIconDisabled[b.id]="Disabled"+a,currentIconDisabledPressed[b.id]="Disabled"+a+"Pressed")}
function showCustomWindowlevelDialog(a,b,d,c){if(a.isEnabled("WindowLevel"+d.id)){var e=null,f={},g=b.get_activeCell();if(g instanceof lt.Controls.Medical.Cell3D)f.width=g.information.windowWidth,f.center=g.information.windowCenter,f.originalWindowLevelCenter=g.defaultWindowLevelCenter,f.originalWindowLevelWidth=g.defaultWindowLevelWidth;else{var h=b.get_activeCellFrame();if(e=h.get_wlRenderer())f.width=e.get_windowLevelWidth(),f.center=e.get_windowLevelCenter(),f.originalWindowLevelCenter=e.originalWindowLevelCenter,
f.originalWindowLevelWidth=e.originalWindowLevelWidth;else return}e=c.open({templateUrl:"views/dialogs/WindowLevelCustom.html",controller:Controllers.WindowLevelCustomController,backdrop:!1,resolve:{settings:function(){return f},currentFrame:function(){return h},seriesService:function(){return b}}});null!=e&&e.result.then(function(c){g instanceof lt.Controls.Medical.Cell3D?(g.information.windowWidth=c.width,g.information.windowCenter=c.center,g.updateWindowLevelValues()):g.get_linked()?b.enumerateFrames(g,
function(a,d){b.withinVisibleRange(g,d)&&a.setWindowLevel(c.width,c.center)}):h.setWindowLevel(c.width,c.center);a.unpress("Perio"+d.id);a.unpress("Endo"+d.id);a.unpress("Dentin"+d.id)})}}
function HideTab_And_ShiftToolbarButtons(){var a=document.getElementById("ltTabWrapper"),b=a.getElementsByClassName("nav nav-tabs")[0];b.style.left="10000px";b.style.width="0px";b.style.position="absolute";var d=a.getElementsByClassName("toolbarbodyArea");a=lt.LTHelper.device==lt.LTDevice.mobile?56:128;b=lt.LTHelper.device==lt.LTDevice.mobile?26:53;var c=lt.LTHelper.device==lt.LTDevice.mobile?8:16;d=d[d.length-1].parentNode;var e=document.createElement("div");e.className="appLogo scroll-body";e.style.width=
a+"px";e.style.height="100%";e.style.zIndex="300";e.style.position="absolute";var f=document.createElement("img");f.style.left="0px";f.style.top="0px";f.style.width=a+"px";f.style.height=b+"px";f.style.position="absolute";f.style.marginTop=c+"px";f.style.zIndex="300";f.src="images/mipacs2.png";b=d.children[0];b.style.left=a+"px";d.insertBefore(e,b);d.insertBefore(f,b)}
function ChangeScrollType(a){var b=a.scrollType;switch(a.scrollType){case lt.Controls.Medical.ScrollType.none:b=lt.Controls.Medical.ScrollType.normal;alert("ScrollType.normal");break;case lt.Controls.Medical.ScrollType.normal:b=lt.Controls.Medical.ScrollType.row;alert("ScrollType.row");break;case lt.Controls.Medical.ScrollType.row:b=lt.Controls.Medical.ScrollType.column;alert("ScrollType.column");break;case lt.Controls.Medical.ScrollType.column:b=lt.Controls.Medical.ScrollType.page;alert("ScrollType.page");
break;case lt.Controls.Medical.ScrollType.page:b=lt.Controls.Medical.ScrollType.none,alert("ScrollType.none")}a.scrollType=b}function GetImageProcessingIndex(a,b){var d,c=a.imageProcessingList.count;for(d=0;d<c;d++)if(a.imageProcessingList.get_item(d).get_command()==b)return d;return-1}function ChangeStructureDisplay(a){}
function edgeEnhancment(a){var b=a.currentTarget.getAttribute("itemIndex");a=a.currentTarget.cellFrame;var d=GetImageProcessingIndex(a,"Endo"),c=new lt.ImageProcessing;c.set_jsFilePath("");c.set_command("Endo");c.get_arguments().UnsharpMask=(50*b).toString()+","+(30+5*b).toString()+",0";-1==d?a.imageProcessingList.add(c):a.imageProcessingList.set_item(parseInt(d.toString()),c)}
function functionClick(a){a.currentTarget.getAttribute("itemIndex");var b=a.currentTarget.cellFrame,d=a.currentTarget.cell,c=a.currentTarget.seriesManagerService,e=a.currentTarget.model,f=a.currentTarget.toolbarService,g=a.currentTarget.tab,h=a.currentTarget.sortInfo,k=a.currentTarget.item;null==h?showCustomWindowlevelDialog(f,c,g,e):d instanceof lt.Controls.Medical.Cell3D?(d.information.windowWidth=h.W,d.information.windowCenter=h.C,d.updateWindowLevelValues()):d.linked?c.enumerateFrames(d,function(a,
b){a.setWindowLevel(h.W,h.C);a.currentCustomWindowlevel=k}):(b.setWindowLevel(h.W,h.C),b.currentCustomWindowlevel=k)}function camelize(a){return a.replace(/(?:^\w|[A-Z]|\b\w)/g,function(a,d){return 0!=d?a.toLowerCase():a.toUpperCase()})}
function getWidthAndCenter(a,b){var d=a[DicomTag.WindowWidth],c=a[DicomTag.WindowCenter];null==d&&(d=this.findTag(a,DicomTag.WindowWidth));if(null!=d&&d.Value&&d.Value.length>b)b=d.Value[b]>>0;else return null;null==c&&(c=this.findTag(a,DicomTag.WindowCenter));if(null!=c&&c.Value&&0<c.Value.length)a=c.Value[0]>>0;else return null;return{W:b,C:a}}
function isFullscreen(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.webkitCurrentFullScreenElement}var keyDownAdded=!1;commangular.command("Pan",["toolbarService","tabService","buttonId",function(a,b,d){return{execute:function(){SetCurrentInteractiveMode(a,b,MedicalViewerAction.Offset,d);enumerateCell(b,function(a){CommandManager.RunCommand(a,MedicalViewerAction.Offset,d)})}}}]);
commangular.command("ZoomToInteractiveMode",["toolbarService","tabService","buttonId",function(a,b,d){return{execute:function(){SetCurrentInteractiveMode(a,b,MedicalViewerAction.Scale,d);enumerateCell(b,function(a){CommandManager.RunCommand(a,MedicalViewerAction.Scale,d)})}}}]);
commangular.command("InteractiveMagnifyGlass",["toolbarService","tabService","buttonId",function(a,b,d){return{execute:function(){SetCurrentInteractiveMode(a,b,MedicalViewerAction.Magnify,d);enumerateCell(b,function(a){CommandManager.RunCommand(a,MedicalViewerAction.Magnify,d)})}}}]);
commangular.command("InteractiveStack",["toolbarService","tabService","buttonId",function(a,b,d){return{execute:function(){SetCurrentInteractiveMode(a,b,MedicalViewerAction.Stack,d);enumerateCell(b,function(a){CommandManager.RunCommand(a,MedicalViewerAction.Stack,d)})}}}]);
commangular.command("WindowLevelInteractiveMode",["toolbarService","tabService","buttonId",function(a,b,d){return{execute:function(){var c=b.get_allTabs()[b.activeTab];a.isEnabled("WindowLevel"+c.id)&&(SetCurrentInteractiveMode(a,b,MedicalViewerAction.WindowLevel,d),enumerateCell(b,function(b){CommandManager.RunCommand(b,MedicalViewerAction.WindowLevel,d);b=b.getCommandInteractiveMode(MedicalViewerAction.WindowLevel);null!=b&&b.add_workStarted(function(b){a.unpress("Perio"+c.id);a.unpress("Endo"+
c.id);a.unpress("Dentin"+c.id)})}))}}}]);
function GetPresetWindowLevelValuesArray(){var a=[];a.push({VR:"CT",VoiType:Models.VoiType.Lung,Text:camelize("LUNG"),Info:{W:1500,C:-600}});a.push({VR:"CT",VoiType:Models.VoiType.Mediastinum,Text:camelize("MEDIASTINUM"),Info:{W:640,C:95}});a.push({VR:"CT",VoiType:Models.VoiType.AbdoPelvis,Text:camelize("ABDO PELVIS"),Info:{W:400,C:40}});a.push({VR:"CT",VoiType:Models.VoiType.Liver,Text:camelize("LIVER"),Info:{W:160,C:70}});a.push({VR:"CT",VoiType:Models.VoiType.SoftTissue,Text:camelize("SOFT TISSUE"),
Info:{W:400,C:40}});a.push({VR:"CT",VoiType:Models.VoiType.Bone,Text:camelize("BONE"),Info:{W:1500,C:150}});a.push({VR:"CT",VoiType:Models.VoiType.Brain,Text:camelize("BRAIN"),Info:{W:150,C:40}});a.push({VR:"CT",VoiType:Models.VoiType.PostFossa,Text:camelize("POST FOSSA"),Info:{W:250,C:45}});a.push({VR:"MR",VoiType:Models.VoiType.BrainT1,Text:camelize("Brain T1"),Info:{W:500,C:250}});a.push({VR:"MR",VoiType:Models.VoiType.BrainT2,Text:camelize("Brain T2"),Info:{W:350,C:150}});a.push({VR:"MR",VoiType:Models.VoiType.SagT2,
Text:camelize("Sag T2"),Info:{W:300,C:150}});a.push({VR:"MR",VoiType:Models.VoiType.HeadNeck,Text:camelize("Head / Neck"),Info:{W:500,C:250}});a.push({VR:"MR",VoiType:Models.VoiType.Spine,Text:camelize("Spine"),Info:{W:500,C:250}});a.push({VR:"MR",VoiType:Models.VoiType.AbdomenPelvisT1,Text:camelize("Abdomen / Pelvis T1"),Info:{W:600,C:180}});a.push({VR:"MR",VoiType:Models.VoiType.AbdomenPelvisT2,Text:camelize("Abdomen/ Pelvis T2"),Info:{W:850,C:150}});a.push({VR:"US",VoiType:Models.VoiType.LowContrast,
Text:camelize("Low Contrast"),Info:{W:190,C:80}});a.push({VR:"US",VoiType:Models.VoiType.MediumContrast,Text:camelize("Medium Contrast"),Info:{W:160,C:70}});a.push({VR:"US",VoiType:Models.VoiType.HighContrast,Text:camelize("High Contrast"),Info:{W:120,C:60}});return a}function AddOtherPresetWindowLevelValues(a,b){for(var d=GetPresetWindowLevelValuesArray(),c=0;c<d.length;c++){var e=d[c];e.VR==a&&b.add(e)}}
function FindPresetWindowLevelValue(a){for(var b=GetPresetWindowLevelValuesArray(),d=0;d<b.length;d++){var c=b[d];if(c.VoiType==a)return c}return null}
commangular.command("OnEdgeEnhancment",["toolbarService","tabService","buttonId","$modal","seriesManagerService",function(a,b,d,c,e){return{execute:function(){var d=b.get_allTabs()[b.activeTab];e.get_activeCell();var g=e.get_activeCellFrame(),h,k=[];k.add({Text:" No Effect",Info:0});for(h=1;11>h;h++)k.add({Text:" Sharpen ( "+h.toString()+" )",Info:0});h=document.getElementById("EdgeEnhancment"+d.id);ShowMenu(k,h,edgeEnhancment,g,a,b,e,c,d,-1)}}}]);
commangular.command("WindowLevelCustom",["toolbarService","tabService","buttonId","$modal","seriesManagerService",function(a,b,d,c,e){return{execute:function(){var d=b.get_allTabs()[b.activeTab],g=e.get_activeCell();if(g instanceof lt.Controls.Medical.Cell3D){var h=g.JSON;var k=g.defaultWindowLevelWidth;var l=g.defaultWindowLevelCenter}else{var m=e.get_activeCellFrame();h=m.metadata;k=m.defaultWindowLevelWidth;l=m.defaultWindowLevelCenter}var p=[];if(g instanceof lt.Controls.Medical.Cell3D)p.add({Text:"Bone",
Info:{W:g.bone.width,C:g.bone.center}});else{g=h[DicomTag.Modality].Value[0];h=h[DicomTag.WindowCenterWidthExplanation];var n=null!=h&&0<h.Value.length;if(n){var r=h.Value.length,q;for(q=0;q<r;q++){var t=getWidthAndCenter(m.metadata,q);p.add({Text:camelize(h.Value[q]),Info:t})}}AddOtherPresetWindowLevelValues(g,p)}g={VoiType:Models.VoiType.Undefined,Text:"Custom",Info:null};0==p.length?(showCustomWindowlevelDialog(a,e,d,c),m.currentCustomWindowlevel=g):(n||p.insert(0,{Text:"Auto",Info:{W:k,C:l}}),
p.add(g),k=document.getElementById("WindowLevelCustom"+d.id),ShowMenu(p,k,functionClick,m,a,b,e,c,d,-1))}}}]);
commangular.command("FitImage",["seriesManagerService","tabService",function(a,b){return{execute:function(){var b=a.get_activeCell();if(null!=b){var c=b.get_linked();b.get_imageViewer().beginUpdate();c?a.enumerateFrames(b,function(a,b){a.set_offsetX(0);a.set_offsetY(0);a.zoom(lt.Controls.Medical.MedicalViewerSizeMode.fit,1)}):(c=a.get_activeCellFrame(),c.set_offsetX(0),c.set_offsetY(0),c.zoom(lt.Controls.Medical.MedicalViewerSizeMode.fit,1));b.get_imageViewer().endUpdate()}}}}]);
commangular.command("OnStructureDisplay",["toolbarService","tabService","buttonId","$modal","seriesManagerService",function(a,b,d,c,e){return{execute:function(){var d=b.get_allTabs()[b.activeTab];e.get_activeCell();var g=e.get_activeCellFrame();b.get_tabData(d.id,TabDataKeys.ViewController);var h=e.structuredDisplayList,k,l=h.length,m=[];for(k=0;k<l;k++)m.add({Text:h[k].Name,Info:h[k]});h=document.getElementById("StructureDisplay"+d.id);ShowMenu(m,h,ChangeStructureDisplay,g,a,b,e,c,d,-1)}}}]);
commangular.command("OneToOne",["seriesManagerService","tabService",function(a,b){return{execute:function(){var b=a.get_activeCell();if(null!=b){var c=b.get_linked();b.get_imageViewer().beginUpdate();c?a.enumerateFrames(b,function(a,b){a.zoom(lt.Controls.Medical.MedicalViewerSizeMode.actualSize,1)}):a.get_activeCellFrame().zoom(lt.Controls.Medical.MedicalViewerSizeMode.actualSize,1);b.get_imageViewer().endUpdate()}}}}]);
function getSortingOperation(a,b){var d=new lt.Controls.Medical.SortingOperation;d.sortByCategory=a;d.selectorAttribute=parseInt(b,16);return d}
commangular.command("TrueSizeDisplay",["seriesManagerService","tabService","toolbarService","$modal",function(a,b,d,c){return{execute:function(){b.get_allTabs();var c=a.get_activeCell(),d=a.get_activeCellFrame();c=a.get_activeCell();null!=c&&(d=c.get_linked(),c.get_imageViewer().beginUpdate(),d?a.enumerateFrames(c,function(a,b){a.set_offsetX(0);a.set_offsetY(0);a.zoom(lt.Controls.Medical.MedicalViewerSizeMode.trueSize,1)}):(d=a.get_activeCellFrame(),d.set_offsetX(0),d.set_offsetY(0),d.zoom(lt.Controls.Medical.MedicalViewerSizeMode.trueSize,
1)),c.get_imageViewer().endUpdate())}}}]);commangular.command("ZoomIn",["seriesManagerService","tabService",function(a,b){return{execute:function(){var b=a.get_activeCell();if(null!=b){var c=b.get_linked();b.get_imageViewer().beginUpdate();c?a.enumerateFrames(b,function(a,b){a.zoom(a.get_scaleMode(),2*a.get_scale())}):(c=a.get_activeCellFrame(),c.zoom(c.get_scaleMode(),2*c.get_scale()));b.get_imageViewer().endUpdate()}}}}]);
commangular.command("ZoomOut",["seriesManagerService","tabService",function(a,b){return{execute:function(){var b=a.get_activeCell();if(null!=b){var c=b.get_linked();b.get_imageViewer().beginUpdate();c?a.enumerateFrames(b,function(a,b){a.zoom(a.get_scaleMode(),a.get_scale()/2)}):(c=a.get_activeCellFrame(),c.zoom(c.get_scaleMode(),c.get_scale()/2));b.get_imageViewer().endUpdate()}}}}]);
commangular.command("RotateClockwise",["seriesManagerService","tabService",function(a,b){return{execute:function(){var b=a.get_activeCell();if(null!=b){var c=b.get_linked();b.get_imageViewer().beginUpdate();if(c)a.enumerateFrames(b,function(a,b){b=GetRealRotationAngle(90,a);a.set_rotateAngle(a.get_rotateAngle()+b);a.IPFunctionParams.Rotate.Angle=a.get_rotateAngle()});else{c=a.get_activeCellFrame();var e=GetRealRotationAngle(90,c);c.set_rotateAngle(c.get_rotateAngle()+e)}b.get_imageViewer().endUpdate()}}}}]);
commangular.command("RotateCounterclockwise",["seriesManagerService","tabService",function(a,b){return{execute:function(){var b=a.get_activeCell();if(null!=b){var c=b.get_linked();b.get_imageViewer().beginUpdate();if(c)a.enumerateFrames(b,function(a,b){b=GetRealRotationAngle(-90,a);a.set_rotateAngle(a.get_rotateAngle()+b)});else{c=a.get_activeCellFrame();var e=GetRealRotationAngle(-90,c);c.set_rotateAngle(c.get_rotateAngle()+e)}b.get_imageViewer().endUpdate()}}}}]);
commangular.command("Flip",["seriesManagerService","tabService",function(a,b){return{execute:function(){var b=a.get_activeCell();if(null!=b){var c=b.get_linked();b.get_imageViewer().beginUpdate();c?a.enumerateFrames(b,function(a,b){a.set_flipped(!a.get_flipped())}):(c=a.get_activeCellFrame(),c.set_flipped(!c.get_flipped()));b.get_imageViewer().endUpdate()}}}}]);
commangular.command("Reverse",["seriesManagerService","tabService",function(a,b){return{execute:function(){var b=a.get_activeCell();if(null!=b){var c=b.get_linked();b.get_imageViewer().beginUpdate();c?a.enumerateFrames(b,function(a,b){a.set_reversed(!a.get_reversed())}):(c=a.get_activeCellFrame(),c.set_reversed(!c.get_reversed()));b.get_imageViewer().endUpdate()}}}}]);
commangular.command("DentalPanoramic",["seriesManagerService","tabService","dicomLoaderService",function(a,b,d){return{execute:function(){a.get_activeCell().runCommand(MedicalViewerAction.PanoramicPolygon);b.get_allTabs();enumerateCell(b,function(a){a.drawCrossHairLines=!1})}}}]);
commangular.command("Invert",["seriesManagerService","tabService","dicomLoaderService",function(a,b,d){return{execute:function(){var b=a.get_activeCell();if(b instanceof lt.Controls.Medical.Cell3D)b.inverted=!b.inverted;else if(null!=b){a.get_seriesLoaderById(b);var d=b.get_linked();b.get_imageViewer().beginUpdate();d?(d=b.get_seriesInstanceUID(),a.get_instances(d,b.get_divID()),a.enumerateFrames(b,function(a,b){try{a.set_inverted(!a.inverted)}catch(h){}})):(d=a.get_activeCellFrame(),d.set_inverted(!d.inverted));
b.get_imageViewer().endUpdate()}}}}]);
commangular.command("ShowDicom",["seriesManagerService","$modal",function(a,b){return{execute:function(){var d=null,c=a.get_activeCell();c instanceof lt.Controls.Medical.Cell3D?(c=c.referenceCell,d=a.get_activeItemForCell(c).attachedFrame):d=a.get_activeViewer().attachedFrame;null!=d&&b.open({templateUrl:lt.LTHelper.device==lt.LTDevice.mobile?"views/dialogs/ViewDicom_Mobile.html":"views/dialogs/ViewDicom.html",controller:Controllers.ViewDicomController,backdrop:"static",resolve:{dicom:function(){return d.metadata},
frame:function(){return d}}})}}}]);commangular.command("SetLinked",["seriesManagerService","tabService","toolbarService","optionsService",function(a,b,d,c){return{execute:function(){if(-1!=b.activeTab){var e=b.get_allTabs()[b.activeTab],f=a.get_activeCell();if(null!=f){var g=!f.get_linked();c.set(OptionNames.LinkImages,g);b.set_tabData(e.id,TabDataKeys.Linked,g);f.set_linked(g);d.updateClass("LinkImages"+e.id,"Linked","UnLinked",function(){return g})}}}}}]);
commangular.command("OnReload",["seriesManagerService","dicomLoaderService","toolbarService","tabService",function(a,b,d,c){return{execute:function(){var b=a.get_activeCell(),f=c.get_allTabs()[c.activeTab];null!=b&&(a.get_seriesLoaderById(b),a.get_instances(b.get_seriesInstanceUID(),b.get_divID()),a.enumerateFrames(b,function(a,b){a.reset();Utils.clearAllShutter(a);a.set_offsetX(0);a.set_offsetY(0);null!=a.subCell&&Utils.subCell_setPresentationMode(a.subCell);a.horizontalAlignment=lt.Controls.Medical.HorizontalAlignmentType.middle;
a.verticalAlignment=lt.Controls.Medical.VerticalAlignmentType.middle},function(a){a.reset()}),d.unpress("Perio"+f.id),d.unpress("Endo"+f.id),d.unpress("Dentin"+f.id))}}}]);
commangular.command("OnToggleTags",["seriesManagerService","tabService","toolbarService",function(a,b,d){return{execute:function(){if(-1!=b.activeTab){var a=b.get_allTabs()[b.activeTab],d=!b.get_tabData(a.id,TabDataKeys.TagToggle);enumerateCell(b,function(a){a.set_overlayTextVisible(d);a.onSizeChanged();a.invalidate()});b.set_tabData(a.id,TabDataKeys.TagToggle,d)}}}}]);
commangular.command("ScrollFrame",["seriesManagerService","tabService","toolbarService",function(a,b,d){return{execute:function(){if(-1!=b.activeTab){var a=b.get_allTabs()[b.activeTab],d=!b.get_tabData(a.id,TabDataKeys.TagToggle);enumerateCell(b,function(a){a.scrollType=lt.Controls.Medical.ScrollType.normal});b.set_tabData(a.id,TabDataKeys.TagToggle,d)}}}}]);
commangular.command("ScrollRow",["seriesManagerService","tabService","toolbarService",function(a,b,d){return{execute:function(){if(-1!=b.activeTab){var a=b.get_allTabs()[b.activeTab],d=!b.get_tabData(a.id,TabDataKeys.TagToggle);enumerateCell(b,function(a){a.scrollType=lt.Controls.Medical.ScrollType.row});b.set_tabData(a.id,TabDataKeys.TagToggle,d)}}}}]);
commangular.command("ScrollColumn",["seriesManagerService","tabService","toolbarService",function(a,b,d){return{execute:function(){if(-1!=b.activeTab){var a=b.get_allTabs()[b.activeTab],d=!b.get_tabData(a.id,TabDataKeys.TagToggle);enumerateCell(b,function(a){a.scrollType=lt.Controls.Medical.ScrollType.column});b.set_tabData(a.id,TabDataKeys.TagToggle,d)}}}}]);var pointCounter=0;
commangular.command("PreviousPoint",["seriesManagerService","tabService","toolbarService",function(a,b,d){return{execute:function(){-1!=b.activeTab&&(b.get_allTabs(),pointCounter--,0>=pointCounter&&(pointCounter=0),enumerateCell(b,function(a){a.invalidate()}))}}}]);commangular.command("NextPoint",["seriesManagerService","tabService","toolbarService",function(a,b,d){return{execute:function(){-1!=b.activeTab&&(b.get_allTabs(),pointCounter++,enumerateCell(b,function(a){a.invalidate()}))}}}]);
commangular.command("ScrollPage",["seriesManagerService","tabService","toolbarService",function(a,b,d){return{execute:function(){if(-1!=b.activeTab){var a=b.get_allTabs()[b.activeTab],d=!b.get_tabData(a.id,TabDataKeys.TagToggle);enumerateCell(b,function(a){a.scrollType=lt.Controls.Medical.ScrollType.page});b.set_tabData(a.id,TabDataKeys.TagToggle,d)}}}}]);
commangular.command("SetEnableSeriesSynchronization",["seriesManagerService","tabService","toolbarService",function(a,b,d){return{execute:function(){var a=b.getActiveViewer();if(a){var e=!a.get_enableSynchronization(),f=b.get_allTabs()[b.activeTab];a.set_enableSynchronization(e);d.updateClass("SynchronizeSeries"+f.id,"EnabledSynchronization","Synchronization",function(){return e})}}}}]);var LinkedOn=!1;
function markCell(a,b){a=a.parentCell;if(Studies[a.studyInstanceUID]){var d,c=Studies[a.studyInstanceUID].PointsList.length;for(d=0;d<c;d++){var e=Studies[a.studyInstanceUID].PointsList[d].Frame;if(null!=e.subCell&&e.subCell.parentCell==a){e=lt.Controls.Medical.Tools.logicalToPhysical(a.selectedItem,Studies[a.studyInstanceUID].PointsList[d].Point);if(!e)break;b.context.save();b.context.beginPath();b.context.strokeStyle="blue";b.context.fillStyle="blue";b.context.rect(e.x-20,e.y-20,40,40);b.context.font=
"20px Arial";b.context.textAlign="center";b.context.textBaseline="middle";b.context.fillText(d.toString(),e.x,e.y);b.context.stroke();b.context.restore()}}}}function markCellClicked(a,b){b.mouseButton==lt.Controls.MouseButtons.left&&(AddFidutialPoint(a,b.position.x,b.position.y),a.invalidate())}var Studies=[];
function AddFidutialPoint(a,b,d){var c=a.selectedItem.attachedFrame;Studies[a.studyInstanceUID]||(Studies[a.studyInstanceUID]={});null==Studies[a.studyInstanceUID].PointsList&&(Studies[a.studyInstanceUID].PointsList=[]);b=lt.Controls.Medical.Tools.physicalToLogical(a.selectedItem,lt.LeadPointD.create(b,d));d=Studies[a.studyInstanceUID].PointsList[pointCounter];Studies[a.studyInstanceUID].PointsList[pointCounter]={Frame:c,Point:b};null!=d&&d.Frame.subCell.parentCell.invalidate()}
commangular.command("SpatialRegsiteration",["seriesManagerService","tabService","toolbarService",function(a,b,d){return{execute:function(){var a=b.get_allTabs()[b.activeTab];a=b.get_tabData(a.id,TabDataKeys.ViewController);a=a.getViewer();var d=[],f=[];enumerateCell(b,function(a){LinkedOn?(a.remove_postRender(markCell),a.remove_cellClicked(markCellClicked),a.invalidate()):(a.add_postRender(markCell),a.add_mouseDown(markCellClicked))});if(LinkedOn){a=b.get_allTabs()[b.activeTab];a=b.get_tabData(a.id,
TabDataKeys.ViewController);a=a.getViewer();for(var g in Studies)if(Studies.hasOwnProperty(g)){var h=Studies[g],k=0,l=h.PointsList.length,m=[];for(k=0;k<l;k++){var p=lt.Controls.Medical.Cursor3DInteractiveMode.get3DPointPosition(h.PointsList[k].Frame,h.PointsList[k].Point);m[k]=lt.Controls.Medical.LeadPoint3D.create(p[0],p[1],p[2])}d.add(g);f.add(m)}a.synchronizeStudies("test",d,f)}LinkedOn=!LinkedOn}}}]);
commangular.command("LinkCells",["seriesManagerService","tabService","toolbarService",function(a,b,d){return{execute:function(){var a=b.get_allTabs()[b.activeTab];a=b.get_tabData(a.id,TabDataKeys.ViewController).getViewer();var d=[],f=[];enumerateCell(b,function(a){if(a.tickBoxes[0].checked){var b=a.selectedItem.attachedFrame.imagePosition;f.add(a.studyInstanceUID);a=[];a[0]=lt.Controls.Medical.LeadPoint3D.create(b[0],b[1],b[2]);d.add(a)}});a.synchronizeStudies("test",f,d)}}}]);
function CreateDateFormat(a){var b=a.toLocaleDateString();return b=b+"  "+a.toLocaleTimeString()}
commangular.command("OnSecondaryCapture",["seriesManagerService","tabService","optionsService","objectStoreService","eventService","$modal","dialogs","$translate","toolbarService",function(a,b,d,c,e,f,g,h,k){return{execute:function(){if(k.isEnabled("SecondaryCapture"+b.selectedTab.id)){var l=new Models.DerivedInfo,m=a.get_metaData(),p=a.get_activeCell();if(p instanceof lt.Controls.Medical.Cell3D)var n=OptionNames.Derived3DSeriesDescriptionText;else p instanceof lt.Controls.Medical.PanoramicCell?(n=
OptionNames.DerivedPanoramicSeriesDescriptionText,m=p.frames.get_item(0).JSON):n=OptionNames.DerivedSeriesDescriptionText;if(null!=m){var r="",q="",t="",y="";l.description=DicomHelper.getDicomTagValue(m,DicomTag.SeriesDescription);l.protocolName=DicomHelper.getDicomTagValue(m,DicomTag.ProtocolName);l.description=l.description&&0!=l.description.length?l.description+(" "+d.get(n)):d.get(n);h("NOTIFY_DERIVED_IMAGE_SAVED").then(function(a){r=a});h("NOTIFY_DERIVED_IMAGE_FAILED").then(function(a){t=a});
h("DIALOGS_NOTIFICATION").then(function(a){q=a});h("DIALOGS_ERROR").then(function(a){y=a});f.open({templateUrl:"views/dialogs/SaveAsDerived.html",controller:Controllers.SaveAsDerivedController,backdrop:"static",resolve:{derivedInfo:function(){return l}}}).result.then(function(b){var d=a.capture_currentFrame(!0);if(d){var f=a.get_activeCellFrame();c.StoreSecondaryCapture(d,f.Instance.SOPInstanceUID,b.number,b.description,b.protocolName).then(function(a){angular.isDefined(a.data)&&angular.isDefined(a.data.Message)?
g.error(y,a.data.Message):(g.notify(q,r),a.data.Date=CreateDateFormat(new Date(Date.now())),e.publish(EventNames.DerivedImageCreated,{series:a.data}))},function(a){g.error(y,t)})}})}}}}}]);function exportResult(a,b,d,c,e,f){a.Export(d.options,d.source).then(function(a){a&&(a.data.FaultType?f.error(e,a.data.Message):(a=a.data,a=a.replace(/"/g,""),-1===a.indexOf("/Files/")&&(a=a+"&auth="+encodeURIComponent(b.authenticationCode)),OpenUrl(c.urls.serviceUrl+a,!0)))},function(a){})}
function GetCaptureSize(a){return Math.min(8E3,Math.max(100,a.get(OptionNames.CaptureSize)))}
commangular.command("OnExport",["seriesManagerService","exportManagerService","$modal","app.config","dialogs","$translate","objectRetrieveService","authenticationService","optionsService",function(a,b,d,c,e,f,g,h,k){return{execute:function(){if(null!=a.get_activeCell()){var l=Utils.get_seriesLayout(a.get_activeCell());d.open({templateUrl:"views/dialogs/Export.html",controller:Controllers.ExportController,backdrop:"static",resolve:{hasLayout:function(){return void 0!=l}}}).result.then(function(d){var l=
"";f("DIALOGS_ERROR_EXPORT_TITLE").then(function(a){l=a});if(d.source==ExportImagesSource.PrintCurrentView)b.Export(d.options,d.source);else if(d.options.LayoutImageWidth=GetCaptureSize(k),d.options.BurnAnnotations){var n=a.get_activeCell();n&&(n.get_seriesInstanceUID(),n=a.get_cellAnnotations(n),0!=n.length?g.UploadAnnotations(n).then(function(a){a=a.data.replace(/"/g,"");d.options.AnnotationsFileName=a;exportResult(b,h,d,c,l,e)}):exportResult(b,h,d,c,l,e))}else d.options.AnnotationsFileName="",
exportResult(b,h,d,c,l,e)})}}}}]);
commangular.command("OnPrint",["seriesManagerService","exportManagerService","$modal","app.config","dialogs","$translate","objectRetrieveService",function(a,b,d,c,e,f,g){return{execute:function(){if(null!=a.get_activeCell()){var f=function(a){b.Print(a.options,a.source).then(function(a){a.data.FaultType?e.error("Printing Error",a.data.Message):(a=a.data,a=a.replace(/"/g,""),OpenUrl(c.urls.serviceUrl+a,!0))},function(a){e.error("Printing Error",a)})};d.open({templateUrl:"views/dialogs/Print.html",controller:Controllers.PrintController,
backdrop:"static"}).result.then(function(b){b.options.LayoutImageWidth=1024;if(b.options.BurnAnnotations){var c=a.get_activeCell();c&&(c.get_seriesInstanceUID(),c=a.get_cellAnnotations(c),0!=c.length?g.UploadAnnotations(c).then(function(a){a=a.data.replace(/"/g,"");b.options.AnnotationsFileName=a;f(b)}):f(b))}else b.options.AnnotationsFileName="",f(b)})}}}}]);
commangular.command("OnPrintView",["seriesManagerService","exportManagerService","tabService","app.config","dialogs","$translate","objectRetrieveService",function(a,b,d,c,e,f,g){return{execute:function(){var a=d.getActiveViewer();a=document.getElementById(a.divId);html2canvas(a.parentElement,{onrendered:function(a){OpenPrintViewUrl(a.toDataURL())}})}}}]);
commangular.command("OnSecondaryCapturePopup",["seriesManagerService","exportManagerService","$modal","app.config","dialogs","$translate","authenticationService","optionsService",function(a,b,d,c,e,f,g,h){return{execute:function(){Utils.get_seriesLayout(a.get_activeCell());if(h.get(OptionNames.CaptureLayout)){var d={options:{}};d.options.LayoutImageWidth=GetCaptureSize(h);d.options.AnnotationsFileName="";d.options.Anonymize=!1;d.options.BurnAnnotations=!1;d.options.CreateDICOMDIR=!1;d.options.DczPassword=
"";d.options.FileFormat="PDF";d.options.ImageCompression=1;d.options.IncludeOverflowImages=!1;d.options.IncludeViewer=!1;d.options.PatientInfo=!0;d.options.ReduceGrayscaleTo8BitsSelected=!1;d.options.WhiteBackground=!1;d.source="Layout";exportResult(b,g,d,c,"",e)}else null!=a.get_activeCell()&&b.PopupCapture()}}}]);
commangular.command("OnSort",["seriesManagerService","toolbarService","tabService","exportManagerService","$modal","app.config","dialogs","$translate",function(a,b,d,c,e,f,g,h){return{execute:function(){var c=d.get_allTabs()[d.activeTab];a.get_activeCell();var f=a.get_activeCellFrame(),g=[];g[0]={Text:"Acquisition Time",Info:getSortingOperation(lt.Controls.Medical.SortType.byAcquisitionTime,"")};g[1]={Text:"Axis",Info:getSortingOperation(lt.Controls.Medical.SortType.byAxis,"")};g[2]={Text:"Instance Number",
Info:getSortingOperation(lt.Controls.Medical.SortType.none,DicomTag.InstanceNumber)};var h=document.getElementById("SortSeries"+c.id);ShowMenu(g,h,sortClick,f,b,d,a,e,c,currentSelectedSortOrder)}}}]);
commangular.command("OnLineProfile",["seriesManagerService","tabService","eventService","exportManagerService","$modal","app.config","dialogs","$translate",function(a,b,d,c,e,f,g,h){return{execute:function(){var c=a.get_activeCell(),e=a.get_activeCellFrame();CommandManager.RunCommand(c,MedicalViewerAction.LineProfile,"");parentDiv||(parentDiv=$("<div id='dialog' title='Line Profile' ><canvas id='lineProfileCanvas' z-index='3' style='left:29px; top:10px; position:absolute'></canvas><canvas id='outerlineProfileCanvas'></canvas><div align= 'right'><div style='float: left'> <label><input type='radio' id='radioColor' name='radioButtonGroup' style= 'float: left; display:lock; text-align:left'> Color </input></label></div><div style='float: right'> <label><input type='radio' id='radioGray' checked='true' name='radioButtonGroup' style= 'float: left; display:lock; text-align:left'> Gray</input></label></div></div><br/><br/><label><input id='checkboxRed' checked='true' disabled='true' type='checkbox' value= 'Red' > Red </input> </label><br/><label><input id='checkboxGreen' checked='true' disabled='true' type='checkbox' value='Green'> Green </input></label> <br/><label><input id='checkboxBlue' checked='true' disabled='true' type='checkbox' value='Blue'> Blue </input></label><br/><label  style='float: right'><button type='button' id='closeButton'>Close</button></label><br/></div>"),
parentDiv.dialog({autoOpen:!1}));d.subscribe(EventNames.SelectedTabChanged,function(a,c){b.find_tab(c.args.currentTab.id);enumerateCell(b,function(a){CommandManager.RunCommand(a,MedicalViewerAction.WindowLevel,"");null!=a.lineProfile&&a.lineProfile.end()},c.args.previousTab);$("#dialog").dialog("close")});if(!$("#dialog").dialog("isOpen")){testDiv||(testDiv=$("<div id='dialog2' title='Line Profile' ><canvas id='testCanvas' width = '500' height ='500' z-index='3' style='background-color:red; width:500px; height:500px; position:absolute'></canvas></div>"),
testDiv.dialog({autoOpen:!1}),$("#dialog").on("dialogclose",function(a){enumerateCell(b,function(a){CommandManager.RunCommand(a,MedicalViewerAction.WindowLevel,"");null!=a.lineProfile&&a.lineProfile.end()})}));$("#dialog").dialog({closeOnEscape:!1,open:function(a,b){$(".ui-dialog-titlebar-close",b.dialog|b).hide()}});$("#dialog").dialog("open");c=document.getElementById("dialog").clientWidth-24;var f=220;document.getElementById("closeButton").addEventListener("click",function(a){$("#dialog").dialog("close")},
!0);var g=document.getElementById("outerlineProfileCanvas"),h=g.getContext("2d"),r=h.measureText("65535").width;g.width=c;g.height=f;f=180;var q=document.getElementById("lineProfileCanvas");h=c/15;c=c-h-r;f-=h;q.width=c;q.height=f;q.style.left=r+12+"px";var t=q.offsetTop-g.offsetTop;q=document.getElementById("lineProfileCanvas");g=document.getElementById("outerlineProfileCanvas");h=g.getContext("2d");h.beginPath();h.strokeStyle="red";h.strokeStyle="black";h.moveTo(r+.5,f+t+1.5);h.lineTo(r+c+.5,f+
t+1.5);h.textAlign="left";h.textBaseline="top";h.fillText("0%",r,t+f);h.textAlign="right";h.fillText("100%",r+c-.5,t+f);isGrayScale16()?h.fillText(0>=e.information.maxValue?"65556":e.information.maxValue.toString(),r-.5,0):h.fillText("256",r-.5,0);h.textBaseline="bottom";isGrayScale16()?h.fillText(e.information.minValue.toString(),r-.5,f+t):h.fillText("0",r-.5,f+t);h.stroke();UpdateSliderPosition(0);g.addEventListener("mousedown",function(a){outerlineCanvas_mouseDown(g,a)},!0);g.addEventListener("mousemove",
function(a){outerlineCanvas_mouseMove(g,a)},!0);g.addEventListener("mouseup",function(a){outerlineCanvas_mouseUp(g,a)},!0);g.onselectstart=function(){return!1};q.addEventListener("mousedown",function(a){innerLineCanvas_mouseDown(q,a)},!0);q.addEventListener("mousemove",function(a){innerLineCanvas_mouseMove(q,a)},!0);q.addEventListener("mouseup",function(a){innerLineCanvas_mouseUp(q,a)},!0);q.onselectstart=function(){return!1};document.getElementById("radioColor").addEventListener("click",radioColor);
document.getElementById("radioGray").addEventListener("click",radioGray);document.getElementById("checkboxRed").addEventListener("click",function(a){checkbox_click("checkboxRed")});document.getElementById("checkboxGreen").addEventListener("click",function(a){checkbox_click("checkboxGreen")});document.getElementById("checkboxBlue").addEventListener("click",function(a){checkbox_click("checkboxBlue")})}}}}]);
commangular.command("OnRunApplication",["externalApplicationsService","exportService","seriesManagerService","toolbarService","$modal",function(a,b,d,c,e){return{execute:function(){e.open({templateUrl:"views/dialogs/RunApp.html",controller:Controllers.RunAppController,backdrop:"static"})}}}]);
commangular.command("OnAddApplication",["externalApplicationsService","toolbarService","$modal",function(a,b,d){return{execute:function(){d.open({templateUrl:"views/dialogs/AddApp.html",controller:Controllers.AddAppController,backdrop:"static"})}}}]);commangular.command("OnWaveformBasicAudio",["seriesManagerService","toolbarService","$modal",function(a,b,d){return{execute:function(){null!=a.get_activeCell()&&d.open({templateUrl:"views/dialogs/Audio.html",controller:Controllers.AudioController,backdrop:"static"})}}}]);
function cinePlayerActive(a){var b,d=a.viewer.layout.get_items().get_count();for(b=0;b<d;b++)if(a.viewer.layout.get_items().get_item(b).cinePlayer.isPlaying)return!0;return!1}
commangular.command("OnToggleCine",["seriesManagerService","toolbarService","$modal","cinePlayerService","tabService",function(a,b,d,c,e){return{execute:function(){var b=a.get_activeCell(),c=b.viewer,d=!1;if(null!=b){var k,l=b.viewer.layout.get_items().get_count();for(k=0;k<l;k++)if(!(c.layout.get_items().get_item(k)instanceof lt.Controls.Medical.Cell3D)){var m=c.layout.get_items().get_item(k);m.tickBoxes[0].checked&&(d=!0,m.cinePlayer.isPlaying?m.cinePlayer.stop():m.cinePlayer.play())}d||(b.cinePlayer.isPlaying?
b.cinePlayer.stop():b.cinePlayer.play());e.get_allTabs()}}}}]);commangular.command("CinePlayer",["seriesManagerService","toolbarService","$modal","cinePlayerService",function(a,b,d,c){return{execute:function(){var b=a.get_activeCell();null!=b&&(c.attachCell(b),d.open({templateUrl:"views/dialogs/CinePlayer.html",controller:Controllers.CinePlayerController,backdrop:"static"}))}}}]);var _ipInstance;
commangular.command("BrightnessContrast",["seriesManagerService","$modal","toolbarService","tabService",function(a,b,d,c){return{execute:function(){var e=a.get_activeCell();if(null!=e){var f=c.get_allTabs()[c.activeTab];e&&d.isEnabled("BrightnessContrast"+f.id)&&(e.get_seriesInstanceUID(),b.open({templateUrl:"views/dialogs/BrightnessContrast.html",controller:Controllers.BrightnessContrastController,backdrop:"static"}).result.then(function(b){var c=a.get_activeCellFrame();var d=new lt.ImageProcessing;
d.set_jsFilePath(_jsFileCoreColorPath);d.set_command("ContrastBrightnessIntensity");d.get_arguments().brightness=10*b.brightness;d.get_arguments().contrast=10*b.contrast;d.get_arguments().intensity=0;c.imageProcessingList.add(d);c.subCell.invalidate()}))}}}}]);
commangular.command("HSL",["seriesManagerService","$modal","toolbarService","tabService",function(a,b,d,c){return{execute:function(){var e=a.get_activeCell(),f=c.get_allTabs()[c.activeTab];e&&d.isEnabled("HSL"+f.id)&&(e.get_seriesInstanceUID(),b.open({templateUrl:"views/dialogs/Hsl.html",controller:Controllers.HSLController,backdrop:"static"}).result.then(function(b){var c=a.get_activeCellFrame();var d=new lt.ImageProcessing;d.set_jsFilePath(_jsFileCoreColorPath);d.set_command("ChangeHueSaturationIntensity");
d.get_arguments().hue=100*b.hue;d.get_arguments().saturation=10*b.saturation;d.get_arguments().intensity=10*b.lightness;c.imageProcessingList.add(d);c.subCell.invalidate()}))}}}]);
commangular.command("StretchHistogram",["seriesManagerService","$modal","toolbarService","tabService",function(a,b,d,c){return{execute:function(){var b=a.get_activeCell(),f=c.get_allTabs()[c.activeTab];b&&d.isEnabled("StretchHistogram"+f.id)&&(b=a.get_activeCellFrame(),f=null!=b.lowResImage?b.lowResImage.canvas:b.thumbnailImage.canvas,f=f.getContext("2d").getImageData(0,0,f.width,f.height),f=lt.Controls.Medical.ImageProcessing.getHistogramPoint(f,10),stretchIntensityLow=f.x,stretchIntensityHigh=f.y,
f=new lt.ImageProcessing,f.set_jsFilePath(_jsFileCoreColorPath),f.set_command("StretchHistogram"),f.get_arguments().low=stretchIntensityLow,f.get_arguments().high=stretchIntensityHigh,b.imageProcessingList.add(f),b.subCell.invalidate())}}}]);
commangular.command("OnShutterObject",["seriesManagerService","$modal","toolbarService","tabService",function(a,b,d,c){return{execute:function(){var b=a.get_activeCell();c.get_allTabs();if(b){var d=a.get_activeCellFrame();var g=c.get_allTabs()[c.activeTab];null!=c.get_tabData(g.id,TabDataKeys.ViewController).getViewer()&&(b=b.get_automation(),null!=b&&((g=b.get_currentEditObject())?lt.Controls.Medical.ShutterObject.isValid(g)?(d.get_shutter().get_objects().clear(),d.get_shutter().get_objects().add(b.get_currentEditObject()),
d.get_shutter().fillStyle="rgba(0, 0, 0, 1)"):alert("Cannot create a shutter using the selected annotation object"):alert("no selected annotation object found!")))}}}}]);var _automationFrame,_automation;commangular.command("OnShutterObjectFreeHand",["seriesManagerService","$modal","toolbarService","tabService",function(a,b,d,c){return{execute:function(){a.get_activeCell();c.get_allTabs();enumerateCell(c,function(a){CommandManager.RunCommand(a,MedicalViewerAction.ShutterFreeHand,"")})}}}]);
commangular.command("OnShutterObjectPolygon",["seriesManagerService","$modal","toolbarService","tabService",function(a,b,d,c){return{execute:function(){a.get_activeCell();c.get_allTabs();enumerateCell(c,function(a){CommandManager.RunCommand(a,MedicalViewerAction.ShutterPolygon,"")})}}}]);
commangular.command("OnShutterObjectRectangle",["seriesManagerService","$modal","toolbarService","tabService",function(a,b,d,c){return{execute:function(){a.get_activeCell();c.get_allTabs();enumerateCell(c,function(a){CommandManager.RunCommand(a,MedicalViewerAction.ShutterRect,"")})}}}]);
commangular.command("OnShutterObjectEllipse",["seriesManagerService","$modal","toolbarService","tabService",function(a,b,d,c){return{execute:function(){a.get_activeCell();c.get_allTabs();enumerateCell(c,function(a){CommandManager.RunCommand(a,MedicalViewerAction.ShutterEllipse,"")})}}}]);
commangular.command("OnProbeTool",["seriesManagerService","$modal","toolbarService","tabService","buttonId",function(a,b,d,c,e){return{execute:function(){SetCurrentInteractiveMode(d,c,MedicalViewerAction.ProbeTool,e);enumerateCell(c,function(a){CommandManager.RunCommand(a,MedicalViewerAction.ProbeTool,e)})}}}]);
commangular.command("OnCrossHair",["seriesManagerService","$modal","toolbarService","tabService","buttonId",function(a,b,d,c,e){return{execute:function(){enumerateCell(c,function(a){a.drawCrossHairLines=!a.drawCrossHairLines})}}}]);
commangular.command("OnCursor3D",["seriesManagerService","$modal","toolbarService","tabService","buttonId",function(a,b,d,c,e){return{execute:function(){SetCurrentInteractiveMode(d,c,MedicalViewerAction.Cursor3D,e,!1);enumerateCell(c,function(a){CommandManager.RunCommand(a,MedicalViewerAction.Cursor3D,e)})}}}]);
commangular.command("Compose",["toolbarService","tabService","buttonId","authenticationService",function(a,b,d,c){return{execute:function(){var d=b.selectedTab,f=b.get_tabData(d.id,TabDataKeys.ViewController),g=c.hasPermission(PermissionNames.CanSaveHangingProtocol),h=c.hasPermission(PermissionNames.CanSaveStructuredDisplay);h&&g&&(a.enable("DeleteStudyStructuredDisplay"+d.id,function(){return h}),a.enable("SaveStructuredDisplay"+d.id,function(){return h}),a.enable("HangingProtocol"+d.id,function(){return g}),
f.isComposing?(a.unpress("LayoutCompose"+d.id),a.hide(["MergeCells"+d.id,"SaveStructuredDisplay"+d.id,"DeleteStudyStructuredDisplay"+d.id,"HangingProtocol"+d.id]),a.disable("MergeCells"+d.id),f.reShowTimeLine||f.hideTimeLine()):(a.press("LayoutCompose"+d.id),a.show(["MergeCells"+d.id,"SaveStructuredDisplay"+d.id,"DeleteStudyStructuredDisplay"+d.id,"HangingProtocol"+d.id]),a.enable("DeleteStudyStructuredDisplay"+d.id,function(){return f.hasLayout()}),f.reShowTimeLine=f.isTimeLineShowing(),f.showTimeLine()),
f.isComposing=!f.isComposing)}}}]);commangular.command("MergeCells",["toolbarService","tabService","buttonId",function(a,b,d){return{execute:function(){b.get_tabData(b.selectedTab.id,TabDataKeys.ViewController).mergeSelectedCells()}}}]);
commangular.command("DeleteStudyStructuredDisplay",["toolbarService","tabService","objectStoreService","$translate","dialogs",function(a,b,d,c,e){return{execute:function(){var f=b.selectedTab,g=b.get_tabData(f.id,TabDataKeys.ViewController),h=g.getStudyLayout(),k,l;c("NOTIFY_DELETE_STUDYLAYOUT_FAILED").then(function(a){});c("DIALOGS_NOTIFICATION").then(function(a){k=a});c("DIALOGS_ERROR").then(function(a){l=a});d.DeleteStudyLayout(h.studyInstanceUID).then(function(b){angular.isDefined(b.data)&&angular.isDefined(b.data.Message)?
e.error(l,b.data.Message):(c("NOTIFY_DELETE_STUDYLAYOUT_SUCCESS").then(function(a){e.notify(k,a)}),g.clearLayout(),a.enable("DeleteStudyStructuredDisplay"+f.id,function(){return!1}))},function(a){e.error(l,a)})}}}]);
commangular.command("HangingProtocol",["toolbarService","tabService","buttonId","$modal","seriesManagerService","objectStoreService","$translate","dialogs",function(a,b,d,c,e,f,g,h){return{execute:function(){b.get_allTabs();var a=e.get_activeCell(),d=null,m=HangingProtocolHelper.get_PrimaryCell(a.viewer,e),p=a.viewer,n,r;0<m.frames.count&&(d=m.frames.item(0).metadata);g("DIALOGS_NOTIFICATION").then(function(a){n=a});g("NOTIFY_SAVE_HP_SUCCESS").then(function(a){r=a});var q=HangingProtocolHelper.get_HangingProtocol(m.viewer,
m,d);c.open({templateUrl:"views/dialogs/HangingProtocol.html",controller:Controllers.HPDialogControllerScope,backdrop:"static",resolve:{dataset:function(){return d},hp:function(){return q}}}).result.then(function(){angular.forEach(q.DisplaySets,function(a,b){delete a.cell;delete a.metadata});angular.forEach(q.ImageSetsSequence,function(a,b){delete a.metadata});p.layout.highlightedItems.clear();f.StoreHangingProtocol(q).success(function(a){angular.isDefined(a.FaultType)?alert(a.Message):h.notify(n,
r)}).error(function(a){alert(a)})},function(){p.layout.highlightedItems.clear()})}}}]);
commangular.command("SaveStructuredDisplay",["seriesManagerService","eventService","tabService","objectStoreService","dialogs","$translate","toolbarService",function(a,b,d,c,e,f,g){return{execute:function(){var b=new Models.StudyLayout,k=d.getActiveViewer(),l="",m="",p=1,n=d.get_tabData(d.selectedTab.id,TabDataKeys.LaunchingStudy);f("DIALOGS_NOTIFICATION").then(function(a){l=a});f("NOTIFY_STRUCTUREDDISPLAY_SUCCESS").then(function(a){m=a});k.cellsArrangement==lt.Controls.Medical.CellsArrangement.grid&&
(b.Rows=k.gridLayout.rows,b.Columns=k.gridLayout.columns);enumerateCell(d,function(c){var d=new Models.SeriesInfo,e=HangingProtocolHelper.get_cellImageBox(c,p),f=a.get_seriesInfo(c.seriesInstanceUID);a.get_instances(c.seriesInstanceUID,c.divID);var g=HangingProtocolHelper.get_activeFrame(c);e.HorizontalJustification=HangingProtocolHelper.ConvertToFrameHorizontalJustication(g.horizontalAlignment);e.VerticalJustification=HangingProtocolHelper.ConvertToFrameVerticalJustication(g.verticalAlignment);d.AnnotationData=
a.get_cellAnnotations(c);!n&&f&&(n=f.StudyInstanceUID);d.StudyInstanceUID=f.StudyInstanceUID;d.SeriesInstanceUID=c.seriesInstanceUID;f.StudyInstanceUID==n?b.SeriesPush(d):(c=$.grep(b.OtherStudies,function(a){return a.StudyInstanceUID==f.StudyInstanceUID}),0<c.length?c=c[0]:(c=new Models.OtherStudies,c.StudyInstanceUID=f.StudyInstanceUID,b.OtherStudies.push(c)),c.Series.push(d));d.ImageBoxNumber=e.ImageBoxNumber;b.Boxes.push(e);p++});enumerateEmptyCell(d,function(a){var c=new Models.ImageBox;new Models.SeriesInfo;
c.Position=HangingProtocolHelper.get_position(a.bounds);c.ImageBoxNumber=p;k.cellsArrangement==lt.Controls.Medical.CellsArrangement.grid&&(c.RowPosition=a.rowPosition,c.ColumnPosition=a.columnsPosition,c.NumberOfRows=a.numberOfRows,c.NumberOfColumns=a.numberOfColumns);b.Boxes.push(c);p++});c.StoreStudyLayout(n,b).success(function(a){angular.isDefined(a.FaultType)?alert(a.Message):(d.get_tabData(d.selectedTab.id,TabDataKeys.ViewController).setStudyLayout(b),e.notify(l,m),g.enable("DeleteStudyStructuredDisplay"+
d.selectedTab.id,function(){return!0}))}).error(function(a){alert(a)})}}}]);commangular.command("ImageAlignLeft",["seriesManagerService",function(a){return{execute:function(){var b=a.get_activeCell();b&&(b.get_linked()?a.enumerateFrames(b,function(a,b){a.horizontalAlignment=lt.Controls.Medical.HorizontalAlignmentType.left}):a.get_activeCellFrame().horizontalAlignment=lt.Controls.Medical.HorizontalAlignmentType.left)}}}]);
commangular.command("ImageAlignRight",["seriesManagerService",function(a){return{execute:function(){var b=a.get_activeCell();b&&(b.get_linked()?a.enumerateFrames(b,function(a,b){a.horizontalAlignment=lt.Controls.Medical.HorizontalAlignmentType.right}):a.get_activeCellFrame().horizontalAlignment=lt.Controls.Medical.HorizontalAlignmentType.right)}}}]);
commangular.command("ImageAlignCenter",["seriesManagerService",function(a){return{execute:function(){var b=a.get_activeCell();b.get_linked()?a.enumerateFrames(b,function(a,b){a.horizontalAlignment=lt.Controls.Medical.HorizontalAlignmentType.middle}):a.get_activeCellFrame().horizontalAlignment=lt.Controls.Medical.HorizontalAlignmentType.middle}}}]);
commangular.command("ImageAlignTop",["seriesManagerService",function(a){return{execute:function(){var b=a.get_activeCell();b.get_linked()?a.enumerateFrames(b,function(a,b){a.verticalAlignment=lt.Controls.Medical.VerticalAlignmentType.top}):b&&(a.get_activeCellFrame().verticalAlignment=lt.Controls.Medical.VerticalAlignmentType.top)}}}]);
commangular.command("ImageAlignBottom",["seriesManagerService",function(a){return{execute:function(){var b=a.get_activeCell();b.get_linked()?a.enumerateFrames(b,function(a,b){a.verticalAlignment=lt.Controls.Medical.VerticalAlignmentType.bottom}):b&&(a.get_activeCellFrame().verticalAlignment=lt.Controls.Medical.VerticalAlignmentType.bottom)}}}]);
commangular.command("ImageAlignMiddle",["seriesManagerService",function(a){return{execute:function(){var b=a.get_activeCell();b.get_linked()?a.enumerateFrames(b,function(a,b){a.verticalAlignment=lt.Controls.Medical.VerticalAlignmentType.middle}):b&&(a.get_activeCellFrame().verticalAlignment=lt.Controls.Medical.VerticalAlignmentType.middle)}}}]);
function copyOverlays(a,b){var d=b.get_overlays().get_count(),c;for(c=0;c<d;c++){var e=b.get_overlays().get_item(c);var f=new lt.Controls.Medical.OverlayText;e.type==lt.Controls.Medical.OverlayTextType.userData&&(f.text=e.text);f.type=e.type;f.positionIndex=e.positionIndex;f.weight=e.weight;f.color=e.color;f.alignment=e.alignment;a.get_overlays().add(f)}}
function reArrangeCellBasedOnMPRType(a,b){switch(b){case lt.Controls.Medical.CellMPRType.sagittal:a.rowPosition=1;a.columnsPosition=-1;break;case lt.Controls.Medical.CellMPRType.coronal:a.rowPosition=1;a.columnsPosition=-1;break;case lt.Controls.Medical.CellMPRType.axial:a.rowPosition=0,a.columnsPosition=-1}}
function find3DObject(a,b){var d,c=a.layout.get_items().get_count();for(d=0;d<c;d++){var e=a.layout.get_items().get_item(d);if(e instanceof lt.Controls.Medical.Cell3D&&e.stackInstanceUID==b.stackInstanceUID&&e.seriesInstanceUID==b.seriesInstanceUID)return e}return null}
function GetMPRFramePosition(a,b){if(a.mprType==b)return a.currentOffset;if(null!=a.derivatives){if(null!=a.derivatives.get_item(0)&&a.derivatives.get_item(0).mprType==b)return a.derivatives.get_item(0).currentOffset;if(null!=a.derivatives.get_item(1)&&a.derivatives.get_item(1).mprType==b)return a.derivatives.get_item(1).currentOffset}return-1}
function ConnectMPRWith3DObject(a,b,d,c){null!=c&&a.add_currentOffsetChanged(function(){var a=find3DObject(d,b);null!=a&&(a.beginUpdate(),a.MPR.axialPosition=GetMPRFramePosition(b,lt.Controls.Medical.CellMPRType.axial),a.MPR.sagittalPosition=GetMPRFramePosition(b,lt.Controls.Medical.CellMPRType.sagittal),a.MPR.coronalPosition=GetMPRFramePosition(b,lt.Controls.Medical.CellMPRType.coronal),a.endUpdate())})}
function createMPRCell(a,b,d,c,e,f,g,h){var k="MedicalCell"+Date.now(),l=d.get_seriesTab(e.get_seriesInstanceUID());g=d.get_seriesInfo(e.get_seriesInstanceUID());var m=e.get_seriesInstanceUID();switch(f){case lt.Controls.Medical.CellMPRType.sagittal:m+="_Sagittal";k=e.divID+"_Sagittal";break;case lt.Controls.Medical.CellMPRType.coronal:m+="_Coronal";k=e.divID+"_Coronal";break;case lt.Controls.Medical.CellMPRType.axial:m+="_Axial",k=e.divID+"_Axial"}g=jQuery.extend(!0,{},g);g.InstanceUID=m;d.set_seriesTab(m,
l);d.set_seriesInfo(m,g);d.set_activeCell(m);d=new lt.Controls.Medical.MPRCell(e,f,k,h);d.add_frameRequested(function(b,c){b=e.cell3D;b.object3D.volumeReady&&(c.image.src=a.GetMPRFrame(b.object3D.id,c.mprType,c.index))});d.tickBoxes[0].visible=!1;reArrangeCellBasedOnMPRType(d,f);d.frameOfReferenceUID=e.frameOfReferenceUID;ConnectMPRWith3DObject(d,e,c,b);d.overlayTextVisible=e.overlayTextVisible;b=new MedicalViewerSeries(g.InstanceUID,"",1,1);b.seriesInstanceUID=g.InstanceUID;b.link=e.get_linked();
c.InitializeCell(d,b);CommandManager.RunCommand(d,CommandManager.LastCommand.Action,CommandManager.LastCommand.ButtonID);return d}var _seriesManagerService;function MakeRoomFor(a,b){var d=a.layout.items.count+b;0!=b&&a.cellsArrangement==lt.Controls.Medical.CellsArrangement.grid&&d>=a.gridLayout.rows*a.gridLayout.columns&&(b=Math.floor(Math.sqrt(d)),d=Math.ceil(d/b),a.layout.beginUpdate(),a.gridLayout.rows=b,a.gridLayout.columns=d,a.layout.endUpdate())}
function VolumeWithMPR(a,b,d,c,e,f,g,h,k,l){var m=c.get_allTabs()[c.activeTab];b=c.get_tabData(m.id,TabDataKeys.ViewController);var p="Server Side"==h.get(OptionNames.MPRRenderSide).trim(),n=a.get_activeCell();if(null!=b&&null!=a.get_activeCell()){var r=function(a,b){u=document.createElement("div");u.id="loader";u.className="loader"+n.div.id;n.div.appendChild(u);lt.LTHelper.device!=lt.LTDevice.desktop||lt.LTHelper.browser==lt.LTBrowser.internetExplorer||p?t(null,null):200<n.frames.count?n.create3D=
!0:t(null,null);n.add_data3DGenerated(q)},q=function(a,b){t(a,b)},t=function(b,g){n instanceof lt.Controls.Medical.Cell3D&&(n=n.referenceCell);b=createMPRCell(k,f,a,y,n,w,e,p);copyOverlays(b,n);b=createMPRCell(k,f,a,y,n,x,e,p);copyOverlays(b,n);d.enable("CrossHair"+m.id,function(){return 0<n.derivatives.count});enumerateCell(c,function(a){a.drawCrossHairLines=!0});u=n.div.getElementsByClassName("loader"+n.div.id)[0];null!=u&&(n.div.removeChild(u),u.id="");n.viewer.layout.selectedItem=n},y=b.getViewer();
if(!alreadyHaveA3Dobject(n,l)){MakeRoomFor(y,Math.max(0,3-n.derivatives.count));Create3DObject(a,d,c,f,g,h,e,l);n=a.get_activeCell();if(n instanceof lt.Controls.Medical.Cell3D&&(n=n.referenceCell,-1==y.layout.items.indexOf(n)))return;if(0==n.derivatives.count){switch(lt.Controls.Medical.MPRCell.canDoMPR(n)){case lt.Controls.Medical.MPRStatus.imageOrientationNotTheSame:alert("An MPR cannot be created for this cell, because each frame in the cell has a different orientation.");return;case lt.Controls.Medical.MPRStatus.cellNotValid:alert("You can't create an MPR image out of this cell");
return;case lt.Controls.Medical.MPRStatus.imagePositionNotReady:alert("The first and second position of the cell is not present");return;case lt.Controls.Medical.MPRStatus.notEnoughFrames:alert("the cell must have at least 3 frames to generate MPR cell out of it");return;case lt.Controls.Medical.MPRStatus.allFramesNotReady:alert("cell data is not downloaded yet");return}n.currentOffset=n.frames.count>>1;switch(n.mprType){case lt.Controls.Medical.CellMPRType.axial:var w=lt.Controls.Medical.CellMPRType.coronal;
var x=lt.Controls.Medical.CellMPRType.sagittal;break;case lt.Controls.Medical.CellMPRType.coronal:w=lt.Controls.Medical.CellMPRType.axial;x=lt.Controls.Medical.CellMPRType.sagittal;break;case lt.Controls.Medical.CellMPRType.sagittal:w=lt.Controls.Medical.CellMPRType.axial,x=lt.Controls.Medical.CellMPRType.coronal}var u;n.fullDownload||p?r(null,null):(n.fullDownload=!0,n.add_progressCompleted(r));reArrangeCellBasedOnMPRType(n,n.mprType)}}}}
commangular.command("OnMPR",["seriesManagerService","$modal","toolbarService","tabService","eventService","queryArchiveService","overlayManagerService","optionsService","objectRetrieveService",function(a,b,d,c,e,f,g,h,k){return{execute:function(){}}}]);
function toggleImageProcessing(a,b,d){var c=a.imageProcessingList.toArray();c=$.grep(c,function(a){return a.command==b.command});removeImageProcessing(a,d);if(c&&0<c.length)return a.imageProcessingList.remove(c[0]),!0;a.imageProcessingList.add(b);return!1}function removeImageProcessing(a,b){for(var d=0;d<b.length;d++){var c=a.imageProcessingList.toArray();if((c=$.grep(c,function(a){return a.command==b[d]}))&&0<c.length)return a.imageProcessingList.remove(c[0]),!0}}
function imageProcessingReady(a,b){a.imageProcessingReady.remove(imageProcessingReady);a.ip.toolbarService.enable(a.ip.buttons,function(){return!0})}
commangular.command("OnTogglePerio",["seriesManagerService","tabService","toolbarService","$commangular",function(a,b,d,c){return{execute:function(){var c=a.get_activeCell(),f=!1;b.get_allTabs();if(null!=c){var g=c.get_linked();var h=new lt.ImageProcessing;h.set_jsFilePath("");h.set_command("Perio");h.get_arguments().MultiscaleEnhancement="1000,-1,-1,-1,-1,'Gaussian'=";h.get_arguments().GammaCorrect="65=";h.get_arguments().UnsharpMask="150,150,0";if(g){var k=a.get_activeCellFrame();a.enumerateFrames(c,
function(a,b){b=toggleImageProcessing(a,h,["Endo","Dentin"]);a!=k||b||(f=!0)})}else g=a.get_activeCellFrame(),(g=toggleImageProcessing(g,h,["Endo","Dentin"]))||c.imageProcessingReady.add(imageProcessingReady),f=g;f?d.unpress("Perio"+b.get_allTabs()[b.activeTab].id):d.press("Perio"+b.get_allTabs()[b.activeTab].id);d.unpress("Endo"+b.get_allTabs()[b.activeTab].id);d.unpress("Dentin"+b.get_allTabs()[b.activeTab].id)}}}}]);
commangular.command("OnToggleDentin",["seriesManagerService","tabService","toolbarService","$commangular",function(a,b,d,c){return{execute:function(){var c=a.get_activeCell(),f=!1;b.get_allTabs();if(null!=c){var g=c.get_linked();var h=new lt.ImageProcessing;h.set_jsFilePath("");h.set_command("Dentin");h.get_arguments().MultiscaleEnhancement="1000,-1,-1,-1,-1,'Gaussian'=";h.get_arguments().GammaCorrect="76=";h.get_arguments().UnsharpMask="150,150,0";if(g){var k=a.get_activeCellFrame();a.enumerateFrames(c,
function(a,b){b=toggleImageProcessing(a,h,["Endo","Perio"]);a!=k||b||(f=!0)})}else g=a.get_activeCellFrame(),(g=toggleImageProcessing(g,h,["Endo","Perio"]))||c.imageProcessingReady.add(imageProcessingReady),f=g;f?d.unpress("Dentin"+b.get_allTabs()[b.activeTab].id):d.press("Dentin"+b.get_allTabs()[b.activeTab].id);d.unpress("Perio"+b.get_allTabs()[b.activeTab].id);d.unpress("Endo"+b.get_allTabs()[b.activeTab].id)}}}}]);
commangular.command("OnToggleEndo",["seriesManagerService","tabService","toolbarService","$commangular",function(a,b,d,c){return{execute:function(){var c=a.get_activeCell(),f=!1;b.get_allTabs();if(null!=c){var g=c.get_linked();var h=new lt.ImageProcessing;h.set_jsFilePath("");h.set_command("Endo");h.get_arguments().MultiscaleEnhancement="1000,-1,-1,-1,-1,'Gaussian'=";h.get_arguments().GammaCorrect="85=";h.get_arguments().UnsharpMask="150,150,0";if(g){var k=a.get_activeCellFrame();a.enumerateFrames(c,
function(a,b){b=toggleImageProcessing(a,h,["Perio","Dentin"]);a!=k||b||(f=!0);a.subCell.invalidate()})}else g=a.get_activeCellFrame(),(f=g=toggleImageProcessing(g,h,["Perio","Dentin"]))||c.imageProcessingReady.add(imageProcessingReady);f?d.unpress("Endo"+b.get_allTabs()[b.activeTab].id):d.press("Endo"+b.get_allTabs()[b.activeTab].id);d.unpress("Perio"+b.get_allTabs()[b.activeTab].id);d.unpress("Dentin"+b.get_allTabs()[b.activeTab].id)}}}}]);
commangular.command("StudyTimeLine",["tabService",function(a){return{execute:function(){if(-1!=a.activeTab){var b=a.get_allTabs()[a.activeTab],d=a.get_tabData(b.id,TabDataKeys.ViewController);ShowStudyTimeLine(b,d,!d.studyTimeLineVisible)}}}}]);commangular.command("Compare",["seriesManagerService","tabService","series","eventService",function(a,b,d,c){return{execute:function(){try{c.publish(EventNames.SeriesSelected,{study:null,series:d,remote:!1,forCompare:!0})}catch(e){console.log(e)}finally{}}}}]);
commangular.command("OnStudyLayout",["seriesManagerService","$modal","tabService",function(a,b,d){return{execute:function(){function a(a,b){var c=a.layout.get_items().get_count();b=Math.min(b,c);for(c=0;c<b;c++)a.layout.get_items().get_item(c).set_position(c);var d=a.get_emptyDivs().get_items().get_count();for(c=0;c<d;c++)a.get_emptyDivs().get_items().get_item(c).set_position(c+b)}var e={},f=d.get_allTabs()[d.activeTab],g=d.get_tabData(f.id,TabDataKeys.ViewController).getViewer();g.exploded&&g.explode(g.explodedCell,
!1);e.rows=parseInt(g.get_gridLayout().get_rows());e.columns=parseInt(g.get_gridLayout().get_columns());angular.isDefined(g.customLayout)&&(e.custom=g.customLayout);b.open({templateUrl:"views/dialogs/StudyLayout.html",controller:Controllers.StudyLayoutController,backdrop:"static",resolve:{layout:function(){return e}}}).result.then(function(b){if(null==b.custom)g.get_gridLayout().set_rows(b.rows),g.get_gridLayout().set_columns(b.columns),g.set_cellsArrangement(0),delete g.customLayout;else{if(null==
b.custom.Frames){g.customLayout=b.custom.Text;g.set_cellsArrangement(1);g.layout.beginUpdate();g.set_totalCells(b.custom.length);a(g,b.custom.length);b=b.custom;g.layout.beginUpdate();for(var c=g.get_emptyDivs().get_items().get_count(),d=0;d<c;d++){var e=g.get_emptyDivs().get_items().get_item(d).get_position();g.get_emptyDivs().get_items().get_item(d).set_bounds(Utils.createLeadRect(b[e][0],b[e][1],b[e][2],b[e][3]));g.get_emptyDivs().get_items().get_item(d).onSizeChanged()}c=Math.min(b.length,g.layout.get_items().get_count());
for(d=0;d<c;d++)e=g.layout.get_items().get_item(d).get_position(),g.layout.get_items().get_item(d).set_bounds(Utils.createLeadRect(b[e][0],b[e][1],b[e][2],b[e][3])),g.layout.get_items().get_item(d).onSizeChanged();for(c=g.layout.get_items().get_count();d<c;d++)g.layout.get_items().get_item(d).set_bounds(Utils.createLeadRect(0,0,0,0));g.layout.endUpdate()}else{g.set_cellsArrangement(1);g.layout.beginUpdate();c=b.custom.Frames.length;g.set_totalCells(c);a(g,c);c=b.custom.Frames;var f=g.get_emptyDivs(),
h=f.get_items().get_count();for(b=0;b<h;b++){var r=f.get_items().get_item(b),q=r.get_position();d=c[q].Position.leftTop.x;e=1-c[q].Position.leftTop.y;var t=c[q].Position.rightBottom.x;q=1-c[q].Position.rightBottom.y;r.set_bounds(Utils.createLeadRect(d,e,t,q));r.onSizeChanged()}f=g.layout.get_items().get_count();length=Math.min(c.length,f);for(b=0;b<length;b++)h=g.layout.get_items().get_item(b),q=h.get_position(),d=c[q].Position.leftTop.x,e=1-c[q].Position.leftTop.y,t=c[q].Position.rightBottom.x,q=
1-c[q].Position.rightBottom.y,h.set_bounds(Utils.createLeadRect(d,e,t,q)),h.onSizeChanged();for(c=b;b<f;b++)g.layout.get_items().get_item(c).dispose()}g.layout.endUpdate()}})}}}]);
commangular.command("OnSeriesLayout",["seriesManagerService","$modal","tabService","optionsService","eventService","dicomLoaderService","toolbarService",function(a,b,d,c,e,f,g){return{execute:function(){var c=d.selectedTab;if(g.isEnabled("SeriesLayouts"+c.id)){var f={};c=d.get_allTabs()[d.activeTab];var l=d.get_tabData(c.id,TabDataKeys.ViewController);var m=a.get_activeCell();l.getOverflowManager();if(null!=m){var p=function(b){var d=1<a.get_maxAllowedStackIndex(b);b=c.id;g.enable(["CinePlayer"+b,
"Stack"+b],function(){return d})};l=l.getViewer();l.exploded&&l.explode(l.explodedCell,!1);f.rows=m.get_gridLayout().get_rows();f.columns=m.get_gridLayout().get_columns();f.custom=m.templateId;l=b.open({templateUrl:"views/dialogs/SeriesLayout.html",controller:Controllers.SeriesLayoutController,backdrop:"static",resolve:{layout:function(){return f}}});l.result.then(function(b){var c=m.get_imageViewer();if(null==b.custom){if(10<b.rows||1>b.rows||10<b.columns||1>b.columns)return alert("valid value is between 1 and 10"),
!1;m.framesMappingIndex=null;a.delete_sopMappings(m.seriesInstanceUID);delete m.templateId;m.beginUpdate();m.gridLayout.rows=b.rows;m.gridLayout.columns=b.columns;0!=m.arrangement&&(m.arrangement=0);m.endUpdate();p(m);e.publish(EventNames.InstanceOverflowClear,{seriesInstanceUID:m.seriesInstanceUID})}else{b=b.custom;Utils.createViewerLayout(m,b,!1);a.set_layout(m.seriesInstanceUID,m.divID,void 0,void 0);b=a.set_framesMapping(m,b.Frames);a.clear_seriesOverflow(m.seriesInstanceUID);e.publish(EventNames.InstanceOverflowClear,
{seriesInstanceUID:m.seriesInstanceUID});for(var d=0;d<b.length;d++){var f=b[d];e.publish(EventNames.InstanceOverflow,{instance:f.Instance,metadata:f.metadata,frame:0,parentCell:m})}0==b.length&&e.publish(EventNames.InstanceOverflowClose,{seriesInstanceUID:m.seriesInstanceUID});c.endUpdate();m.onSizeChanged()}})}}}}}]);
commangular.command("DeleteCell",["seriesManagerService","tabService","eventService","queryArchiveService",function(a,b,d,c){return{execute:function(){var c=b.get_allTabs()[b.activeTab],f=b.get_tabData(c.id,TabDataKeys.ViewController).getViewer(),g=a.get_activeCell();f.exploded&&f.explode(f.explodedCell,!1);if(null!=g){f.layout.get_items().remove(g);var h=g.get_automation();null!=h&&(h.get_container().get_children().clear(),h.detach());a.remove_cell(g);g.dispose();$("#dialog").dialog("close");g=f.layout.get_items().get_count();
0<g?(g=f.layout.get_items().get_item(0),a.set_activeCell(g.divID),c=g.get_seriesInstanceUID(),d.publish(EventNames.ActiveSeriesChanged,{seriesInstanceUID:c,id:g.divID})):(a.set_activeCell(null),d.publish(EventNames.DeleteTab,{id:c.id}))}else alert("no cell to delete")}}}]);var cobb;
function AddTag(a,b){var d=new lt.Controls.Medical.OverlayText;d.text=a;d.type=lt.Controls.Medical.OverlayTextType.userData;d.positionIndex=b;d.weight=1;d.alignment=lt.Controls.Medical.OverlayAlignment.topLeft;return d}
commangular.command("OnSettings3D",["toolbarService","tabService","buttonId","$modal","seriesManagerService","queryArchiveService",function(a,b,d,c,e,f){return{execute:function(){var a=e.get_activeItem();c.open({templateUrl:"views/dialogs/Settings3D.html",controller:Controllers.Settings3DController,backdrop:"static",resolve:{cell:function(){return a}}}).result.then(function(b){a.beginUpdate();a.showVolumeBorder=b.ShowVolumeBorder;a.showRotationCube=b.ShowRotationCube;a.projection=b.ProjectionMethod;
a.volume.enableClippingFrame=b.ShowClippingFrame;a.volume.lowResQuality=b.LowResQuality;a.MPR.enableCrossLines=b.ShowMPRCrossLines;a.endUpdate()})}}}]);
function handle_request3DData(a,b,d,c,e,f,g,h,k,l,m){switch(e.type){case lt.Controls.Medical.Requested3DDataType.render:a.image.src=e.JSON;break;case lt.Controls.Medical.Requested3DDataType.delete3DObject:if(b=a.get_referenceCell())b.divID=UUID.genV4().toString();break;case lt.Controls.Medical.Requested3DDataType.update3DSettings:f.Update3DSettings(e.JSON,a.object3D.id).then(function(b){a.refresh()});break;case lt.Controls.Medical.Requested3DDataType.get3DInfo:f.Get3DSettings(e.JSON,a.object3D.id).then(function(b){var c=
new lt.Controls.Medical.WindowLevelInfomation;try{var d=JSON.parse(b.data);c.windowWidth=d.WindowWidth;c.windowCenter=d.WindowCenter;c.minValue=d.MinimumValue;c.maxValue=d.MaximumValue;c.autoScaleSlope=a.information.autoScaleSlope;c.autoScaleIntercept=a.information.autoScaleIntercept;a.bone={};a.bone.width=d.BoneWindowWidth;a.bone.center=d.BoneWindowCenter;a.information=c;"CT"==DicomHelper.GetTagText(a.JSON[DicomTag.Modality])&&(c.windowWidth=d.BoneWindowWidth,c.windowCenter=d.BoneWindowCenter);a.information=
c}catch(q){}})}}function alreadyHaveA3Dobject(a,b){var d=a.viewer,c,e=d.layout.items.count;for(c=0;c<e;c++)if(d.layout.items.get_item(c)instanceof lt.Controls.Medical.Cell3D){var f=d.layout.items.get_item(c);100==f.object3D.progress&&(f.volumeType=b);if(f.referenceCell==a)return!0}return!1}
function Create3DObject(a,b,d,c,e,f,g,h){var k=a.get_activeCell(),l=new Models.QueryOptions;l.SeriesOptions.SeriesInstanceUID=k.seriesInstanceUID;var m=d.get_allTabs()[d.activeTab];d.get_tabData(m.id,TabDataKeys.ViewController).getViewer();if(k instanceof lt.Controls.Medical.Cell3D){var p=k;100==p.object3D.progress&&(p.volumeType=h);return!0}if(!alreadyHaveA3Dobject(k,h)){var n=k.viewer;3>n.layout.items.count+n.emptyDivs.items.count&&(n.cellsArrangement=lt.Controls.Medical.CellsArrangement.grid,n.layout.beginUpdate(),
n.gridLayout.rows=2,n.gridLayout.columns=2,n.layout.endUpdate());n.exploded&&(n.exploded=!1);k.Id3D=k.divID+"_3D";var r=k.frames.get_item(0),q=r.Instance.SOPInstanceUID;p=new lt.Controls.Medical.Cell3D(n,k.Id3D);p.object3D=m.AddnewEngine(k.divID,c,l,q,f);p.add_volumeTypeChanged(function(a,b){g.publish(EventNames.ActiveSeriesChanged,{seriesInstanceUID:k.seriesInstanceUID,id:k.divID})});p.referenceCell=k;k.cell3D=p;var t=-1!=f.get(OptionNames.RenderingMethod).indexOf("Hardware")?0:1;k.object3D=p.object3D;
p.object3D.add_request3DData(function(e,f){handle_request3DData(p,b,d,e,f,c,l,a,h,q,t)});p.object3D.add_statusChanged(function(e,f){switch(f.status){case lt.Controls.Medical.Object3DStatus.error:p.viewer.layout.get_items().remove(p);a.remove_cell(p);p.dispose();alert(f.message);break;case lt.Controls.Medical.Object3DStatus.ready:if(100==p.object3D.progress){p.URL=c.Get3DImage();var g={BoneWindowWidth:"",BoneWindowCenter:""};"CT"==DicomHelper.GetTagText(r.JSON[DicomTag.Modality])?c.Get3DSettings(g,
p.object3D.id).then(function(a){new lt.Controls.Medical.WindowLevelInfomation;g=JSON.parse(a.data);a={};a.WindowWidth=g.BoneWindowWidth;a.WindowCenter=g.BoneWindowCenter;c.Update3DSettings(a,p.object3D.id).then(function(a){p.beginUpdate();p.volumeType=h;p.endUpdate();a=d.get_allTabs()[d.activeTab];b.enable("VolumeType"+a.id)})}):(p.beginUpdate(),p.volumeType=h,p.endUpdate(),e=d.get_allTabs()[d.activeTab],b.enable("VolumeType"+e.id))}}});r=k.frames.get_item(0);m=r.metadata;p.JSON=m;DicomHelper.getPatientName(m,
DicomTag.PatientName);DicomHelper.GetTagTextValue(m,DicomTag.StudyDescription);DicomHelper.parseDicomDate(DicomHelper.GetTagTextValue(m,DicomTag.StudyDate));DicomHelper.parseDicomDate(DicomHelper.GetTagTextValue(m,DicomTag.SeriesDate));DicomHelper.GetTagTextValue(m,DicomTag.SeriesDescription);e.set_cellOverlays(p,m,!1);p.stackInstanceUID=k.stackInstanceUID;p.seriesInstanceUID=k.seriesInstanceUID;p.studyInstanceUID="3D";p.set_unselectedBorderColor(f.get(OptionNames.UnSelectedBorderColor));p.set_selectedSubCellBorderColor(f.get(OptionNames.SelectedSubCellBorderColor));
p.set_selectedBorderColor(f.get(OptionNames.SelectedBorderColor));p.set_highlightedSubCellBorderColor(f.get(OptionNames.SelectedBorderColor));p.set_showFrameBorder(f.get(OptionNames.ShowFrameBorder));document.getElementById(n.divId);n.layout.get_items().add(p);e=p.get_divID();a.add_seriesCell(p);$("#"+e).attr("seriesInstanceUID",p.get_seriesInstanceUID());m=d.get_allTabs()[d.activeTab];b.disable("VolumeType"+m.id);p.start("")}}
commangular.command("OnVRT",["seriesManagerService","toolbarService","tabService","dicomLoaderService","queryArchiveService","overlayManagerService","optionsService","eventService","objectRetrieveService",function(a,b,d,c,e,f,g,h,k){return{execute:function(){VolumeWithMPR(a,null,b,d,h,e,f,g,k,lt.Controls.Medical.VolumeType.VRT)}}}]);
commangular.command("OnMIP",["seriesManagerService","toolbarService","tabService","dicomLoaderService","queryArchiveService","overlayManagerService","optionsService","eventService","objectRetrieveService",function(a,b,d,c,e,f,g,h,k){return{execute:function(){VolumeWithMPR(a,null,b,d,h,e,f,g,k,lt.Controls.Medical.VolumeType.MIP)}}}]);
commangular.command("OnSSD",["seriesManagerService","toolbarService","tabService","dicomLoaderService","queryArchiveService","overlayManagerService","optionsService","eventService","objectRetrieveService",function(a,b,d,c,e,f,g,h,k){return{execute:function(){VolumeWithMPR(a,null,b,d,h,e,f,g,k,lt.Controls.Medical.VolumeType.SSD)}}}]);
commangular.command("OnMPRVolume",["seriesManagerService","toolbarService","tabService","dicomLoaderService","queryArchiveService","overlayManagerService","optionsService","eventService","objectRetrieveService",function(a,b,d,c,e,f,g,h,k){return{execute:function(){VolumeWithMPR(a,null,b,d,h,e,f,g,k,lt.Controls.Medical.VolumeType.MPR)}}}]);
commangular.command("OnRotate3D",["toolbarService","tabService","buttonId",function(a,b,d){return{execute:function(){SetCurrentInteractiveMode(a,b,MedicalViewerAction.Rotate3D,d);enumerateCell(b,function(a){CommandManager.RunCommand(a,MedicalViewerAction.Rotate3D,d)})}}}]);
commangular.command("ToggleFullScreen",["seriesManagerService","tabService","dicomLoaderService",function(a,b,d){return{execute:function(){if(null==document.getElementById("textObject"))if(isFullscreen())document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen();else if(document.fullscreenEnabled||document.webkitFullscreenEnabled||
document.mozFullScreenEnabled||document.msFullscreenEnabled){var c=b.get_allTabs()[b.activeTab];if(c=b.get_tabData(c.id,TabDataKeys.ViewController))c=c.getViewer(),a.get_activeCell(),c=document.getElementById(c.divId),c=c.parentElement,c.requestFullscreen?c.requestFullscreen():c.webkitRequestFullscreen?c.webkitRequestFullscreen():document.mozRequestFullScreen?document.mozRequestFullScreen():document.msRequestFullscreen&&document.msRequestFullscreen()}}}}]);
commangular.command("ToggleReferenceLine",["seriesManagerService","tabService","toolbarService",function(a,b,d){return{execute:function(){var c=b.get_allTabs()[b.activeTab],e=b.get_tabData(c.id,TabDataKeys.ViewController).getViewer();if(null!=e){var f=!e.get_showReferenceLine();e.set_showReferenceLine(f);f?d.press("ReferenceLine"+c.id):(d.unpress("ReferenceLine"+c.id),e.invalidate());c=a.get_activeCell();if(null!=c){var g=c.studyInstanceUID;enumerateCell(b,function(a){a.studyInstanceUID!=g||a.fullDownload||
(a.fullDownload=!0)});e.invalidate()}}}}}]);
commangular.command("ShowFirstLastReferenceLine",["seriesManagerService","tabService","toolbarService",function(a,b,d){return{execute:function(){var c=b.get_allTabs()[b.activeTab],e=b.get_tabData(c.id,TabDataKeys.ViewController).getViewer();if(null!=e){var f=!e.get_showFirstAndLastReferenceLine();e.set_showFirstAndLastReferenceLine(f);f?d.press("ShowFirstLast"+c.id):d.unpress("ShowFirstLast"+c.id);c=a.get_activeCell();if(null!=c){var g=c.studyInstanceUID;enumerateCell(b,function(a){a.studyInstanceUID!=
g||a.fullDownload||(a.fullDownload=!0)});e.invalidate()}}}}}]);
function OpenUrl(a,b){b=b||!1;if(lt.LTHelper.OS==lt.LTOS.iOS&&!lt.LTDevice.mobile||b){var d=window.open("","_blank");d?(window.focus(),d.location.href=a,d.focus()):lt.LTHelper.browser===lt.LTBrowser.chrome&&b?($("#dialogForPrintPdf").length&&$("#dialogForPrintPdf").remove(),parentDiv=$("<div id='dialogForPrintPdf' title='File Ready' ><a href='"+a+"'  target='_blank'>Click here to open or download</a></div>"),parentDiv.dialog({autoOpen:!1}),$("#dialogForPrintPdf").dialog("open")):window.location.href=
a}else window.location.href=a}function OpenPrintViewUrl(a){var b=window.open();b&&b.document.write('<img onload="document.location=\'#\';" src="'+a+'" ></img>')}function SetCurrentInteractiveMode(a,b,d,c,e){b=b.get_allTabs()[b.activeTab];currentInteractiveMode[b.id]!=d&&(currentInteractiveMode[b.id]=d,PressButton(a,b,c,e))}function GetCurrentInteractiveMode(a){var b=-1;angular.isDefined(currentInteractiveMode[a])&&(b=currentInteractiveMode[a]);return-1==b?MedicalViewerAction.WindowLevel:b}
function enumerateCell(a,b,d){if(-1!=a.activeTab&&(d=d?d:a.get_allTabs()[a.activeTab],a=a.get_tabData(d.id,TabDataKeys.ViewController),null!=a&&(a=a.getViewer(),null!=a))){var c=a.layout.get_items().get_count();for(d=0;d<c;d++){var e=a.layout.get_items().get_item(d);null!=e&&b(e)}}}
function enumerateEmptyCell(a,b){if(-1!=a.activeTab){var d=a.get_allTabs()[a.activeTab];a=a.get_tabData(d.id,TabDataKeys.ViewController).getViewer();if(null!=a){var c=a.emptyDivs.items.count;for(d=0;d<c;d++){var e=a.emptyDivs.items.item(d);null!=e&&b(e)}}}}
function radioColor(){var a=document.getElementById("checkboxRed"),b=document.getElementById("checkboxGreen"),d=document.getElementById("checkboxBlue");a.disabled=!1;b.disabled=!1;d.disabled=!1;a=currentPosition;lineProfileInteractiveMode.histogramColorType=lt.Controls.Medical.ColorType.RGB;UpdateSliderPosition(a)}
function radioGray(){var a=document.getElementById("checkboxRed"),b=document.getElementById("checkboxGreen"),d=document.getElementById("checkboxBlue");a.disabled=!0;b.disabled=!0;d.disabled=!0;a=currentPosition;lineProfileInteractiveMode.histogramColorType=lt.Controls.Medical.ColorType.gray;UpdateSliderPosition(a)}function checkbox_click(a){RenderLineProfileHistogram(0,0,!1)}function GetRealRotationAngle(a,b){var d=1;b.get_flipped()^b.get_reversed()&&(d=-1);return d*a}
function isOverLineProfileSlider(a){a=a.pageY;var b=document.getElementById("lineProfileCanvas");return a>=b.height}var mouseDown=!1,lineProfileHistogram=null,currentLineProfileFrame=null,lineProfileInteractiveMode=null,colorType=lt.Controls.Medical.ColorType.auto;function HistogramUpdated(){RenderLineProfileHistogram(0,0,!1);var a=document.getElementById("lineProfileCanvas");null!=a&&UpdateSliderPosition(a.clientWidth)}
function UpdateSliderSize(){var a=colorType==lt.Controls.Medical.ColorType.gray?1:3,b=document.getElementById("lineProfileCanvas");a=lineProfileHistogram.length/a;lineProfileSliderSize=b.width<a?a-b.width:0}
function RenderLineProfileHistogram(a,b,d){var c=document.getElementById("lineProfileCanvas"),e=document.getElementById("outerlineProfileCanvas");if(null!=c&&null!=e&&null!=currentLineProfileFrame){e=c.getContext("2d");var f=c.height,g=currentLineProfileFrame.information.maxValue-currentLineProfileFrame.information.minValue;if(0!=lineProfileHistogram.length){UpdateSliderSize();var h,k=colorType==lt.Controls.Medical.ColorType.gray?1:3,l=[],m=[];3==k?(l[0]="red",m[0]=$("#checkboxRed").is(":checked")?
!0:!1,l[1]="green",m[1]=$("#checkboxGreen").is(":checked")?!0:!1,l[2]="blue",m[2]=$("#checkboxBlue").is(":checked")?!0:!1):(l[0]="black",m[0]=!0);e.clearRect(0,0,c.width,c.height);e.save();for(h=0;h<k;h++)if(m[h]){var p,n=Math.min(lineProfileHistogram.length/k,c.width),r=f-(lineProfileHistogram[lineProfileSliderPosition*k+h]-currentLineProfileFrame.information.minValue)*f/g;e.beginPath();e.strokeStyle=l[h];e.moveTo(0,r);for(p=1;p<n;p++)r=lineProfileHistogram[(lineProfileSliderPosition+p)*k+h]-currentLineProfileFrame.information.minValue,
r=f-r*f/g,e.lineTo(p,r);e.stroke()}c=document.getElementById("lineProfileCanvas");f=c.height;if(0!=lineProfileHistogram.length){if(d){e=c.getContext("2d");d=e.measureText("65535").width;c=a+d;k=colorType==lt.Controls.Medical.ColorType.gray?1:3;l=c;m="";for(h=0;h<k;h++)p=(lineProfileSliderPosition+c)*k+h,p>=lineProfileHistogram.length||(c=a+d,r=f-(lineProfileHistogram[p]-currentLineProfileFrame.information.minValue)*f/g,e.beginPath(),e.strokeStyle="black",e.fillStyle="rgba(230, 230, 128, 0.5)",e.arc(c+
.5,r,4,0,2*Math.PI),e.moveTo(c+.5,r),e.lineTo(c+.5,f),currentLineProfileFrame.parentCell.lineProfile.histogramMarker=lineProfileSliderPosition+c,m+=lineProfileHistogram[p].toString(),h<k-1&&(m+=","),e.fill(),e.stroke());c<e.measureText(m).width+10?(e.textAlign="left",l+=10):(e.textAlign="right",l-=4);m&&(e.beginPath(),e.textBaseline="baseline",e.fillStyle="black",e.fillText(m,l,b),e.fillStyle="gray",e.strokeText(m,l,b),e.fill(),e.stroke())}else currentLineProfileFrame.parentCell.lineProfile.histogramMarker=
-1;e.restore()}}}}function isOverGraph(a){var b=a.pageY;a=a.pageX;var d=document.getElementById("lineProfileCanvas");return b<d.height&&a<d.width}var currentPosition=0,lineProfileSliderSize=0,lineProfileSliderPosition=0;
function UpdateSliderPosition(a){if(lineProfileHistogram&&0!=lineProfileHistogram.length){var b=document.getElementById("dialog").clientWidth-24,d=document.getElementById("outerlineProfileCanvas"),c=document.getElementById("lineProfileCanvas"),e=d.getContext("2d");var f=b/15;var g=e.measureText("65535").width,h=c.offsetTop-d.offsetTop;b=b-f-g;f=c.clientHeight;e.clearRect(0,f+2+h,d.width,d.height-f);0!=lineProfileSliderSize&&(f=180,e.lineWidth=1,e.beginPath(),e.strokeStyle="rgba(255, 0, 0, 0.5)",e.moveTo(g+
.5,f+h+15+.5),e.lineTo(g+b+.5,f+h+15+.5),e.stroke(),e.beginPath(),currentPosition=a,currentPosition=Math.min(g+b+.5,Math.max(g,g+.5+currentPosition)),lineProfileSliderPosition=Math.round((currentPosition-g)*lineProfileSliderSize/b),e.lineWidth=2,e.fillStyle="rgba(255, 128, 128, 1)",e.arc(currentPosition,f+h+15,6,0,2*Math.PI),e.fill(),e.stroke(),e.textAlign="left",e.textBaseline="top",a=colorType==lt.Controls.Medical.ColorType.gray?1:3,f=c.clientHeight,c=Math.round(100*(lineProfileSliderPosition+b)/
(lineProfileHistogram.length/a)),e.fillText(Math.round(100*lineProfileSliderPosition/(lineProfileHistogram.length/a))+"%",g,f+h+1),e.textAlign="right",e.fillText(c+"%",g+b-.5,f+h+1))}}function getMousePoint(a,b){var d=document.getElementById("outerlineProfileCanvas").getContext("2d").measureText("65535").width;b=lt.LTHelper.getPosition(b,null);d=a.pageX-parseInt(b.x.toString())-d;a=a.pageY-parseInt(b.y.toString());return lt.LeadPointD.create(d,a)}
function outerlineCanvas_mouseDown(a,b){mouseDown=!1;document.getElementById("outerlineProfileCanvas");isOverLineProfileSlider(b)&&(mouseDown=!0,a=getMousePoint(b,a),UpdateSliderPosition(a.x),RenderLineProfileHistogram(0,0,!1));b.preventDefault()}function outerlineCanvas_mouseMove(a,b){mouseDown?(a=getMousePoint(b,a),UpdateSliderPosition(a.x),RenderLineProfileHistogram(0,0,!1)):isOverGraph(b);b.preventDefault();b.stopImmediatePropagation()}
function outerlineCanvas_mouseUp(a,b){mouseDown=!1;b.preventDefault();b.stopImmediatePropagation()}function isGrayScale16(){return!0}var histogramMouseDown=!1;function innerLineCanvas_mouseDown(a,b){histogramMouseDown=!1;document.getElementById("lineProfileCanvas");histogramMouseDown=!0;a=getMousePoint(b,a);UpdateLineOnHistogram(a.x,a.y,histogramMouseDown);b.preventDefault()}
function innerLineCanvas_mouseMove(a,b){histogramMouseDown&&(a=getMousePoint(b,a),UpdateLineOnHistogram(a.x,a.y,histogramMouseDown));b.preventDefault();b.stopImmediatePropagation()}function innerLineCanvas_mouseUp(a,b){histogramMouseDown=!1;UpdateLineOnHistogram(0,0,histogramMouseDown);b.preventDefault();b.stopImmediatePropagation()}function UpdateLineOnHistogram(a,b,d){RenderLineProfileHistogram(a,b,d)}
function ShowMenu(a,b,d,c,e,f,g,h,k,l){l=document.getElementById("customWidnowLevel_expandMenu");if(null!=l)l.style.visibility="visible";else{setTimeout(function(){function a(b){window.removeEventListener("click",a);b=document.getElementById("customWidnowLevel_expandMenu");null!=b&&"visible"==b.style.visibility&&(b.style.visibility="hidden",b.parentNode.removeChild(b),b.id="",b.innerHTML="")}window.addEventListener("click",a,!0)},10);l=document.getElementById("scrollLeft_toolbar_button");var m=0,
p=document.getElementById("ltTabWrapper");p&&(p=p.getElementsByClassName("scroll-body-inner"),null!=p&&0!=p.length&&(p=p[p.length-1]))&&(m=p.offsetLeft);p=f.getWindowLayout();f=document.createElement("div");f.id="customWidnowLevel_expandMenu";f.style.position="absolute";f.style.visibility="visible";f.style.zIndex="200";f.style.backgroundColor="#151515";f.style.width="250";f.style.top="84px";f.style.left=l.offsetLeft+l.clientWidth+b.offsetLeft+m+"px";f.style.display="block";f.style.height="200px";
p.appendChild(f);b=g.get_activeCell();l=a.length;m=b.SortOrderAcsending?" \u2193":" \u2191";for(var n=0;n<l;n++)p=a[n].Text==b.CurrentSelectedSortOrder,f.innerHTML=0==n?f.innerHTML+"<a class='menuBar' style='display: block;'></a>":f.innerHTML+"<a class='itemDivider' style='display: block;'></a>",f.innerHTML+="<a class='menuItemText2' id='dropdownmenuitem"+n+"' style='display: block; cursor: pointer;       text-decoration:none;'>"+(p?"\u2713 ":"")+a[n].Text+(p?m:"")+"</a>";for(n=0;n<l;n++){var r=document.getElementById("dropdownmenuitem"+
n.toString());r.setAttribute("itemIndex",n.toString());r.cellFrame=c;r.toolbarService=e;r.seriesManagerService=g;r.model=h;r.tab=k;r.cell=b;r.sortInfo=a[n].Info;r.item=a[n];r.addEventListener("mouseover",emptyFunction,!1);r.addEventListener("mouseleave",emptyFunction,!1);r.addEventListener("touchstart",d,!1);lt.LTHelper.msPointerEnabled?r.addEventListener(lt.Controls.Medical.Tools.pointerup,d,!1):r.addEventListener("mouseup",d,!1);lt.LTHelper.msPointerEnabled?r.addEventListener(lt.Controls.Medical.Tools.pointerdown,
function(a){a.preventDefault();a.stopImmediatePropagation()},!1):r.addEventListener("mousedown",function(a){a.preventDefault();a.stopImmediatePropagation()},!1)}f.style.height=r.offsetTop+r.clientHeight+1+"px"}}var currentSelectedSortOrder=-1,_sort_timer_event;
function sortClick(a){var b=parseInt(a.currentTarget.getAttribute("itemIndex")),d=a.currentTarget.seriesManagerService,c=a.currentTarget.cell,e=a.currentTarget.sortInfo;-1!=a.currentTarget.text.indexOf("\u2713")?c.SortOrderAcsending=!c.SortOrderAcsending:c.CurrentSelectedSortOrder=a.currentTarget.text;e.order=c.SortOrderAcsending?lt.Controls.Medical.SortOrder.ascending:lt.Controls.Medical.SortOrder.descending;currentSelectedSortOrder=b;c.fullDownload=!0;c._sort_timer_event=window.setInterval(function(a){d.enumerateFrames(c,
function(a,b){});c.sortingOperationsSequence=[e];window.clearInterval(c._sort_timer_event)},500)}
(function(a){var b=function(){function a(a,b,d){var c=this;a.add=function(){try{var a=new ExternalApp;a.name=c.$scope.name;a.args=c.$scope.args;a.path=c.$scope.path;c.externalApplicationsService.addApp(a);b.dismiss("")}catch(k){alert(k)}};a.cancel=function(){b.dismiss("cancel")};this.externalApplicationsService=d;this.$scope=a}a.$inject=["$scope","$modalInstance","externalApplicationsService"];return a}();a.AddAppController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g,h){var c=this,e="";(h=h.get_activeCell())&&(e=h.get_seriesInstanceUID());a.externalApplications=[];h=d.getAppList();for(var f in h)a.externalApplications.push(h[f].name);a.selectedApp="";a.run=function(){var a=c.externalApplicationsService.getAppList()[c.$scope.selectedApp];if(0<=a.args.indexOf("%pathname%"))if(""===e)alert("No active cell, please select one before you launch selected application");else{var d=g.GetInstanceLocalPathName(e);d.success(function(b){a.args=
a.args.replace("%pathname%",b);c.externalApplicationsService.runApp(a)});d.error(function(a){alert(a)})}else c.externalApplicationsService.runApp(a);b.dismiss("")};a.cancel=function(){b.dismiss("cancel")};a.deleteapp=function(){c.externalApplicationsService.deleteApp(c.$scope.selectedApp);b.dismiss("")};this.externalApplicationsService=d;this.$scope=a}a.$inject=["$scope","$modalInstance","externalApplicationsService","exportService","seriesManagerService"];return a}();a.RunAppController=b})(Controllers||
(Controllers={}));
var DicomLoader=function(){function a(a,d,c,e,f,g,h,k){this._objectRetrieveService=c;this._queryArchiveService=f;this._objectStoreService=k;this._eventService=e;this._qService=g;this._seriesManagerService=h;this._retrieveLocalUrl=a;this._authenticationService=d}a.prototype.loadSeries=function(a,d,c,e,f,g){c=a.get_seriesInstanceUID();a=a.divID;this._eventService.publish(EventNames.OnLoadLayout,{layout:"",seriesInstanceUID:c,id:a,template:""});this._eventService.publish(EventNames.MrtiInfoReady,{seriesInstanceUID:c});
this.getInfo(c,a,d,null)};a.prototype.getInfo=function(a,d,c,e){this.findSeriesInstances(a,d,c).then(function(b){this.getDicomJSON(b,d).then(function(b){this.setImageInformation(e,a,d);this.loadPresentationState(b,d,c)}.bind(this))}.bind(this))};a.prototype.setImageInformation=function(a,d,c){var b=this._seriesManagerService.get_seriesCellById(c);if(null!=b&&0<b.frames.count){var f=this._seriesManagerService.get_instances(b.seriesInstanceUID,c),g=this,h=b.frames.toArray();if(f)for(var k=f.length,
l=0,m=f[0].NumberOfFrames,p=0;p<k;p++){var n=f[p];if(null!=n&&null!=n.Pages&&0<n.Pages.length){for(var r=n.Pages.length,q,t=n.Pages[0],y=0;y<r;y++)if(y+l<b.frames.count){var w=1==m?Utils.findFirst(h,function(a){return(a=a.Instance)?a.SOPInstanceUID==n.SOPInstanceUID:!1}):b.frames.item(y+l);q=n.Pages[y];null!=q&&0!=t.TileSize.width&&(t=q);var x=t.SupportWindowLevel;null!=t.ImagePositionPatientArray&&w.set_imagePosition(t.ImagePositionPatientArray);null!=t.ImageOrientationPatientArray&&w.set_imageOrientation(t.ImageOrientationPatientArray);
null!=t.PatientOrientation&&w.set_patientProjection(t.PatientOrientation);null!=t.PixelSpacingPatientArray&&2==t.PixelSpacingPatientArray.length&&(w.set_rowSpacing(parseFloat(t.PixelSpacingPatientArray[1])),w.set_columnSpacing(parseFloat(t.PixelSpacingPatientArray[0])));q=new lt.Controls.Medical.MRTIImage;q.imageUri=this._retrieveLocalUrl+"/GetImageTile?auth="+encodeURIComponent(this._authenticationService.authenticationCode)+"&instance="+n.SOPInstanceUID;q.imageName=t.ImageName;q.mimeType=t.MimeType;
q.fullDpi=lt.LeadSizeD.create(150,150);q.tileSize=lt.LeadSizeD.create(t.TileSize.width,t.TileSize.height);q.frameIndex=y;q.supportWindowLevel=x&&!w.isWaveForm;q.resolutions=[];for(x=0;x<t.Resolutions.length;x++)q.resolutions[x]=lt.LeadSizeD.create(t.Resolutions[x].width,t.Resolutions[x].height);w.set_width(q.resolutions[0].width);w.set_height(q.resolutions[0].height);q.fullSize=lt.LeadSizeD.create(w.get_width(),w.get_height());w.mrtiInfo=q}l+=r}}else setTimeout($.proxy(function(){g.setImageInformation(a,
d,c)},this),350)}};a.prototype.getSeriesStacks=function(a){return this._objectRetrieveService.GetSeriesStacks(a).then(function(a){if(null!=a.data)return{stacks:a.data}})};a.prototype.loadFrameDicomJSON=function(a,d){var b=this;return this._objectRetrieveService.GetDicomJSON(a.Instance.StudyInstanceUID,a.Instance.SeriesInstanceUID,a.Instance.SOPInstanceUID).then(function(c){if(null!=c.data){var e=JSON.parse(c.data),g=DicomHelper.GetDicomImageInformation(e),h=d||!0;a.set_information(g);a.set_imagePosition(g.position);
g.orientation&&a.set_imageOrientation(g.orientation);a.set_imageType(g.imageType);a.set_lossyCompression(g.lossyImageCompression);a.metadata=e;a.JSON=e;a.isWaveForm=g.isWaveForm;a.set_width(g.get_width());a.set_height(g.get_height());a.set_rowSpacing(g.rowSpacing);a.set_columnSpacing(g.columnSpacing);a.originalSize={width:g.get_width(),height:g.get_height()};h&&b._eventService.publish(EventNames.ImageInformationReady,{seriesInstanceUID:a.Instance.SeriesInstanceUID,frameIndex:a.FrameIndex});b._eventService.publish(EventNames.LoadedDicomJSON,
{seriesInstanceUID:a.Instance.SeriesInstanceUID,cellFrame:a});return{xmlData:c,cellFrame:a}}})};a.prototype.loadLayout=function(a,d,c){var b=this;return this._objectRetrieveService.GetSeriesLayout(a,"").then(function(e){b._eventService.publish(EventNames.OnLoadLayout,{layout:e.data,seriesInstanceUID:a,id:d,template:c});return{seriesInstanceUID:a,layout:e.data}})};a.prototype.loadPresentationInfo=function(a,d,c){var b=this;return this._objectRetrieveService.GetPresentationInfo(a).then(function(e){e=
e.data;c&&0<c.length&&(e=$.grep(e,function(a,b){return 0<=c.indexOf(a.SOPInstanceUID)}));b._eventService.publish(EventNames.OnPresentationInfoLoaded,{seriesInstanceUID:a,presentationInfo:e,id:d});return{seriesInstanceUID:a,presentationInfo:e,id:d}})};a.prototype.loadPresentationState=function(a,d,c){var b=this;return this._queryArchiveService.FindPresentationState(a.seriesInstanceUID).then(function(e){e=e.data;c&&0<c.length&&(e=$.grep(e,function(a,b){return 0<$.grep(a.ReferencedSOPInstanceUIDs,function(a,
b){return 0<=c.indexOf(a)}).length}));b._eventService.publish(EventNames.PresentationStateLoaded,{seriesInstanceUID:a.seriesInstanceUID,annotations:e,id:d})})};a.prototype.findSeriesInstances=function(a,d,c){var b=this,f=new Models.QueryOptions,g=angular.isDefined(c)&&null!=c&&0<c.length?c[0]:"";f.SeriesOptions.SeriesInstanceUID=a;return this._queryArchiveService.FindInstances(f,g).then(function(e){e=e.data;b._seriesManagerService.get_presentationInfo(a,d);if(c&&0<c.length){var f,h=c.length,m=[],
p;for(f=0;f<h;f++)for(p=0;p<e.length;p++)if(null!=e[p]&&c[f]==e[p].SOPInstanceUID){m.add(e[p]);break}e=m}b._eventService.publish(EventNames.OnInstancesFound,{seriesInstanceUID:a,instances:e,id:d,stackInstanceUID:g});return{seriesInstanceUID:a,instances:e,id:d}})};a.prototype.getDicomJSON=function(a,d){var b=a.instances[0],e=this;return this._objectRetrieveService.GetDicomJSON(b.StudyInstanceUID,b.SeriesInstanceUID,b.SOPInstanceUID).then(function(c){c=JSON.parse(c.data);e._eventService.publish(EventNames.OnDicomJSONRetrieved,
{seriesInstanceUID:a.seriesInstanceUID,instances:a.instances,metadata:c,id:d,sopInstanceUID:b.SOPInstanceUID});e._eventService.publish(EventNames.LoadedDicomJSON,{seriesInstanceUID:a.seriesInstanceUID,cellFrame:null,id:d});return{seriesInstanceUID:a.seriesInstanceUID,instances:a.instances,metadata:c}})};a.prototype.sortInstances=function(a,d){return parseInt(a.InstanceNumber)-parseInt(d.InstanceNumber)};a.prototype.getDataSize=function(a){var b=DicomHelper.getDicomTag(a,DicomTag.Columns),c=DicomHelper.getDicomTag(a,
DicomTag.Rows);a=Utils.isTabletOrMobile()?256:512;b=null!=b&&0<b.length?parseInt(DicomHelper.GetTagText(b[0]),10):512;c=null!=c&&c.length?parseInt(DicomHelper.GetTagText(c[0]),10):512;var e=b;if(Math.max(b,c)<a)return lt.LeadSizeD.create(e,c);if(b>c){e=a;var f=c*a/b}else f=a,e=b*a/c;return lt.LeadSizeD.create(parseInt(e),parseInt(f))};a.$inject="retrieveLocalUrl authenticationService objectRetrieveService eventService queryArchiveService $q seriesManagerService objectStoreService".split(" ");return a}();
commangular.command("OnAnnotationSelect",["toolbarService","tabService","buttonId",function(a,b,d){return{execute:function(){setAnnTool(a,b,d,MedicalViewerAction.AnnSelect)}}}]);function SetOrientation(a,b){a.get_activeCell().orientation=b}commangular.command("OnHeadOrientation",["seriesManagerService",function(a){return{execute:function(){SetOrientation(a,lt.Controls.Medical.OrientationFace.superior)}}}]);
commangular.command("OnFeetOrientation",["seriesManagerService",function(a){return{execute:function(){SetOrientation(a,lt.Controls.Medical.OrientationFace.inferior)}}}]);commangular.command("OnLeftOrientation",["seriesManagerService",function(a){return{execute:function(){SetOrientation(a,lt.Controls.Medical.OrientationFace.left)}}}]);commangular.command("OnRightOrientation",["seriesManagerService",function(a){return{execute:function(){SetOrientation(a,lt.Controls.Medical.OrientationFace.right)}}}]);
commangular.command("OnAnteriorOrientation",["seriesManagerService",function(a){return{execute:function(){SetOrientation(a,lt.Controls.Medical.OrientationFace.anterior)}}}]);commangular.command("OnPosteriorOrientation",["seriesManagerService",function(a){return{execute:function(){SetOrientation(a,lt.Controls.Medical.OrientationFace.posterior)}}}]);commangular.command("OnAnnotationArrow",["toolbarService","tabService","buttonId",function(a,b,d){return{execute:function(){setAnnTool(a,b,d,MedicalViewerAction.AnnPointer)}}}]);
commangular.command("OnAnnotationPoint",["toolbarService","tabService","buttonId",function(a,b,d){return{execute:function(){setAnnTool(a,b,d,MedicalViewerAction.AnnPoint)}}}]);commangular.command("OnAnnotationRectangle",["toolbarService","tabService","buttonId",function(a,b,d){return{execute:function(){setAnnTool(a,b,d,MedicalViewerAction.AnnRectangle)}}}]);
commangular.command("OnAnnotationTextPointer",["toolbarService","tabService","buttonId",function(a,b,d){return{execute:function(){setAnnTool(a,b,d,MedicalViewerAction.AnnTextPointer)}}}]);commangular.command("OnAnnotationEllipse",["toolbarService","tabService","buttonId",function(a,b,d){return{execute:function(){setAnnTool(a,b,d,MedicalViewerAction.AnnEllipse)}}}]);
commangular.command("OnAnnotationCurve",["toolbarService","tabService","buttonId",function(a,b,d){return{execute:function(){setAnnTool(a,b,d,MedicalViewerAction.AnnCurve)}}}]);commangular.command("OnAnnotationLine",["toolbarService","tabService","buttonId",function(a,b,d){return{execute:function(){setAnnTool(a,b,d,MedicalViewerAction.AnnLine)}}}]);commangular.command("OnAnnotationFreehand",["toolbarService","tabService","buttonId",function(a,b,d){return{execute:function(){setAnnTool(a,b,d,MedicalViewerAction.AnnFreeHand)}}}]);
commangular.command("OnAnnotationPolyline",["toolbarService","tabService","buttonId",function(a,b,d){return{execute:function(){setAnnTool(a,b,d,MedicalViewerAction.AnnPolyline)}}}]);commangular.command("OnAnnotationPolygon",["toolbarService","tabService","buttonId",function(a,b,d){return{execute:function(){setAnnTool(a,b,d,MedicalViewerAction.AnnPolygon)}}}]);
commangular.command("OnAnnotationText",["toolbarService","tabService","buttonId",function(a,b,d){return{execute:function(){setAnnTool(a,b,d,MedicalViewerAction.AnnText)}}}]);commangular.command("OnAnnotationNote",["toolbarService","tabService","buttonId",function(a,b,d){return{execute:function(){setAnnTool(a,b,d,MedicalViewerAction.AnnNote)}}}]);commangular.command("OnAnnotationHighlight",["toolbarService","tabService","buttonId",function(a,b,d){return{execute:function(){setAnnTool(a,b,d,MedicalViewerAction.AnnHighlight)}}}]);
commangular.command("OnAnnotationRuler",["toolbarService","tabService","buttonId",function(a,b,d){return{execute:function(){setAnnTool(a,b,d,MedicalViewerAction.AnnRuler)}}}]);commangular.command("OnAnnotationPolyRuler",["toolbarService","tabService","buttonId",function(a,b,d){return{execute:function(){setAnnTool(a,b,d,MedicalViewerAction.AnnPolyRuler)}}}]);
commangular.command("OnAnnotationProtractor",["toolbarService","tabService","buttonId",function(a,b,d){return{execute:function(){setAnnTool(a,b,d,MedicalViewerAction.AnnProtractor)}}}]);
commangular.command("OnAnnotationShowHide",["seriesManagerService","toolbarService","$commangular","authenticationService","tabService",function(a,b,d,c,e){return{execute:function(){var f=e.get_allTabs()[e.activeTab],g=e.get_tabData(f.id,TabDataKeys.AnnotationVisiblity);angular.isUndefined(g)&&(g=!0);g=!g;enumerateCell(e,function(a){a=a.get_automation();a.get_activeContainer().set_isVisible(g);a.get_automationControl().automationInvalidate(lt.LeadRectD.empty)});g||d.dispatch("Pan",{buttonId:"Pan"+
f.id});b.enable(["Select"+f.id,"Arrow"+f.id,"Ellipse"+f.id,"Highlight"+f.id,"Rectangle"+f.id,"Text"+f.id,"Ruler"+f.id,"PolyRuler"+f.id,"Protractor"+f.id,"Curve"+f.id,"Line"+f.id,"Freehand"+f.id,"Point"+f.id,"Polyline"+f.id,"Polygon"+f.id,"Note"+f.id,"DeleteAnnotations"+f.id,"ClearAnnotations"+f.id,"ClearAllAnnotations"+f.id],function(){return g});b.enable("CalibrateRuler"+f.id,function(){var b=a.get_activeCell().get_automation(),c=b.activeContainer;return g&&null!=b.currentDesigner&&1==c.selectionObject.selectedObjects.count&&
c.selectionObject.selectedObjects.item(0)instanceof lt.Annotations.Engine.AnnPolyRulerObject});b.enable("SaveAnn"+f.id,function(){return g&&c.hasPermission(PermissionNames.CanStoreAnnotations)});b.enable("LoadAnn"+f.id,function(){var b=a.get_activeCell();return g&&c.hasPermission(PermissionNames.CanViewAnnotations)&&0<a.get_annotationIDs(b.seriesInstanceUID,b.divID).length});e.set_tabData(f.id,TabDataKeys.AnnotationVisiblity,g)}}}]);
commangular.command("OnDeleteAnnotation",["seriesManagerService","toolbarService","authenticationService","tabService",function(a,b,d,c){return{execute:function(){c.get_allTabs();a.deleteSelectedAnnotations()}}}]);
commangular.command("OnClearAnnotation",["seriesManagerService","toolbarService","authenticationService","tabService",function(a,b,d,c){return{execute:function(){var d=c.get_allTabs()[c.activeTab];b.isEnabled("ClearAnnotations"+d.id)&&(a.clearAnnotations(),b.isEnabled("CalibrateRuler"+d.id)&&b.disable("CalibrateRuler"+d.id))}}}]);
commangular.command("OnClearAllAnnotation",["seriesManagerService","toolbarService","tabService",function(a,b,d){return{execute:function(){var c=d.get_allTabs()[d.activeTab];b.isEnabled("ClearAllAnnotations"+c.id)&&(a.clearAllAnnotations(),b.isEnabled("CalibrateRuler"+c.id)&&b.disable("CalibrateRuler"+c.id))}}}]);
commangular.command("OnLoadAnnotations",["seriesManagerService","toolbarService","$modal","eventService","objectRetrieveService","$translate","dialogs","tabService",function(a,b,d,c,e,f,g,h){return{execute:function(){var c=h.get_allTabs()[h.activeTab];if(b.isEnabled("LoadAnn"+c.id)){var l=a.get_activeCell(),m=a.get_annotationIDs(l.seriesInstanceUID,l.divID),p=a.get_activeCellFrame();p.get_container().get_children();p=p.get_container();var n="",r,q,t;f("DIALOGS_NOTIFY").then(function(a){n=a});f("NO").then(function(a){r=
a});f("ANNOTATIONS").then(function(a){q=a.toLowerCase()});f("FOUND").then(function(a){t=a});var y=d.open({templateUrl:"views/dialogs/Annotations.html",controller:Controllers.AnnotationsController,backdrop:"static",resolve:{annotations:function(){return m},seriesInstanceUID:function(){return l.seriesInstanceUID}}}),w={SourceDpiX:p.mapper.sourceDpiX,SourceDpiY:p.mapper.sourceDpiY,TargetDpiX:p.mapper.targetDpiX,TargetDpiY:p.mapper.targetDpiY};w=JSON.stringify(w);y.result.then(function(b){e.GetPresentationAnnotations(b,
w).then(function(b){200==b.status&&(b.data&&0<b.data.length?(b=$.parseXML(b.data),a.add_annotations(l,b)):g.notify(n,r+" "+q+" "+t))},function(a){f("DIALOGS_ERROR").then(function(b){g.error(b,a)})})}).finally(function(d){var e=a.get_annotationIDs(l.seriesInstanceUID,l.divID);b.enable("LoadAnn"+c.id,function(){return angular.isDefined(e)&&0<e.length})})}}}}]);
commangular.command("OnSaveAnnotations",["seriesManagerService","toolbarService","objectStoreService","authenticationService","$modal","$translate","dialogs","tabService","optionsService",function(a,b,d,c,e,f,g,h,k){return{execute:function(){var l=h.get_allTabs()[h.activeTab];if(b.isEnabled("SaveAnn"+l.id)){for(var m=a.get_activeCell(),p=m.get_frames().get_count(),n=!1,r=0;r<p;r++){var q=m.get_frames().item(r);var t=q.get_container().get_children().count;q=q.get_container();0!=t&&(n=!0)}if(!n)alert("no annotation found to save");
else if(m){var y=m.get_seriesInstanceUID(),w=a.get_cellAnnotations(m),x="",u="",A="Error";f("ANNOTATIONS_SAVED").then(function(a){x=a.toLowerCase()});f("DIALOGS_NOTIFY").then(function(a){u=a});f("DIALOGS_ERROR").then(function(a){A=a});if(0<w.length){p=e.open({templateUrl:"views/dialogs/AnnotationsSave.html",controller:Controllers.AnnotationsSaveController,backdrop:"static"});var G={SourceDpiX:q.mapper.sourceDpiX,SourceDpiY:q.mapper.sourceDpiY,TargetDpiX:q.mapper.targetDpiX,TargetDpiY:q.mapper.targetDpiY};
G=JSON.stringify(G);p.result.then(function(e){d.StoreAnnotations(y,w,e,G).then(function(d){if(angular.isDefined(d.data)&&angular.isDefined(d.data.Message))g.error(A,d.data.Message);else{var e=k.get(OptionNames.DentalMode);a.add_annotationID(y,m.divID,d.data);e&&b.hilightBorder("LoadAnn"+l.id,"1px","#ff0000");b.enable("LoadAnn"+l.id,function(){return c.hasPermission(PermissionNames.CanViewAnnotations)});b.enable("SaveAnn"+l.id,function(){return c.hasPermission(PermissionNames.CanStoreAnnotations)});
g.notify(u,x)}},function(a){var b="";b=angular.isDefined(a.status)?Utils.get_httpStatusText(a.status):a;f("DIALOGS_ERROR").then(function(a){g.error(a,b)})})})}}}}}}]);
commangular.command("OnCalibrateRuler",["seriesManagerService","toolbarService","tabService","$modal",function(a,b,d,c){return{execute:function(){var e=d.get_allTabs()[d.activeTab];b.isEnabled("CalibrateRuler"+e.id)&&c.open({templateUrl:"views/dialogs/CalibrateRuler.html",controller:Controllers.CalibrateRulerController,backdrop:"static"}).result.then(function(b){if(isNaN(b.length))alert("Invalid Length");else{var c=a.get_activeCell(),d=c.get_automation(),e=d.get_currentEditObject(),f=parseInt(b.unit,
10);if(b.applyToAll)for(c=c.get_frames().count;c--;)m=d.get_containers().item(c),m.get_mapper().calibrate(e.getRulerLength(1),0,lt.LeadLengthD.create(b.length),f),m.children.toArray().forEach(function(a,b){a instanceof lt.Annotations.Engine.AnnPolyRulerObject&&(a.measurementUnit=f)});else{var m=d.get_containers().item(a.get_activeSubCellIndex(c));m.get_mapper().calibrate(e.getRulerLength(1),0,lt.LeadLengthD.create(b.length),f);e.measurementUnit=f}}d.get_automationControl().automationInvalidate(lt.LeadRectD.empty)})}}}]);
function setAnnTool(a,b,d,c){a.isEnabled(d)&&(SetCurrentInteractiveMode(a,b,c,d,!1),enumerateCell(b,function(a){CommandManager.RunCommand(a,c,d)}))}
(function(a){var b=function(){function a(a,b,d,g,h,k,l,m,p){this._unknownString="Unknown";this._dateFormat=h.get(OptionNames.DateFormat);this._timeFormat=h.get(OptionNames.TimeFormat);this._scope=a;this._objectRetrieveService=m;a.gridOptions={columnDefs:[{headerName:"Tag",field:"tag",width:150,cellRenderer:{renderer:"group",innerRenderer:this.innerCellRenderer.bind(this)}},{headerName:"Name",field:"name",width:250},{headerName:"Value",field:"value",width:250}],rowData:this.buildData(k,[]),rowSelection:"multiple",
rowsAlreadyGrouped:!0,enableColResize:!0,enableSorting:!0,rowHeight:20,icons:{groupExpanded:'<i class="fa fa-minus-square-o"/>',groupContracted:'<i class="fa fa-plus-square-o"/>'},onGridReady:function(){a.gridOptions.api.hideOverlay()}};a.ok=function(){g.close()};p("UNKNOWN").then(function(a){this._unknownString=a}.bind(this));b.subscribe(EventNames.StackChanged,this.stackChanged.bind(this))}a.prototype.innerCellRenderer=function(a){return"SQ"==a.data.vr?'<span><i class="fa fa-tags" style="color: blue"></i>&nbsp;'+
a.data.tag+"</span>":'<span><i class="fa fa-tag" style="color: blue"></i>&nbsp;'+a.data.tag+"</span>"};a.prototype.buildData=function(a,b){for(var c in a){var d=new Models.DicomData(this.splitCamelCaseToString(a[c].keyword),c),e=new Models.DicomTagRow(d);d.name||(d.name=this._unknownString);d.vr=a[c].vr;if("PN"==a[c].vr)d.value=DicomHelper.getPatientNameFromTag(a[c]);else if("SQ"!=a[c].vr){var k=DicomHelper.getConvertValue(a[c]);"DA"==a[c].vr&&k&&(k=new Date(DicomHelper.parseDicomDate(k)),k=k.toString(this._dateFormat));
"TM"==a[c].vr&&k&&(k=Date.today().at(DicomHelper.parseDicomTime(k)),k=k.toString(this._timeFormat));d.value=k}else if(a[c].Value&&0<a[c].Value.length){k=a[c].Value.length;e.group=!0;e.expanded=!1;for(var l=0;l<k;l++)d=new Models.DicomData("Item","FFFEE000"),d=new Models.DicomTagRow(d),d.group=!0,d.expanded=!1,e.children.push(d),this.buildData(a[c].Value[l],d.children)}b.push(e)}return b};a.prototype.getDateTime=function(){return(new Date).toString(this._dateFormat+" "+this._timeFormat)};a.prototype.splitCamelCaseToString=
function(a){return a?a.replace(/(^[a-z]+)|[0-9]+|[A-Z][a-z]+|[A-Z]+(?=[A-Z][a-z]|[0-9])/g,function(a,b){b&&(a=a[0].toUpperCase()+a.substr(1));return a+" "}).trim():""};a.prototype.stackChanged=function(a,b){var c=b.args.frame;c&&null!=c.metadata?(a=this.buildData(c.metadata,[]),this._scope.gridOptions.api.setRowData(a)):c&&!c.metadata&&c.Instance&&this._objectRetrieveService.GetDicomJSON(c.Instance.StudyInstanceUID,c.Instance.SeriesInstanceUID,c.Instance.SOPInstanceUID).success(function(a){try{if(c.metadata=
JSON.parse(a),c.metadata){var b=this.buildData(c.metadata,[]);this._scope.gridOptions.api.setRowData(b)}}catch(k){console.log(k)}}.bind(this))};a.$inject="$scope eventService toolbarService $modalInstance optionsService dicom frame objectRetrieveService $translate".split(" ");return a}();a.ViewDicomController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g){a.derivedInfo=g;a.editSeriesNumber=b.get(OptionNames.EnableSeriesNumberEdit);a.editProtocolName=b.get(OptionNames.EnableProtocolNameEdit);a.ok=function(){d.close(a.derivedInfo)};a.cancel=function(){d.dismiss("cancel")}}a.$inject=["$scope","optionsService","$modalInstance","derivedInfo"];return a}();a.SaveAsDerivedController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){return function(a,b){this.value=a;this.displayName=b;this.selectable=!0}}();a.ExportSource=b;var d=function(){function a(a,c,d,h){a.exportFormats=[];a.exportFormats.push(new Models.ExportImageFormat("BMP","Bmp",!0,!1));a.exportFormats.push(new Models.ExportImageFormat("JPG","Jpeg",!0,!1,!0));a.exportFormats.push(new Models.ExportImageFormat("JPG Lossless","JpegLossy",!0,!0));a.exportFormats.push(new Models.ExportImageFormat("PNG","Png",!0,!1));a.exportFormats.push(new Models.ExportImageFormat("TIF",
"Tif",!0,!0));a.exportFormats.push(new Models.ExportImageFormat("CMP","Cmp",!0,!1,!0));a.exportFormats.push(new Models.ExportImageFormat("PDF","PDF",!1,!1,!1,!0,!0));a.exportFormats.push(new Models.ExportImageFormat("DICOM","DicomGray",!1,!0));a.exportFormats.push(new Models.ExportImageFormat("DICOM Zip","DicomZip",!1,!0));a.exportOptions=new Models.ExportOptions;a.source={};a.source.selectedFormat=a.exportFormats[3];a.exportSources=[];a.exportSources.push(new b("PrintCurrentView","Print Current View"));
a.exportSources.push(new b("AllPatientImages","All Patient Images"));a.exportSources.push(new b("CurrentSeries","Current Series"));a.exportSources.push(new b("SelectedImages","Selected Images"));a.exportSources.push(new b("Layout","Current Series Layout"));h||(a.exportSources[3].selectable=!1);a.source.value=a.exportSources[0].value;a.passwordValid=function(){return a.exportOptions.DczPassword&&0<a.exportOptions.DczPassword.length};a.ok=function(){a.exportOptions.FileFormat="JpegLossy"==a.source.selectedFormat.Format?
"Jpg Lossless":a.source.selectedFormat.Format;a.exportOptions.LayoutImageWidth=0;d.close({options:a.exportOptions,source:a.source.value})};a.cancel=function(){d.dismiss("cancel")}}a.$inject=["$scope","optionsService","$modalInstance","hasLayout"];return a}();a.ExportController=d})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g,h,k,l,m,p){d.get(OptionNames.DateFormat);a.gridOptions={enableSorting:!0,enableRowSelection:!0,enableRowHeaderSelection:lt.LTHelper.device==lt.LTDevice.mobile||lt.LTHelper.device==lt.LTDevice.tablet,noUnselect:!1,multiSelect:!1,onRegisterApi:function(b){b.selection.on.rowSelectionChanged(a,function(b){a.selectedAnnotation=b.entity});a.gridapi=b},columnDefs:[{name:"Description",field:"ContentDescription",enableHiding:!1},{name:"Create Date",field:"CreationDate",
enableHiding:!1},{name:"Creator Name",field:"ContentCreatorName",enableHiding:!1}],data:h};a.selectedAnnotation=null;a.ok=function(){var c="";null!=a.selectedAnnotation&&(c=a.selectedAnnotation.SOPInstanceUID);b.close(c)};a.cancel=function(){b.dismiss("cancel")};a["delete"]=function(){l.DeleteAnnotations(a.selectedAnnotation.SOPInstanceUID).then(function(){var b=m.get_activeCell();m.remove_annotationID(p,b.divID,a.selectedAnnotation.SOPInstanceUID);a.selectedAnnotation=null},function(a){})};a.canDeleteAnnotations=
function(){return k.hasPermission(PermissionNames.CanDeleteAnnotations)&&null!=a.selectedAnnotation};a.onSelectRow=function(b,c){a.selectedAnnotation=c;a.$apply()};a.annotations=h}a.$inject="$scope $modalInstance optionsService eventService annotations authenticationService objectStoreService seriesManagerService seriesInstanceUID".split(" ");return a}();a.AnnotationsController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b){a.info={};a.info.description="";a.ok=function(){b.close(a.info.description)};a.cancel=function(){b.dismiss("cancel")}}a.$inject=["$scope","$modalInstance"];return a}();a.AnnotationsSaveController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g){var c=d.get_activeCellFrame().Instance.SOPInstanceUID;a.uiType="none";g.GetAudioGroupsCount(c).then(function(b){200==b.status&&(b.data&&0<b.data?(lt.LTHelper.OS==lt.LTOS.iOS&&lt.LTHelper.device==lt.LTDevice.tablet&&(a.uiType="download"),"download"!=a.uiType&&(a.uiType="playback"),a.href=g.BuildAudioUrl(c,0,"audio/wav")):a.uiType="none")},function(b){a.uiType="none"});a.close=function(){b.close()}}a.$inject=["$scope","$modalInstance","seriesManagerService",
"objectRetrieveService"];return a}();a.AudioController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g,h,k){a.enabled=!0;a.service=g;a.player={};a.player.currentFrame=g.currentFrame;a.first=function(){g.first()};a.previous=function(){g.previous()};a.stop=function(){g.stop()};a.play=function(){d.get_activeCell();g.start()};a.next=function(){g.next()};a.last=function(){g.last()};a.close=function(){b.close()};h.subscribe(EventNames.PlayerStopped,function(b,c){a.player.currentFrame=c.args.frame+1});g.set_frameChanged(function(b){a.player.currentFrame=b+
1})}a.$inject="$scope $modalInstance seriesManagerService cinePlayerService eventService safeApply".split(" ");return a}();a.CinePlayerController=b})(Controllers||(Controllers={}));
var InteractiveVerticalSlider=function(a){function b(b,c){var d=a.call(this)||this;d._unitSize=0;d._currentStep=0;d._inMin=!0;d._inMax=!1;d._screenY=0;d._isStarted=!1;d._workCompleted=null;d._stepChanged=null;a.prototype.set_enableMouseWheel.call(d,!1);d._scrollBar=b;d._steps=c;d._slider=document.createElement("div");d._slider.className="slider";d._scrollBar.appendChild(d._slider);d.createControl(d._scrollBar,d._scrollBar.parentElement,d._slider);lt.LTHelper.supportsTouch&&d.set_hitTestBuffer(15);
d.setupSlider();d.startListening();return d}__extends(b,a);b.prototype.setupSlider=function(){var a=this.calculateSliderHeight(this._steps);this._unitSize=(this._scrollBar.clientHeight-a)/Math.max(1,this._steps-1);var b=this.get_currentStep();this.set_currentStep(1);this._slider.style.height=a+"px";this._slider.style.position="absolute";this.set_currentStep(b)};b.prototype.calculateSliderHeight=function(a){a=this._scrollBar.clientHeight/(0==a?1:a);return 30<a?a:30};b.prototype.get_isWorking=function(){return this._isStarted};
b.prototype.get_currentStep=function(){return this._currentStep+1};b.prototype.set_currentStep=function(a){if(!(0>=a||a>this._steps)){--a;var b=$(this._scrollBar).offset().top;b=a*this._unitSize+b;$(this._slider).offset({top:b});this._currentStep=a}};b.prototype.updateSteps=function(a){var b=this.get_currentStep();this._steps=a;this._unitSize=this._screenY=0;this._inMin=!0;this._inMax=!1;this.setupSlider();this.set_currentStep(Math.min(b,a))};b.prototype.resetSteps=function(a){this._steps=a;this._unitSize=
this._screenY=0;this._inMin=!0;this._inMax=!1;this.setupSlider();this.set_currentStep(1)};b.prototype.add_stepChanged=function(a){this._stepChanged=ss.Delegate.combine(this._stepChanged,a)};b.prototype.remove_stepChanged=function(a){this._stepChanged=ss.Delegate.remove(this._stepChanged,a)};b.prototype.add_workCompleted=function(a){this._workCompleted=ss.Delegate.combine(this._workCompleted,a)};b.prototype.remove_workCompleted=function(a){this._workCompleted=ss.Delegate.remove(this._workCompleted,
a)};b.prototype.onDragStarted=function(b){1>=this._steps||isNaN(this._unitSize)||(a.prototype.onDragStarted.call(this,b),this._isStarted=!0,this._currentPosition=b.position)};b.prototype.onDragCompleted=function(a){this._isStarted&&(this._isStarted=!1,null!=this._workCompleted&&this._workCompleted(this,null))};b.prototype.onDragDelta=function(a){if(this._isStarted){var b=a.get_nativeEvent();null!=b.touches&&(b=b.touches[0]);var d=b.clientY;var f=d-this._screenY;a.get_position();a=$(this._scrollBar).offset().top;
var g=this._scrollBar.clientHeight+a-this._slider.clientHeight;b=b.clientY;var h=(b-a)/this._unitSize;this._screenY=d;if(0!=f){0<f?h=Math.ceil(h):0>f&&(h=Math.floor(h));0>h&&(h=0);h>this._steps-1&&(h=this._steps-1);b=h*this._unitSize+a;if(b<=a){if(this._inMin)return;this._inMin=!0;b=a}else this._inMin=!1;if(b>=g){if(this._inMax)return;this._inMax=!0;b=g}else this._inMax=!1;this._currentStep!=h&&(this._currentStep=h,$(this._slider).offset({top:b}),null!==this._stepChanged&&this._stepChanged(this,new StepChangedEventArgs(this.get_currentStep())))}}};
return b}(lt.Controls.InteractiveService),StepChangedEventArgs=function(a){function b(b){var c=a.call(this)||this;c._newIndex=b;return c}__extends(b,a);b.prototype.get_newIndex=function(){return this._newIndex};b.prototype.set_newIindex=function(a){this._newIndex=a};return b}(lt.LeadEventArgs);
(function(a){var b=function(){function a(a,b,d,g,h){function c(){var b=[];b.contrast=10*a.ipVals.contrast;b.brightness=10*a.ipVals.brightness;b.intensity=0;a.ipApi.applyIPCommand("ContrastBrightnessIntensity",b)}a.ipVals={contrast:0,brightness:0};a.slider={options:{stop:function(a,b){c()}}};a.frame=h.get_activeCellFrame();a.ipApi={};a.change=function(){c()};a.ok=function(){b.close(a.ipVals)};a.cancel=function(){b.dismiss("cancel")}}a.$inject=["$scope","$modalInstance","optionsService","eventService",
"seriesManagerService"];return a}();a.BrightnessContrastController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function b(b,d,f,g,h,k,l,m){var c=this,e=!1;this._modal=g;b.selectedServer=null;b.pacsConfig=Models.RemoteConfig.Factory(f.get(OptionNames.RemoteConfig));b.pacsConnections=[];c.filter(b.pacsConfig.servers,b.pacsConnections);b.gridOptions={enableSorting:!0,enableRowSelection:!0,enableRowHeaderSelection:lt.LTHelper.device==lt.LTDevice.mobile||lt.LTHelper.device==lt.LTDevice.tablet,noUnselect:!1,multiSelect:!1,onRegisterApi:function(a){b.gridApi=a;a.selection.on.rowSelectionChanged(b,
function(a){b.selectedServer=a.entity})},columnDefs:[{name:"AE Title",field:"AETitle",enableHiding:!1,displayName:"AE Title"},{name:"IP Address",field:"IPAddress",enableHiding:!1,displayName:"IP Address"},{name:"Port",field:"Port",enableHiding:!1},{name:"Default",field:"isDefault",enableHiding:!1}],data:b.pacsConnections};b.addPacsServer=function(){g.open({templateUrl:"views/dialogs/AddPacsServer.html",controller:a.AddPacsServerController,backdrop:"static",resolve:{server:function(){},clientAE:function(){return b.pacsConfig.client}}}).result.then(function(a){for(var d=
0;d<b.pacsConfig.servers.length;d++)a.isDefault&&(b.pacsConfig.servers[d].isDefault=!1);b.pacsConfig.servers.push(a);c.filter(b.pacsConfig.servers,b.pacsConnections)})};b.deletePacsServer=function(){var a=$.grep(b.pacsConfig.servers,function(a,c){return a.id==b.selectedServer.id&&"pacs"==a.type});0<a.length&&(a=b.pacsConfig.servers.indexOf(a[0]),b.pacsConfig.servers.splice(a,1),b.selectedServer=null,c.filter(b.pacsConfig.servers,b.pacsConnections))};b.editPacsServer=function(){g.open({templateUrl:"views/dialogs/AddPacsServer.html",
controller:a.AddPacsServerController,backdrop:"static",resolve:{server:function(){return b.selectedServer},clientAE:function(){return b.pacsConfig.client}}}).result.then(function(a){var d=$.grep(b.pacsConfig.servers,function(a,c){return a.id==b.selectedServer.id&&"pacs"==a.type});if(0<d.length){d=b.pacsConfig.servers.indexOf(d[0]);for(var e=0;e<b.pacsConfig.servers.length;e++)e!=d&&a.isDefault&&(b.pacsConfig.servers[e].isDefault=!1);b.pacsConfig.servers[d]=a;c.filter(b.pacsConfig.servers,b.pacsConnections)}})};
b.save=function(){var a={},d=JSON.stringify(b.pacsConfig);a[OptionNames.RemoteConfig]=d;f.saveDefaultOptions(a).success(function(){f.set(OptionNames.RemoteConfig,d);k.notify(c._notificationTitle,c._saveSuccessMsg);e=!0}).error(function(a){k.error(c._saveFailureMsg+": "+status)})};b.close=function(){d.close(e)};l("NOTIFY_PACSCONFIG_SAVE_SUCCESS").then(function(a){c._saveSuccessMsg=a});l("NOTIFY_PACSCONFIG_SAVE_FAILURE").then(function(a){c._saveFailureMsg=a});l("DIALOGS_NOTIFICATION").then(function(a){c._notificationTitle=
a})}b.prototype.filter=function(a,b){0<b.length&&b.splice(0,b.length);for(var c=0;c<a.length;c++)"pacs"==a[c].type&&b.push(a[c])};b.$inject="$scope $modalInstance optionsService $modal authenticationService dialogs $translate $timeout".split(" ");return b}();a.RemotePacsController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g,h,k,l,m){var c="",e="",f="",q="";a.title="DIALOGS_ADD_REMOTE_PACS_TITLE";d&&(a.title="DIALOGS_EDIT_REMOTE_PACS_TITLE","string"==typeof d.isDefault&&(d.isDefault="true"==d.isDefault?!0:!1));l("DIALOGS_NOTIFICATION").then(function(a){c=a});l("DIALOGS_ERROR").then(function(a){e=a});l("VERIFY_SUCCESS").then(function(a){f=a});l("VERIFY_FAILURE").then(function(a){q=a});a.server=d||new Models.PACSConnection;a.ok=function(){b.close(a.server)};a.cancel=function(){b.dismiss("cancel")};
a.verify=function(){k.start("Verifying Connection...");h.VerifyConnection(a.server,g).success(function(a){k.stop();0<a.replace(/(\r\n|\n|")/gm,"").length?m.error(e,q+": "+a):m.notify(c,f)}).error(function(a){k.stop();angular.isDefined(a.Message)?m.error(e,q+": "+a.Message):m.error(e,q+": "+a)})}}a.$inject="$scope $modalInstance server clientAE queryPacsService blockUI $translate dialogs".split(" ");return a}();a.AddPacsServerController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(){this.protocolName=this.description=this.number=""}Object.defineProperty(a.prototype,"number",{get:function(){return this._number},set:function(a){this._number=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"description",{get:function(){return this._description},set:function(a){this._description=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"protocolName",{get:function(){return this._protocolName},set:function(a){this._protocolName=
a},enumerable:!0,configurable:!0});return a}();a.DerivedInfo=b;b=function(){return function(){this.IncludeOverflowImages=this.BurnAnnotations=!1;this.LayoutImageWidth=150;this.PatientInfo=this.WhiteBackground=!0;this.PageHeight=this.PageWidth=0;this.ReduceGrayscaleTo8BitsSelected=!1;this.AnnotationsFileName=""}}();a.PrintOptions=b;b=function(){return function(b,c,d,f,g){this.referencedSOPInstanceUID=[];null!=b&&0<b.length&&this.referencedSOPInstanceUID.push(b);void 0!=c&&void 0!=d&&void 0!=f&&void 0!=
g&&(this.Position=new a.FramePosition(lt.LeadPointD.create(c,d),lt.LeadPointD.create(f,g)));this.NumberOfColumns=this.NumberOfRows=this.ImageBoxNumber=this.ColumnPosition=this.RowPosition=-1;this.ImageBoxLayoutType=e.Single;this.HorizontalJustification=a.FrameHorizontalJustification.Center;this.VerticalJustification=a.FrameVerticalJustification.Center;this.WindowWidth=this.WindowCenter=-1;this.ReferencedPresentationStateSOP="";this.ImageBoxTileVerticalDimension=this.ImageBoxTileHorizontalDimension=
1}}();a.ImageBox=b;(function(a){a[a.Looping=0]="Looping";a[a.Sweeping=1]="Sweeping";a[a.Stop=2]="Stop";a[a.SweepingStop=3]="SweepingStop";a[a.Backward=4]="Backward";a[a.BackwardStop=5]="BackwardStop";a[a.Shuffle=6]="Shuffle";a[a.ShuffleStop=7]="ShuffleStop"})(a.PlaybackSequencing||(a.PlaybackSequencing={}));b=function(){return function(){this.SeriesInstanceUID=this.StudyInstanceUID="";this.ImageBoxNumber=-1;this.AnnotationData=""}}();a.SeriesInfo=b;b=function(){return function(){this.SOPInstanceUID=
this.SOPClassUID="";this.FrameNumber=-1}}();a.FirstFrame=b;b=function(){return function(){this.Boxes=[];this.TemplateId=""}}();a.Layout=b;b=function(){function a(){this.Columns=this.Rows=-1;this.Series=[];this.Boxes=[];this.OtherStudies=[]}a.prototype.SeriesExists=function(a){if(null==this.Series)return!1;for(var b=0;b<this.Series.length;b++)if(this.Series[b].SeriesInstanceUID==a.SeriesInstanceUID&&this.Series[b].StudyInstanceUID==a.StudyInstanceUID)return!0;return!1};a.prototype.SeriesPush=function(a){null!=
this.Series&&0==this.SeriesExists(a)&&this.Series.push(a)};return a}();a.StudyLayout=b;b=function(){return function(){this.StudyInstanceUID="";this.Series=[]}}();a.OtherStudies=b;b=function(){return function(){this.CreateDICOMDIR=this.BurnAnnotations=!1;this.ImageCompression=1;this.IncludeOverflowImages=!1;this.LayoutImageWidth=150;this.FileFormat="BMP";this.Anonymize=this.ReduceGrayscaleTo8BitsSelected=!1;this.DczPassword="";this.IncludeViewer=!1;this.PatientInfo=this.WhiteBackground=!0}}();a.ExportOptions=
b;b=function(){function a(a,b,c,d,e,f,g){this._DisplayName=a;this._Format=b;this._CanReduceBitdepth=c;this._CanPreserveBitdepth=d;this._CanCompress=e||!1;this._WhiteBackground=f;this._PrintPatientInfo=g}Object.defineProperty(a.prototype,"WhiteBackground",{get:function(){return this._WhiteBackground},set:function(a){this._WhiteBackground!=a&&(this._WhiteBackground=a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"PrintPatientInfo",{get:function(){return this._PrintPatientInfo},
set:function(a){this._PrintPatientInfo!=a&&(this._PrintPatientInfo=a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"CanCompress",{get:function(){return this._CanCompress},set:function(a){this._CanCompress!=a&&(this._CanCompress=a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"CanReduceBitdepth",{get:function(){return this._CanReduceBitdepth},set:function(a){this._CanReduceBitdepth!=a&&(this._CanReduceBitdepth=a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"CanPreserveBitdepth",{get:function(){return this._CanPreserveBitdepth},set:function(a){this._CanPreserveBitdepth!=a&&(this._CanPreserveBitdepth=a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"DisplayName",{get:function(){return this._DisplayName},set:function(a){this._DisplayName!=a&&(this._DisplayName=a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"Format",{get:function(){return this._Format},set:function(a){this._Format!=a&&(this._Format=a)},enumerable:!0,
configurable:!0});return a}();a.ExportImageFormat=b;b=function(){return function(){this.ReferencedImageSequence=null;this.ImageSize={}}}();a.AnnUserData=b;b=function(){return function(){this.ReferencedSopInstanceUid=this.ReferencedSopClassUid="";this.ReferencedFrameNumber=[]}}();a.SopInstanceReference=b;b=function(){return function(){this.type=this.getType();this.id=UUID.generate();this.isDefault=!1;this.name=""}}();a.RemoteConnection=b;var d=function(a){function b(){var b=a.call(this)||this;b.AETitle=
"";b.IPAddress="";b.Port=0;return b}__extends(b,a);b.prototype.getType=function(){return"pacs"};b.prototype.getName=function(){return this.AETitle};b.Factory=function(a){var c=new b;c.AETitle=a.AETitle;c.IPAddress=a.IPAddress;c.Port=a.Port;c.id=a.id;c.name=a.AETitle;return c};return b}(b);a.PACSConnection=d;var c=function(a){function b(){var b=a.call(this)||this;b.dicomWebRoot="";b.wado="";b.qido="qido-rs";b.rs="wado-rs";b.stow="stow-rs";b.stowMaxFiles=0;b.stowMaxFileSize=0;b.title="";return b}__extends(b,
a);b.prototype.getType=function(){return"wado"};b.prototype.getName=function(){return this.title};b.Factory=function(a){var c=new b;c.dicomWebRoot=a.dicomWebRoot;c.wado=a.wado;c.qido=a.qido;c.rs=a.rs;c.stow=a.stow;c.stowMaxFiles=a.stowMaxFiles;c.stowMaxFileSize=a.stowMaxFileSize;c.title=a.title;c.id=a.id;c.name=a.title;return c};return b}(b);a.WadoConnection=c;b=function(){function a(){this.client="";this.servers=[]}a.Factory=function(b){var e=new a;if(b&&0<b.length){b=JSON.parse(b);e.client=b.client;
for(var f=0;f<b.servers.length;f++)"pacs"===b.servers[f].type?e.servers.push(d.Factory(b.servers[f])):"wado"===b.servers[f].type?e.servers.push(c.Factory(b.servers[f])):console.error("unsupported object for remote connection")}return e};return a}();a.RemoteConfig=b;b=function(){return function(){this.Id="";this.Client=this.Server=null;this.SOPInstanceUID=this.SeriesInstanceUID=this.StudyInstanceUID=this.PatientID="";this.Status=DownloadStatus.Idle;this.UserData=this.ErrorMessage="";this.Open=!1}}();
a.DownloadInfo=b;b=function(){return function(){this.Modality=this.SeriesDescription=this.SeriesNumber=this.StudyDescription=this.PatientName=this.PatientId=""}}();a.SeriesExtraInformation=b;b=function(){return function(){this.AssignedPermissions=[];this.Name=this.Description=""}}();a.Role=b;b=function(){return function(){this.Name=this.FriendlyName=this.Description=""}}();a.Permission=b;b=function(){return function(a,b,c,d){this.left=a;this.top=b;this.right=c;this.bottom=d}}();a.Box=b;b=function(){return function(a,
b,c){this.name=a;this.friendlyName=b;this.icon=c;this.boxes=[]}}();a.StudyLayoutOption=b;b=function(){function a(){this._Boxes=[];this._LayoutImageWidth=1024}Object.defineProperty(a.prototype,"BurnAnnotations",{get:function(){return this._BurnAnnotations},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"LayoutImageWidth",{get:function(){return this._LayoutImageWidth},set:function(a){this._LayoutImageWidth=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"Boxes",
{get:function(){return this._Boxes},enumerable:!0,configurable:!0});return a}();a.PrintViewOptions=b;b=function(){return function(a,b){this.User=a;this.PatientId=b}}();a.UserPatientPermission=b;b=function(){return function(a,b){this.Role=a;this.PatientId=b}}();a.RolePatientPermission=b;b=function(){function a(){}Object.defineProperty(a,"COMPLETE",{get:function(){return 0},enumerable:!0,configurable:!0});Object.defineProperty(a,"PARTIAL",{get:function(){return 1},enumerable:!0,configurable:!0});Object.defineProperty(a,
"NONE",{get:function(){return 2},enumerable:!0,configurable:!0});return a}();a.MRTIStatus=b;var e;(function(a){a[a.Tiled=0]="Tiled";a[a.Stack=1]="Stack";a[a.Cine=2]="Cine";a[a.Processed=3]="Processed";a[a.Single=4]="Single"})(e=a.ImageBoxLayoutType||(a.ImageBoxLayoutType={}));(function(a){a[a.AE=0]="AE";a[a.AS=1]="AS";a[a.AT=2]="AT";a[a.CS=3]="CS";a[a.DA=4]="DA";a[a.DS=5]="DS";a[a.DT=6]="DT";a[a.FD=7]="FD";a[a.FL=8]="FL";a[a.IS=9]="IS";a[a.LO=10]="LO";a[a.LT=11]="LT";a[a.OB=12]="OB";a[a.OW=13]="OW";
a[a.PN=14]="PN";a[a.SH=15]="SH";a[a.SL=16]="SL";a[a.SQ=17]="SQ";a[a.SS=18]="SS";a[a.ST=19]="ST";a[a.TM=20]="TM";a[a.UI=21]="UI";a[a.UL=22]="UL";a[a.UN=23]="UN";a[a.US=24]="US";a[a.UT=25]="UT";a[a.OF=26]="OF";a[a.UR=27]="UR";a[a.UC=28]="UC";a[a.OD=29]="OD"})(a.ValueRepresentation||(a.ValueRepresentation={}));b=function(){function a(){this.HangingProtocolDescription=this.HangingProtocolName="";this.HangingProtocolLevel=g.Site;this.HangingProtocolCreator="";this.WCFHangingProtocolCreationDateTime=new Date;
this.HangingProtocolDefinitionSequence=[];this.NumberOfPriorsReferenced=0;this.ImageSetsSequence=[];this.HangingProtocolUserIdentificationCodeSequence=[];this.HangingProtocolUserGroupName=null;this.NumberOfScreens=1;this.NominalScreenDefinitionSequence=[];this.DisplaySets=[];this.PartialDataDisplayHandling=p.MaintainLayout;this.NavigationIndicatorSequence=this.SynchronizedScrollingSequence=null;this.Columns=this.Rows=-1}a.prototype.deleteSimilarFilterOperations=function(a){for(var b=this.DisplaySets.length-
1;0<=b;b--)for(var c=this.DisplaySets[b],d=c.FilterOperationsSequence.length-1;0<=d;d--)c.FilterOperationsSequence[d].isFilterOperationsEqual(a)&&c.FilterOperationsSequence.splice(d,1)};a.prototype.cloneFilterOperation=function(a){for(var b=this.DisplaySets.length,c=0;c<b;c++){var d=this.DisplaySets[c];if(0==d.existsFilterOperation(a)){for(var e=Utils.clone(a),f=d.metadata,g=null,h=null,k,l=a.WCFSelectorSequencePointer.split("\\"),n=a.WCFSelectorSequencePointerItems.split("\\"),m=0;m<l.length;m++){var p=
l[m].replace(":","");f.hasOwnProperty(p)&&(h=f[p],g=f,k=parseInt(n[m])-1,f=DicomHelper.get_TagValue(f,p,k))}f="";"PN"==h.vr?f=DicomHelper.getPatientNameFromTag(h):"SQ"!=h.vr?f=DicomHelper.getConvertValue(h):h.Value&&0<h.Value.length&&(h=l[l.length-1].replace(":",""),l=n.length-1,k=null,0<=l&&(k=n[l]),g=DicomHelper.getCodeSequenceList(g,h,k),0<g.length?(e.SelectorCodeSequenceValue=g,f=g[0].toFullString()):e=null);null!=e&&(e.SelectorValue=f,d.FilterOperationsSequence.push(e))}}};a.prototype.mergeFilterOperationValues=
function(a){for(var b=[],c=this.DisplaySets.length,d=0;d<c;d++)for(var e=this.DisplaySets[d],f=e.FilterOperationsSequence.length,g=0;g<f;g++){var h=e.FilterOperationsSequence[g];h.WCFSelectorAttribute==a.WCFSelectorAttribute&&-1==b.indexOf(h.SelectorValue)&&b.push(h.SelectorValue)}b=b.join("\\");for(d=0;d<c;d++)for(e=this.DisplaySets[d],f=e.FilterOperationsSequence.length,g=0;g<f;g++)h=e.FilterOperationsSequence[g],h.WCFSelectorAttribute==a.WCFSelectorAttribute&&(h.SelectorValue=b)};a.prototype.getNextImageSetNumber=
function(){for(var a=0,b=0;b<this.ImageSetsSequence.length;b++)this.ImageSetsSequence[b].TimeBasedImageSetsSequence.forEach(function(b){a<b.ImageSetNumber&&(a=b.ImageSetNumber)});return a+1};a.prototype.getNumberOfPriorsReferenced=function(){for(var a=0,b=0;b<this.ImageSetsSequence.length;b++)a+=this.ImageSetsSequence[b].TimeBasedImageSetsSequence.length-1;return a};a.prototype.updateImageSetSelectorValues=function(){};a.prototype.getTimeBasedImageSetLabel=function(a){for(var b="",c=0;c<this.ImageSetsSequence.length;c++)this.ImageSetsSequence[c].TimeBasedImageSetsSequence.forEach(function(c){a==
c.ImageSetNumber&&(b=c.ImageSetLabel)});return b};a.prototype.getCellMprTypeName=function(a){var b="";switch(a){case k.Axial:b="Axial";break;case k.Sagittal:b="Sagittal";break;case k.Coronal:b="Coronal";break;case k.None:b=""}return b};a.prototype.updateDisplaySetCombinedName=function(){for(var a=0;a<this.DisplaySets.length;a++){var b=this.DisplaySets[a];if(null!=b.ReformattingOperationInitialViewDirection){var c=this.getCellMprTypeName(b.ReformattingOperationInitialViewDirection);b.CombinedName=
b.DisplaySetLabel+" (MPR Reformatted "+c+") - "+this.getTimeBasedImageSetLabel(b.ImageSetNumber)}else b.CombinedName=b.DisplaySetLabel+" - "+this.getTimeBasedImageSetLabel(b.ImageSetNumber)}};a.prototype.sortFilterOperations=function(){for(var a=this.DisplaySets.length,b=0;b<a;b++)this.DisplaySets[b].sortFilterOperations()};return a}();a.HangingProtocol=b;b=function(){return function(){this.StudyDescription="";this.AnatomicRegionSequence=[];this.ProcedureCodeSequence=[];this.ReasonForRequestedProcedureCodeSequence=
[];this.Laterality=null;this.ProtocolName=this.BodyPartExamined="";this.ScheduledProtocolCodeSequence=this.RequestedProcedureCodeSequence=null}}();a.HangingProtocolDefinition=b;b=function(){function b(){this.ImageSetSelectorSequence=[];this.TimeBasedImageSetsSequence=[];this.Name=""}b.prototype.FindTimeBasedImageSetNumber=function(a){if(null==this.TimeBasedImageSetsSequence)return 0;for(var b=0;b<this.TimeBasedImageSetsSequence.length;b++)if(this.TimeBasedImageSetsSequence[b].StudyDateTime.equals(a))return this.TimeBasedImageSetsSequence[b].ImageSetNumber;
return 0};b.prototype.AddTimeBasedImageSet=function(a,b){var c=new f(b);c.StudyDateTime=a;this.TimeBasedImageSetsSequence.push(c);return b};b.prototype.splitCamelCaseToString=function(a){return a.split(/(?=[A-Z])/).join(" ")};b.prototype.UpdateImageSelectorItem=function(b,c,d){b=DicomHelper.getDicomTagValue(b,c);if(null!=b&&0!=b.length){b=b.trim();var e=null;this.ImageSetSelectorSequence.forEach(function(a){a.SelectorName===d&&(e=a)});if(null==e)e=new a.ImageSetSelector,e.ImageSetSelectorUsageFlag=
a.ImageSetSelectorUsage.Match,e.WCFSelectorAttribute=Utils.insert(c,4,":"),e.SelectorValueNumber=1,e.SelectorValue=b,e.SelectorName=d,this.ImageSetSelectorSequence.push(e);else{c=e.SelectorValue.split("\\");for(var f=!1,g=0;g<c.length;g++)if(c[g]==b){f=!0;break}f||(e.SelectorValue=e.SelectorValue+"\\"+b)}}};return b}();a.ImageSet=b;b=function(){return function(){this.ImageSetSelectorUsageFlag=h.Match;this.WCFSelectorAttribute="";this.SelectorValueNumber=0;this.SelectorAttributeVr=this.WCFSelectorSequencePointer=
this.SelectorName=this.SelectorValue="";this.SelectorCodeSequenceValue=[]}}();a.ImageSetSelector=b;var f=function(){return function(a){this.RelativeTime=[];this.AbstractPriorValue=[];this.ImageSetNumber=a}}();a.TimeBasedImageSet=f;b=function(){function b(){this.Boxes=[];this.DisplaySetHorizontalJustification=a.FrameHorizontalJustification.Center;this.DisplaySetVerticalJustification=a.FrameVerticalJustification.Center;this.FilterOperationsSequence=[];this.DisplaySetPatientOrientation=Array(2)}b.prototype.existsFilterOperation=
function(a){for(var b=!1,c=this.FilterOperationsSequence.length,d=0;d<c&&!(b=this.FilterOperationsSequence[d].isFilterOperationsEqual(a));d++);return b};b.prototype.dynamicSort=function(a){var b=1;"-"===a[0]&&(b=-1,a=a.substr(1));return function(c,d){return(c[a]<d[a]?-1:c[a]>d[a]?1:0)*b}};b.prototype.filterOperationCompare=function(a,b){return a.WCFSelectorAttribute.localeCompare(b.WCFSelectorAttribute)};b.prototype.sortFilterOperations=function(){this.FilterOperationsSequence.sort(this.filterOperationCompare)};
return b}();a.DisplaySet=b;b=function(){return function(){}}();a.HangingProtocolUserIdentificationCode=b;b=function(){return function(){}}();a.NominalScreenDefinition=b;b=function(){return function(){this.DisplaySetScrollingGroup=[]}}();a.SynchronizedScrolling=b;b=function(){return function(){}}();a.NavigationIndicator=b;b=function(){return function(){this.ValueMaximum=this.ValueMinimum=0}}();a.ValueRange=b;b=function(){function a(){this.ImageSetSelectorUsageFlag=h.Match;this.SelectorValue="";this.SelectorValueNumber=
0;this.WCFSelectorAttribute=this.SelectorName=""}a.prototype.isFilterOperationsEqual=function(a){return this.WCFSelectorAttribute==a.WCFSelectorAttribute&&this.WCFSelectorSequencePointer==a.WCFSelectorSequencePointer&&this.WCFSelectorSequencePointerItems==a.WCFSelectorSequencePointerItems};return a}();a.FilterOperation=b;b=function(){function a(){}a.prototype.Convert=function(a){Utils.isValidNumber(a.selectorAttribute)&&(this.SelectorAttribute=a.selectorAttribute,this.SelectorValueNumber=1);switch(a.sortByCategory){case lt.Controls.Medical.SortType.byAxis:this.SortByCategory=
l.AlongAxis;break;case lt.Controls.Medical.SortType.byAcquisitionTime:this.SortByCategory=l.ByAcquireTime}switch(a.order){case lt.Controls.Medical.SortOrder.ascending:this.SortingDirection=m.Increasing;break;case lt.Controls.Medical.SortOrder.descending:this.SortingDirection=m.Decreasing}};return a}();a.SortingOperations=b;b=function(){return function(){this.Creator=this.Description=this.Name="";this.HangingProtocolDefinitionSequence=[]}}();a.HangingProtocolQuery=b;b=function(){return function(){this.SOPInstanceUID=
this.Name="";this.Level=null}}();a.HangingProtocolQueryResult=b;b=function(){return function(a,b){this.name=a;this.tag=b;this.vr=this.value=""}}();a.DicomData=b;b=function(){return function(a){this.children=[];this.group=!1;this.expanded=!0;this.data=a}}();a.DicomTagRow=b;var g;(function(a){a[a.Manufacturer=0]="Manufacturer";a[a.Site=1]="Site";a[a.UserGroup=2]="UserGroup";a[a.SingleUser=3]="SingleUser"})(g=a.HangingProtocolLevel||(a.HangingProtocolLevel={}));var h;(function(a){a[a.Match=0]="Match";
a[a.NoMatch=1]="NoMatch"})(h=a.ImageSetSelectorUsage||(a.ImageSetSelectorUsage={}));(function(a){a[a.RelativeTime=0]="RelativeTime";a[a.AbstractPrior=1]="AbstractPrior"})(a.ImageSetSelectorCategory||(a.ImageSetSelectorCategory={}));(function(a){a[a.Seconds=0]="Seconds";a[a.Minutes=1]="Minutes";a[a.Hours=2]="Hours";a[a.Days=3]="Days";a[a.Weeks=4]="Weeks";a[a.Months=5]="Months";a[a.Years=6]="Years"})(a.RelativeTimeUnits||(a.RelativeTimeUnits={}));(function(a){a[a.Present=0]="Present";a[a.NotPresent=
1]="NotPresent"})(a.AttributePresence||(a.AttributePresence={}));(function(a){a[a.RangeInclusive=0]="RangeInclusive";a[a.RangeExclusive=1]="RangeExclusive";a[a.GreaterOrEqual=2]="GreaterOrEqual";a[a.LessOrEqual=3]="LessOrEqual";a[a.GreaterThan=4]="GreaterThan";a[a.LessThan=5]="LessThan";a[a.MemberOf=6]="MemberOf";a[a.NotMemberOf=7]="NotMemberOf"})(a.FilterByOperator||(a.FilterByOperator={}));var k;(function(a){a[a.None=-1]="None";a[a.Axial=0]="Axial";a[a.Sagittal=1]="Sagittal";a[a.Coronal=2]="Coronal"})(k=
a.InitialViewDirection||(a.InitialViewDirection={}));(function(a){a[a.Mpr=0]="Mpr";a[a.ThreeDRendering=1]="ThreeDRendering";a[a.Slab=2]="Slab"})(a.ReformattingOperationType||(a.ReformattingOperationType={}));(function(a){a[a.None=0]="None";a[a.Vertical=1]="Vertical";a[a.Horizontal=2]="Horizontal"})(a.ScrollDirection||(a.ScrollDirection={}));(function(a){a[a.None=0]="None";a[a.Page=1]="Page";a[a.RowColumn=2]="RowColumn";a[a.Image=3]="Image"})(a.ScrollType||(a.ScrollType={}));var l;(function(a){a[a.AlongAxis=
0]="AlongAxis";a[a.ByAcquireTime=1]="ByAcquireTime"})(l=a.SortByCategory||(a.SortByCategory={}));var m;(function(a){a[a.Increasing=0]="Increasing";a[a.Decreasing=1]="Decreasing"})(m=a.SortingDirection||(a.SortingDirection={}));var p;(function(a){a[a.Undefined=0]="Undefined";a[a.MaintainLayout=1]="MaintainLayout";a[a.AdaptLayout=2]="AdaptLayout"})(p=a.PartialDataDisplayHandling||(a.PartialDataDisplayHandling={}));(function(a){a[a.Undefined=0]="Undefined";a[a.Lung=1]="Lung";a[a.Mediastinum=2]="Mediastinum";
a[a.AbdoPelvis=3]="AbdoPelvis";a[a.Liver=4]="Liver";a[a.SoftTissue=5]="SoftTissue";a[a.Bone=6]="Bone";a[a.Brain=7]="Brain";a[a.PostFossa=8]="PostFossa";a[a.BrainT1=9]="BrainT1";a[a.BrainT2=10]="BrainT2";a[a.SagT2=11]="SagT2";a[a.HeadNeck=12]="HeadNeck";a[a.Spine=13]="Spine";a[a.AbdomenPelvisT1=14]="AbdomenPelvisT1";a[a.AbdomenPelvisT2=15]="AbdomenPelvisT2";a[a.LowContrast=16]="LowContrast";a[a.MediumContrast=17]="MediumContrast";a[a.HighContrast=18]="HighContrast"})(a.VoiType||(a.VoiType={}));(function(a){a.fromString=
function(b){return"LUNG"==b?a.Lung:"Mediastinum"==b?a.Mediastinum:"AbdoPelvis"==b?a.AbdoPelvis:"Liver"==b?a.Liver:"SoftTissue"==b?a.SoftTissue:"Bone"==b?a.Bone:"Brain"==b?a.Brain:"PostFossa"==b?a.PostFossa:a.Undefined}})(a.VoiType||(a.VoiType={}));b=function(){return function(a,b){this.name=b;this.id=a}}();a.DropDownItem=b;b=function(){return function(){this.volumeType="Volume";this.lowResQuality=.5;this.isoThreshold=50;this.showClippingFrame=this.showCrossLines=!1;this.showRotationCube=this.showVolumeBorder=
!0;this.resizeFactor=this.projectionMethod=1;this.highResQuality=1.2}}();a.Settings3DOptions=b})(Models||(Models={}));
(function(a){var b=function(){function a(a,b,d,g,h,k,l,m,p,n){var c=this,e,f;p("DIALOGS_CONFIRMATION_TITLE").then(function(a){e=a});p("DELETE_QUEUE_VIEW_CONFIRMATION").then(function(a){f=a});a.tabId="";a.filterQuery={};a.filterQuery.status=DownloadStatus.All;a.filterQuery.name="";a.filterQuery.server="";a.auto={};a.auto.refresh=!0;a.getJobHeader=function(a){var b=[];b.push("Status: "+c.get_statusString(a.Status));a.SeriesInfo&&(b.push("Name: "+a.SeriesInfo.PatientName),b.push("Series #: "+a.SeriesInfo.SeriesNumber),
b.push("Desc: "+a.SeriesInfo.SeriesDescription));a.Server&&b.push("Server: "+a.Server.AETitle);return b.join(", ")};var y=a.$watch("tabId",function(b,d){h.set_tabData(a.tabId,TabDataKeys.ViewController,c);h.set_tabData(a.tabId,TabDataKeys.Linked,!0);y()});b.subscribe(EventNames.DownloadSeries,$.proxy(this.DownloadSeries,this));b.subscribe(EventNames.SelectedTabChanged,function(b,d){d.args.currentTab.id!=a.tabId||c._isLoaded||(c._isLoaded=!0,g.loadUserQueue().success(function(b){a.downloads=b}).error(function(a){}))});
b.subscribe(EventNames.JobCreated,function(a,b){b.args.job.open=!0});b.subscribe(EventNames.JobUpdated,function(b,c){b=a.downloads.map(function(a){return a.Id}).indexOf(c.args.job.Id);-1!=b&&(b=a.downloads[b],b.Status=c.args.job.Status,b.ErrorMessage=c.args.job.ErrorMessage)});a.$watch("downloads",function(b,d){angular.isDefined(b)&&(b=$.grep(b,function(a,b){return a.Open}),0<b.length?b[0]!=c._openedJob&&(c._openedJob=b[0],c.selectedJobChanged(a,c._openedJob)):c._openedJob=null)},!0);a.statusChanged=
function(b){switch(parseInt(b)){case DownloadStatus.Idle:case DownloadStatus.Started:case DownloadStatus.All:a.canDeleteJob=!1;break;default:a.canDeleteJob=n.hasPermission(PermissionNames.CanDeleteDownloadInfo)}};a.refreshedChanged=function(a){g.autoRefresh(a)};a.deleteView=function(){var b=l("byJobInfo")(a.downloads,a.filterQuery);0<b.length&&m.confirm(e,f).result.then(function(c){var d=[];c=b.length;for(var e=0;e<c;e++)d.push(parseInt(b[e].Id));g.deleteJobs(d).success(function(){for(var b=d.length;b--;){var c=
a.downloads.map(function(a){return a.Id}).indexOf(d[b].toString());-1!=c&&a.downloads.splice(c,1)}}).error(function(a){})})};a.viewSeries=function(){if(c._openedJob&&c._openedJob.Status==DownloadStatus.Completed){var a={StudyInstanceUID:c._openedJob.StudyInstanceUID,PatientID:c._openedJob.SeriesInfo.PatientId};b.publish(EventNames.SeriesSelected,{study:a,series:{InstanceUID:c._openedJob.SeriesInstanceUID,StudyInstanceUID:a.StudyInstanceUID,Patient:{ID:c._openedJob.SeriesInfo.PatientId,Name:c._openedJob.SeriesInfo.PatientName}},
remote:!1})}};a.statusChanged(a.filterQuery.status);a.refreshedChanged(a.auto.refresh);this._seriesDownloadQueueService=g}a.prototype.get_statusString=function(a){if(null==a)return"Unknown";switch(a){case DownloadStatus.Idle:return"Idle";case DownloadStatus.Started:return"Started";case DownloadStatus.Completed:return"Completed";case DownloadStatus.Error:return"Error";case DownloadStatus.Aborted:return"Aborted"}return"Unknown"};a.prototype.DownloadSeries=function(a,b){a=new Models.SeriesExtraInformation;
b.args.studyInfo&&(b.args.studyInfo.Patient&&(a.PatientId=b.args.studyInfo.Patient.ID,a.PatientName=b.args.studyInfo.Patient.Name,b.args.seriesInfo.Patient=b.args.studyInfo.Patient),a.StudyDescription=b.args.studyInfo.Description);a.SeriesNumber=b.args.seriesInfo.Number;a.SeriesDescription=b.args.seriesInfo.Description;a.Modality=b.args.seriesInfo.Modality;this._seriesDownloadQueueService.downloadSeries(b.args.pacsClientInfo,b.args.clientAe,b.args.seriesInfo,a)};a.prototype.selectedJobChanged=function(a,
b){a.canViewJob=null==b||b.Status!=DownloadStatus.Completed?!1:!0};a.$inject="$scope eventService optionsService seriesDownloadQueueService tabService $timeout $filter dialogs $translate authenticationService".split(" ");return a}();a.UserQueueController=b})(Controllers||(Controllers={}));
filters.filter("byJobInfo",function(){return function(a,b){if(angular.isDefined(a))return $.grep(a,function(a,c){return(a.Status==b.status||b.status==DownloadStatus.All)&&(0==b.name.length||a.SeriesInfo&&angular.isDefined(a.SeriesInfo.PatientName)&&-1!=a.SeriesInfo.PatientName.search(new RegExp(b.name,"i")))&&(0==b.server.length||angular.isDefined(a.Server)&&-1!=a.Server.AETitle.search(new RegExp(b.server,"i")))})}});
(function(a){var b=function(){function a(a,b,d){a.edit={};a.canManageRoles=function(){return d.hasPermission(PermissionNames.CanManageRoles)};a.canManageUsers=function(){return d.hasPermission(PermissionNames.CanManageUsers)};a.ok=function(){b.close("ok")};a.cancel=function(){b.dismiss("cancel")};a.isFormValid=function(){return!0};a.canManageUsers()?a.edit.view="NewUser":a.edit.view="NewRole"}a.$inject=["$scope","$modalInstance","authenticationService"];return a}();a.PermissionsManagementController=
b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g,h){var c=this;a.username="";a.password="";a.confirmPassword="";a.validateOnAd=!1;a.validateOnIdP=!1;a.createUser=$.proxy(this.createUser,this);this._authenticationService=d;this._scope=a;this._dialogs=g;h("DIALOGS_NOTIFICATION").then(function(a){c._notifyTitle=a});h("DIALOGS_ERROR").then(function(a){c._errorTitle=a})}a.prototype.createUser=function(a,b,d,g){var c=this,e="classic";d?e="activedirectory":g&&(e="federatedIdP");this._authenticationService.createUser(a,
b,e).success(function(a){angular.isDefined(a.FaultType)?c._dialogs.error(c._errorTitle,a.Message):c._dialogs.notify(c._notifyTitle,"User created successfully.")}).error(function(a){angular.isDefined(a.FaultType)?c._dialogs.error(c._errorTitle,a.Message):c._dialogs.error(c._errorTitle,a)})};a.$inject=["$scope","optionsService","authenticationService","dialogs","$translate"];return a}();a.NewUserController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g,h){var c=this;a.role=null;a.selectedPermissions=[];a.deleteRole=$.proxy(this.deleteRole,this);a.roleChanged=$.proxy(this.roleChanged,this);a.updateRole=$.proxy(this.updateRole,this);this._authenticationService=d;this._dialogs=g;h("DIALOGS_NOTIFICATION").then(function(a){c._notifyTitle=a});h("DIALOGS_ERROR").then(function(a){c._errorTitle=a});d.getRoles().success(function(b){a.roles=b;a.roles&&0<a.roles.length&&(a.role=a.roles[0],c.roleChanged(a.role))}).error(function(a){});
d.getPermissions().success(function(b){a.permissions=b;c.roleChanged(a.role)}).error(function(a){});this._scope=a}a.prototype.deleteRole=function(a){var b=this;this._authenticationService.deleteRole(a.Name).success(function(c){angular.isDefined(c.FaultType)?b._dialogs.error(b._errorTitle,c.Message):(c=b._scope.roles.map(function(a){return a.Name}).indexOf(a.Name),b._dialogs.notify(b._notifyTitle,"Role ["+a.Name+"] deleted successfully."),-1!=c&&(b._scope.roles.splice(c,1),b._scope.selectedPermissions.length=
0))}).error(function(a){b._dialogs.error(b._errorTitle,a)})};a.prototype.roleChanged=function(a){this._scope.selectedPermissions.length=0;if(null!=a)for(var b=a.AssignedPermissions.length,c=0;c<b;c++)this._scope.selectedPermissions.push(a.AssignedPermissions[c])};a.prototype.updateRole=function(a,b){var c=this;this._authenticationService.updateRolePermissions(a.Name,b).success(function(d){angular.isDefined(d.FaultType)?c._dialogs.error(c._errorTitle,d.Message):(a.AssignedPermissions=b,c._dialogs.notify(c._notifyTitle,
"Role ["+a.Name+"] updated successfully."))}).error(function(a){c._dialogs.error(c._errorTitle,a)})};a.$inject=["$scope","optionsService","authenticationService","dialogs","$translate"];return a}();a.UpdateRoleController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g,h){var c=this;a.role="";a.createRole=$.proxy(this.createRole,this);this._authenticationService=d;this._dialogs=g;h("DIALOGS_NOTIFICATION").then(function(a){c._notifyTitle=a});h("DIALOGS_ERROR").then(function(a){c._errorTitle=a})}a.prototype.createRole=function(a,b){var c=this;this._authenticationService.createRole(a,b).success(function(b){angular.isDefined(b.FaultType)?c._dialogs.error(c._errorTitle,b.Message):c._dialogs.notify(c._notifyTitle,"Role ["+
a+"] created successfully.")}).error(function(a){c._dialogs.error(c._errorTitle,a)})};a.$inject=["$scope","optionsService","authenticationService","dialogs","$translate"];return a}();a.NewRoleController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g,h,k){var c=this;this._authenticationService=d;this._dialogs=g;this._userPermissions={};this._userRoles={};this._timeout=k;a.selectedPermissions=[];a.selectedRoles=[];a.password="";a.confirmPassword="";a.deleteUser=$.proxy(this.deleteUser,this);a.isCurrentUserSelected=$.proxy(this.isCurrentUserSelected,this);a.userChanged=$.proxy(this.userChanged,this);a.resetPassword=$.proxy(this.resetPassword,this);a.updateUser=$.proxy(this.updateUser,this);a.userHasPermission=
$.proxy(this.userHasPermission,this);h("DIALOGS_NOTIFICATION").then(function(a){c._notifyTitle=a});h("DIALOGS_ERROR").then(function(a){c._errorTitle=a});this._confirmDeleteUserTitle="Confirm Delete";h("DIALOGS_CONFIRMATION_DELETE_USER_TITLE").then(function(a){this._confirmDeleteUserTitle=a}.bind(this));this._confirmDeleteUserMessage="Are you sure you want to delete the currently selected user ({0})?";h("DIALOGS_CONFIRMATION_DELETE_USER_MESSAGE").then(function(a){this._confirmDeleteUserMessage=a}.bind(this));
d.getAllUsers().success(function(b){a.usersInfo={};a.users=[];if(b&&0<b.length)for(var e=0;e<b.length;e++){var f=b[e];f.UserName?(a.usersInfo[f.UserName]=f,a.users.push(f.UserName)):(a.usersInfo[f]=f,a.users.push(f))}a.users&&0<a.users.length&&(a.user=a.users[0]);d.getRoles().success(function(b){a.roles=b||[];d.getPermissions().success(function(b){a.permissions=b;c.userChanged(a.user)}).error(function(a){})}).error(function(a){})}).error(function(a){});a.canSetPermission=$.proxy(this.canSetPermission,
this);this._scope=a}a.prototype.deleteUser=function(a){var b=this,c=this._confirmDeleteUserMessage.format(a);this._dialogs.confirm(this._confirmDeleteUserTitle,c).result.then(function(c){"yes"==c&&b._authenticationService.deleteUser(a).success(function(c){angular.isDefined(c.FaultType)?b._dialogs.error(b._errorTitle,c.Message):(c=b._scope.users.map(function(a){return a}).indexOf(a),b._dialogs.notify(b._notifyTitle,"User ["+a+"] deleted successfully."),-1!=c&&(b._scope.users.splice(c,1),b._scope.selectedPermissions.length=
0,b._scope.selectedRoles.length=0))}).error(function(a){b._dialogs.error(b._errorTitle,a)})})};a.prototype.isCurrentUserSelected=function(a){var b=!1;null!=a&&(b=a==this._authenticationService.user);return b};a.prototype.userChanged=function(a){var b=this;this._scope.password="";this._scope.confirmPassword="";angular.isDefined(this._userRoles[a])?b._scope.selectedRoles=this._userRoles[a]:this._authenticationService.getUserRoles(a).success(function(c){b._scope.selectedRoles=c;b._userRoles[a]=angular.copy(b._scope.selectedRoles)}).error(function(a){b._dialogs.error(b._errorTitle,
a)});angular.isDefined(this._userPermissions[a])?b._scope.selectedPermissions=this._userPermissions[a]:this._authenticationService.getUserPermissions(a).success(function(a){b._scope.selectedPermissions=a}).error(function(a){b._dialogs.error(b._errorTitle,a)})};a.prototype.resetPassword=function(a,b){var c=this;this._authenticationService.validatePassword(b).success(function(d){0==d.length?c._authenticationService.resetPassword(a,b).success(function(b){angular.isDefined(b.FaultType)?c._dialogs.error(c._errorTitle,
b.Message):c._dialogs.notify(c._notifyTitle,"User ["+a+"] password reset successfully.")}).error(function(a){c._dialogs.error(c._errorTitle,a)}):c._dialogs.error(c._errorTitle,d)}).error(function(a){c._dialogs.error(c._errorTitle,a)})};a.prototype.canSetPermission=function(a){for(var b=this._scope.selectedRoles.length,c=0;c<b;c++){var d=this._scope.roles.map(function(a){return a.Name}).indexOf(this._scope.selectedRoles[c]);if(-1!=d&&-1!=this._scope.roles[d].AssignedPermissions.indexOf(a))return!1}return!0};
a.prototype.updateUser=function(a,b,d){for(var c=this._scope.roles.length,e=0;e<c;e++){var f=this._scope.roles[e].Name,l=b.map(function(a){return a}).indexOf(f);-1!=l?this.grantRole(a,f):this.denyRole(a,f)}c=this._scope.permissions.length;for(e=0;e<c;e++)b=this._scope.permissions[e].Name,l=d.map(function(a){return a}).indexOf(b),-1!=l?this.grantPermission(a,b):this.denyPermission(a,b);this._dialogs.notify(this._notifyTitle,"User ["+a+"] updated successfully.")};a.prototype.grantRole=function(a,b){var c=
this;this._authenticationService.grantRole(a,b).success(function(d){-1==c._userRoles[a].indexOf(b)&&c._userRoles[a].push(b)}).error(function(a){})};a.prototype.denyRole=function(a,b){var c=this;this._authenticationService.denyRole(a,b).success(function(d){d=c._userRoles[a].indexOf(b);-1!=d&&c._userRoles[a].slice(d,1)}).error(function(a){})};a.prototype.grantPermission=function(a,b){var c=this;this._authenticationService.grantPermission(a,b).success(function(d){c._userPermissions[a]&&-1==c._userPermissions[a].indexOf(b)&&
c._userPermissions[a].push(b)}).error(function(a){})};a.prototype.denyPermission=function(a,b){var c=this;this._authenticationService.denyPermission(a,b).success(function(d){c._userPermissions[a]&&(d=c._userPermissions[a].indexOf(b),-1!=d&&c._userPermissions[a].slice(d,1))}).error(function(a){})};a.prototype.userHasPermission=function(a,b){return angular.isDefined(this._userPermissions[a])?-1!=this._userPermissions[a].indexOf(b):!1};a.$inject="$scope optionsService authenticationService dialogs $translate $timeout".split(" ");
return a}();a.UpdateUserController=b})(Controllers||(Controllers={}));String.prototype.format||(String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,d){return"undefined"!=typeof a[d]?a[d]:b})});
commangular.command("OnSpyGlass",["toolbarService","tabService","buttonId",function(a,b,d){return{execute:function(){SpyglassEffect=Spyglass.Default;SetCurrentInteractiveMode(a,b,MedicalViewerAction.SpyGlass,d,!1);enumerateCell(b,function(a){a.getCommand(MedicalViewerAction.SpyGlass).tiling=!0;CommandManager.RunCommand(a,MedicalViewerAction.SpyGlass,d)})}}}]);
commangular.command("OnSpyGlassInvert",["toolbarService","tabService","buttonId",function(a,b,d){return{execute:function(){SpyglassEffect=Spyglass.Invert;SetCurrentInteractiveMode(a,b,MedicalViewerAction.SpyGlass,d,!1);enumerateCell(b,function(a){a.getCommand(MedicalViewerAction.SpyGlass).tiling=!0;CommandManager.RunCommand(a,MedicalViewerAction.SpyGlass,d)})}}}]);
commangular.command("OnSpyGlassEqualization",["toolbarService","tabService","buttonId",function(a,b,d){return{execute:function(){SpyglassEffect=Spyglass.Equalization;SetCurrentInteractiveMode(a,b,MedicalViewerAction.SpyGlass,d,!1);enumerateCell(b,function(a){a.getCommand(MedicalViewerAction.SpyGlass).tiling=!0;CommandManager.RunCommand(a,MedicalViewerAction.SpyGlass,d)})}}}]);
commangular.command("OnSpyGlassCLAHE",["toolbarService","tabService","buttonId",function(a,b,d){return{execute:function(){SpyglassEffect=Spyglass.CLAHE;SetCurrentInteractiveMode(a,b,MedicalViewerAction.SpyGlass,d,!1);enumerateCell(b,function(a){a.getCommand(MedicalViewerAction.SpyGlass).tiling=!0;CommandManager.RunCommand(a,MedicalViewerAction.SpyGlass,d)})}}}]);
(function(a){var b=function(){function a(a,b){a.calibration={};a.calibration.length=null;a.calibration.unit=6;a.calibration.applyToAll=!1;a.isValid=function(){return null!=a.calibration.length&&0<a.calibration.length.length};a.ok=function(){b.close(a.calibration)};a.cancel=function(){b.dismiss("cancel")}}a.$inject=["$scope","$modalInstance"];return a}();a.CalibrateRulerController=b})(Controllers||(Controllers={}));
var OverflowManager=function(){function a(a,d,c,e){this._injectorService=angular.element(document.getElementById("app")).injector();this._overflowTag=$(a);this._parent=this._overflowTag.find(".scroll-body-inner");0==this._parent.length&&(this._parent=this._overflowTag);this._loader=d;this._horizontal=angular.isDefined(e)?e:!0;this._overflowInstances=[];this._overflowInfo={};this._selectedImg=null;this._layout=c;this._dragDropBindings={};this.Initialize()}Object.defineProperty(a.prototype,"horizontal",
{get:function(){return this._horizontal},set:function(a){this._horizontal=a},enumerable:!0,configurable:!0});a.prototype.Initialize=function(){lt.LTHelper.getElementStyle(this._overflowTag[0],"position");this._overflowTag[0].style.border="0px";this._overflowTag[0].style.padding="0px";this._overflowTag[0].style.margin="0px"};a.prototype.add=function(a){setTimeout(function(){this._cellSize=this._horizontal?.9*this._overflowTag.height():.8*this._overflowTag.width();var b=$("<div style='position: relative; border: 0; background-color: black'></div>"),
c=this._cellSize+"px";b.width(c);b.height(c);this._horizontal?(b.css("margin-left","5px"),b.css("margin-right","0px"),b.css("margin-bottom","auto")):(b.css("margin-left","auto"),b.css("margin-right","auto"),b.css("margin-top","5px"),b.css("margin-bottom","0px"));b.attr("id",a.instance.SOPInstanceUID+"_parent");this._parent.append(b);this.horizontal&&(c=2*this._injectorService.get("optionsService").get(OptionNames.SeriesThumbnailWidth),150<c&&(c=150),b.css("margin-top",c/2-this._cellSize/2+"px"));
this.CreateViewer(b[0],a);this._overflowInfo[a.instance.SOPInstanceUID]=a;this._overflowInstances.push(a.instance.SOPInstanceUID)}.bind(this),500)};a.prototype.addInstances=function(a){a=a||[];var b=a.length;for(var c=0;c<b;c++)this.hasInstance(a[c].instance.SOPInstanceUID)||this.add(a[c])};a.prototype.hasInstance=function(a){return 0<this._parent.find("#"+a).length};a.prototype.clear=function(){this._parent.empty();this._overflowInstances=[];this._overflowInfo={}};a.prototype.get_overflowInstances=
function(){for(var a=[],d=0;d<this._overflowInstances.length;d++)angular.isDefined(this._overflowInstances[d])&&a.push(this._overflowInfo[this._overflowInstances[d]].instance);return a};a.prototype.CreateViewer=function(a,d){var b=document.createElement("img");this._injectorService.get("optionsService");var e=this._injectorService.get("authenticationService"),f=this._injectorService.get("app.config"),g=f.urls.serviceUrl+f.urls.objectRetrieveLocalServiceName;f=d.parentCell;var h=[];g=g+"/GetImage?"+
("auth="+encodeURIComponent(e.authenticationCode));g+="&instance="+d.instance.SOPInstanceUID;g=g+"&frame=0"+("&mime="+encodeURIComponent("image/jpeg"));g=g+"&bp=24&qf=10"+("&cx="+Math.ceil(this._cellSize));g+="&cy="+Math.ceil(this._cellSize);g+="&r="+Date.now();b.setAttribute("id",d.instance.SOPInstanceUID);b.src=g;b.alt="loading...";b.style.maxHeight="100%";b.style.maxWidth="100%";this._horizontal&&(b.style.display="block",b.style.margin="auto");for(e=0;e<f.imageViewer.items.count;e++)g=f.imageViewer.items.item(e),
$(g.overlayCanvas).data("subcell",g),h.push(g.overlayCanvas);f=new DragDrop.DragDropBinding({sources:[b],targets:h,anchors:[],onTargetUp:this.overlayItemDropped.bind(this),onMouseDown:this.onMouseDown.bind(this)});f.start();this._dragDropBindings[d.instance.SOPInstanceUID]=f;a.appendChild(b)};a.prototype.overlayItemDropped=function(a,d,c){a=$(c[0]).data("subcell");d=d.id;c=a.parentCell;var b=c.framesMappingIndex,f=!1,g=c.imageViewer.items.indexOf(a);b&&-1!=b[g]&&(f=!0);if(null!=a.attachedFrame||f)f=
a.attachedFrame,null==f&&(f=c.frames.item(b[g])),this.onInstanceSwap(null,{sopInstanceUID:d,cellFrame:f,frame:f.FrameIndex,instance:f.Instance,metadata:f.metadata,parentCell:c,subCell:a});else this.onInstanceAdd(null,{sopInstanceUID:d,parentCell:c,subCell:a})};a.prototype.onMouseDown=function(a,d){this._selectedImg!=d&&this.selectImg(d,this._selectedImg)};a.prototype.selectImg=function(a,d){null!=d&&(d.style.border="0px");null!=a&&(a.style.border="3px solid #5C880C",this._selectedImg=a)};a.prototype.onInstanceSwap=
function(a,d){a={frame:d.frame,instance:d.instance,metadata:d.metadata,parentCell:d.parentCell};var b=Utils.findFirst(d.parentCell.frames.toArray(),function(a){return a.Instance?a.Instance.SOPInstanceUID==d.sopInstanceUID:!1});b&&(d.parentCell.imageViewer.beginUpdate(),d.subCell.attachedFrame=b,d.subCell.isMapped=!0,this.add(a),this.removeInstance(d.sopInstanceUID),d.parentCell.imageViewer.endUpdate(),d.parentCell.onSizeChanged())};a.prototype.onInstanceAdd=function(a,d){if(a=Utils.findFirst(d.parentCell.frames.toArray(),
function(a){return a.Instance?a.Instance.SOPInstanceUID==d.sopInstanceUID:!1}))d.parentCell.imageViewer.beginUpdate(),d.subCell.isMapped=!0,d.subCell.attachedFrame=a,this.removeInstance(d.sopInstanceUID),d.parentCell.imageViewer.endUpdate(),d.parentCell.onSizeChanged()};a.prototype.removeInstance=function(a){var b=document.getElementById(a+"_parent");if(null!=b){var c=this._overflowInstances.indexOf(a);$(b).remove();-1!=c&&(this._overflowInstances.splice(c,1),delete this._overflowInfo[a],delete this._dragDropBindings[a],
0==this._overflowInstances.length&&this.checkCanClose(b))}};a.prototype.checkCanClose=function(a){null!=this._layout&&this._layout.api.closePane(this._layout.direction)};a.prototype.prepareCellFrame=function(a,d){var b=DicomHelper.GetDicomImageInformation(d.metadata);a.set_instanceNumber(d.instance.InstanceNumber);a.metadata=d.metadata;a.Instance=d.instance;a.FrameNumber=d.frame+1;a.FrameIndex=d.frame;if(0==d.frame){d.parentCell.frames.indexOf(a);d.parentCell.get_seriesInstanceUID();a.set_information(b);
a.set_imagePosition(b.position);a.set_imageType(b.imageType);a.set_lossyCompression(b.lossyImageCompression);a.isWaveForm=b.isWaveForm;d=b.get_width();var e=b.get_height();a.set_width(d);a.set_height(e);a.set_rowSpacing(b.rowSpacing);a.set_columnSpacing(b.columnSpacing);a.originalSize={width:b.get_width(),height:b.get_height()}}else b=DicomHelper.GetDicomImageInformation(d.metadata),a.set_information(b),a.originalSize={width:b.get_width(),height:b.get_height()},a.set_width(b.get_width()),a.set_height(b.get_height()),
a.isWaveForm=b.isWaveForm};return a}();
(function(a){var b=function(){function a(a,b,d){b=Utils.get_spacingSize();var c=this;a.layoutConfig={autoBindCustomButtons:!0,scrollToBookmarkOnLoad:!1,applyDemoStyles:!0,spacing_closed:2*b,spacing_open:2*b,livePaneResizing:!1,west__size:0,west__resizable:!1,west__togglerLength_closed:21,south__resizable:!1,south__initHidden:!0,south__togglerContent_open:"<span style='vertical-align:top; color:white; vertical-align:middle'>Overflow</span>",south__togglerLength_open:64,south__togglerContent_closed:"<span style='vertical-align:top; color:white'>Overflow</span>",
south__togglerLength_closed:64,east__initHidden:!0,east__resizable:!1,east__size:0,north__size:0,north__initHidden:!0,north__resizable:!1,north__showOverflowOnHover:!0};a.tabId="";a.viewerId=UUID.generate();a.viewerapi={};a.seriesList=[];this._scope=a;a.$watch("tabId",function(b,e){e=d.get_tabData(b,TabDataKeys.CompareInstances);var f=c.getGrid(e.length);d.set_tabData(a.tabId,TabDataKeys.ViewController,c);d.set_tabData(a.tabId,TabDataKeys.Linked,!0);a.viewerConfig=new MedicalViewerConfig;a.viewerConfig.rows=
f.rows;a.viewerConfig.columns=f.columns;a.viewerConfig.splitterSize=Utils.get_splitterSize();d.set_tabData(b,TabDataKeys.CompareInstances,null);$.each(e,function(b,c){b=new MedicalViewerSeries(c.InstanceUID,c.Patient.ID);b.forCompare=!0;a.seriesList.push(b)})})}a.prototype.getGrid=function(a){var b=Math.ceil(Math.sqrt(a));return{columns:Math.round(Math.ceil(a/b)),rows:b}};a.prototype.getViewer=function(){return this._scope.viewerapi.getMedicalViewer()};a.$inject=["$scope","toolbarService","tabService"];
return a}();a.CompareViewController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g,h,k,l){this._$scope=a;this._optionsService=b;a.customStudyLayoutOptions=this.GetLayoutFromXMLFile(0);a.layout=g;null!=g.custom&&(b=a.customStudyLayoutOptions.map(function(a){return a.Text}).indexOf(g.custom),-1!=b&&(a.layout.custom=a.customStudyLayoutOptions[b]));a.ok=function(){d.close(a.layout)};a.cancel=function(){d.dismiss("cancel")};a.isRowValid=this.isRowValid.bind(this);a.getIsRowValidError=this.getIsRowValidError.bind(this);a.isColumnValid=
this.isColumnValid.bind(this);a.getIsColumnValidError=this.getIsColumnValidError.bind(this);a.doHideCustomLayouts=this.doHideCustomLayouts.bind(this);a.isFormValid=this.isFormValid.bind(this);l.hasPermission(PermissionNames.CanViewTemplates)&&h.GetAllTemplates().success(function(b){var c=null;null!=g.custom?c=$.grep(b,function(a,b){return a.Id==g.custom}):b=$.grep(b,function(a,b){return a.Availability==Models.TemplateAvailability.Study||a.Availability==Models.TemplateAvailability.SeriesAndStudy});
a.templates=b;a.layout={rows:g.rows,columns:g.columns,custom:null};angular.isDefined(c)&&null!=c&&0<c.length&&(a.layout.custom=c[0])}.bind(this)).error(function(a){k.error(this._errorMesssage+": "+a)}.bind(this))}a.prototype.GetLayoutFromXMLFile=function(a){var b=new XMLHttpRequest;b.open("GET","StudyLayouts.xml",!1);b.send();b=$.parseXML(b.responseText).getElementsByTagName("Layout");for(var c=b.length-a,d=0,h=[],k,l,m;d<c;d++)for(h[d]=[],m=b[d+a].childElementCount,k=b[d+a].firstElementChild,l=b[d+
a].attributes,h[d].Icon=l.getNamedItem("icon").value,h[d].Text=l.getNamedItem("text").value,l=0;l<m;l++)h[d][l]=this.stringArrayToFloatArray(k.textContent),k=k.nextElementSibling;return h};a.prototype.stringArrayToFloatArray=function(a){a=a.split(",");if(null==a||!a.length)return null;var b,c=Array(a.length);for(b=0;b<a.length;b++)c[b]=parseFloat(a[b]);return c};a.prototype.doHideCustomLayouts=function(){var a=this._optionsService.get(OptionNames.HideCustomLayouts);null==a&&(a=!0);return a};a.prototype.isRowValid=
function(){return""==this.getIsRowValidError()};a.prototype.getIsRowValidError=function(){return $.isNumeric(this._$scope.layout.rows)?0>=this._$scope.layout.rows?"Must be greater than 0":"":"Must be numeric"};a.prototype.isColumnValid=function(){return""==this.getIsColumnValidError()};a.prototype.getIsColumnValidError=function(){return $.isNumeric(this._$scope.layout.columns)?0>=this._$scope.layout.columns?"Must be greater than 0":"":"Must be numeric"};a.prototype.isFormValid=function(){return this.isRowValid()&&
this.isColumnValid()};a.$inject="$scope optionsService $modalInstance layout templateService dialogs authenticationService".split(" ");return a}();a.StudyLayoutController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(){this._orientation=this._position=this._orientationOverlay=this._cineOptions=null;this._height=this._width=this._instanceNumber=this._columnSpacing=this._rowSpacing=0;this._patientOrientation=null}Object.defineProperty(a.prototype,"cineOptions",{get:function(){return this._cineOptions},set:function(a){this._cineOptions=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"orientationOverlay",{get:function(){return this._orientationOverlay},
set:function(a){this._orientationOverlay=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"position",{get:function(){return this._position},set:function(a){this._position=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"orientation",{get:function(){return this._orientation},set:function(a){this._orientation=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"rowSpacing",{get:function(){return this._rowSpacing},set:function(a){this._rowSpacing=
a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"columnSpacing",{get:function(){return this._columnSpacing},set:function(a){this._columnSpacing=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"instanceNumber",{get:function(){return this._instanceNumber},set:function(a){this._instanceNumber=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"width",{get:function(){return this._width},set:function(a){this._width=a},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"patientOrientation",{get:function(){return this._patientOrientation},set:function(a){this._patientOrientation=a},enumerable:!0,configurable:!0});return a}();a.FramePresentationInfo=b;b=function(){return function(){this.Parameters=this.Name=null}}();a.ImageProcessingFunction=b;(function(){return function(){this.height=this.width=
0;this.functions={}}})()})(Models||(Models={}));var DicomTag;
(function(a){a.FileMetaInformationGroupLength="00020000";a.FileMetaInformationVersion="00020001";a.MediaStorageSOPClassUID="00020002";a.MediaStorageSOPInstanceUID="00020003";a.TransferSyntaxUID="00020010";a.ImplementationClassUID="00020012";a.ImplementationVersionName="00020013";a.SourceApplicationEntityTitle="00020016";a.SendingApplicationEntityTitle="00020017";a.ReceivingApplicationEntityTitle="00020018";a.PrivateInformationCreatorUID="00020100";a.PrivateInformation="00020102";a.FileSetID="00041130";
a.FileSetDescriptorFileID="00041141";a.SpecificCharacterSetOfFileSetDescriptorFile="00041142";a.OffsetFirstRootDirectory="00041200";a.OffsetLastRootDirectory="00041202";a.FileSetConsistencyFlag="00041212";a.DirectoryRecordSequence="00041220";a.OffsetNextDirectory="00041400";a.RecordInUseFlag="00041410";a.OffsetChildDirectory="00041420";a.DirectoryRecordType="00041430";a.PrivateRecordUID="00041432";a.ReferencedFileID="00041500";a.MRDRDirectoryRecordOffset="00041504";a.ReferencedSOPClassUIDInFile="00041510";
a.ReferencedSOPInstanceUIDInFile="00041511";a.ReferencedTransferSyntaxUIDInFile="00041512";a.ReferencedRelatedGeneralSOPClassUIDInFile="0004151A";a.NumberOfReferences="00041600";a.LengthToEnd="00080001";a.SpecificCharacterSet="00080005";a.LanguageCodeSequence="00080006";a.ImageType="00080008";a.RecognitionCode="00080010";a.InstanceCreationDate="00080012";a.InstanceCreationTime="00080013";a.InstanceCreatorUID="00080014";a.InstanceCoercionDateTime="00080015";a.SOPClassUID="00080016";a.SOPInstanceUID=
"00080018";a.RelatedGeneralSOPClassUID="0008001A";a.OriginalSpecializedSOPClassUID="0008001B";a.StudyDate="00080020";a.SeriesDate="00080021";a.AcquisitionDate="00080022";a.ContentDate="00080023";a.OverlayDate="00080024";a.CurveDate="00080025";a.AcquisitionDateTime="0008002A";a.StudyTime="00080030";a.SeriesTime="00080031";a.AcquisitionTime="00080032";a.ContentTime="00080033";a.OverlayTime="00080034";a.CurveTime="00080035";a.DataSetType="00080040";a.DataSetSubtype="00080041";a.NuclearMedicineSeriesType=
"00080042";a.AccessionNumber="00080050";a.IssuerOfAccessionNumberSequence="00080051";a.QueryRetrieveLevel="00080052";a.QueryRetrieveView="00080053";a.RetrieveAETitle="00080054";a.InstanceAvailability="00080056";a.FailedSOPInstanceUIDList="00080058";a.Modality="00080060";a.ModalitiesInStudy="00080061";a.SOPClassesInStudy="00080062";a.ConversionType="00080064";a.PresentationIntentType="00080068";a.Manufacturer="00080070";a.InstitutionName="00080080";a.InstitutionAddress="00080081";a.InstitutionCodeSequence=
"00080082";a.ReferringPhysicianName="00080090";a.ReferringPhysicianAddress="00080092";a.ReferringPhysicianTelephoneNumbers="00080094";a.ReferringPhysicianIdentificationSequence="00080096";a.ConsultingPhysicianName="0008009C";a.ConsultingPhysicianIdentificationSequence="0008009D";a.CodeValue="00080100";a.ExtendedCodeValue="00080101";a.CodingSchemeDesignator="00080102";a.CodingSchemeVersion="00080103";a.CodeMeaning="00080104";a.MappingResource="00080105";a.ContextGroupVersion="00080106";a.ContextGroupLocalVersion=
"00080107";a.ExtendedCodeMeaning="00080108";a.ContextGroupExtensionFlag="0008010B";a.CodingSchemeUID="0008010C";a.ContextGroupExtensionCreatorUID="0008010D";a.ContextIdentifier="0008010F";a.CodingSchemeIdentificationSequence="00080110";a.CodingSchemeRegistry="00080112";a.CodingSchemeExternalID="00080114";a.CodingSchemeName="00080115";a.CodingSchemeResponsibleOrganization="00080116";a.ContextUID="00080117";a.MappingResourceUID="00080118";a.LongCodeValue="00080119";a.URNCodeValue="00080120";a.EquivalentCodeSequence=
"00080121";a.TimezoneOffsetFromUTC="00080201";a.PrivateDataElementCharacteristicsSequence="00080300";a.PrivateGroupReference="00080301";a.PrivateCreatorReference="00080302";a.BlockIdentifyingInformationStatus="00080303";a.NonidentifyingPrivateElements="00080304";a.DeidentificationActionSequence="00080305";a.IdentifyingPrivateElements="00080306";a.DeidentificationAction="00080307";a.NetworkID="00081000";a.StationName="00081010";a.StudyDescription="00081030";a.ProcedureCodeSequence="00081032";a.SeriesDescription=
"0008103E";a.SeriesDescriptionCodeSequence="0008103F";a.InstitutionalDepartmentName="00081040";a.PhysicianOfRecord="00081048";a.PhysicianOfRecordIdentificationSequence="00081049";a.PerformingPhysicianName="00081050";a.PerformingPhysicianIdentificationSequence="00081052";a.NameOfPhysicianReadingStudy="00081060";a.PhysicianReadingStudyIdentificationSequence="00081062";a.OperatorName="00081070";a.OperatorIdentificationSequence="00081072";a.AdmittingDiagnosesDescription="00081080";a.AdmittingDiagnosesCodeSequence=
"00081084";a.ManufacturerModelName="00081090";a.ReferencedResultsSequence="00081100";a.ReferencedStudySequence="00081110";a.ReferencedPerformedProcedureStepSequence="00081111";a.ReferencedSeriesSequence="00081115";a.ReferencedPatientSequence="00081120";a.ReferencedVisitSequence="00081125";a.ReferencedOverlaySequence="00081130";a.ReferencedStereometricInstanceSequence="00081134";a.ReferencedWaveformSequence="0008113A";a.ReferencedImageSequence="00081140";a.ReferencedCurveSequence="00081145";a.ReferencedInstanceSequence=
"0008114A";a.ReferencedRealWorldValueMappingInstanceSequence="0008114B";a.ReferencedSOPClassUID="00081150";a.ReferencedSOPInstanceUID="00081155";a.SOPClassesSupported="0008115A";a.ReferencedFrameNumber="00081160";a.SimpleFrameList="00081161";a.CalculatedFrameList="00081162";a.TimeRange="00081163";a.FrameExtractionSequence="00081164";a.MultiFrameSourceSOPInstanceUID="00081167";a.RetrieveURL="00081190";a.TransactionUID="00081195";a.WarningReason="00081196";a.FailureReason="00081197";a.FailedSOPSequence=
"00081198";a.ReferencedSOPSequence="00081199";a.StudiesContainingOtherReferencedInstancesSequence="00081200";a.RelatedSeriesSequence="00081250";a.LossyImageCompressionRetired="00082110";a.DerivationDescription="00082111";a.SourceImageSequence="00082112";a.StageName="00082120";a.StageNumber="00082122";a.NumberOfStages="00082124";a.ViewName="00082127";a.ViewNumber="00082128";a.NumberOfEventTimers="00082129";a.NumberOfViewsInStage="0008212A";a.EventElapsedTime="00082130";a.EventTimerName="00082132";
a.EventTimerSequence="00082133";a.EventTimeOffset="00082134";a.EventCodeSequence="00082135";a.StartTrim="00082142";a.StopTrim="00082143";a.RecommendedDisplayFrameRate="00082144";a.TransducerPosition="00082200";a.TransducerOrientation="00082204";a.AnatomicStructure="00082208";a.AnatomicRegionSequence="00082218";a.AnatomicRegionModifierSequence="00082220";a.PrimaryAnatomicStructureSequence="00082228";a.AnatomicStructureSpaceOrRegionSequence="00082229";a.PrimaryAnatomicStructureModifierSequence="00082230";
a.TransducerPositionSequence="00082240";a.TransducerPositionModifierSequence="00082242";a.TransducerOrientationSequence="00082244";a.TransducerOrientationModifierSequence="00082246";a.AnatomicStructureSpaceOrRegionCodeSequenceTrial="00082251";a.AnatomicPortalOfEntranceCodeSequenceTrial="00082253";a.AnatomicApproachDirectionCodeSequenceTrial="00082255";a.AnatomicPerspectiveDescriptionTrial="00082256";a.AnatomicPerspectiveCodeSequenceTrial="00082257";a.AnatomicLocationOfExaminingInstrumentDescriptionTrial=
"00082258";a.AnatomicLocationOfExaminingInstrumentCodeSequenceTrial="00082259";a.AnatomicStructureSpaceOrRegionModifierCodeSequenceTrial="0008225A";a.OnAxisBackgroundAnatomicStructureCodeSequenceTrial="0008225C";a.AlternateRepresentationSequence="00083001";a.IrradiationEventUID="00083010";a.SourceIrradiationEventSequence="00083011";a.RadiopharmaceuticalAdministrationEventUID="00083012";a.IdentifyingComments="00084000";a.FrameType="00089007";a.ReferencedImageEvidenceSequence="00089092";a.ReferencedRawDataSequence=
"00089121";a.CreatorVersionUID="00089123";a.DerivationImageSequence="00089124";a.SourceImageEvidenceSequence="00089154";a.PixelPresentation="00089205";a.VolumetricProperties="00089206";a.VolumeBasedCalculationTechnique="00089207";a.ComplexImageComponent="00089208";a.AcquisitionContrast="00089209";a.DerivationCodeSequence="00089215";a.ReferencedPresentationStateSequence="00089237";a.ReferencedOtherPlaneSequence="00089410";a.FrameDisplaySequence="00089458";a.RecommendedDisplayFrameRateInFloat="00089459";
a.SkipFrameRangeFlag="00089460";a.PatientName="00100010";a.PatientID="00100020";a.IssuerOfPatientID="00100021";a.TypeOfPatientID="00100022";a.IssuerOfPatientIDQualifiersSequence="00100024";a.PatientBirthDate="00100030";a.PatientBirthTime="00100032";a.PatientSex="00100040";a.PatientInsurancePlanCodeSequence="00100050";a.PatientPrimaryLanguageCodeSequence="00100101";a.PatientPrimaryLanguageModifierCodeSequence="00100102";a.QualityControlSubject="00100200";a.QualityControlSubjectTypeCodeSequence="00100201";
a.OtherPatientIDs="00101000";a.OtherPatientNames="00101001";a.OtherPatientIDsSequence="00101002";a.PatientBirthName="00101005";a.PatientAge="00101010";a.PatientSize="00101020";a.PatientSizeCodeSequence="00101021";a.PatientWeight="00101030";a.PatientAddress="00101040";a.InsurancePlanIdentification="00101050";a.PatientMotherBirthName="00101060";a.MilitaryRank="00101080";a.BranchOfService="00101081";a.MedicalRecordLocator="00101090";a.ReferencedPatientPhotoSequence="00101100";a.MedicalAlerts="00102000";
a.Allergies="00102110";a.CountryOfResidence="00102150";a.RegionOfResidence="00102152";a.PatientTelephoneNumbers="00102154";a.PatientTelecomInformation="00102155";a.EthnicGroup="00102160";a.Occupation="00102180";a.SmokingStatus="001021A0";a.AdditionalPatientHistory="001021B0";a.PregnancyStatus="001021C0";a.LastMenstrualDate="001021D0";a.PatientReligiousPreference="001021F0";a.PatientSpeciesDescription="00102201";a.PatientSpeciesCodeSequence="00102202";a.PatientSexNeutered="00102203";a.AnatomicalOrientationType=
"00102210";a.PatientBreedDescription="00102292";a.PatientBreedCodeSequence="00102293";a.BreedRegistrationSequence="00102294";a.BreedRegistrationNumber="00102295";a.BreedRegistryCodeSequence="00102296";a.ResponsiblePerson="00102297";a.ResponsiblePersonRole="00102298";a.ResponsibleOrganization="00102299";a.PatientComments="00104000";a.ExaminedBodyThickness="00109431";a.ClinicalTrialSponsorName="00120010";a.ClinicalTrialProtocolID="00120020";a.ClinicalTrialProtocolName="00120021";a.ClinicalTrialSiteID=
"00120030";a.ClinicalTrialSiteName="00120031";a.ClinicalTrialSubjectID="00120040";a.ClinicalTrialSubjectReadingID="00120042";a.ClinicalTrialTimePointID="00120050";a.ClinicalTrialTimePointDescription="00120051";a.ClinicalTrialCoordinatingCenterName="00120060";a.PatientIdentityRemoved="00120062";a.DeIdentificationMethod="00120063";a.DeIdentificationMethodCodeSequence="00120064";a.ClinicalTrialSeriesID="00120071";a.ClinicalTrialSeriesDescription="00120072";a.ClinicalTrialProtocolEthicsCommitteeName=
"00120081";a.ClinicalTrialProtocolEthicsCommitteeApprovalNumber="00120082";a.ConsentForClinicalTrialUseSequence="00120083";a.DistributionType="00120084";a.ConsentForDistributionFlag="00120085";a.CADFileFormat="00140023";a.ComponentReferenceSystem="00140024";a.ComponentManufacturingProcedure="00140025";a.ComponentManufacturer="00140028";a.MaterialThickness="00140030";a.MaterialPipeDiameter="00140032";a.MaterialIsolationDiameter="00140034";a.MaterialGrade="00140042";a.MaterialPropertiesDescription=
"00140044";a.MaterialPropertiesFileFormat="00140045";a.MaterialNotes="00140046";a.ComponentShape="00140050";a.CurvatureType="00140052";a.OuterDiameter="00140054";a.InnerDiameter="00140056";a.ActualEnvironmentalConditions="00141010";a.ExpiryDate="00141020";a.EnvironmentalConditions="00141040";a.EvaluatorSequence="00142002";a.EvaluatorNumber="00142004";a.EvaluatorName="00142006";a.EvaluationAttempt="00142008";a.IndicationSequence="00142012";a.IndicationNumber="00142014";a.IndicationLabel="00142016";
a.IndicationDescription="00142018";a.IndicationType="0014201A";a.IndicationDisposition="0014201C";a.IndicationROISequence="0014201E";a.IndicationPhysicalPropertySequence="00142030";a.PropertyLabel="00142032";a.CoordinateSystemNumberOfAxes="00142202";a.CoordinateSystemAxesSequence="00142204";a.CoordinateSystemAxisDescription="00142206";a.CoordinateSystemDataSetMapping="00142208";a.CoordinateSystemAxisNumber="0014220A";a.CoordinateSystemAxisType="0014220C";a.CoordinateSystemAxisUnits="0014220E";a.CoordinateSystemAxisValues=
"00142210";a.CoordinateSystemTransformSequence="00142220";a.TransformDescription="00142222";a.TransformNumberOfAxes="00142224";a.TransformOrderOfAxes="00142226";a.TransformedAxisUnits="00142228";a.CoordinateSystemTransformRotationAndScaleMatrix="0014222A";a.CoordinateSystemTransformTranslationMatrix="0014222C";a.InternalDetectorFrameTime="00143011";a.NumberOfFramesIntegrated="00143012";a.DetectorTemperatureSequence="00143020";a.SensorName="00143022";a.HorizontalOffsetOfSensor="00143024";a.VerticalOffsetOfSensor=
"00143026";a.SensorTemperature="00143028";a.DarkCurrentSequence="00143040";a.DarkCurrentCounts="00143050";a.GainCorrectionReferenceSequence="00143060";a.AirCounts="00143070";a.KVUsedInGainCalibration="00143071";a.MAUsedInGainCalibration="00143072";a.NumberOfFramesUsedForIntegration="00143073";a.FilterMaterialUsedInGainCalibration="00143074";a.FilterThicknessUsedInGainCalibration="00143075";a.DateOfGainCalibration="00143076";a.TimeOfGainCalibration="00143077";a.BadPixelImage="00143080";a.CalibrationNotes=
"00143099";a.PulserEquipmentSequence="00144002";a.PulserType="00144004";a.PulserNotes="00144006";a.ReceiverEquipmentSequence="00144008";a.AmplifierType="0014400A";a.ReceiverNotes="0014400C";a.PreAmplifierEquipmentSequence="0014400E";a.PreAmplifierNotes="0014400F";a.TransmitTransducerSequence="00144010";a.ReceiveTransducerSequence="00144011";a.NumberOfElements="00144012";a.ElementShape="00144013";a.ElementDimensionA="00144014";a.ElementDimensionB="00144015";a.ElementPitchA="00144016";a.MeasuredBeamDimensionA=
"00144017";a.MeasuredBeamDimensionB="00144018";a.LocationOfMeasuredBeamDiameter="00144019";a.NominalFrequency="0014401A";a.MeasuredCenterFrequency="0014401B";a.MeasuredBandwidth="0014401C";a.ElementPitchB="0014401D";a.PulserSettingsSequence="00144020";a.PulseWidth="00144022";a.ExcitationFrequency="00144024";a.ModulationType="00144026";a.Damping="00144028";a.ReceiverSettingsSequence="00144030";a.AcquiredSoundpathLength="00144031";a.AcquisitionCompressionType="00144032";a.AcquisitionSampleSize="00144033";
a.RectifierSmoothing="00144034";a.DACSequence="00144035";a.DACType="00144036";a.DACGainPoints="00144038";a.DACTimePoints="0014403A";a.DACAmplitude="0014403C";a.PreAmplifierSettingsSequence="00144040";a.TransmitTransducerSettingsSequence="00144050";a.ReceiveTransducerSettingsSequence="00144051";a.IncidentAngle="00144052";a.CouplingTechnique="00144054";a.CouplingMedium="00144056";a.CouplingVelocity="00144057";a.ProbeCenterLocationX="00144058";a.ProbeCenterLocationZ="00144059";a.SoundPathLength="0014405A";
a.DelayLawIdentifier="0014405C";a.GateSettingsSequence="00144060";a.GateThreshold="00144062";a.VelocityOfSound="00144064";a.CalibrationSettingsSequence="00144070";a.CalibrationProcedure="00144072";a.ProcedureVersion="00144074";a.ProcedureCreationDate="00144076";a.ProcedureExpirationDate="00144078";a.ProcedureLastModifiedDate="0014407A";a.CalibrationTime="0014407C";a.CalibrationDate="0014407E";a.ProbeDriveEquipmentSequence="00144080";a.DriveType="00144081";a.ProbeDriveNotes="00144082";a.DriveProbeSequence=
"00144083";a.ProbeInductance="00144084";a.ProbeResistance="00144085";a.ReceiveProbeSequence="00144086";a.ProbeDriveSettingsSequence="00144087";a.BridgeResistors="00144088";a.ProbeOrientationAngle="00144089";a.UserSelectedGainY="0014408B";a.UserSelectedPhase="0014408C";a.UserSelectedOffsetX="0014408D";a.UserSelectedOffsetY="0014408E";a.ChannelSettingsSequence="00144091";a.ChannelThreshold="00144092";a.ScannerSettingsSequence="0014409A";a.ScanProcedure="0014409B";a.TranslationRateX="0014409C";a.TranslationRateY=
"0014409D";a.ChannelOverlap="0014409F";a.ImageQualityIndicatorType="001440A0";a.ImageQualityIndicatorMaterial="001440A1";a.ImageQualityIndicatorSize="001440A2";a.LINACEnergy="00145002";a.LINACOutput="00145004";a.ActiveAperture="00145100";a.TotalAperture="00145101";a.ApertureElevation="00145102";a.MainLobeAngle="00145103";a.MainRoofAngle="00145104";a.ConnectorType="00145105";a.WedgeModelNumber="00145106";a.WedgeAngleFloat="00145107";a.WedgeRoofAngle="00145108";a.WedgeElement1Position="00145109";a.WedgeMaterialVelocity=
"0014510A";a.WedgeMaterial="0014510B";a.WedgeOffsetZ="0014510C";a.WedgeOriginOffsetX="0014510D";a.WedgeTimeDelay="0014510E";a.WedgeName="0014510F";a.WedgeManufacturerName="00145110";a.WedgeDescription="00145111";a.NominalBeamAngle="00145112";a.WedgeOffsetX="00145113";a.WedgeOffsetY="00145114";a.WedgeTotalLength="00145115";a.WedgeInContactLength="00145116";a.WedgeFrontGap="00145117";a.WedgeTotalHeight="00145118";a.WedgeFrontHeight="00145119";a.WedgeRearHeight="0014511A";a.WedgeTotalWidth="0014511B";
a.WedgeInContactWidth="0014511C";a.WedgeChamferHeight="0014511D";a.WedgeCurve="0014511E";a.RadiusAlongTheWedge="0014511F";a.ContrastBolusAgent="00180010";a.ContrastBolusAgentSequence="00180012";a.ContrastBolusT1Relaxivity="00180013";a.ContrastBolusAdministrationRouteSequence="00180014";a.BodyPartExamined="00180015";a.ScanningSequence="00180020";a.SequenceVariant="00180021";a.ScanOptions="00180022";a.MRAcquisitionType="00180023";a.SequenceName="00180024";a.AngioFlag="00180025";a.InterventionDrugInformationSequence=
"00180026";a.InterventionDrugStopTime="00180027";a.InterventionDrugDose="00180028";a.InterventionDrugCodeSequence="00180029";a.AdditionalDrugSequence="0018002A";a.Radionuclide="00180030";a.Radiopharmaceutical="00180031";a.EnergyWindowCenterline="00180032";a.EnergyWindowTotalWidth="00180033";a.InterventionDrugName="00180034";a.InterventionDrugStartTime="00180035";a.InterventionSequence="00180036";a.TherapyType="00180037";a.InterventionStatus="00180038";a.TherapyDescription="00180039";a.InterventionDescription=
"0018003A";a.CineRate="00180040";a.InitialCineRunState="00180042";a.SliceThickness="00180050";a.KVP="00180060";a.CountsAccumulated="00180070";a.AcquisitionTerminationCondition="00180071";a.EffectiveDuration="00180072";a.AcquisitionStartCondition="00180073";a.AcquisitionStartConditionData="00180074";a.AcquisitionTerminationConditionData="00180075";a.RepetitionTime="00180080";a.EchoTime="00180081";a.InversionTime="00180082";a.NumberOfAverages="00180083";a.ImagingFrequency="00180084";a.ImagedNucleus=
"00180085";a.EchoNumber="00180086";a.MagneticFieldStrength="00180087";a.SpacingBetweenSlices="00180088";a.NumberOfPhaseEncodingSteps="00180089";a.DataCollectionDiameter="00180090";a.EchoTrainLength="00180091";a.PercentSampling="00180093";a.PercentPhaseFieldOfView="00180094";a.PixelBandwidth="00180095";a.DeviceSerialNumber="00181000";a.DeviceUID="00181002";a.DeviceID="00181003";a.PlateID="00181004";a.GeneratorID="00181005";a.GridID="00181006";a.CassetteID="00181007";a.GantryID="00181008";a.SecondaryCaptureDeviceID=
"00181010";a.HardcopyCreationDeviceID="00181011";a.DateOfSecondaryCapture="00181012";a.TimeOfSecondaryCapture="00181014";a.SecondaryCaptureDeviceManufacturer="00181016";a.HardcopyDeviceManufacturer="00181017";a.SecondaryCaptureDeviceManufacturerModelName="00181018";a.SecondaryCaptureDeviceSoftwareVersions="00181019";a.HardcopyDeviceSoftwareVersion="0018101A";a.HardcopyDeviceManufacturerModelName="0018101B";a.SoftwareVersion="00181020";a.VideoImageFormatAcquired="00181022";a.DigitalImageFormatAcquired=
"00181023";a.ProtocolName="00181030";a.ContrastBolusRoute="00181040";a.ContrastBolusVolume="00181041";a.ContrastBolusStartTime="00181042";a.ContrastBolusStopTime="00181043";a.ContrastBolusTotalDose="00181044";a.SyringeCounts="00181045";a.ContrastFlowRate="00181046";a.ContrastFlowDuration="00181047";a.ContrastBolusIngredient="00181048";a.ContrastBolusIngredientConcentration="00181049";a.SpatialResolution="00181050";a.TriggerTime="00181060";a.TriggerSourceOrType="00181061";a.NominalInterval="00181062";
a.FrameTime="00181063";a.CardiacFramingType="00181064";a.FrameTimeVector="00181065";a.FrameDelay="00181066";a.ImageTriggerDelay="00181067";a.MultiplexGroupTimeOffset="00181068";a.TriggerTimeOffset="00181069";a.SynchronizationTrigger="0018106A";a.SynchronizationChannel="0018106C";a.TriggerSamplePosition="0018106E";a.RadiopharmaceuticalRoute="00181070";a.RadiopharmaceuticalVolume="00181071";a.RadiopharmaceuticalStartTime="00181072";a.RadiopharmaceuticalStopTime="00181073";a.RadionuclideTotalDose="00181074";
a.RadionuclideHalfLife="00181075";a.RadionuclidePositronFraction="00181076";a.RadiopharmaceuticalSpecificActivity="00181077";a.RadiopharmaceuticalStartDateTime="00181078";a.RadiopharmaceuticalStopDateTime="00181079";a.BeatRejectionFlag="00181080";a.LowRRValue="00181081";a.HighRRValue="00181082";a.IntervalsAcquired="00181083";a.IntervalsRejected="00181084";a.PVCRejection="00181085";a.SkipBeats="00181086";a.HeartRate="00181088";a.CardiacNumberOfImages="00181090";a.TriggerWindow="00181094";a.ReconstructionDiameter=
"00181100";a.DistanceSourceToDetector="00181110";a.DistanceSourceToPatient="00181111";a.EstimatedRadiographicMagnificationFactor="00181114";a.GantryDetectorTilt="00181120";a.GantryDetectorSlew="00181121";a.TableHeight="00181130";a.TableTraverse="00181131";a.TableMotion="00181134";a.TableVerticalIncrement="00181135";a.TableLateralIncrement="00181136";a.TableLongitudinalIncrement="00181137";a.TableAngle="00181138";a.TableType="0018113A";a.RotationDirection="00181140";a.AngularPosition="00181141";a.RadialPosition=
"00181142";a.ScanArc="00181143";a.AngularStep="00181144";a.CenterOfRotationOffset="00181145";a.RotationOffset="00181146";a.FieldOfViewShape="00181147";a.FieldOfViewDimension="00181149";a.ExposureTime="00181150";a.XRayTubeCurrent="00181151";a.Exposure="00181152";a.ExposureInUAs="00181153";a.AveragePulseWidth="00181154";a.RadiationSetting="00181155";a.RectificationType="00181156";a.RadiationMode="0018115A";a.ImageAndFluoroscopyAreaDoseProduct="0018115E";a.FilterType="00181160";a.TypeOfFilters="00181161";
a.IntensifierSize="00181162";a.ImagerPixelSpacing="00181164";a.Grid="00181166";a.GeneratorPower="00181170";a.CollimatorGridName="00181180";a.CollimatorType="00181181";a.FocalDistance="00181182";a.XFocusCenter="00181183";a.YFocusCenter="00181184";a.FocalSpot="00181190";a.AnodeTargetMaterial="00181191";a.BodyPartThickness="001811A0";a.CompressionForce="001811A2";a.PaddleDescription="001811A4";a.DateOfLastCalibration="00181200";a.TimeOfLastCalibration="00181201";a.DateTimeOfLastCalibration="00181202";
a.ConvolutionKernel="00181210";a.UpperLowerPixelValues="00181240";a.ActualFrameDuration="00181242";a.CountRate="00181243";a.PreferredPlaybackSequencing="00181244";a.ReceiveCoilName="00181250";a.TransmitCoilName="00181251";a.PlateType="00181260";a.PhosphorType="00181261";a.ScanVelocity="00181300";a.WholeBodyTechnique="00181301";a.ScanLength="00181302";a.AcquisitionMatrix="00181310";a.InPlanePhaseEncodingDirection="00181312";a.FlipAngle="00181314";a.VariableFlipAngleFlag="00181315";a.SAR="00181316";
a.DBDt="00181318";a.AcquisitionDeviceProcessingDescription="00181400";a.AcquisitionDeviceProcessingCode="00181401";a.CassetteOrientation="00181402";a.CassetteSize="00181403";a.ExposuresOnPlate="00181404";a.RelativeXRayExposure="00181405";a.ExposureIndex="00181411";a.TargetExposureIndex="00181412";a.DeviationIndex="00181413";a.ColumnAngulation="00181450";a.TomoLayerHeight="00181460";a.TomoAngle="00181470";a.TomoTime="00181480";a.TomoType="00181490";a.TomoClass="00181491";a.NumberOfTomosynthesisSourceImages=
"00181495";a.PositionerMotion="00181500";a.PositionerType="00181508";a.PositionerPrimaryAngle="00181510";a.PositionerSecondaryAngle="00181511";a.PositionerPrimaryAngleIncrement="00181520";a.PositionerSecondaryAngleIncrement="00181521";a.DetectorPrimaryAngle="00181530";a.DetectorSecondaryAngle="00181531";a.ShutterShape="00181600";a.ShutterLeftVerticalEdge="00181602";a.ShutterRightVerticalEdge="00181604";a.ShutterUpperHorizontalEdge="00181606";a.ShutterLowerHorizontalEdge="00181608";a.CenterOfCircularShutter=
"00181610";a.RadiusOfCircularShutter="00181612";a.VerticesOfThePolygonalShutter="00181620";a.ShutterPresentationValue="00181622";a.ShutterOverlayGroup="00181623";a.ShutterPresentationColorCIELabValue="00181624";a.CollimatorShape="00181700";a.CollimatorLeftVerticalEdge="00181702";a.CollimatorRightVerticalEdge="00181704";a.CollimatorUpperHorizontalEdge="00181706";a.CollimatorLowerHorizontalEdge="00181708";a.CenterOfCircularCollimator="00181710";a.RadiusOfCircularCollimator="00181712";a.VerticesOfThePolygonalCollimator=
"00181720";a.AcquisitionTimeSynchronized="00181800";a.TimeSource="00181801";a.TimeDistributionProtocol="00181802";a.NTPSourceAddress="00181803";a.PageNumberVector="00182001";a.FrameLabelVector="00182002";a.FramePrimaryAngleVector="00182003";a.FrameSecondaryAngleVector="00182004";a.SliceLocationVector="00182005";a.DisplayWindowLabelVector="00182006";a.NominalScannedPixelSpacing="00182010";a.DigitizingDeviceTransportDirection="00182020";a.RotationOfScannedFilm="00182030";a.BiopsyTargetSequence="00182041";
a.TargetUID="00182042";a.LocalizingCursorPosition="00182043";a.CalculatedTargetPosition="00182044";a.TargetLabel="00182045";a.DisplayedZValue="00182046";a.IVUSAcquisition="00183100";a.IVUSPullbackRate="00183101";a.IVUSGatedRate="00183102";a.IVUSPullbackStartFrameNumber="00183103";a.IVUSPullbackStopFrameNumber="00183104";a.LesionNumber="00183105";a.AcquisitionComments="00184000";a.OutputPower="00185000";a.TransducerData="00185010";a.FocusDepth="00185012";a.ProcessingFunction="00185020";a.PostprocessingFunction=
"00185021";a.MechanicalIndex="00185022";a.BoneThermalIndex="00185024";a.CranialThermalIndex="00185026";a.SoftTissueThermalIndex="00185027";a.SoftTissueFocusThermalIndex="00185028";a.SoftTissueSurfaceThermalIndex="00185029";a.DynamicRange="00185030";a.TotalGain="00185040";a.DepthOfScanField="00185050";a.PatientPosition="00185100";a.ViewPosition="00185101";a.ProjectionEponymousNameCodeSequence="00185104";a.ImageTransformationMatrix="00185210";a.ImageTranslationVector="00185212";a.Sensitivity="00186000";
a.SequenceOfUltrasoundRegions="00186011";a.RegionSpatialFormat="00186012";a.RegionDataType="00186014";a.RegionFlags="00186016";a.RegionLocationMinX0="00186018";a.RegionLocationMinY0="0018601A";a.RegionLocationMaxX1="0018601C";a.RegionLocationMaxY1="0018601E";a.ReferencePixelX0="00186020";a.ReferencePixelY0="00186022";a.PhysicalUnitsXDirection="00186024";a.PhysicalUnitsYDirection="00186026";a.ReferencePixelPhysicalValueX="00186028";a.ReferencePixelPhysicalValueY="0018602A";a.PhysicalDeltaX="0018602C";
a.PhysicalDeltaY="0018602E";a.TransducerFrequency="00186030";a.TransducerType="00186031";a.PulseRepetitionFrequency="00186032";a.DopplerCorrectionAngle="00186034";a.SteeringAngle="00186036";a.DopplerSampleVolumeXPositionRetired="00186038";a.DopplerSampleVolumeXPosition="00186039";a.DopplerSampleVolumeYPositionRetired="0018603A";a.DopplerSampleVolumeYPosition="0018603B";a.TMLinePositionX0Retired="0018603C";a.TMLinePositionX0="0018603D";a.TMLinePositionY0Retired="0018603E";a.TMLinePositionY0="0018603F";
a.TMLinePositionX1Retired="00186040";a.TMLinePositionX1="00186041";a.TMLinePositionY1Retired="00186042";a.TMLinePositionY1="00186043";a.PixelComponentOrganization="00186044";a.PixelComponentMask="00186046";a.PixelComponentRangeStart="00186048";a.PixelComponentRangeStop="0018604A";a.PixelComponentPhysicalUnits="0018604C";a.PixelComponentDataType="0018604E";a.NumberOfTableBreakPoints="00186050";a.TableOfXBreakPoints="00186052";a.TableOfYBreakPoints="00186054";a.NumberOfTableEntries="00186056";a.TableOfPixelValues=
"00186058";a.TableOfParameterValues="0018605A";a.RWaveTimeVector="00186060";a.DetectorConditionsNominalFlag="00187000";a.DetectorTemperature="00187001";a.DetectorType="00187004";a.DetectorConfiguration="00187005";a.DetectorDescription="00187006";a.DetectorMode="00187008";a.DetectorID="0018700A";a.DateOfLastDetectorCalibration="0018700C";a.TimeOfLastDetectorCalibration="0018700E";a.ExposuresOnDetectorSinceLastCalibration="00187010";a.ExposuresOnDetectorSinceManufactured="00187011";a.DetectorTimeSinceLastExposure=
"00187012";a.DetectorActiveTime="00187014";a.DetectorActivationOffsetFromExposure="00187016";a.DetectorBinning="0018701A";a.DetectorElementPhysicalSize="00187020";a.DetectorElementSpacing="00187022";a.DetectorActiveShape="00187024";a.DetectorActiveDimension="00187026";a.DetectorActiveOrigin="00187028";a.DetectorManufacturerName="0018702A";a.DetectorManufacturerModelName="0018702B";a.FieldOfViewOrigin="00187030";a.FieldOfViewRotation="00187032";a.FieldOfViewHorizontalFlip="00187034";a.PixelDataAreaOriginRelativeToFOV=
"00187036";a.PixelDataAreaRotationAngleRelativeToFOV="00187038";a.GridAbsorbingMaterial="00187040";a.GridSpacingMaterial="00187041";a.GridThickness="00187042";a.GridPitch="00187044";a.GridAspectRatio="00187046";a.GridPeriod="00187048";a.GridFocalDistance="0018704C";a.FilterMaterial="00187050";a.FilterThicknessMinimum="00187052";a.FilterThicknessMaximum="00187054";a.FilterBeamPathLengthMinimum="00187056";a.FilterBeamPathLengthMaximum="00187058";a.ExposureControlMode="00187060";a.ExposureControlModeDescription=
"00187062";a.ExposureStatus="00187064";a.PhototimerSetting="00187065";a.ExposureTimeInUS="00188150";a.XRayTubeCurrentInUA="00188151";a.ContentQualification="00189004";a.PulseSequenceName="00189005";a.MRImagingModifierSequence="00189006";a.EchoPulseSequence="00189008";a.InversionRecovery="00189009";a.FlowCompensation="00189010";a.MultipleSpinEcho="00189011";a.MultiPlanarExcitation="00189012";a.PhaseContrast="00189014";a.TimeOfFlightContrast="00189015";a.Spoiling="00189016";a.SteadyStatePulseSequence=
"00189017";a.EchoPlanarPulseSequence="00189018";a.TagAngleFirstAxis="00189019";a.MagnetizationTransfer="00189020";a.T2Preparation="00189021";a.BloodSignalNulling="00189022";a.SaturationRecovery="00189024";a.SpectrallySelectedSuppression="00189025";a.SpectrallySelectedExcitation="00189026";a.SpatialPreSaturation="00189027";a.Tagging="00189028";a.OversamplingPhase="00189029";a.TagSpacingFirstDimension="00189030";a.GeometryOfKSpaceTraversal="00189032";a.SegmentedKSpaceTraversal="00189033";a.RectilinearPhaseEncodeReordering=
"00189034";a.TagThickness="00189035";a.PartialFourierDirection="00189036";a.CardiacSynchronizationTechnique="00189037";a.ReceiveCoilManufacturerName="00189041";a.MRReceiveCoilSequence="00189042";a.ReceiveCoilType="00189043";a.QuadratureReceiveCoil="00189044";a.MultiCoilDefinitionSequence="00189045";a.MultiCoilConfiguration="00189046";a.MultiCoilElementName="00189047";a.MultiCoilElementUsed="00189048";a.MRTransmitCoilSequence="00189049";a.TransmitCoilManufacturerName="00189050";a.TransmitCoilType=
"00189051";a.SpectralWidth="00189052";a.ChemicalShiftReference="00189053";a.VolumeLocalizationTechnique="00189054";a.MRAcquisitionFrequencyEncodingSteps="00189058";a.DeCoupling="00189059";a.DeCoupledNucleus="00189060";a.DeCouplingFrequency="00189061";a.DeCouplingMethod="00189062";a.DeCouplingChemicalShiftReference="00189063";a.KSpaceFiltering="00189064";a.TimeDomainFiltering="00189065";a.NumberOfZeroFills="00189066";a.BaselineCorrection="00189067";a.ParallelReductionFactorInPlane="00189069";a.CardiacRRIntervalSpecified=
"00189070";a.AcquisitionDuration="00189073";a.FrameAcquisitionDateTime="00189074";a.DiffusionDirectionality="00189075";a.DiffusionGradientDirectionSequence="00189076";a.ParallelAcquisition="00189077";a.ParallelAcquisitionTechnique="00189078";a.InversionTimes="00189079";a.MetaboliteMapDescription="00189080";a.PartialFourier="00189081";a.EffectiveEchoTime="00189082";a.MetaboliteMapCodeSequence="00189083";a.ChemicalShiftSequence="00189084";a.CardiacSignalSource="00189085";a.DiffusionBValue="00189087";
a.DiffusionGradientOrientation="00189089";a.VelocityEncodingDirection="00189090";a.VelocityEncodingMinimumValue="00189091";a.VelocityEncodingAcquisitionSequence="00189092";a.NumberOfKSpaceTrajectories="00189093";a.CoverageOfKSpace="00189094";a.SpectroscopyAcquisitionPhaseRows="00189095";a.ParallelReductionFactorInPlaneRetired="00189096";a.TransmitterFrequency="00189098";a.ResonantNucleus="00189100";a.FrequencyCorrection="00189101";a.MRSpectroscopyFOVGeometrySequence="00189103";a.SlabThickness="00189104";
a.SlabOrientation="00189105";a.MidSlabPosition="00189106";a.MRSpatialSaturationSequence="00189107";a.MRTimingAndRelatedParametersSequence="00189112";a.MREchoSequence="00189114";a.MRModifierSequence="00189115";a.MRDiffusionSequence="00189117";a.CardiacSynchronizationSequence="00189118";a.MRAveragesSequence="00189119";a.MRFOVGeometrySequence="00189125";a.VolumeLocalizationSequence="00189126";a.SpectroscopyAcquisitionDataColumns="00189127";a.DiffusionAnisotropyType="00189147";a.FrameReferenceDateTime=
"00189151";a.MRMetaboliteMapSequence="00189152";a.ParallelReductionFactorOutOfPlane="00189155";a.SpectroscopyAcquisitionOutOfPlanePhaseSteps="00189159";a.BulkMotionStatus="00189166";a.ParallelReductionFactorSecondInPlane="00189168";a.CardiacBeatRejectionTechnique="00189169";a.RespiratoryMotionCompensationTechnique="00189170";a.RespiratorySignalSource="00189171";a.BulkMotionCompensationTechnique="00189172";a.BulkMotionSignalSource="00189173";a.ApplicableSafetyStandardAgency="00189174";a.ApplicableSafetyStandardDescription=
"00189175";a.OperatingModeSequence="00189176";a.OperatingModeType="00189177";a.OperatingMode="00189178";a.SpecificAbsorptionRateDefinition="00189179";a.GradientOutputType="00189180";a.SpecificAbsorptionRateValue="00189181";a.GradientOutput="00189182";a.FlowCompensationDirection="00189183";a.TaggingDelay="00189184";a.RespiratoryMotionCompensationTechniqueDescription="00189185";a.RespiratorySignalSourceID="00189186";a.ChemicalShiftMinimumIntegrationLimitInHz="00189195";a.ChemicalShiftMaximumIntegrationLimitInHz=
"00189196";a.MRVelocityEncodingSequence="00189197";a.FirstOrderPhaseCorrection="00189198";a.WaterReferencedPhaseCorrection="00189199";a.MRSpectroscopyAcquisitionType="00189200";a.RespiratoryCyclePosition="00189214";a.VelocityEncodingMaximumValue="00189217";a.TagSpacingSecondDimension="00189218";a.TagAngleSecondAxis="00189219";a.FrameAcquisitionDuration="00189220";a.MRImageFrameTypeSequence="00189226";a.MRSpectroscopyFrameTypeSequence="00189227";a.MRAcquisitionPhaseEncodingStepsInPlane="00189231";
a.MRAcquisitionPhaseEncodingStepsOutOfPlane="00189232";a.SpectroscopyAcquisitionPhaseColumns="00189234";a.CardiacCyclePosition="00189236";a.SpecificAbsorptionRateSequence="00189239";a.RFEchoTrainLength="00189240";a.GradientEchoTrainLength="00189241";a.ArterialSpinLabelingContrast="00189250";a.MRArterialSpinLabelingSequence="00189251";a.ASLTechniqueDescription="00189252";a.ASLSlabNumber="00189253";a.ASLSlabThickness="00189254";a.ASLSlabOrientation="00189255";a.ASLMidSlabPosition="00189256";a.ASLContext=
"00189257";a.ASLPulseTrainDuration="00189258";a.ASLCrusherFlag="00189259";a.ASLCrusherFlowLimit="0018925A";a.ASLCrusherDescription="0018925B";a.ASLBolusCutOffFlag="0018925C";a.ASLBolusCutOffTimingSequence="0018925D";a.ASLBolusCutOffTechnique="0018925E";a.ASLBolusCutOffDelayTime="0018925F";a.ASLSlabSequence="00189260";a.ChemicalShiftMinimumIntegrationLimitInPpm="00189295";a.ChemicalShiftMaximumIntegrationLimitInPpm="00189296";a.WaterReferenceAcquisition="00189297";a.EchoPeakPosition="00189298";a.CTAcquisitionTypeSequence=
"00189301";a.AcquisitionType="00189302";a.TubeAngle="00189303";a.CTAcquisitionDetailsSequence="00189304";a.RevolutionTime="00189305";a.SingleCollimationWidth="00189306";a.TotalCollimationWidth="00189307";a.CTTableDynamicsSequence="00189308";a.TableSpeed="00189309";a.TableFeedPerRotation="00189310";a.SpiralPitchFactor="00189311";a.CTGeometrySequence="00189312";a.DataCollectionCenterPatient="00189313";a.CTReconstructionSequence="00189314";a.ReconstructionAlgorithm="00189315";a.ConvolutionKernelGroup=
"00189316";a.ReconstructionFieldOfView="00189317";a.ReconstructionTargetCenterPatient="00189318";a.ReconstructionAngle="00189319";a.ImageFilter="00189320";a.CTExposureSequence="00189321";a.ReconstructionPixelSpacing="00189322";a.ExposureModulationType="00189323";a.EstimatedDoseSaving="00189324";a.CTXRayDetailsSequence="00189325";a.CTPositionSequence="00189326";a.TablePosition="00189327";a.ExposureTimeInMs="00189328";a.CTImageFrameTypeSequence="00189329";a.XRayTubeCurrentInMA="00189330";a.ExposureInMAs=
"00189332";a.ConstantVolumeFlag="00189333";a.FluoroscopyFlag="00189334";a.DistanceSourceToDataCollectionCenter="00189335";a.ContrastBolusAgentNumber="00189337";a.ContrastBolusIngredientCodeSequence="00189338";a.ContrastAdministrationProfileSequence="00189340";a.ContrastBolusUsageSequence="00189341";a.ContrastBolusAgentAdministered="00189342";a.ContrastBolusAgentDetected="00189343";a.ContrastBolusAgentPhase="00189344";a.CTDIvol="00189345";a.CTDIPhantomTypeCodeSequence="00189346";a.CalciumScoringMassFactorPatient=
"00189351";a.CalciumScoringMassFactorDevice="00189352";a.EnergyWeightingFactor="00189353";a.CTAdditionalXRaySourceSequence="00189360";a.ProjectionPixelCalibrationSequence="00189401";a.DistanceSourceToIsocenter="00189402";a.DistanceObjectToTableTop="00189403";a.ObjectPixelSpacingInCenterOfBeam="00189404";a.PositionerPositionSequence="00189405";a.TablePositionSequence="00189406";a.CollimatorShapeSequence="00189407";a.PlanesInAcquisition="00189410";a.XAXRFFrameCharacteristicsSequence="00189412";a.FrameAcquisitionSequence=
"00189417";a.XRayReceptorType="00189420";a.AcquisitionProtocolName="00189423";a.AcquisitionProtocolDescription="00189424";a.ContrastBolusIngredientOpaque="00189425";a.DistanceReceptorPlaneToDetectorHousing="00189426";a.IntensifierActiveShape="00189427";a.IntensifierActiveDimension="00189428";a.PhysicalDetectorSize="00189429";a.PositionOfIsocenterProjection="00189430";a.FieldOfViewSequence="00189432";a.FieldOfViewDescription="00189433";a.ExposureControlSensingRegionsSequence="00189434";a.ExposureControlSensingRegionShape=
"00189435";a.ExposureControlSensingRegionLeftVerticalEdge="00189436";a.ExposureControlSensingRegionRightVerticalEdge="00189437";a.ExposureControlSensingRegionUpperHorizontalEdge="00189438";a.ExposureControlSensingRegionLowerHorizontalEdge="00189439";a.CenterOfCircularExposureControlSensingRegion="00189440";a.RadiusOfCircularExposureControlSensingRegion="00189441";a.VerticesOfThePolygonalExposureControlSensingRegion="00189442";a.ColumnAngulationPatient="00189447";a.BeamAngle="00189449";a.FrameDetectorParametersSequence=
"00189451";a.CalculatedAnatomyThickness="00189452";a.CalibrationSequence="00189455";a.ObjectThicknessSequence="00189456";a.PlaneIdentification="00189457";a.FieldOfViewDimensionInFloat="00189461";a.IsocenterReferenceSystemSequence="00189462";a.PositionerIsocenterPrimaryAngle="00189463";a.PositionerIsocenterSecondaryAngle="00189464";a.PositionerIsocenterDetectorRotationAngle="00189465";a.TableXPositionToIsocenter="00189466";a.TableYPositionToIsocenter="00189467";a.TableZPositionToIsocenter="00189468";
a.TableHorizontalRotationAngle="00189469";a.TableHeadTiltAngle="00189470";a.TableCradleTiltAngle="00189471";a.FrameDisplayShutterSequence="00189472";a.AcquiredImageAreaDoseProduct="00189473";a.CArmPositionerTabletopRelationship="00189474";a.XRayGeometrySequence="00189476";a.IrradiationEventIdentificationSequence="00189477";a.XRay3DFrameTypeSequence="00189504";a.ContributingSourcesSequence="00189506";a.XRay3DAcquisitionSequence="00189507";a.PrimaryPositionerScanArc="00189508";a.SecondaryPositionerScanArc=
"00189509";a.PrimaryPositionerScanStartAngle="00189510";a.SecondaryPositionerScanStartAngle="00189511";a.PrimaryPositionerIncrement="00189514";a.SecondaryPositionerIncrement="00189515";a.StartAcquisitionDateTime="00189516";a.EndAcquisitionDateTime="00189517";a.PrimaryPositionerIncrementSign="00189518";a.SecondaryPositionerIncrementSign="00189519";a.ApplicationName="00189524";a.ApplicationVersion="00189525";a.ApplicationManufacturer="00189526";a.AlgorithmType="00189527";a.AlgorithmDescription="00189528";
a.XRay3DReconstructionSequence="00189530";a.ReconstructionDescription="00189531";a.PerProjectionAcquisitionSequence="00189538";a.DetectorPositionSequence="00189541";a.XRayAcquisitionDoseSequence="00189542";a.XRaySourceIsocenterPrimaryAngle="00189543";a.XRaySourceIsocenterSecondaryAngle="00189544";a.BreastSupportIsocenterPrimaryAngle="00189545";a.BreastSupportIsocenterSecondaryAngle="00189546";a.BreastSupportXPositionToIsocenter="00189547";a.BreastSupportYPositionToIsocenter="00189548";a.BreastSupportZPositionToIsocenter=
"00189549";a.DetectorIsocenterPrimaryAngle="00189550";a.DetectorIsocenterSecondaryAngle="00189551";a.DetectorXPositionToIsocenter="00189552";a.DetectorYPositionToIsocenter="00189553";a.DetectorZPositionToIsocenter="00189554";a.XRayGridSequence="00189555";a.XRayFilterSequence="00189556";a.DetectorActiveAreaTLHCPosition="00189557";a.DetectorActiveAreaOrientation="00189558";a.PositionerPrimaryAngleDirection="00189559";a.DiffusionBMatrixSequence="00189601";a.DiffusionBValueXX="00189602";a.DiffusionBValueXY=
"00189603";a.DiffusionBValueXZ="00189604";a.DiffusionBValueYY="00189605";a.DiffusionBValueYZ="00189606";a.DiffusionBValueZZ="00189607";a.DecayCorrectionDateTime="00189701";a.StartDensityThreshold="00189715";a.StartRelativeDensityDifferenceThreshold="00189716";a.StartCardiacTriggerCountThreshold="00189717";a.StartRespiratoryTriggerCountThreshold="00189718";a.TerminationCountsThreshold="00189719";a.TerminationDensityThreshold="00189720";a.TerminationRelativeDensityThreshold="00189721";a.TerminationTimeThreshold=
"00189722";a.TerminationCardiacTriggerCountThreshold="00189723";a.TerminationRespiratoryTriggerCountThreshold="00189724";a.DetectorGeometry="00189725";a.TransverseDetectorSeparation="00189726";a.AxialDetectorDimension="00189727";a.RadiopharmaceuticalAgentNumber="00189729";a.PETFrameAcquisitionSequence="00189732";a.PETDetectorMotionDetailsSequence="00189733";a.PETTableDynamicsSequence="00189734";a.PETPositionSequence="00189735";a.PETFrameCorrectionFactorsSequence="00189736";a.RadiopharmaceuticalUsageSequence=
"00189737";a.AttenuationCorrectionSource="00189738";a.NumberOfIterations="00189739";a.NumberOfSubsets="00189740";a.PETReconstructionSequence="00189749";a.PETFrameTypeSequence="00189751";a.TimeOfFlightInformationUsed="00189755";a.ReconstructionType="00189756";a.DecayCorrected="00189758";a.AttenuationCorrected="00189759";a.ScatterCorrected="00189760";a.DeadTimeCorrected="00189761";a.GantryMotionCorrected="00189762";a.PatientMotionCorrected="00189763";a.CountLossNormalizationCorrected="00189764";a.RandomsCorrected=
"00189765";a.NonUniformRadialSamplingCorrected="00189766";a.SensitivityCalibrated="00189767";a.DetectorNormalizationCorrection="00189768";a.IterativeReconstructionMethod="00189769";a.AttenuationCorrectionTemporalRelationship="00189770";a.PatientPhysiologicalStateSequence="00189771";a.PatientPhysiologicalStateCodeSequence="00189772";a.DepthOfFocus="00189801";a.ExcludedIntervalsSequence="00189803";a.ExclusionStartDateTime="00189804";a.ExclusionDuration="00189805";a.USImageDescriptionSequence="00189806";
a.ImageDataTypeSequence="00189807";a.DataType="00189808";a.TransducerScanPatternCodeSequence="00189809";a.AliasedDataType="0018980B";a.PositionMeasuringDeviceUsed="0018980C";a.TransducerGeometryCodeSequence="0018980D";a.TransducerBeamSteeringCodeSequence="0018980E";a.TransducerApplicationCodeSequence="0018980F";a.ZeroVelocityPixelValue="00189810";a.ContributingEquipmentSequence="0018A001";a.ContributionDateTime="0018A002";a.ContributionDescription="0018A003";a.StudyInstanceUID="0020000D";a.SeriesInstanceUID=
"0020000E";a.StudyID="00200010";a.SeriesNumber="00200011";a.AcquisitionNumber="00200012";a.InstanceNumber="00200013";a.IsotopeNumber="00200014";a.PhaseNumber="00200015";a.IntervalNumber="00200016";a.TimeSlotNumber="00200017";a.AngleNumber="00200018";a.ItemNumber="00200019";a.PatientOrientation="00200020";a.OverlayNumber="00200022";a.CurveNumber="00200024";a.LUTNumber="00200026";a.ImagePosition="00200030";a.ImagePositionPatient="00200032";a.ImageOrientation="00200035";a.ImageOrientationPatient="00200037";
a.Location="00200050";a.FrameOfReferenceUID="00200052";a.Laterality="00200060";a.ImageLaterality="00200062";a.ImageGeometryType="00200070";a.MaskingImage="00200080";a.ReportNumber="002000AA";a.TemporalPositionIdentifier="00200100";a.NumberOfTemporalPositions="00200105";a.TemporalResolution="00200110";a.SynchronizationFrameOfReferenceUID="00200200";a.SOPInstanceUIDOfConcatenationSource="00200242";a.SeriesInStudy="00201000";a.AcquisitionsInSeries="00201001";a.ImagesInAcquisition="00201002";a.ImagesInSeries=
"00201003";a.AcquisitionsInStudy="00201004";a.ImagesInStudy="00201005";a.Reference="00201020";a.PositionReferenceIndicator="00201040";a.SliceLocation="00201041";a.OtherStudyNumbers="00201070";a.NumberOfPatientRelatedStudies="00201200";a.NumberOfPatientRelatedSeries="00201202";a.NumberOfPatientRelatedInstances="00201204";a.NumberOfStudyRelatedSeries="00201206";a.NumberOfStudyRelatedInstances="00201208";a.NumberOfSeriesRelatedInstances="00201209";a.SourceImageIDs="00203100";a.ModifyingDeviceID="00203401";
a.ModifiedImageID="00203402";a.ModifiedImageDate="00203403";a.ModifyingDeviceManufacturer="00203404";a.ModifiedImageTime="00203405";a.ModifiedImageDescription="00203406";a.ImageComments="00204000";a.OriginalImageIdentification="00205000";a.OriginalImageIdentificationNomenclature="00205002";a.StackID="00209056";a.InStackPositionNumber="00209057";a.FrameAnatomySequence="00209071";a.FrameLaterality="00209072";a.FrameContentSequence="00209111";a.PlanePositionSequence="00209113";a.PlaneOrientationSequence=
"00209116";a.TemporalPositionIndex="00209128";a.NominalCardiacTriggerDelayTime="00209153";a.NominalCardiacTriggerTimePriorToRPeak="00209154";a.ActualCardiacTriggerTimePriorToRPeak="00209155";a.FrameAcquisitionNumber="00209156";a.DimensionIndexValues="00209157";a.FrameComments="00209158";a.ConcatenationUID="00209161";a.InConcatenationNumber="00209162";a.InConcatenationTotalNumber="00209163";a.DimensionOrganizationUID="00209164";a.DimensionIndexPointer="00209165";a.FunctionalGroupPointer="00209167";
a.UnassignedSharedConvertedAttributesSequence="00209170";a.UnassignedPerFrameConvertedAttributesSequence="00209171";a.ConversionSourceAttributesSequence="00209172";a.DimensionIndexPrivateCreator="00209213";a.DimensionOrganizationSequence="00209221";a.DimensionIndexSequence="00209222";a.ConcatenationFrameOffsetNumber="00209228";a.FunctionalGroupPrivateCreator="00209238";a.NominalPercentageOfCardiacPhase="00209241";a.NominalPercentageOfRespiratoryPhase="00209245";a.StartingRespiratoryAmplitude="00209246";
a.StartingRespiratoryPhase="00209247";a.EndingRespiratoryAmplitude="00209248";a.EndingRespiratoryPhase="00209249";a.RespiratoryTriggerType="00209250";a.RRIntervalTimeNominal="00209251";a.ActualCardiacTriggerDelayTime="00209252";a.RespiratorySynchronizationSequence="00209253";a.RespiratoryIntervalTime="00209254";a.NominalRespiratoryTriggerDelayTime="00209255";a.RespiratoryTriggerDelayThreshold="00209256";a.ActualRespiratoryTriggerDelayTime="00209257";a.ImagePositionVolume="00209301";a.ImageOrientationVolume=
"00209302";a.UltrasoundAcquisitionGeometry="00209307";a.ApexPosition="00209308";a.VolumeToTransducerMappingMatrix="00209309";a.VolumeToTableMappingMatrix="0020930A";a.VolumeToTransducerRelationship="0020930B";a.PatientFrameOfReferenceSource="0020930C";a.TemporalPositionTimeOffset="0020930D";a.PlanePositionVolumeSequence="0020930E";a.PlaneOrientationVolumeSequence="0020930F";a.TemporalPositionSequence="00209310";a.DimensionOrganizationType="00209311";a.VolumeFrameOfReferenceUID="00209312";a.TableFrameOfReferenceUID=
"00209313";a.DimensionDescriptionLabel="00209421";a.PatientOrientationInFrameSequence="00209450";a.FrameLabel="00209453";a.AcquisitionIndex="00209518";a.ContributingSOPInstancesReferenceSequence="00209529";a.ReconstructionIndex="00209536";a.LightPathFilterPassThroughWavelength="00220001";a.LightPathFilterPassBand="00220002";a.ImagePathFilterPassThroughWavelength="00220003";a.ImagePathFilterPassBand="00220004";a.PatientEyeMovementCommanded="00220005";a.PatientEyeMovementCommandCodeSequence="00220006";
a.SphericalLensPower="00220007";a.CylinderLensPower="00220008";a.CylinderAxis="00220009";a.EmmetropicMagnification="0022000A";a.IntraOcularPressure="0022000B";a.HorizontalFieldOfView="0022000C";a.PupilDilated="0022000D";a.DegreeOfDilation="0022000E";a.StereoBaselineAngle="00220010";a.StereoBaselineDisplacement="00220011";a.StereoHorizontalPixelOffset="00220012";a.StereoVerticalPixelOffset="00220013";a.StereoRotation="00220014";a.AcquisitionDeviceTypeCodeSequence="00220015";a.IlluminationTypeCodeSequence=
"00220016";a.LightPathFilterTypeStackCodeSequence="00220017";a.ImagePathFilterTypeStackCodeSequence="00220018";a.LensesCodeSequence="00220019";a.ChannelDescriptionCodeSequence="0022001A";a.RefractiveStateSequence="0022001B";a.MydriaticAgentCodeSequence="0022001C";a.RelativeImagePositionCodeSequence="0022001D";a.CameraAngleOfView="0022001E";a.StereoPairsSequence="00220020";a.LeftImageSequence="00220021";a.RightImageSequence="00220022";a.StereoPairsPresent="00220028";a.AxialLengthOfTheEye="00220030";
a.OphthalmicFrameLocationSequence="00220031";a.ReferenceCoordinates="00220032";a.DepthSpatialResolution="00220035";a.MaximumDepthDistortion="00220036";a.AlongScanSpatialResolution="00220037";a.MaximumAlongScanDistortion="00220038";a.OphthalmicImageOrientation="00220039";a.DepthOfTransverseImage="00220041";a.MydriaticAgentConcentrationUnitsSequence="00220042";a.AcrossScanSpatialResolution="00220048";a.MaximumAcrossScanDistortion="00220049";a.MydriaticAgentConcentration="0022004E";a.IlluminationWaveLength=
"00220055";a.IlluminationPower="00220056";a.IlluminationBandwidth="00220057";a.MydriaticAgentSequence="00220058";a.OphthalmicAxialMeasurementsRightEyeSequence="00221007";a.OphthalmicAxialMeasurementsLeftEyeSequence="00221008";a.OphthalmicAxialMeasurementsDeviceType="00221009";a.OphthalmicAxialLengthMeasurementsType="00221010";a.OphthalmicAxialLengthSequence="00221012";a.OphthalmicAxialLength="00221019";a.LensStatusCodeSequence="00221024";a.VitreousStatusCodeSequence="00221025";a.IOLFormulaCodeSequence=
"00221028";a.IOLFormulaDetail="00221029";a.KeratometerIndex="00221033";a.SourceOfOphthalmicAxialLengthCodeSequence="00221035";a.TargetRefraction="00221037";a.RefractiveProcedureOccurred="00221039";a.RefractiveSurgeryTypeCodeSequence="00221040";a.OphthalmicUltrasoundMethodCodeSequence="00221044";a.OphthalmicAxialLengthMeasurementsSequence="00221050";a.IOLPower="00221053";a.PredictedRefractiveError="00221054";a.OphthalmicAxialLengthVelocity="00221059";a.LensStatusDescription="00221065";a.VitreousStatusDescription=
"00221066";a.IOLPowerSequence="00221090";a.LensConstantSequence="00221092";a.IOLManufacturer="00221093";a.LensConstantDescription="00221094";a.ImplantName="00221095";a.KeratometryMeasurementTypeCodeSequence="00221096";a.ImplantPartNumber="00221097";a.ReferencedOphthalmicAxialMeasurementsSequence="00221100";a.OphthalmicAxialLengthMeasurementsSegmentNameCodeSequence="00221101";a.RefractiveErrorBeforeRefractiveSurgeryCodeSequence="00221103";a.IOLPowerForExactEmmetropia="00221121";a.IOLPowerForExactTargetRefraction=
"00221122";a.AnteriorChamberDepthDefinitionCodeSequence="00221125";a.LensThicknessSequence="00221127";a.AnteriorChamberDepthSequence="00221128";a.LensThickness="00221130";a.AnteriorChamberDepth="00221131";a.SourceOfLensThicknessDataCodeSequence="00221132";a.SourceOfAnteriorChamberDepthDataCodeSequence="00221133";a.SourceOfRefractiveMeasurementsSequence="00221134";a.SourceOfRefractiveMeasurementsCodeSequence="00221135";a.OphthalmicAxialLengthMeasurementModified="00221140";a.OphthalmicAxialLengthDataSourceCodeSequence=
"00221150";a.OphthalmicAxialLengthAcquisitionMethodCodeSequence="00221153";a.SignalToNoiseRatio="00221155";a.OphthalmicAxialLengthDataSourceDescription="00221159";a.OphthalmicAxialLengthMeasurementsTotalLengthSequence="00221210";a.OphthalmicAxialLengthMeasurementsSegmentalLengthSequence="00221211";a.OphthalmicAxialLengthMeasurementsLengthSummationSequence="00221212";a.UltrasoundOphthalmicAxialLengthMeasurementsSequence="00221220";a.OpticalOphthalmicAxialLengthMeasurementsSequence="00221225";a.UltrasoundSelectedOphthalmicAxialLengthSequence=
"00221230";a.OphthalmicAxialLengthSelectionMethodCodeSequence="00221250";a.OpticalSelectedOphthalmicAxialLengthSequence="00221255";a.SelectedSegmentalOphthalmicAxialLengthSequence="00221257";a.SelectedTotalOphthalmicAxialLengthSequence="00221260";a.OphthalmicAxialLengthQualityMetricSequence="00221262";a.OphthalmicAxialLengthQualityMetricTypeCodeSequence="00221265";a.OphthalmicAxialLengthQualityMetricTypeDescription="00221273";a.IntraocularLensCalculationsRightEyeSequence="00221300";a.IntraocularLensCalculationsLeftEyeSequence=
"00221310";a.ReferencedOphthalmicAxialLengthMeasurementQCImageSequence="00221330";a.OphthalmicMappingDeviceType="00221415";a.AcquisitionMethodCodeSequence="00221420";a.AcquisitionMethodAlgorithmSequence="00221423";a.OphthalmicThicknessMapTypeCodeSequence="00221436";a.OphthalmicThicknessMappingNormalsSequence="00221443";a.RetinalThicknessDefinitionCodeSequence="00221445";a.PixelValueMappingToCodedConceptSequence="00221450";a.MappedPixelValue="00221452";a.PixelValueMappingExplanation="00221454";a.OphthalmicThicknessMapQualityThresholdSequence=
"00221458";a.OphthalmicThicknessMapThresholdQualityRating="00221460";a.AnatomicStructureReferencePoint="00221463";a.RegistrationToLocalizerSequence="00221465";a.RegisteredLocalizerUnits="00221466";a.RegisteredLocalizerTopLeftHandCorner="00221467";a.RegisteredLocalizerBottomRightHandCorner="00221468";a.OphthalmicThicknessMapQualityRatingSequence="00221470";a.RelevantOPTAttributesSequence="00221472";a.TransformationMethodCodeSequence="00221512";a.TransformationAlgorithmSequence="00221513";a.OphthalmicAxialLengthMethod=
"00221515";a.OphthalmicFOV="00221517";a.TwoDimensionalToThreeDimensionalMapSequence="00221518";a.WideFieldOphthalmicPhotographyQualityRatingSequence="00221525";a.WideFieldOphthalmicPhotographyQualityThresholdSequence="00221526";a.WideFieldOphthalmicPhotographyThresholdQualityRating="00221527";a.XCoordinatesCenterPixelViewAngle="00221528";a.YCoordinatesCenterPixelViewAngle="00221529";a.NumberOfMapPoints="00221530";a.TwoDimensionalToThreeDimensionalMapData="00221531";a.VisualFieldHorizontalExtent="00240010";
a.VisualFieldVerticalExtent="00240011";a.VisualFieldShape="00240012";a.ScreeningTestModeCodeSequence="00240016";a.MaximumStimulusLuminance="00240018";a.BackgroundLuminance="00240020";a.StimulusColorCodeSequence="00240021";a.BackgroundIlluminationColorCodeSequence="00240024";a.StimulusArea="00240025";a.StimulusPresentationTime="00240028";a.FixationSequence="00240032";a.FixationMonitoringCodeSequence="00240033";a.VisualFieldCatchTrialSequence="00240034";a.FixationCheckedQuantity="00240035";a.PatientNotProperlyFixatedQuantity=
"00240036";a.PresentedVisualStimuliDataFlag="00240037";a.NumberOfVisualStimuli="00240038";a.ExcessiveFixationLossesDataFlag="00240039";a.ExcessiveFixationLosses="00240040";a.StimuliRetestingQuantity="00240042";a.CommentsOnPatientPerformanceOfVisualField="00240044";a.FalseNegativesEstimateFlag="00240045";a.FalseNegativesEstimate="00240046";a.NegativeCatchTrialsQuantity="00240048";a.FalseNegativesQuantity="00240050";a.ExcessiveFalseNegativesDataFlag="00240051";a.ExcessiveFalseNegatives="00240052";a.FalsePositivesEstimateFlag=
"00240053";a.FalsePositivesEstimate="00240054";a.CatchTrialsDataFlag="00240055";a.PositiveCatchTrialsQuantity="00240056";a.TestPointNormalsDataFlag="00240057";a.TestPointNormalsSequence="00240058";a.GlobalDeviationProbabilityNormalsFlag="00240059";a.FalsePositivesQuantity="00240060";a.ExcessiveFalsePositivesDataFlag="00240061";a.ExcessiveFalsePositives="00240062";a.VisualFieldTestNormalsFlag="00240063";a.ResultsNormalsSequence="00240064";a.AgeCorrectedSensitivityDeviationAlgorithmSequence="00240065";
a.GlobalDeviationFromNormal="00240066";a.GeneralizedDefectSensitivityDeviationAlgorithmSequence="00240067";a.LocalizedDeviationFromNormal="00240068";a.PatientReliabilityIndicator="00240069";a.VisualFieldMeanSensitivity="00240070";a.GlobalDeviationProbability="00240071";a.LocalDeviationProbabilityNormalsFlag="00240072";a.LocalizedDeviationProbability="00240073";a.ShortTermFluctuationCalculated="00240074";a.ShortTermFluctuation="00240075";a.ShortTermFluctuationProbabilityCalculated="00240076";a.ShortTermFluctuationProbability=
"00240077";a.CorrectedLocalizedDeviationFromNormalCalculated="00240078";a.CorrectedLocalizedDeviationFromNormal="00240079";a.CorrectedLocalizedDeviationFromNormalProbabilityCalculated="00240080";a.CorrectedLocalizedDeviationFromNormalProbability="00240081";a.GlobalDeviationProbabilitySequence="00240083";a.LocalizedDeviationProbabilitySequence="00240085";a.FovealSensitivityMeasured="00240086";a.FovealSensitivity="00240087";a.VisualFieldTestDuration="00240088";a.VisualFieldTestPointSequence="00240089";
a.VisualFieldTestPointXCoordinate="00240090";a.VisualFieldTestPointYCoordinate="00240091";a.AgeCorrectedSensitivityDeviationValue="00240092";a.StimulusResults="00240093";a.SensitivityValue="00240094";a.RetestStimulusSeen="00240095";a.RetestSensitivityValue="00240096";a.VisualFieldTestPointNormalsSequence="00240097";a.QuantifiedDefect="00240098";a.AgeCorrectedSensitivityDeviationProbabilityValue="00240100";a.GeneralizedDefectCorrectedSensitivityDeviationFlag="00240102";a.GeneralizedDefectCorrectedSensitivityDeviationValue=
"00240103";a.GeneralizedDefectCorrectedSensitivityDeviationProbabilityValue="00240104";a.MinimumSensitivityValue="00240105";a.BlindSpotLocalized="00240106";a.BlindSpotXCoordinate="00240107";a.BlindSpotYCoordinate="00240108";a.VisualAcuityMeasurementSequence="00240110";a.RefractiveParametersUsedOnPatientSequence="00240112";a.MeasurementLaterality="00240113";a.OphthalmicPatientClinicalInformationLeftEyeSequence="00240114";a.OphthalmicPatientClinicalInformationRightEyeSequence="00240115";a.FovealPointNormativeDataFlag=
"00240117";a.FovealPointProbabilityValue="00240118";a.ScreeningBaselineMeasured="00240120";a.ScreeningBaselineMeasuredSequence="00240122";a.ScreeningBaselineType="00240124";a.ScreeningBaselineValue="00240126";a.AlgorithmSource="00240202";a.DataSetName="00240306";a.DataSetVersion="00240307";a.DataSetSource="00240308";a.DataSetDescription="00240309";a.VisualFieldTestReliabilityGlobalIndexSequence="00240317";a.VisualFieldGlobalResultsIndexSequence="00240320";a.DataObservationSequence="00240325";a.IndexNormalsFlag=
"00240338";a.IndexProbability="00240341";a.IndexProbabilitySequence="00240344";a.SamplesPerPixel="00280002";a.SamplesPerPixelUsed="00280003";a.PhotometricInterpretation="00280004";a.ImageDimensions="00280005";a.PlanarConfiguration="00280006";a.NumberOfFrames="00280008";a.FrameIncrementPointer="00280009";a.FrameDimensionPointer="0028000A";a.Rows="00280010";a.Columns="00280011";a.Planes="00280012";a.UltrasoundColorDataPresent="00280014";a.PixelSpacing="00280030";a.ZoomFactor="00280031";a.ZoomCenter=
"00280032";a.PixelAspectRatio="00280034";a.ImageFormat="00280040";a.ManipulatedImage="00280050";a.CorrectedImage="00280051";a.CompressionRecognitionCode="0028005F";a.CompressionCode="00280060";a.CompressionOriginator="00280061";a.CompressionLabel="00280062";a.CompressionDescription="00280063";a.CompressionSequence="00280065";a.CompressionStepPointers="00280066";a.RepeatInterval="00280068";a.BitsGrouped="00280069";a.PerimeterTable="00280070";a.PerimeterValue="00280071";a.PredictorRows="00280080";a.PredictorColumns=
"00280081";a.PredictorConstants="00280082";a.BlockedPixels="00280090";a.BlockRows="00280091";a.BlockColumns="00280092";a.RowOverlap="00280093";a.ColumnOverlap="00280094";a.BitsAllocated="00280100";a.BitsStored="00280101";a.HighBit="00280102";a.PixelRepresentation="00280103";a.SmallestValidPixelValue="00280104";a.LargestValidPixelValue="00280105";a.SmallestImagePixelValue="00280106";a.LargestImagePixelValue="00280107";a.SmallestPixelValueInSeries="00280108";a.LargestPixelValueInSeries="00280109";a.SmallestImagePixelValueInPlane=
"00280110";a.LargestImagePixelValueInPlane="00280111";a.PixelPaddingValue="00280120";a.PixelPaddingRangeLimit="00280121";a.FloatPixelPaddingValue="00280122";a.DoubleFloatPixelPaddingValue="00280123";a.FloatPixelPaddingRangeLimit="00280124";a.DoubleFloatPixelPaddingRangeLimit="00280125";a.ImageLocation="00280200";a.QualityControlImage="00280300";a.BurnedInAnnotation="00280301";a.RecognizableVisualFeatures="00280302";a.LongitudinalTemporalInformationModified="00280303";a.ReferencedColorPaletteInstanceUID=
"00280304";a.TransformLabel="00280400";a.TransformVersionNumber="00280401";a.NumberOfTransformSteps="00280402";a.SequenceOfCompressedData="00280403";a.DetailsOfCoefficients="00280404";a.RowsForNthOrderCoefficients="00280400";a.ColumnsForNthOrderCoefficients="00280401";a.CoefficientCoding="00280402";a.CoefficientCodingPointers="00280403";a.DCTLabel="00280700";a.DataBlockDescription="00280701";a.DataBlock="00280702";a.NormalizationFactorFormat="00280710";a.ZonalMapNumberFormat="00280720";a.ZonalMapLocation=
"00280721";a.ZonalMapFormat="00280722";a.AdaptiveMapFormat="00280730";a.CodeNumberFormat="00280740";a.CodeLabel="00280800";a.NumberOfTables="00280802";a.CodeTableLocation="00280803";a.BitsForCodeWord="00280804";a.ImageDataLocation="00280808";a.PixelSpacingCalibrationType="00280A02";a.PixelSpacingCalibrationDescription="00280A04";a.PixelIntensityRelationship="00281040";a.PixelIntensityRelationshipSign="00281041";a.WindowCenter="00281050";a.WindowWidth="00281051";a.RescaleIntercept="00281052";a.RescaleSlope=
"00281053";a.RescaleType="00281054";a.WindowCenterWidthExplanation="00281055";a.VOILUTFunction="00281056";a.GrayScale="00281080";a.RecommendedViewingMode="00281090";a.GrayLookupTableDescriptor="00281100";a.RedPaletteColorLookupTableDescriptor="00281101";a.GreenPaletteColorLookupTableDescriptor="00281102";a.BluePaletteColorLookupTableDescriptor="00281103";a.AlphaPaletteColorLookupTableDescriptor="00281104";a.LargeRedPaletteColorLookupTableDescriptor="00281111";a.LargeGreenPaletteColorLookupTableDescriptor=
"00281112";a.LargeBluePaletteColorLookupTableDescriptor="00281113";a.PaletteColorLookupTableUID="00281199";a.GrayLookupTableData="00281200";a.RedPaletteColorLookupTableData="00281201";a.GreenPaletteColorLookupTableData="00281202";a.BluePaletteColorLookupTableData="00281203";a.AlphaPaletteColorLookupTableData="00281204";a.LargeRedPaletteColorLookupTableData="00281211";a.LargeGreenPaletteColorLookupTableData="00281212";a.LargeBluePaletteColorLookupTableData="00281213";a.LargePaletteColorLookupTableUID=
"00281214";a.SegmentedRedPaletteColorLookupTableData="00281221";a.SegmentedGreenPaletteColorLookupTableData="00281222";a.SegmentedBluePaletteColorLookupTableData="00281223";a.BreastImplantPresent="00281300";a.PartialView="00281350";a.PartialViewDescription="00281351";a.PartialViewCodeSequence="00281352";a.SpatialLocationsPreserved="0028135A";a.DataFrameAssignmentSequence="00281401";a.DataPathAssignment="00281402";a.BitsMappedToColorLookupTable="00281403";a.BlendingLUT1Sequence="00281404";a.BlendingLUT1TransferFunction=
"00281405";a.BlendingWeightConstant="00281406";a.BlendingLookupTableDescriptor="00281407";a.BlendingLookupTableData="00281408";a.EnhancedPaletteColorLookupTableSequence="0028140B";a.BlendingLUT2Sequence="0028140C";a.BlendingLUT2TransferFunction="0028140D";a.DataPathID="0028140E";a.RGBLUTTransferFunction="0028140F";a.AlphaLUTTransferFunction="00281410";a.ICCProfile="00282000";a.LossyImageCompression="00282110";a.LossyImageCompressionRatio="00282112";a.LossyImageCompressionMethod="00282114";a.ModalityLUTSequence=
"00283000";a.LUTDescriptor="00283002";a.LUTExplanation="00283003";a.ModalityLUTType="00283004";a.LUTData="00283006";a.VOILUTSequence="00283010";a.SoftcopyVOILUTSequence="00283110";a.ImagePresentationComments="00284000";a.BiPlaneAcquisitionSequence="00285000";a.RepresentativeFrameNumber="00286010";a.FrameNumbersOfInterestFOI="00286020";a.FrameOfInterestDescription="00286022";a.FrameOfInterestType="00286023";a.MaskPointer="00286030";a.RWavePointer="00286040";a.MaskSubtractionSequence="00286100";a.MaskOperation=
"00286101";a.ApplicableFrameRange="00286102";a.MaskFrameNumbers="00286110";a.ContrastFrameAveraging="00286112";a.MaskSubPixelShift="00286114";a.TIDOffset="00286120";a.MaskOperationExplanation="00286190";a.EquipmentAdministratorSequence="00287000";a.NumberOfDisplaySubsystems="00287001";a.CurrentConfigurationID="00287002";a.DisplaySubsystemID="00287003";a.DisplaySubsystemName="00287004";a.DisplaySubsystemDescription="00287005";a.SystemStatus="00287006";a.SystemStatusComment="00287007";a.TargetLuminanceCharacteristicsSequence=
"00287008";a.LuminanceCharacteristicsID="00287009";a.DisplaySubsystemConfigurationSequence="0028700A";a.ConfigurationID="0028700B";a.ConfigurationName="0028700C";a.ConfigurationDescription="0028700D";a.ReferencedTargetLuminanceCharacteristicsID="0028700E";a.QAResultsSequence="0028700F";a.DisplaySubsystemQAResultsSequence="00287010";a.ConfigurationQAResultsSequence="00287011";a.MeasurementEquipmentSequence="00287012";a.MeasurementFunctions="00287013";a.MeasurementEquipmentType="00287014";a.VisualEvaluationResultSequence=
"00287015";a.DisplayCalibrationResultSequence="00287016";a.DDLValue="00287017";a.CIExyWhitePoint="00287018";a.DisplayFunctionType="00287019";a.GammaValue="0028701A";a.NumberOfLuminancePoints="0028701B";a.LuminanceResponseSequence="0028701C";a.TargetMinimumLuminance="0028701D";a.TargetMaximumLuminance="0028701E";a.LuminanceValue="0028701F";a.LuminanceResponseDescription="00287020";a.WhitePointFlag="00287021";a.DisplayDeviceTypeCodeSequence="00287022";a.DisplaySubsystemSequence="00287023";a.LuminanceResultSequence=
"00287024";a.AmbientLightValueSource="00287025";a.MeasuredCharacteristics="00287026";a.LuminanceUniformityResultSequence="00287027";a.VisualEvaluationTestSequence="00287028";a.TestResult="00287029";a.TestResultComment="0028702A";a.TestImageValidation="0028702B";a.TestPatternCodeSequence="0028702C";a.MeasurementPatternCodeSequence="0028702D";a.VisualEvaluationMethodCodeSequence="0028702E";a.PixelDataProviderURL="00287FE0";a.DataPointRows="00289001";a.DataPointColumns="00289002";a.SignalDomainColumns=
"00289003";a.LargestMonochromePixelValue="00289099";a.DataRepresentation="00289108";a.PixelMeasuresSequence="00289110";a.FrameVOILUTSequence="00289132";a.PixelValueTransformationSequence="00289145";a.SignalDomainRows="00289235";a.DisplayFilterPercentage="00289411";a.FramePixelShiftSequence="00289415";a.SubtractionItemID="00289416";a.PixelIntensityRelationshipLUTSequence="00289422";a.FramePixelDataPropertiesSequence="00289443";a.GeometricalProperties="00289444";a.GeometricMaximumDistortion="00289445";
a.ImageProcessingApplied="00289446";a.MaskSelectionMode="00289454";a.LUTFunction="00289474";a.MaskVisibilityPercentage="00289478";a.PixelShiftSequence="00289501";a.RegionPixelShiftSequence="00289502";a.VerticesOfTheRegion="00289503";a.MultiFramePresentationSequence="00289505";a.PixelShiftFrameRange="00289506";a.LUTFrameRange="00289507";a.ImageToEquipmentMappingMatrix="00289520";a.EquipmentCoordinateSystemIdentification="00289537";a.StudyStatusID="0032000A";a.StudyPriorityID="0032000C";a.StudyIDIssuer=
"00320012";a.StudyVerifiedDate="00320032";a.StudyVerifiedTime="00320033";a.StudyReadDate="00320034";a.StudyReadTime="00320035";a.ScheduledStudyStartDate="00321000";a.ScheduledStudyStartTime="00321001";a.ScheduledStudyStopDate="00321010";a.ScheduledStudyStopTime="00321011";a.ScheduledStudyLocation="00321020";a.ScheduledStudyLocationAETitle="00321021";a.ReasonForStudy="00321030";a.RequestingPhysicianIdentificationSequence="00321031";a.RequestingPhysician="00321032";a.RequestingService="00321033";a.RequestingServiceCodeSequence=
"00321034";a.StudyArrivalDate="00321040";a.StudyArrivalTime="00321041";a.StudyCompletionDate="00321050";a.StudyCompletionTime="00321051";a.StudyComponentStatusID="00321055";a.RequestedProcedureDescription="00321060";a.RequestedProcedureCodeSequence="00321064";a.RequestedContrastAgent="00321070";a.StudyComments="00324000";a.ReferencedPatientAliasSequence="00380004";a.VisitStatusID="00380008";a.AdmissionID="00380010";a.IssuerOfAdmissionID="00380011";a.IssuerOfAdmissionIDSequence="00380014";a.RouteOfAdmissions=
"00380016";a.ScheduledAdmissionDate="0038001A";a.ScheduledAdmissionTime="0038001B";a.ScheduledDischargeDate="0038001C";a.ScheduledDischargeTime="0038001D";a.ScheduledPatientInstitutionResidence="0038001E";a.AdmittingDate="00380020";a.AdmittingTime="00380021";a.DischargeDate="00380030";a.DischargeTime="00380032";a.DischargeDiagnosisDescription="00380040";a.DischargeDiagnosisCodeSequence="00380044";a.SpecialNeeds="00380050";a.ServiceEpisodeID="00380060";a.IssuerOfServiceEpisodeID="00380061";a.ServiceEpisodeDescription=
"00380062";a.IssuerOfServiceEpisodeIDSequence="00380064";a.PertinentDocumentsSequence="00380100";a.PertinentResourcesSequence="00380101";a.ResourceDescription="00380102";a.CurrentPatientLocation="00380300";a.PatientInstitutionResidence="00380400";a.PatientState="00380500";a.PatientClinicalTrialParticipationSequence="00380502";a.VisitComments="00384000";a.WaveformOriginality="003A0004";a.NumberOfWaveformChannels="003A0005";a.NumberOfWaveformSamples="003A0010";a.SamplingFrequency="003A001A";a.MultiplexGroupLabel=
"003A0020";a.ChannelDefinitionSequence="003A0200";a.WaveformChannelNumber="003A0202";a.ChannelLabel="003A0203";a.ChannelStatus="003A0205";a.ChannelSourceSequence="003A0208";a.ChannelSourceModifiersSequence="003A0209";a.SourceWaveformSequence="003A020A";a.ChannelDerivationDescription="003A020C";a.ChannelSensitivity="003A0210";a.ChannelSensitivityUnitsSequence="003A0211";a.ChannelSensitivityCorrectionFactor="003A0212";a.ChannelBaseline="003A0213";a.ChannelTimeSkew="003A0214";a.ChannelSampleSkew="003A0215";
a.ChannelOffset="003A0218";a.WaveformBitsStored="003A021A";a.FilterLowFrequency="003A0220";a.FilterHighFrequency="003A0221";a.NotchFilterFrequency="003A0222";a.NotchFilterBandwidth="003A0223";a.WaveformDataDisplayScale="003A0230";a.WaveformDisplayBackgroundCIELabValue="003A0231";a.WaveformPresentationGroupSequence="003A0240";a.PresentationGroupNumber="003A0241";a.ChannelDisplaySequence="003A0242";a.ChannelRecommendedDisplayCIELabValue="003A0244";a.ChannelPosition="003A0245";a.DisplayShadingFlag="003A0246";
a.FractionalChannelDisplayScale="003A0247";a.AbsoluteChannelDisplayScale="003A0248";a.MultiplexedAudioChannelsDescriptionCodeSequence="003A0300";a.ChannelIdentificationCode="003A0301";a.ChannelMode="003A0302";a.ScheduledStationAETitle="00400001";a.ScheduledProcedureStepStartDate="00400002";a.ScheduledProcedureStepStartTime="00400003";a.ScheduledProcedureStepEndDate="00400004";a.ScheduledProcedureStepEndTime="00400005";a.ScheduledPerformingPhysicianName="00400006";a.ScheduledProcedureStepDescription=
"00400007";a.ScheduledProtocolCodeSequence="00400008";a.ScheduledProcedureStepID="00400009";a.StageCodeSequence="0040000A";a.ScheduledPerformingPhysicianIdentificationSequence="0040000B";a.ScheduledStationName="00400010";a.ScheduledProcedureStepLocation="00400011";a.PreMedication="00400012";a.ScheduledProcedureStepStatus="00400020";a.OrderPlacerIdentifierSequence="00400026";a.OrderFillerIdentifierSequence="00400027";a.LocalNamespaceEntityID="00400031";a.UniversalEntityID="00400032";a.UniversalEntityIDType=
"00400033";a.IdentifierTypeCode="00400035";a.AssigningFacilitySequence="00400036";a.AssigningJurisdictionCodeSequence="00400039";a.AssigningAgencyOrDepartmentCodeSequence="0040003A";a.ScheduledProcedureStepSequence="00400100";a.ReferencedNonImageCompositeSOPInstanceSequence="00400220";a.PerformedStationAETitle="00400241";a.PerformedStationName="00400242";a.PerformedLocation="00400243";a.PerformedProcedureStepStartDate="00400244";a.PerformedProcedureStepStartTime="00400245";a.PerformedProcedureStepEndDate=
"00400250";a.PerformedProcedureStepEndTime="00400251";a.PerformedProcedureStepStatus="00400252";a.PerformedProcedureStepID="00400253";a.PerformedProcedureStepDescription="00400254";a.PerformedProcedureTypeDescription="00400255";a.PerformedProtocolCodeSequence="00400260";a.PerformedProtocolType="00400261";a.ScheduledStepAttributesSequence="00400270";a.RequestAttributesSequence="00400275";a.CommentsOnThePerformedProcedureStep="00400280";a.PerformedProcedureStepDiscontinuationReasonCodeSequence="00400281";
a.QuantitySequence="00400293";a.Quantity="00400294";a.MeasuringUnitsSequence="00400295";a.BillingItemSequence="00400296";a.TotalTimeOfFluoroscopy="00400300";a.TotalNumberOfExposures="00400301";a.EntranceDose="00400302";a.ExposedArea="00400303";a.DistanceSourceToEntrance="00400306";a.DistanceSourceToSupport="00400307";a.ExposureDoseSequence="0040030E";a.CommentsOnRadiationDose="00400310";a.XRayOutput="00400312";a.HalfValueLayer="00400314";a.OrganDose="00400316";a.OrganExposed="00400318";a.BillingProcedureStepSequence=
"00400320";a.FilmConsumptionSequence="00400321";a.BillingSuppliesAndDevicesSequence="00400324";a.ReferencedProcedureStepSequence="00400330";a.PerformedSeriesSequence="00400340";a.CommentsOnTheScheduledProcedureStep="00400400";a.ProtocolContextSequence="00400440";a.ContentItemModifierSequence="00400441";a.ScheduledSpecimenSequence="00400500";a.SpecimenAccessionNumber="0040050A";a.ContainerIdentifier="00400512";a.IssuerOfTheContainerIdentifierSequence="00400513";a.AlternateContainerIdentifierSequence=
"00400515";a.ContainerTypeCodeSequence="00400518";a.ContainerDescription="0040051A";a.ContainerComponentSequence="00400520";a.SpecimenSequence="00400550";a.SpecimenIdentifier="00400551";a.SpecimenDescriptionSequenceTrial="00400552";a.SpecimenDescriptionTrial="00400553";a.SpecimenUID="00400554";a.AcquisitionContextSequence="00400555";a.AcquisitionContextDescription="00400556";a.SpecimenDescriptionSequence="00400560";a.IssuerOfTheSpecimenIdentifierSequence="00400562";a.SpecimenTypeCodeSequence="0040059A";
a.SpecimenShortDescription="00400600";a.SpecimenDetailedDescription="00400602";a.SpecimenPreparationSequence="00400610";a.SpecimenPreparationStepContentItemSequence="00400612";a.SpecimenLocalizationContentItemSequence="00400620";a.SlideIdentifier="004006FA";a.ImageCenterPointCoordinatesSequence="0040071A";a.XOffsetInSlideCoordinateSystem="0040072A";a.YOffsetInSlideCoordinateSystem="0040073A";a.ZOffsetInSlideCoordinateSystem="0040074A";a.PixelSpacingSequence="004008D8";a.CoordinateSystemAxisCodeSequence=
"004008DA";a.MeasurementUnitsCodeSequence="004008EA";a.VitalStainCodeSequenceTrial="004009F8";a.RequestedProcedureID="00401001";a.ReasonForTheRequestedProcedure="00401002";a.RequestedProcedurePriority="00401003";a.PatientTransportArrangements="00401004";a.RequestedProcedureLocation="00401005";a.PlacerOrderNumberProcedure="00401006";a.FillerOrderNumberProcedure="00401007";a.ConfidentialityCode="00401008";a.ReportingPriority="00401009";a.ReasonForRequestedProcedureCodeSequence="0040100A";a.NamesOfIntendedRecipientsOfResults=
"00401010";a.IntendedRecipientsOfResultsIdentificationSequence="00401011";a.ReasonForPerformedProcedureCodeSequence="00401012";a.RequestedProcedureDescriptionTrial="00401060";a.PersonIdentificationCodeSequence="00401101";a.PersonAddress="00401102";a.PersonTelephoneNumbers="00401103";a.PersonTelecomInformation="00401104";a.RequestedProcedureComments="00401400";a.ReasonForTheImagingServiceRequest="00402001";a.IssueDateOfImagingServiceRequest="00402004";a.IssueTimeOfImagingServiceRequest="00402005";
a.PlacerOrderNumberImagingServiceRequestRetired="00402006";a.FillerOrderNumberImagingServiceRequestRetired="00402007";a.OrderEnteredBy="00402008";a.OrderEntererLocation="00402009";a.OrderCallbackPhoneNumber="00402010";a.OrderCallbackTelecomInformation="00402011";a.PlacerOrderNumberImagingServiceRequest="00402016";a.FillerOrderNumberImagingServiceRequest="00402017";a.ImagingServiceRequestComments="00402400";a.ConfidentialityConstraintOnPatientDataDescription="00403001";a.GeneralPurposeScheduledProcedureStepStatus=
"00404001";a.GeneralPurposePerformedProcedureStepStatus="00404002";a.GeneralPurposeScheduledProcedureStepPriority="00404003";a.ScheduledProcessingApplicationsCodeSequence="00404004";a.ScheduledProcedureStepStartDateTime="00404005";a.MultipleCopiesFlag="00404006";a.PerformedProcessingApplicationsCodeSequence="00404007";a.HumanPerformerCodeSequence="00404009";a.ScheduledProcedureStepModificationDateTime="00404010";a.ExpectedCompletionDateTime="00404011";a.ResultingGeneralPurposePerformedProcedureStepsSequence=
"00404015";a.ReferencedGeneralPurposeScheduledProcedureStepSequence="00404016";a.ScheduledWorkitemCodeSequence="00404018";a.PerformedWorkitemCodeSequence="00404019";a.InputAvailabilityFlag="00404020";a.InputInformationSequence="00404021";a.RelevantInformationSequence="00404022";a.ReferencedGeneralPurposeScheduledProcedureStepTransactionUID="00404023";a.ScheduledStationNameCodeSequence="00404025";a.ScheduledStationClassCodeSequence="00404026";a.ScheduledStationGeographicLocationCodeSequence="00404027";
a.PerformedStationNameCodeSequence="00404028";a.PerformedStationClassCodeSequence="00404029";a.PerformedStationGeographicLocationCodeSequence="00404030";a.RequestedSubsequentWorkitemCodeSequence="00404031";a.NonDICOMOutputCodeSequence="00404032";a.OutputInformationSequence="00404033";a.ScheduledHumanPerformersSequence="00404034";a.ActualHumanPerformersSequence="00404035";a.HumanPerformerOrganization="00404036";a.HumanPerformerName="00404037";a.RawDataHandling="00404040";a.InputReadinessState="00404041";
a.PerformedProcedureStepStartDateTime="00404050";a.PerformedProcedureStepEndDateTime="00404051";a.ProcedureStepCancellationDateTime="00404052";a.EntranceDoseInMGy="00408302";a.ParametricMapFrameTypeSequence="00409092";a.ReferencedImageRealWorldValueMappingSequence="00409094";a.RealWorldValueMappingSequence="00409096";a.PixelValueMappingCodeSequence="00409098";a.LUTLabel="00409210";a.RealWorldValueLastValueMapped="00409211";a.RealWorldValueLUTData="00409212";a.RealWorldValueFirstValueMapped="00409216";
a.QuantityDefinitionSequence="00409220";a.RealWorldValueIntercept="00409224";a.RealWorldValueSlope="00409225";a.FindingsFlagTrial="0040A007";a.RelationshipType="0040A010";a.FindingsSequenceTrial="0040A020";a.FindingsGroupUIDTrial="0040A021";a.ReferencedFindingsGroupUIDTrial="0040A022";a.FindingsGroupRecordingDateTrial="0040A023";a.FindingsGroupRecordingTimeTrial="0040A024";a.FindingsSourceCategoryCodeSequenceTrial="0040A026";a.VerifyingOrganization="0040A027";a.DocumentingOrganizationIdentifierCodeSequenceTrial=
"0040A028";a.VerificationDateTime="0040A030";a.ObservationDateTime="0040A032";a.ValueType="0040A040";a.ConceptNameCodeSequence="0040A043";a.MeasurementPrecisionDescriptionTrial="0040A047";a.ContinuityOfContent="0040A050";a.UrgencyOrPriorityAlertsTrial="0040A057";a.SequencingIndicatorTrial="0040A060";a.DocumentIdentifierCodeSequenceTrial="0040A066";a.DocumentAuthorTrial="0040A067";a.DocumentAuthorIdentifierCodeSequenceTrial="0040A068";a.IdentifierCodeSequenceTrial="0040A070";a.VerifyingObserverSequence=
"0040A073";a.ObjectBinaryIdentifierTrial="0040A074";a.VerifyingObserverName="0040A075";a.DocumentingObserverIdentifierCodeSequenceTrial="0040A076";a.AuthorObserverSequence="0040A078";a.ParticipantSequence="0040A07A";a.CustodialOrganizationSequence="0040A07C";a.ParticipationType="0040A080";a.ParticipationDateTime="0040A082";a.ObserverType="0040A084";a.ProcedureIdentifierCodeSequenceTrial="0040A085";a.VerifyingObserverIdentificationCodeSequence="0040A088";a.ObjectDirectoryBinaryIdentifierTrial="0040A089";
a.EquivalentCDADocumentSequence="0040A090";a.ReferencedWaveformChannels="0040A0B0";a.DateOfDocumentOrVerbalTransactionTrial="0040A110";a.TimeOfDocumentCreationOrVerbalTransactionTrial="0040A112";a.DateTime="0040A120";a.Date="0040A121";a.Time="0040A122";a.PersonName="0040A123";a.UID="0040A124";a.ReportStatusIDTrial="0040A125";a.TemporalRangeType="0040A130";a.ReferencedSamplePositions="0040A132";a.ReferencedFrameNumbers="0040A136";a.ReferencedTimeOffsets="0040A138";a.ReferencedDateTime="0040A13A";a.TextValue=
"0040A160";a.FloatingPointValue="0040A161";a.RationalNumeratorValue="0040A162";a.RationalDenominatorValue="0040A163";a.ObservationCategoryCodeSequenceTrial="0040A167";a.ConceptCodeSequence="0040A168";a.BibliographicCitationTrial="0040A16A";a.PurposeOfReferenceCodeSequence="0040A170";a.ObservationUID="0040A171";a.ReferencedObservationUIDTrial="0040A172";a.ReferencedObservationClassTrial="0040A173";a.ReferencedObjectObservationClassTrial="0040A174";a.AnnotationGroupNumber="0040A180";a.ObservationDateTrial=
"0040A192";a.ObservationTimeTrial="0040A193";a.MeasurementAutomationTrial="0040A194";a.ModifierCodeSequence="0040A195";a.IdentificationDescriptionTrial="0040A224";a.CoordinatesSetGeometricTypeTrial="0040A290";a.AlgorithmCodeSequenceTrial="0040A296";a.AlgorithmDescriptionTrial="0040A297";a.PixelCoordinatesSetTrial="0040A29A";a.MeasuredValueSequence="0040A300";a.NumericValueQualifierCodeSequence="0040A301";a.CurrentObserverTrial="0040A307";a.NumericValue="0040A30A";a.ReferencedAccessionSequenceTrial=
"0040A313";a.ReportStatusCommentTrial="0040A33A";a.ProcedureContextSequenceTrial="0040A340";a.VerbalSourceTrial="0040A352";a.AddressTrial="0040A353";a.TelephoneNumberTrial="0040A354";a.VerbalSourceIdentifierCodeSequenceTrial="0040A358";a.PredecessorDocumentsSequence="0040A360";a.ReferencedRequestSequence="0040A370";a.PerformedProcedureCodeSequence="0040A372";a.CurrentRequestedProcedureEvidenceSequence="0040A375";a.ReportDetailSequenceTrial="0040A380";a.PertinentOtherEvidenceSequence="0040A385";a.HL7StructuredDocumentReferenceSequence=
"0040A390";a.ObservationSubjectUIDTrial="0040A402";a.ObservationSubjectClassTrial="0040A403";a.ObservationSubjectTypeCodeSequenceTrial="0040A404";a.CompletionFlag="0040A491";a.CompletionFlagDescription="0040A492";a.VerificationFlag="0040A493";a.ArchiveRequested="0040A494";a.PreliminaryFlag="0040A496";a.ContentTemplateSequence="0040A504";a.IdenticalDocumentsSequence="0040A525";a.ObservationSubjectContextFlagTrial="0040A600";a.ObserverContextFlagTrial="0040A601";a.ProcedureContextFlagTrial="0040A603";
a.ContentSequence="0040A730";a.RelationshipSequenceTrial="0040A731";a.RelationshipTypeCodeSequenceTrial="0040A732";a.LanguageCodeSequenceTrial="0040A744";a.UniformResourceLocatorTrial="0040A992";a.WaveformAnnotationSequence="0040B020";a.TemplateIdentifier="0040DB00";a.TemplateVersion="0040DB06";a.TemplateLocalVersion="0040DB07";a.TemplateExtensionFlag="0040DB0B";a.TemplateExtensionOrganizationUID="0040DB0C";a.TemplateExtensionCreatorUID="0040DB0D";a.ReferencedContentItemIdentifier="0040DB73";a.HL7InstanceIdentifier=
"0040E001";a.HL7DocumentEffectiveTime="0040E004";a.HL7DocumentTypeCodeSequence="0040E006";a.DocumentClassCodeSequence="0040E008";a.RetrieveURI="0040E010";a.RetrieveLocationUID="0040E011";a.TypeOfInstances="0040E020";a.DICOMRetrievalSequence="0040E021";a.DICOMMediaRetrievalSequence="0040E022";a.WADORetrievalSequence="0040E023";a.XDSRetrievalSequence="0040E024";a.WADORSRetrievalSequence="0040E025";a.RepositoryUniqueID="0040E030";a.HomeCommunityID="0040E031";a.DocumentTitle="00420010";a.EncapsulatedDocument=
"00420011";a.MIMETypeOfEncapsulatedDocument="00420012";a.SourceInstanceSequence="00420013";a.ListOfMIMETypes="00420014";a.ProductPackageIdentifier="00440001";a.SubstanceAdministrationApproval="00440002";a.ApprovalStatusFurtherDescription="00440003";a.ApprovalStatusDateTime="00440004";a.ProductTypeCodeSequence="00440007";a.ProductName="00440008";a.ProductDescription="00440009";a.ProductLotIdentifier="0044000A";a.ProductExpirationDateTime="0044000B";a.SubstanceAdministrationDateTime="00440010";a.SubstanceAdministrationNotes=
"00440011";a.SubstanceAdministrationDeviceID="00440012";a.ProductParameterSequence="00440013";a.SubstanceAdministrationParameterSequence="00440019";a.LensDescription="00460012";a.RightLensSequence="00460014";a.LeftLensSequence="00460015";a.UnspecifiedLateralityLensSequence="00460016";a.CylinderSequence="00460018";a.PrismSequence="00460028";a.HorizontalPrismPower="00460030";a.HorizontalPrismBase="00460032";a.VerticalPrismPower="00460034";a.VerticalPrismBase="00460036";a.LensSegmentType="00460038";
a.OpticalTransmittance="00460040";a.ChannelWidth="00460042";a.PupilSize="00460044";a.CornealSize="00460046";a.AutorefractionRightEyeSequence="00460050";a.AutorefractionLeftEyeSequence="00460052";a.DistancePupillaryDistance="00460060";a.NearPupillaryDistance="00460062";a.IntermediatePupillaryDistance="00460063";a.OtherPupillaryDistance="00460064";a.KeratometryRightEyeSequence="00460070";a.KeratometryLeftEyeSequence="00460071";a.SteepKeratometricAxisSequence="00460074";a.RadiusOfCurvature="00460075";
a.KeratometricPower="00460076";a.KeratometricAxis="00460077";a.FlatKeratometricAxisSequence="00460080";a.BackgroundColor="00460092";a.Optotype="00460094";a.OptotypePresentation="00460095";a.SubjectiveRefractionRightEyeSequence="00460097";a.SubjectiveRefractionLeftEyeSequence="00460098";a.AddNearSequence="00460100";a.AddIntermediateSequence="00460101";a.AddOtherSequence="00460102";a.AddPower="00460104";a.ViewingDistance="00460106";a.VisualAcuityTypeCodeSequence="00460121";a.VisualAcuityRightEyeSequence=
"00460122";a.VisualAcuityLeftEyeSequence="00460123";a.VisualAcuityBothEyesOpenSequence="00460124";a.ViewingDistanceType="00460125";a.VisualAcuityModifiers="00460135";a.DecimalVisualAcuity="00460137";a.OptotypeDetailedDefinition="00460139";a.ReferencedRefractiveMeasurementsSequence="00460145";a.SpherePower="00460146";a.CylinderPower="00460147";a.CornealTopographySurface="00460201";a.CornealVertexLocation="00460202";a.PupilCentroidXCoordinate="00460203";a.PupilCentroidYCoordinate="00460204";a.EquivalentPupilRadius=
"00460205";a.CornealTopographyMapTypeCodeSequence="00460207";a.VerticesOfTheOutlineOfPupil="00460208";a.CornealTopographyMappingNormalsSequence="00460210";a.MaximumCornealCurvatureSequence="00460211";a.MaximumCornealCurvature="00460212";a.MaximumCornealCurvatureLocation="00460213";a.MinimumKeratometricSequence="00460215";a.SimulatedKeratometricCylinderSequence="00460218";a.AverageCornealPower="00460220";a.CornealISValue="00460224";a.AnalyzedArea="00460227";a.SurfaceRegularityIndex="00460230";a.SurfaceAsymmetryIndex=
"00460232";a.CornealEccentricityIndex="00460234";a.KeratoconusPredictionIndex="00460236";a.DecimalPotentialVisualAcuity="00460238";a.CornealTopographyMapQualityEvaluation="00460242";a.SourceImageCornealProcessedDataSequence="00460244";a.CornealPointLocation="00460247";a.CornealPointEstimated="00460248";a.AxialPower="00460249";a.TangentialPower="00460250";a.RefractivePower="00460251";a.RelativeElevation="00460252";a.CornealWavefront="00460253";a.ImagedVolumeWidth="00480001";a.ImagedVolumeHeight="00480002";
a.ImagedVolumeDepth="00480003";a.TotalPixelMatrixColumns="00480006";a.TotalPixelMatrixRows="00480007";a.TotalPixelMatrixOriginSequence="00480008";a.SpecimenLabelInImage="00480010";a.FocusMethod="00480011";a.ExtendedDepthOfField="00480012";a.NumberOfFocalPlanes="00480013";a.DistanceBetweenFocalPlanes="00480014";a.RecommendedAbsentPixelCIELabValue="00480015";a.IlluminatorTypeCodeSequence="00480100";a.ImageOrientationSlide="00480102";a.OpticalPathSequence="00480105";a.OpticalPathIdentifier="00480106";
a.OpticalPathDescription="00480107";a.IlluminationColorCodeSequence="00480108";a.SpecimenReferenceSequence="00480110";a.CondenserLensPower="00480111";a.ObjectiveLensPower="00480112";a.ObjectiveLensNumericalAperture="00480113";a.PaletteColorLookupTableSequence="00480120";a.ReferencedImageNavigationSequence="00480200";a.TopLeftHandCornerOfLocalizerArea="00480201";a.BottomRightHandCornerOfLocalizerArea="00480202";a.OpticalPathIdentificationSequence="00480207";a.PlanePositionSlideSequence="0048021A";
a.ColumnPositionInTotalImagePixelMatrix="0048021E";a.RowPositionInTotalImagePixelMatrix="0048021F";a.PixelOriginInterpretation="00480301";a.CalibrationImage="00500004";a.DeviceSequence="00500010";a.ContainerComponentTypeCodeSequence="00500012";a.ContainerComponentThickness="00500013";a.DeviceLength="00500014";a.ContainerComponentWidth="00500015";a.DeviceDiameter="00500016";a.DeviceDiameterUnits="00500017";a.DeviceVolume="00500018";a.IntermarkerDistance="00500019";a.ContainerComponentMaterial="0050001A";
a.ContainerComponentID="0050001B";a.ContainerComponentLength="0050001C";a.ContainerComponentDiameter="0050001D";a.ContainerComponentDescription="0050001E";a.DeviceDescription="00500020";a.ContrastBolusIngredientPercentByVolume="00520001";a.OCTFocalDistance="00520002";a.BeamSpotSize="00520003";a.EffectiveRefractiveIndex="00520004";a.OCTAcquisitionDomain="00520006";a.OCTOpticalCenterWavelength="00520007";a.AxialResolution="00520008";a.RangingDepth="00520009";a.ALineRate="00520011";a.ALinesPerFrame=
"00520012";a.CatheterRotationalRate="00520013";a.ALinePixelSpacing="00520014";a.ModeOfPercutaneousAccessSequence="00520016";a.IntravascularOCTFrameTypeSequence="00520025";a.OCTZOffsetApplied="00520026";a.IntravascularFrameContentSequence="00520027";a.IntravascularLongitudinalDistance="00520028";a.IntravascularOCTFrameContentSequence="00520029";a.OCTZOffsetCorrection="00520030";a.CatheterDirectionOfRotation="00520031";a.SeamLineLocation="00520033";a.FirstALineLocation="00520034";a.SeamLineIndex="00520036";
a.NumberOfPaddedALines="00520038";a.InterpolationType="00520039";a.RefractiveIndexApplied="0052003A";a.EnergyWindowVector="00540010";a.NumberOfEnergyWindows="00540011";a.EnergyWindowInformationSequence="00540012";a.EnergyWindowRangeSequence="00540013";a.EnergyWindowLowerLimit="00540014";a.EnergyWindowUpperLimit="00540015";a.RadiopharmaceuticalInformationSequence="00540016";a.ResidualSyringeCounts="00540017";a.EnergyWindowName="00540018";a.DetectorVector="00540020";a.NumberOfDetectors="00540021";a.DetectorInformationSequence=
"00540022";a.PhaseVector="00540030";a.NumberOfPhases="00540031";a.PhaseInformationSequence="00540032";a.NumberOfFramesInPhase="00540033";a.PhaseDelay="00540036";a.PauseBetweenFrames="00540038";a.PhaseDescription="00540039";a.RotationVector="00540050";a.NumberOfRotations="00540051";a.RotationInformationSequence="00540052";a.NumberOfFramesInRotation="00540053";a.RRIntervalVector="00540060";a.NumberOfRRIntervals="00540061";a.GatedInformationSequence="00540062";a.DataInformationSequence="00540063";a.TimeSlotVector=
"00540070";a.NumberOfTimeSlots="00540071";a.TimeSlotInformationSequence="00540072";a.TimeSlotTime="00540073";a.SliceVector="00540080";a.NumberOfSlices="00540081";a.AngularViewVector="00540090";a.TimeSliceVector="00540100";a.NumberOfTimeSlices="00540101";a.StartAngle="00540200";a.TypeOfDetectorMotion="00540202";a.TriggerVector="00540210";a.NumberOfTriggersInPhase="00540211";a.ViewCodeSequence="00540220";a.ViewModifierCodeSequence="00540222";a.RadionuclideCodeSequence="00540300";a.AdministrationRouteCodeSequence=
"00540302";a.RadiopharmaceuticalCodeSequence="00540304";a.CalibrationDataSequence="00540306";a.EnergyWindowNumber="00540308";a.ImageID="00540400";a.PatientOrientationCodeSequence="00540410";a.PatientOrientationModifierCodeSequence="00540412";a.PatientGantryRelationshipCodeSequence="00540414";a.SliceProgressionDirection="00540500";a.ScanProgressionDirection="00540501";a.SeriesType="00541000";a.Units="00541001";a.CountsSource="00541002";a.ReprojectionMethod="00541004";a.SUVType="00541006";a.RandomsCorrectionMethod=
"00541100";a.AttenuationCorrectionMethod="00541101";a.DecayCorrection="00541102";a.ReconstructionMethod="00541103";a.DetectorLinesOfResponseUsed="00541104";a.ScatterCorrectionMethod="00541105";a.AxialAcceptance="00541200";a.AxialMash="00541201";a.TransverseMash="00541202";a.DetectorElementSize="00541203";a.CoincidenceWindowWidth="00541210";a.SecondaryCountsType="00541220";a.FrameReferenceTime="00541300";a.PrimaryPromptsCountsAccumulated="00541310";a.SecondaryCountsAccumulated="00541311";a.SliceSensitivityFactor=
"00541320";a.DecayFactor="00541321";a.DoseCalibrationFactor="00541322";a.ScatterFractionFactor="00541323";a.DeadTimeFactor="00541324";a.ImageIndex="00541330";a.CountsIncluded="00541400";a.DeadTimeCorrectionFlag="00541401";a.HistogramSequence="00603000";a.HistogramNumberOfBins="00603002";a.HistogramFirstBinValue="00603004";a.HistogramLastBinValue="00603006";a.HistogramBinWidth="00603008";a.HistogramExplanation="00603010";a.HistogramData="00603020";a.SegmentationType="00620001";a.SegmentSequence="00620002";
a.SegmentedPropertyCategoryCodeSequence="00620003";a.SegmentNumber="00620004";a.SegmentLabel="00620005";a.SegmentDescription="00620006";a.SegmentAlgorithmType="00620008";a.SegmentAlgorithmName="00620009";a.SegmentIdentificationSequence="0062000A";a.ReferencedSegmentNumber="0062000B";a.RecommendedDisplayGrayscaleValue="0062000C";a.RecommendedDisplayCIELabValue="0062000D";a.MaximumFractionalValue="0062000E";a.SegmentedPropertyTypeCodeSequence="0062000F";a.SegmentationFractionalType="00620010";a.SegmentedPropertyTypeModifierCodeSequence=
"00620011";a.UsedSegmentsSequence="00620012";a.DeformableRegistrationSequence="00640002";a.SourceFrameOfReferenceUID="00640003";a.DeformableRegistrationGridSequence="00640005";a.GridDimensions="00640007";a.GridResolution="00640008";a.VectorGridData="00640009";a.PreDeformationMatrixRegistrationSequence="0064000F";a.PostDeformationMatrixRegistrationSequence="00640010";a.NumberOfSurfaces="00660001";a.SurfaceSequence="00660002";a.SurfaceNumber="00660003";a.SurfaceComments="00660004";a.SurfaceProcessing=
"00660009";a.SurfaceProcessingRatio="0066000A";a.SurfaceProcessingDescription="0066000B";a.RecommendedPresentationOpacity="0066000C";a.RecommendedPresentationType="0066000D";a.FiniteVolume="0066000E";a.Manifold="00660010";a.SurfacePointsSequence="00660011";a.SurfacePointsNormalsSequence="00660012";a.SurfaceMeshPrimitivesSequence="00660013";a.NumberOfSurfacePoints="00660015";a.PointCoordinatesData="00660016";a.PointPositionAccuracy="00660017";a.MeanPointDistance="00660018";a.MaximumPointDistance="00660019";
a.PointsBoundingBoxCoordinates="0066001A";a.AxisOfRotation="0066001B";a.CenterOfRotation="0066001C";a.NumberOfVectors="0066001E";a.VectorDimensionality="0066001F";a.VectorAccuracy="00660020";a.VectorCoordinateData="00660021";a.TrianglePointIndexList="00660023";a.EdgePointIndexList="00660024";a.VertexPointIndexList="00660025";a.TriangleStripSequence="00660026";a.TriangleFanSequence="00660027";a.LineSequence="00660028";a.PrimitivePointIndexList="00660029";a.SurfaceCount="0066002A";a.ReferencedSurfaceSequence=
"0066002B";a.ReferencedSurfaceNumber="0066002C";a.SegmentSurfaceGenerationAlgorithmIdentificationSequence="0066002D";a.SegmentSurfaceSourceInstanceSequence="0066002E";a.AlgorithmFamilyCodeSequence="0066002F";a.AlgorithmNameCodeSequence="00660030";a.AlgorithmVersion="00660031";a.AlgorithmParameters="00660032";a.FacetSequence="00660034";a.SurfaceProcessingAlgorithmIdentificationSequence="00660035";a.AlgorithmName="00660036";a.RecommendedPointRadius="00660037";a.RecommendedLineThickness="00660038";a.LongPrimitivePointIndexList=
"00660040";a.LongTrianglePointIndexList="00660041";a.LongEdgePointIndexList="00660042";a.LongVertexPointIndexList="00660043";a.ImplantSize="00686210";a.ImplantTemplateVersion="00686221";a.ReplacedImplantTemplateSequence="00686222";a.ImplantType="00686223";a.DerivationImplantTemplateSequence="00686224";a.OriginalImplantTemplateSequence="00686225";a.EffectiveDateTime="00686226";a.ImplantTargetAnatomySequence="00686230";a.InformationFromManufacturerSequence="00686260";a.NotificationFromManufacturerSequence=
"00686265";a.InformationIssueDateTime="00686270";a.InformationSummary="00686280";a.ImplantRegulatoryDisapprovalCodeSequence="006862A0";a.OverallTemplateSpatialTolerance="006862A5";a.HPGLDocumentSequence="006862C0";a.HPGLDocumentID="006862D0";a.HPGLDocumentLabel="006862D5";a.ViewOrientationCodeSequence="006862E0";a.ViewOrientationModifier="006862F0";a.HPGLDocumentScaling="006862F2";a.HPGLDocument="00686300";a.HPGLContourPenNumber="00686310";a.HPGLPenSequence="00686320";a.HPGLPenNumber="00686330";a.HPGLPenLabel=
"00686340";a.HPGLPenDescription="00686345";a.RecommendedRotationPoint="00686346";a.BoundingRectangle="00686347";a.ImplantTemplate3DModelSurfaceNumber="00686350";a.SurfaceModelDescriptionSequence="00686360";a.SurfaceModelLabel="00686380";a.SurfaceModelScalingFactor="00686390";a.MaterialsCodeSequence="006863A0";a.CoatingMaterialsCodeSequence="006863A4";a.ImplantTypeCodeSequence="006863A8";a.FixationMethodCodeSequence="006863AC";a.MatingFeatureSetsSequence="006863B0";a.MatingFeatureSetID="006863C0";
a.MatingFeatureSetLabel="006863D0";a.MatingFeatureSequence="006863E0";a.MatingFeatureID="006863F0";a.MatingFeatureDegreeOfFreedomSequence="00686400";a.DegreeOfFreedomID="00686410";a.DegreeOfFreedomType="00686420";a.TwoDMatingFeatureCoordinatesSequence="00686430";a.ReferencedHPGLDocumentID="00686440";a.TwoDMatingPoint="00686450";a.TwoDMatingAxes="00686460";a.TwoDDegreeOfFreedomSequence="00686470";a.ThreeDDegreeOfFreedomAxis="00686490";a.RangeOfFreedom="006864A0";a.ThreeDMatingPoint="006864C0";a.ThreeDMatingAxes=
"006864D0";a.TwoDDegreeOfFreedomAxis="006864F0";a.PlanningLandmarkPointSequence="00686500";a.PlanningLandmarkLineSequence="00686510";a.PlanningLandmarkPlaneSequence="00686520";a.PlanningLandmarkID="00686530";a.PlanningLandmarkDescription="00686540";a.PlanningLandmarkIdentificationCodeSequence="00686545";a.TwoDPointCoordinatesSequence="00686550";a.TwoDPointCoordinates="00686560";a.ThreeDPointCoordinates="00686590";a.TwoDLineCoordinatesSequence="006865A0";a.TwoDLineCoordinates="006865B0";a.ThreeDLineCoordinates=
"006865D0";a.TwoDPlaneCoordinatesSequence="006865E0";a.TwoDPlaneIntersection="006865F0";a.ThreeDPlaneOrigin="00686610";a.ThreeDPlaneNormal="00686620";a.GraphicAnnotationSequence="00700001";a.GraphicLayer="00700002";a.BoundingBoxAnnotationUnits="00700003";a.AnchorPointAnnotationUnits="00700004";a.GraphicAnnotationUnits="00700005";a.UnformattedTextValue="00700006";a.TextObjectSequence="00700008";a.GraphicObjectSequence="00700009";a.BoundingBoxTopLeftHandCorner="00700010";a.BoundingBoxBottomRightHandCorner=
"00700011";a.BoundingBoxTextHorizontalJustification="00700012";a.AnchorPoint="00700014";a.AnchorPointVisibility="00700015";a.GraphicDimensions="00700020";a.NumberOfGraphicPoints="00700021";a.GraphicData="00700022";a.GraphicType="00700023";a.GraphicFilled="00700024";a.ImageRotationRetired="00700040";a.ImageHorizontalFlip="00700041";a.ImageRotation="00700042";a.DisplayedAreaTopLeftHandCornerTrial="00700050";a.DisplayedAreaBottomRightHandCornerTrial="00700051";a.DisplayedAreaTopLeftHandCorner="00700052";
a.DisplayedAreaBottomRightHandCorner="00700053";a.DisplayedAreaSelectionSequence="0070005A";a.GraphicLayerSequence="00700060";a.GraphicLayerOrder="00700062";a.GraphicLayerRecommendedDisplayGrayscaleValue="00700066";a.GraphicLayerRecommendedDisplayRGBValue="00700067";a.GraphicLayerDescription="00700068";a.ContentLabel="00700080";a.ContentDescription="00700081";a.PresentationCreationDate="00700082";a.PresentationCreationTime="00700083";a.ContentCreatorName="00700084";a.ContentCreatorIdentificationCodeSequence=
"00700086";a.AlternateContentDescriptionSequence="00700087";a.PresentationSizeMode="00700100";a.PresentationPixelSpacing="00700101";a.PresentationPixelAspectRatio="00700102";a.PresentationPixelMagnificationRatio="00700103";a.GraphicGroupLabel="00700207";a.GraphicGroupDescription="00700208";a.CompoundGraphicSequence="00700209";a.CompoundGraphicInstanceID="00700226";a.FontName="00700227";a.FontNameType="00700228";a.CSSFontName="00700229";a.RotationAngle="00700230";a.TextStyleSequence="00700231";a.LineStyleSequence=
"00700232";a.FillStyleSequence="00700233";a.GraphicGroupSequence="00700234";a.TextColorCIELabValue="00700241";a.HorizontalAlignment="00700242";a.VerticalAlignment="00700243";a.ShadowStyle="00700244";a.ShadowOffsetX="00700245";a.ShadowOffsetY="00700246";a.ShadowColorCIELabValue="00700247";a.Underlined="00700248";a.Bold="00700249";a.Italic="00700250";a.PatternOnColorCIELabValue="00700251";a.PatternOffColorCIELabValue="00700252";a.LineThickness="00700253";a.LineDashingStyle="00700254";a.LinePattern=
"00700255";a.FillPattern="00700256";a.FillMode="00700257";a.ShadowOpacity="00700258";a.GapLength="00700261";a.DiameterOfVisibility="00700262";a.RotationPoint="00700273";a.TickAlignment="00700274";a.ShowTickLabel="00700278";a.TickLabelAlignment="00700279";a.CompoundGraphicUnits="00700282";a.PatternOnOpacity="00700284";a.PatternOffOpacity="00700285";a.MajorTicksSequence="00700287";a.TickPosition="00700288";a.TickLabel="00700289";a.CompoundGraphicType="00700294";a.GraphicGroupID="00700295";a.ShapeType=
"00700306";a.RegistrationSequence="00700308";a.MatrixRegistrationSequence="00700309";a.MatrixSequence="0070030A";a.FrameOfReferenceTransformationMatrixType="0070030C";a.RegistrationTypeCodeSequence="0070030D";a.FiducialDescription="0070030F";a.FiducialIdentifier="00700310";a.FiducialIdentifierCodeSequence="00700311";a.ContourUncertaintyRadius="00700312";a.UsedFiducialsSequence="00700314";a.GraphicCoordinatesDataSequence="00700318";a.FiducialUID="0070031A";a.FiducialSetSequence="0070031C";a.FiducialSequence=
"0070031E";a.GraphicLayerRecommendedDisplayCIELabValue="00700401";a.BlendingSequence="00700402";a.RelativeOpacity="00700403";a.ReferencedSpatialRegistrationSequence="00700404";a.BlendingPosition="00700405";a.HangingProtocolName="00720002";a.HangingProtocolDescription="00720004";a.HangingProtocolLevel="00720006";a.HangingProtocolCreator="00720008";a.HangingProtocolCreationDateTime="0072000A";a.HangingProtocolDefinitionSequence="0072000C";a.HangingProtocolUserIdentificationCodeSequence="0072000E";a.HangingProtocolUserGroupName=
"00720010";a.SourceHangingProtocolSequence="00720012";a.NumberOfPriorsReferenced="00720014";a.ImageSetsSequence="00720020";a.ImageSetSelectorSequence="00720022";a.ImageSetSelectorUsageFlag="00720024";a.SelectorAttribute="00720026";a.SelectorValueNumber="00720028";a.TimeBasedImageSetsSequence="00720030";a.ImageSetNumber="00720032";a.ImageSetSelectorCategory="00720034";a.RelativeTime="00720038";a.RelativeTimeUnits="0072003A";a.AbstractPriorValue="0072003C";a.AbstractPriorCodeSequence="0072003E";a.ImageSetLabel=
"00720040";a.SelectorAttributeVR="00720050";a.SelectorSequencePointer="00720052";a.SelectorSequencePointerPrivateCreator="00720054";a.SelectorAttributePrivateCreator="00720056";a.SelectorATValue="00720060";a.SelectorCSValue="00720062";a.SelectorISValue="00720064";a.SelectorLOValue="00720066";a.SelectorLTValue="00720068";a.SelectorPNValue="0072006A";a.SelectorSHValue="0072006C";a.SelectorSTValue="0072006E";a.SelectorUTValue="00720070";a.SelectorDSValue="00720072";a.SelectorFDValue="00720074";a.SelectorFLValue=
"00720076";a.SelectorULValue="00720078";a.SelectorUSValue="0072007A";a.SelectorSLValue="0072007C";a.SelectorSSValue="0072007E";a.SelectorUIValue="0072007F";a.SelectorCodeSequenceValue="00720080";a.NumberOfScreens="00720100";a.NominalScreenDefinitionSequence="00720102";a.NumberOfVerticalPixels="00720104";a.NumberOfHorizontalPixels="00720106";a.DisplayEnvironmentSpatialPosition="00720108";a.ScreenMinimumGrayscaleBitDepth="0072010A";a.ScreenMinimumColorBitDepth="0072010C";a.ApplicationMaximumRepaintTime=
"0072010E";a.DisplaySetsSequence="00720200";a.DisplaySetNumber="00720202";a.DisplaySetLabel="00720203";a.DisplaySetPresentationGroup="00720204";a.DisplaySetPresentationGroupDescription="00720206";a.PartialDataDisplayHandling="00720208";a.SynchronizedScrollingSequence="00720210";a.DisplaySetScrollingGroup="00720212";a.NavigationIndicatorSequence="00720214";a.NavigationDisplaySet="00720216";a.ReferenceDisplaySets="00720218";a.ImageBoxesSequence="00720300";a.ImageBoxNumber="00720302";a.ImageBoxLayoutType=
"00720304";a.ImageBoxTileHorizontalDimension="00720306";a.ImageBoxTileVerticalDimension="00720308";a.ImageBoxScrollDirection="00720310";a.ImageBoxSmallScrollType="00720312";a.ImageBoxSmallScrollAmount="00720314";a.ImageBoxLargeScrollType="00720316";a.ImageBoxLargeScrollAmount="00720318";a.ImageBoxOverlapPriority="00720320";a.CineRelativeToRealTime="00720330";a.FilterOperationsSequence="00720400";a.FilterByCategory="00720402";a.FilterByAttributePresence="00720404";a.FilterByOperator="00720406";a.StructuredDisplayBackgroundCIELabValue=
"00720420";a.EmptyImageBoxCIELabValue="00720421";a.StructuredDisplayImageBoxSequence="00720422";a.StructuredDisplayTextBoxSequence="00720424";a.ReferencedFirstFrameSequence="00720427";a.ImageBoxSynchronizationSequence="00720430";a.SynchronizedImageBoxList="00720432";a.TypeOfSynchronization="00720434";a.BlendingOperationType="00720500";a.ReformattingOperationType="00720510";a.ReformattingThickness="00720512";a.ReformattingInterval="00720514";a.ReformattingOperationInitialViewDirection="00720516";a.ThreeDRenderingType=
"00720520";a.SortingOperationsSequence="00720600";a.SortByCategory="00720602";a.SortingDirection="00720604";a.DisplaySetPatientOrientation="00720700";a.VOIType="00720702";a.PseudoColorType="00720704";a.PseudoColorPaletteInstanceReferenceSequence="00720705";a.ShowGrayscaleInverted="00720706";a.ShowImageTrueSizeFlag="00720710";a.ShowGraphicAnnotationFlag="00720712";a.ShowPatientDemographicsFlag="00720714";a.ShowAcquisitionTechniquesFlag="00720716";a.DisplaySetHorizontalJustification="00720717";a.DisplaySetVerticalJustification=
"00720718";a.ContinuationStartMeterset="00740120";a.ContinuationEndMeterset="00740121";a.ProcedureStepState="00741000";a.ProcedureStepProgressInformationSequence="00741002";a.ProcedureStepProgress="00741004";a.ProcedureStepProgressDescription="00741006";a.ProcedureStepCommunicationsURISequence="00741008";a.ContactURI="0074100A";a.ContactDisplayName="0074100C";a.ProcedureStepDiscontinuationReasonCodeSequence="0074100E";a.BeamTaskSequence="00741020";a.BeamTaskType="00741022";a.BeamOrderIndexTrial="00741024";
a.AutosequenceFlag="00741025";a.TableTopVerticalAdjustedPosition="00741026";a.TableTopLongitudinalAdjustedPosition="00741027";a.TableTopLateralAdjustedPosition="00741028";a.PatientSupportAdjustedAngle="0074102A";a.TableTopEccentricAdjustedAngle="0074102B";a.TableTopPitchAdjustedAngle="0074102C";a.TableTopRollAdjustedAngle="0074102D";a.DeliveryVerificationImageSequence="00741030";a.VerificationImageTiming="00741032";a.DoubleExposureFlag="00741034";a.DoubleExposureOrdering="00741036";a.DoubleExposureMetersetTrial=
"00741038";a.DoubleExposureFieldDeltaTrial="0074103A";a.RelatedReferenceRTImageSequence="00741040";a.GeneralMachineVerificationSequence="00741042";a.ConventionalMachineVerificationSequence="00741044";a.IonMachineVerificationSequence="00741046";a.FailedAttributesSequence="00741048";a.OverriddenAttributesSequence="0074104A";a.ConventionalControlPointVerificationSequence="0074104C";a.IonControlPointVerificationSequence="0074104E";a.AttributeOccurrenceSequence="00741050";a.AttributeOccurrencePointer=
"00741052";a.AttributeItemSelector="00741054";a.AttributeOccurrencePrivateCreator="00741056";a.SelectorSequencePointerItems="00741057";a.ScheduledProcedureStepPriority="00741200";a.WorklistLabel="00741202";a.ProcedureStepLabel="00741204";a.ScheduledProcessingParametersSequence="00741210";a.PerformedProcessingParametersSequence="00741212";a.UnifiedProcedureStepPerformedProcedureSequence="00741216";a.RelatedProcedureStepSequence="00741220";a.ProcedureStepRelationshipType="00741222";a.ReplacedProcedureStepSequence=
"00741224";a.DeletionLock="00741230";a.ReceivingAE="00741234";a.RequestingAE="00741236";a.ReasonForCancellation="00741238";a.SCPStatus="00741242";a.SubscriptionListStatus="00741244";a.UnifiedProcedureStepListStatus="00741246";a.BeamOrderIndex="00741324";a.DoubleExposureMeterset="00741338";a.DoubleExposureFieldDelta="0074133A";a.ImplantAssemblyTemplateName="00760001";a.ImplantAssemblyTemplateIssuer="00760003";a.ImplantAssemblyTemplateVersion="00760006";a.ReplacedImplantAssemblyTemplateSequence="00760008";
a.ImplantAssemblyTemplateType="0076000A";a.OriginalImplantAssemblyTemplateSequence="0076000C";a.DerivationImplantAssemblyTemplateSequence="0076000E";a.ImplantAssemblyTemplateTargetAnatomySequence="00760010";a.ProcedureTypeCodeSequence="00760020";a.SurgicalTechnique="00760030";a.ComponentTypesSequence="00760032";a.ComponentTypeCodeSequence="00760034";a.ExclusiveComponentType="00760036";a.MandatoryComponentType="00760038";a.ComponentSequence="00760040";a.ComponentID="00760055";a.ComponentAssemblySequence=
"00760060";a.Component1ReferencedID="00760070";a.Component1ReferencedMatingFeatureSetID="00760080";a.Component1ReferencedMatingFeatureID="00760090";a.Component2ReferencedID="007600A0";a.Component2ReferencedMatingFeatureSetID="007600B0";a.Component2ReferencedMatingFeatureID="007600C0";a.ImplantTemplateGroupName="00780001";a.ImplantTemplateGroupDescription="00780010";a.ImplantTemplateGroupIssuer="00780020";a.ImplantTemplateGroupVersion="00780024";a.ReplacedImplantTemplateGroupSequence="00780026";a.ImplantTemplateGroupTargetAnatomySequence=
"00780028";a.ImplantTemplateGroupMembersSequence="0078002A";a.ImplantTemplateGroupMemberID="0078002E";a.ThreeDImplantTemplateGroupMemberMatchingPoint="00780050";a.ThreeDImplantTemplateGroupMemberMatchingAxes="00780060";a.ImplantTemplateGroupMemberMatching2DCoordinatesSequence="00780070";a.TwoDImplantTemplateGroupMemberMatchingPoint="00780090";a.TwoDImplantTemplateGroupMemberMatchingAxes="007800A0";a.ImplantTemplateGroupVariationDimensionSequence="007800B0";a.ImplantTemplateGroupVariationDimensionName=
"007800B2";a.ImplantTemplateGroupVariationDimensionRankSequence="007800B4";a.ReferencedImplantTemplateGroupMemberID="007800B6";a.ImplantTemplateGroupVariationDimensionRank="007800B8";a.SurfaceScanAcquisitionTypeCodeSequence="00800001";a.SurfaceScanModeCodeSequence="00800002";a.RegistrationMethodCodeSequence="00800003";a.ShotDurationTime="00800004";a.ShotOffsetTime="00800005";a.SurfacePointPresentationValueData="00800006";a.SurfacePointColorCIELabValueData="00800007";a.UVMappingSequence="00800008";
a.TextureLabel="00800009";a.UValueData="00800010";a.VValueData="00800011";a.ReferencedTextureSequence="00800012";a.ReferencedSurfaceDataSequence="00800013";a.StorageMediaFileSetID="00880130";a.StorageMediaFileSetUID="00880140";a.IconImageSequence="00880200";a.TopicTitle="00880904";a.TopicSubject="00880906";a.TopicAuthor="00880910";a.TopicKeywords="00880912";a.SOPInstanceStatus="01000410";a.SOPAuthorizationDateTime="01000420";a.SOPAuthorizationComment="01000424";a.AuthorizationEquipmentCertificationNumber=
"01000426";a.MACIDNumber="04000005";a.MACCalculationTransferSyntaxUID="04000010";a.MACAlgorithm="04000015";a.DataElementsSigned="04000020";a.DigitalSignatureUID="04000100";a.DigitalSignatureDateTime="04000105";a.CertificateType="04000110";a.CertificateOfSigner="04000115";a.Signature="04000120";a.CertifiedTimestampType="04000305";a.CertifiedTimestamp="04000310";a.DigitalSignaturePurposeCodeSequence="04000401";a.ReferencedDigitalSignatureSequence="04000402";a.ReferencedSOPInstanceMACSequence="04000403";
a.MAC="04000404";a.EncryptedAttributesSequence="04000500";a.EncryptedContentTransferSyntaxUID="04000510";a.EncryptedContent="04000520";a.ModifiedAttributesSequence="04000550";a.OriginalAttributesSequence="04000561";a.AttributeModificationDateTime="04000562";a.ModifyingSystem="04000563";a.SourceOfPreviousValues="04000564";a.ReasonForTheAttributeModification="04000565";a.EscapeTriplet="10000000";a.RunLengthTriplet="10000001";a.HuffmanTableSize="10000002";a.HuffmanTableTriplet="10000003";a.ShiftTableSize=
"10000004";a.ShiftTableTriplet="10000005";a.ZonalMap="10100000";a.NumberOfCopies="20000010";a.PrinterConfigurationSequence="2000001E";a.PrintPriority="20000020";a.MediumType="20000030";a.FilmDestination="20000040";a.FilmSessionLabel="20000050";a.MemoryAllocation="20000060";a.MaximumMemoryAllocation="20000061";a.ColorImagePrintingFlag="20000062";a.CollationFlag="20000063";a.AnnotationFlag="20000065";a.ImageOverlayFlag="20000067";a.PresentationLUTFlag="20000069";a.ImageBoxPresentationLUTFlag="2000006A";
a.MemoryBitDepth="200000A0";a.PrintingBitDepth="200000A1";a.MediaInstalledSequence="200000A2";a.OtherMediaAvailableSequence="200000A4";a.SupportedImageDisplayFormatsSequence="200000A8";a.ReferencedFilmBoxSequence="20000500";a.ReferencedStoredPrintSequence="20000510";a.ImageDisplayFormat="20100010";a.AnnotationDisplayFormatID="20100030";a.FilmOrientation="20100040";a.FilmSizeID="20100050";a.PrinterResolutionID="20100052";a.DefaultPrinterResolutionID="20100054";a.MagnificationType="20100060";a.SmoothingType=
"20100080";a.DefaultMagnificationType="201000A6";a.OtherMagnificationTypesAvailable="201000A7";a.DefaultSmoothingType="201000A8";a.OtherSmoothingTypesAvailable="201000A9";a.BorderDensity="20100100";a.EmptyImageDensity="20100110";a.MinDensity="20100120";a.MaxDensity="20100130";a.Trim="20100140";a.ConfigurationInformation="20100150";a.ConfigurationInformationDescription="20100152";a.MaximumCollatedFilms="20100154";a.Illumination="2010015E";a.ReflectedAmbientLight="20100160";a.PrinterPixelSpacing="20100376";
a.ReferencedFilmSessionSequence="20100500";a.ReferencedImageBoxSequence="20100510";a.ReferencedBasicAnnotationBoxSequence="20100520";a.ImageBoxPosition="20200010";a.Polarity="20200020";a.RequestedImageSize="20200030";a.RequestedDecimateCropBehavior="20200040";a.RequestedResolutionID="20200050";a.RequestedImageSizeFlag="202000A0";a.DecimateCropResult="202000A2";a.BasicGrayscaleImageSequence="20200110";a.BasicColorImageSequence="20200111";a.ReferencedImageOverlayBoxSequence="20200130";a.ReferencedVOILUTBoxSequence=
"20200140";a.AnnotationPosition="20300010";a.TextString="20300020";a.ReferencedOverlayPlaneSequence="20400010";a.ReferencedOverlayPlaneGroups="20400011";a.OverlayPixelDataSequence="20400020";a.OverlayMagnificationType="20400060";a.OverlaySmoothingType="20400070";a.OverlayOrImageMagnification="20400072";a.MagnifyToNumberOfColumns="20400074";a.OverlayForegroundDensity="20400080";a.OverlayBackgroundDensity="20400082";a.OverlayMode="20400090";a.ThresholdDensity="20400100";a.ReferencedImageBoxSequenceRetired=
"20400500";a.PresentationLUTSequence="20500010";a.PresentationLUTShape="20500020";a.ReferencedPresentationLUTSequence="20500500";a.PrintJobID="21000010";a.ExecutionStatus="21000020";a.ExecutionStatusInfo="21000030";a.CreationDate="21000040";a.CreationTime="21000050";a.Originator="21000070";a.DestinationAE="21000140";a.OwnerID="21000160";a.NumberOfFilms="21000170";a.ReferencedPrintJobSequencePullStoredPrint="21000500";a.PrinterStatus="21100010";a.PrinterStatusInfo="21100020";a.PrinterName="21100030";
a.PrintQueueID="21100099";a.QueueStatus="21200010";a.PrintJobDescriptionSequence="21200050";a.ReferencedPrintJobSequence="21200070";a.PrintManagementCapabilitiesSequence="21300010";a.PrinterCharacteristicsSequence="21300015";a.FilmBoxContentSequence="21300030";a.ImageBoxContentSequence="21300040";a.AnnotationContentSequence="21300050";a.ImageOverlayBoxContentSequence="21300060";a.PresentationLUTContentSequence="21300080";a.ProposedStudySequence="213000A0";a.OriginalImageSequence="213000C0";a.LabelUsingInformationExtractedFromInstances=
"22000001";a.LabelText="22000002";a.LabelStyleSelection="22000003";a.MediaDisposition="22000004";a.BarcodeValue="22000005";a.BarcodeSymbology="22000006";a.AllowMediaSplitting="22000007";a.IncludeNonDICOMObjects="22000008";a.IncludeDisplayApplication="22000009";a.PreserveCompositeInstancesAfterMediaCreation="2200000A";a.TotalNumberOfPiecesOfMediaCreated="2200000B";a.RequestedMediaApplicationProfile="2200000C";a.ReferencedStorageMediaSequence="2200000D";a.FailureAttributes="2200000E";a.AllowLossyCompression=
"2200000F";a.RequestPriority="22000020";a.RTImageLabel="30020002";a.RTImageName="30020003";a.RTImageDescription="30020004";a.ReportedValuesOrigin="3002000A";a.RTImagePlane="3002000C";a.XRayImageReceptorTranslation="3002000D";a.XRayImageReceptorAngle="3002000E";a.RTImageOrientation="30020010";a.ImagePlanePixelSpacing="30020011";a.RTImagePosition="30020012";a.RadiationMachineName="30020020";a.RadiationMachineSAD="30020022";a.RadiationMachineSSD="30020024";a.RTImageSID="30020026";a.SourceToReferenceObjectDistance=
"30020028";a.FractionNumber="30020029";a.ExposureSequence="30020030";a.MetersetExposure="30020032";a.DiaphragmPosition="30020034";a.FluenceMapSequence="30020040";a.FluenceDataSource="30020041";a.FluenceDataScale="30020042";a.PrimaryFluenceModeSequence="30020050";a.FluenceMode="30020051";a.FluenceModeID="30020052";a.DVHType="30040001";a.DoseUnits="30040002";a.DoseType="30040004";a.SpatialTransformOfDose="30040005";a.DoseComment="30040006";a.NormalizationPoint="30040008";a.DoseSummationType="3004000A";
a.GridFrameOffsetVector="3004000C";a.DoseGridScaling="3004000E";a.RTDoseROISequence="30040010";a.DoseValue="30040012";a.TissueHeterogeneityCorrection="30040014";a.DVHNormalizationPoint="30040040";a.DVHNormalizationDoseValue="30040042";a.DVHSequence="30040050";a.DVHDoseScaling="30040052";a.DVHVolumeUnits="30040054";a.DVHNumberOfBins="30040056";a.DVHData="30040058";a.DVHReferencedROISequence="30040060";a.DVHROIContributionType="30040062";a.DVHMinimumDose="30040070";a.DVHMaximumDose="30040072";a.DVHMeanDose=
"30040074";a.StructureSetLabel="30060002";a.StructureSetName="30060004";a.StructureSetDescription="30060006";a.StructureSetDate="30060008";a.StructureSetTime="30060009";a.ReferencedFrameOfReferenceSequence="30060010";a.RTReferencedStudySequence="30060012";a.RTReferencedSeriesSequence="30060014";a.ContourImageSequence="30060016";a.PredecessorStructureSetSequence="30060018";a.StructureSetROISequence="30060020";a.ROINumber="30060022";a.ReferencedFrameOfReferenceUID="30060024";a.ROIName="30060026";a.ROIDescription=
"30060028";a.ROIDisplayColor="3006002A";a.ROIVolume="3006002C";a.RTRelatedROISequence="30060030";a.RTROIRelationship="30060033";a.ROIGenerationAlgorithm="30060036";a.ROIGenerationDescription="30060038";a.ROIContourSequence="30060039";a.ContourSequence="30060040";a.ContourGeometricType="30060042";a.ContourSlabThickness="30060044";a.ContourOffsetVector="30060045";a.NumberOfContourPoints="30060046";a.ContourNumber="30060048";a.AttachedContours="30060049";a.ContourData="30060050";a.RTROIObservationsSequence=
"30060080";a.ObservationNumber="30060082";a.ReferencedROINumber="30060084";a.ROIObservationLabel="30060085";a.RTROIIdentificationCodeSequence="30060086";a.ROIObservationDescription="30060088";a.RelatedRTROIObservationsSequence="300600A0";a.RTROIInterpretedType="300600A4";a.ROIInterpreter="300600A6";a.ROIPhysicalPropertiesSequence="300600B0";a.ROIPhysicalProperty="300600B2";a.ROIPhysicalPropertyValue="300600B4";a.ROIElementalCompositionSequence="300600B6";a.ROIElementalCompositionAtomicNumber="300600B7";
a.ROIElementalCompositionAtomicMassFraction="300600B8";a.AdditionalRTROIIdentificationCodeSequence="300600B9";a.FrameOfReferenceRelationshipSequence="300600C0";a.RelatedFrameOfReferenceUID="300600C2";a.FrameOfReferenceTransformationType="300600C4";a.FrameOfReferenceTransformationMatrix="300600C6";a.FrameOfReferenceTransformationComment="300600C8";a.MeasuredDoseReferenceSequence="30080010";a.MeasuredDoseDescription="30080012";a.MeasuredDoseType="30080014";a.MeasuredDoseValue="30080016";a.TreatmentSessionBeamSequence=
"30080020";a.TreatmentSessionIonBeamSequence="30080021";a.CurrentFractionNumber="30080022";a.TreatmentControlPointDate="30080024";a.TreatmentControlPointTime="30080025";a.TreatmentTerminationStatus="3008002A";a.TreatmentTerminationCode="3008002B";a.TreatmentVerificationStatus="3008002C";a.ReferencedTreatmentRecordSequence="30080030";a.SpecifiedPrimaryMeterset="30080032";a.SpecifiedSecondaryMeterset="30080033";a.DeliveredPrimaryMeterset="30080036";a.DeliveredSecondaryMeterset="30080037";a.SpecifiedTreatmentTime=
"3008003A";a.DeliveredTreatmentTime="3008003B";a.ControlPointDeliverySequence="30080040";a.IonControlPointDeliverySequence="30080041";a.SpecifiedMeterset="30080042";a.DeliveredMeterset="30080044";a.MetersetRateSet="30080045";a.MetersetRateDelivered="30080046";a.ScanSpotMetersetsDelivered="30080047";a.DoseRateDelivered="30080048";a.TreatmentSummaryCalculatedDoseReferenceSequence="30080050";a.CumulativeDoseToDoseReference="30080052";a.FirstTreatmentDate="30080054";a.MostRecentTreatmentDate="30080056";
a.NumberOfFractionsDelivered="3008005A";a.OverrideSequence="30080060";a.ParameterSequencePointer="30080061";a.OverrideParameterPointer="30080062";a.ParameterItemIndex="30080063";a.MeasuredDoseReferenceNumber="30080064";a.ParameterPointer="30080065";a.OverrideReason="30080066";a.CorrectedParameterSequence="30080068";a.CorrectionValue="3008006A";a.CalculatedDoseReferenceSequence="30080070";a.CalculatedDoseReferenceNumber="30080072";a.CalculatedDoseReferenceDescription="30080074";a.CalculatedDoseReferenceDoseValue=
"30080076";a.StartMeterset="30080078";a.EndMeterset="3008007A";a.ReferencedMeasuredDoseReferenceSequence="30080080";a.ReferencedMeasuredDoseReferenceNumber="30080082";a.ReferencedCalculatedDoseReferenceSequence="30080090";a.ReferencedCalculatedDoseReferenceNumber="30080092";a.BeamLimitingDeviceLeafPairsSequence="300800A0";a.RecordedWedgeSequence="300800B0";a.RecordedCompensatorSequence="300800C0";a.RecordedBlockSequence="300800D0";a.TreatmentSummaryMeasuredDoseReferenceSequence="300800E0";a.RecordedSnoutSequence=
"300800F0";a.RecordedRangeShifterSequence="300800F2";a.RecordedLateralSpreadingDeviceSequence="300800F4";a.RecordedRangeModulatorSequence="300800F6";a.RecordedSourceSequence="30080100";a.SourceSerialNumber="30080105";a.TreatmentSessionApplicationSetupSequence="30080110";a.ApplicationSetupCheck="30080116";a.RecordedBrachyAccessoryDeviceSequence="30080120";a.ReferencedBrachyAccessoryDeviceNumber="30080122";a.RecordedChannelSequence="30080130";a.SpecifiedChannelTotalTime="30080132";a.DeliveredChannelTotalTime=
"30080134";a.SpecifiedNumberOfPulses="30080136";a.DeliveredNumberOfPulses="30080138";a.SpecifiedPulseRepetitionInterval="3008013A";a.DeliveredPulseRepetitionInterval="3008013C";a.RecordedSourceApplicatorSequence="30080140";a.ReferencedSourceApplicatorNumber="30080142";a.RecordedChannelShieldSequence="30080150";a.ReferencedChannelShieldNumber="30080152";a.BrachyControlPointDeliveredSequence="30080160";a.SafePositionExitDate="30080162";a.SafePositionExitTime="30080164";a.SafePositionReturnDate="30080166";
a.SafePositionReturnTime="30080168";a.PulseSpecificBrachyControlPointDeliveredSequence="30080171";a.PulseNumber="30080172";a.BrachyPulseControlPointDeliveredSequence="30080173";a.CurrentTreatmentStatus="30080200";a.TreatmentStatusComment="30080202";a.FractionGroupSummarySequence="30080220";a.ReferencedFractionNumber="30080223";a.FractionGroupType="30080224";a.BeamStopperPosition="30080230";a.FractionStatusSummarySequence="30080240";a.TreatmentDate="30080250";a.TreatmentTime="30080251";a.RTPlanLabel=
"300A0002";a.RTPlanName="300A0003";a.RTPlanDescription="300A0004";a.RTPlanDate="300A0006";a.RTPlanTime="300A0007";a.TreatmentProtocols="300A0009";a.PlanIntent="300A000A";a.TreatmentSites="300A000B";a.RTPlanGeometry="300A000C";a.PrescriptionDescription="300A000E";a.DoseReferenceSequence="300A0010";a.DoseReferenceNumber="300A0012";a.DoseReferenceUID="300A0013";a.DoseReferenceStructureType="300A0014";a.NominalBeamEnergyUnit="300A0015";a.DoseReferenceDescription="300A0016";a.DoseReferencePointCoordinates=
"300A0018";a.NominalPriorDose="300A001A";a.DoseReferenceType="300A0020";a.ConstraintWeight="300A0021";a.DeliveryWarningDose="300A0022";a.DeliveryMaximumDose="300A0023";a.TargetMinimumDose="300A0025";a.TargetPrescriptionDose="300A0026";a.TargetMaximumDose="300A0027";a.TargetUnderdoseVolumeFraction="300A0028";a.OrganAtRiskFullVolumeDose="300A002A";a.OrganAtRiskLimitDose="300A002B";a.OrganAtRiskMaximumDose="300A002C";a.OrganAtRiskOverdoseVolumeFraction="300A002D";a.ToleranceTableSequence="300A0040";
a.ToleranceTableNumber="300A0042";a.ToleranceTableLabel="300A0043";a.GantryAngleTolerance="300A0044";a.BeamLimitingDeviceAngleTolerance="300A0046";a.BeamLimitingDeviceToleranceSequence="300A0048";a.BeamLimitingDevicePositionTolerance="300A004A";a.SnoutPositionTolerance="300A004B";a.PatientSupportAngleTolerance="300A004C";a.TableTopEccentricAngleTolerance="300A004E";a.TableTopPitchAngleTolerance="300A004F";a.TableTopRollAngleTolerance="300A0050";a.TableTopVerticalPositionTolerance="300A0051";a.TableTopLongitudinalPositionTolerance=
"300A0052";a.TableTopLateralPositionTolerance="300A0053";a.RTPlanRelationship="300A0055";a.FractionGroupSequence="300A0070";a.FractionGroupNumber="300A0071";a.FractionGroupDescription="300A0072";a.NumberOfFractionsPlanned="300A0078";a.NumberOfFractionPatternDigitsPerDay="300A0079";a.RepeatFractionCycleLength="300A007A";a.FractionPattern="300A007B";a.NumberOfBeams="300A0080";a.BeamDoseSpecificationPoint="300A0082";a.BeamDose="300A0084";a.BeamMeterset="300A0086";a.BeamDosePointDepth="300A0088";a.BeamDosePointEquivalentDepth=
"300A0089";a.BeamDosePointSSD="300A008A";a.BeamDoseMeaning="300A008B";a.BeamDoseVerificationControlPointSequence="300A008C";a.AverageBeamDosePointDepth="300A008D";a.AverageBeamDosePointEquivalentDepth="300A008E";a.AverageBeamDosePointSSD="300A008F";a.NumberOfBrachyApplicationSetups="300A00A0";a.BrachyApplicationSetupDoseSpecificationPoint="300A00A2";a.BrachyApplicationSetupDose="300A00A4";a.BeamSequence="300A00B0";a.TreatmentMachineName="300A00B2";a.PrimaryDosimeterUnit="300A00B3";a.SourceAxisDistance=
"300A00B4";a.BeamLimitingDeviceSequence="300A00B6";a.RTBeamLimitingDeviceType="300A00B8";a.SourceToBeamLimitingDeviceDistance="300A00BA";a.IsocenterToBeamLimitingDeviceDistance="300A00BB";a.NumberOfLeafJawPairs="300A00BC";a.LeafPositionBoundaries="300A00BE";a.BeamNumber="300A00C0";a.BeamName="300A00C2";a.BeamDescription="300A00C3";a.BeamType="300A00C4";a.BeamDeliveryDurationLimit="300A00C5";a.RadiationType="300A00C6";a.HighDoseTechniqueType="300A00C7";a.ReferenceImageNumber="300A00C8";a.PlannedVerificationImageSequence=
"300A00CA";a.ImagingDeviceSpecificAcquisitionParameters="300A00CC";a.TreatmentDeliveryType="300A00CE";a.NumberOfWedges="300A00D0";a.WedgeSequence="300A00D1";a.WedgeNumber="300A00D2";a.WedgeType="300A00D3";a.WedgeID="300A00D4";a.WedgeAngle="300A00D5";a.WedgeFactor="300A00D6";a.TotalWedgeTrayWaterEquivalentThickness="300A00D7";a.WedgeOrientation="300A00D8";a.IsocenterToWedgeTrayDistance="300A00D9";a.SourceToWedgeTrayDistance="300A00DA";a.WedgeThinEdgePosition="300A00DB";a.BolusID="300A00DC";a.BolusDescription=
"300A00DD";a.EffectiveWedgeAngle="300A00DE";a.NumberOfCompensators="300A00E0";a.MaterialID="300A00E1";a.TotalCompensatorTrayFactor="300A00E2";a.CompensatorSequence="300A00E3";a.CompensatorNumber="300A00E4";a.CompensatorID="300A00E5";a.SourceToCompensatorTrayDistance="300A00E6";a.CompensatorRows="300A00E7";a.CompensatorColumns="300A00E8";a.CompensatorPixelSpacing="300A00E9";a.CompensatorPosition="300A00EA";a.CompensatorTransmissionData="300A00EB";a.CompensatorThicknessData="300A00EC";a.NumberOfBoli=
"300A00ED";a.CompensatorType="300A00EE";a.CompensatorTrayID="300A00EF";a.NumberOfBlocks="300A00F0";a.TotalBlockTrayFactor="300A00F2";a.TotalBlockTrayWaterEquivalentThickness="300A00F3";a.BlockSequence="300A00F4";a.BlockTrayID="300A00F5";a.SourceToBlockTrayDistance="300A00F6";a.IsocenterToBlockTrayDistance="300A00F7";a.BlockType="300A00F8";a.AccessoryCode="300A00F9";a.BlockDivergence="300A00FA";a.BlockMountingPosition="300A00FB";a.BlockNumber="300A00FC";a.BlockName="300A00FE";a.BlockThickness="300A0100";
a.BlockTransmission="300A0102";a.BlockNumberOfPoints="300A0104";a.BlockData="300A0106";a.ApplicatorSequence="300A0107";a.ApplicatorID="300A0108";a.ApplicatorType="300A0109";a.ApplicatorDescription="300A010A";a.CumulativeDoseReferenceCoefficient="300A010C";a.FinalCumulativeMetersetWeight="300A010E";a.NumberOfControlPoints="300A0110";a.ControlPointSequence="300A0111";a.ControlPointIndex="300A0112";a.NominalBeamEnergy="300A0114";a.DoseRateSet="300A0115";a.WedgePositionSequence="300A0116";a.WedgePosition=
"300A0118";a.BeamLimitingDevicePositionSequence="300A011A";a.LeafJawPositions="300A011C";a.GantryAngle="300A011E";a.GantryRotationDirection="300A011F";a.BeamLimitingDeviceAngle="300A0120";a.BeamLimitingDeviceRotationDirection="300A0121";a.PatientSupportAngle="300A0122";a.PatientSupportRotationDirection="300A0123";a.TableTopEccentricAxisDistance="300A0124";a.TableTopEccentricAngle="300A0125";a.TableTopEccentricRotationDirection="300A0126";a.TableTopVerticalPosition="300A0128";a.TableTopLongitudinalPosition=
"300A0129";a.TableTopLateralPosition="300A012A";a.IsocenterPosition="300A012C";a.SurfaceEntryPoint="300A012E";a.SourceToSurfaceDistance="300A0130";a.AverageBeamDosePointSourceToExternalContourSurfaceDistance="300A0131";a.SourceToExternalContourDistance="300A0132";a.ExternalContourEntryPoint="300A0133";a.CumulativeMetersetWeight="300A0134";a.TableTopPitchAngle="300A0140";a.TableTopPitchRotationDirection="300A0142";a.TableTopRollAngle="300A0144";a.TableTopRollRotationDirection="300A0146";a.HeadFixationAngle=
"300A0148";a.GantryPitchAngle="300A014A";a.GantryPitchRotationDirection="300A014C";a.GantryPitchAngleTolerance="300A014E";a.PatientSetupSequence="300A0180";a.PatientSetupNumber="300A0182";a.PatientSetupLabel="300A0183";a.PatientAdditionalPosition="300A0184";a.FixationDeviceSequence="300A0190";a.FixationDeviceType="300A0192";a.FixationDeviceLabel="300A0194";a.FixationDeviceDescription="300A0196";a.FixationDevicePosition="300A0198";a.FixationDevicePitchAngle="300A0199";a.FixationDeviceRollAngle="300A019A";
a.ShieldingDeviceSequence="300A01A0";a.ShieldingDeviceType="300A01A2";a.ShieldingDeviceLabel="300A01A4";a.ShieldingDeviceDescription="300A01A6";a.ShieldingDevicePosition="300A01A8";a.SetupTechnique="300A01B0";a.SetupTechniqueDescription="300A01B2";a.SetupDeviceSequence="300A01B4";a.SetupDeviceType="300A01B6";a.SetupDeviceLabel="300A01B8";a.SetupDeviceDescription="300A01BA";a.SetupDeviceParameter="300A01BC";a.SetupReferenceDescription="300A01D0";a.TableTopVerticalSetupDisplacement="300A01D2";a.TableTopLongitudinalSetupDisplacement=
"300A01D4";a.TableTopLateralSetupDisplacement="300A01D6";a.BrachyTreatmentTechnique="300A0200";a.BrachyTreatmentType="300A0202";a.TreatmentMachineSequence="300A0206";a.SourceSequence="300A0210";a.SourceNumber="300A0212";a.SourceType="300A0214";a.SourceManufacturer="300A0216";a.ActiveSourceDiameter="300A0218";a.ActiveSourceLength="300A021A";a.SourceModelID="300A021B";a.SourceDescription="300A021C";a.SourceEncapsulationNominalThickness="300A0222";a.SourceEncapsulationNominalTransmission="300A0224";
a.SourceIsotopeName="300A0226";a.SourceIsotopeHalfLife="300A0228";a.SourceStrengthUnits="300A0229";a.ReferenceAirKermaRate="300A022A";a.SourceStrength="300A022B";a.SourceStrengthReferenceDate="300A022C";a.SourceStrengthReferenceTime="300A022E";a.ApplicationSetupSequence="300A0230";a.ApplicationSetupType="300A0232";a.ApplicationSetupNumber="300A0234";a.ApplicationSetupName="300A0236";a.ApplicationSetupManufacturer="300A0238";a.TemplateNumber="300A0240";a.TemplateType="300A0242";a.TemplateName="300A0244";
a.TotalReferenceAirKerma="300A0250";a.BrachyAccessoryDeviceSequence="300A0260";a.BrachyAccessoryDeviceNumber="300A0262";a.BrachyAccessoryDeviceID="300A0263";a.BrachyAccessoryDeviceType="300A0264";a.BrachyAccessoryDeviceName="300A0266";a.BrachyAccessoryDeviceNominalThickness="300A026A";a.BrachyAccessoryDeviceNominalTransmission="300A026C";a.ChannelSequence="300A0280";a.ChannelNumber="300A0282";a.ChannelLength="300A0284";a.ChannelTotalTime="300A0286";a.SourceMovementType="300A0288";a.NumberOfPulses=
"300A028A";a.PulseRepetitionInterval="300A028C";a.SourceApplicatorNumber="300A0290";a.SourceApplicatorID="300A0291";a.SourceApplicatorType="300A0292";a.SourceApplicatorName="300A0294";a.SourceApplicatorLength="300A0296";a.SourceApplicatorManufacturer="300A0298";a.SourceApplicatorWallNominalThickness="300A029C";a.SourceApplicatorWallNominalTransmission="300A029E";a.SourceApplicatorStepSize="300A02A0";a.TransferTubeNumber="300A02A2";a.TransferTubeLength="300A02A4";a.ChannelShieldSequence="300A02B0";
a.ChannelShieldNumber="300A02B2";a.ChannelShieldID="300A02B3";a.ChannelShieldName="300A02B4";a.ChannelShieldNominalThickness="300A02B8";a.ChannelShieldNominalTransmission="300A02BA";a.FinalCumulativeTimeWeight="300A02C8";a.BrachyControlPointSequence="300A02D0";a.ControlPointRelativePosition="300A02D2";a.ControlPoint3DPosition="300A02D4";a.CumulativeTimeWeight="300A02D6";a.CompensatorDivergence="300A02E0";a.CompensatorMountingPosition="300A02E1";a.SourceToCompensatorDistance="300A02E2";a.TotalCompensatorTrayWaterEquivalentThickness=
"300A02E3";a.IsocenterToCompensatorTrayDistance="300A02E4";a.CompensatorColumnOffset="300A02E5";a.IsocenterToCompensatorDistances="300A02E6";a.CompensatorRelativeStoppingPowerRatio="300A02E7";a.CompensatorMillingToolDiameter="300A02E8";a.IonRangeCompensatorSequence="300A02EA";a.CompensatorDescription="300A02EB";a.RadiationMassNumber="300A0302";a.RadiationAtomicNumber="300A0304";a.RadiationChargeState="300A0306";a.ScanMode="300A0308";a.VirtualSourceAxisDistances="300A030A";a.SnoutSequence="300A030C";
a.SnoutPosition="300A030D";a.SnoutID="300A030F";a.NumberOfRangeShifters="300A0312";a.RangeShifterSequence="300A0314";a.RangeShifterNumber="300A0316";a.RangeShifterID="300A0318";a.RangeShifterType="300A0320";a.RangeShifterDescription="300A0322";a.NumberOfLateralSpreadingDevices="300A0330";a.LateralSpreadingDeviceSequence="300A0332";a.LateralSpreadingDeviceNumber="300A0334";a.LateralSpreadingDeviceID="300A0336";a.LateralSpreadingDeviceType="300A0338";a.LateralSpreadingDeviceDescription="300A033A";a.LateralSpreadingDeviceWaterEquivalentThickness=
"300A033C";a.NumberOfRangeModulators="300A0340";a.RangeModulatorSequence="300A0342";a.RangeModulatorNumber="300A0344";a.RangeModulatorID="300A0346";a.RangeModulatorType="300A0348";a.RangeModulatorDescription="300A034A";a.BeamCurrentModulationID="300A034C";a.PatientSupportType="300A0350";a.PatientSupportID="300A0352";a.PatientSupportAccessoryCode="300A0354";a.FixationLightAzimuthalAngle="300A0356";a.FixationLightPolarAngle="300A0358";a.MetersetRate="300A035A";a.RangeShifterSettingsSequence="300A0360";
a.RangeShifterSetting="300A0362";a.IsocenterToRangeShifterDistance="300A0364";a.RangeShifterWaterEquivalentThickness="300A0366";a.LateralSpreadingDeviceSettingsSequence="300A0370";a.LateralSpreadingDeviceSetting="300A0372";a.IsocenterToLateralSpreadingDeviceDistance="300A0374";a.RangeModulatorSettingsSequence="300A0380";a.RangeModulatorGatingStartValue="300A0382";a.RangeModulatorGatingStopValue="300A0384";a.RangeModulatorGatingStartWaterEquivalentThickness="300A0386";a.RangeModulatorGatingStopWaterEquivalentThickness=
"300A0388";a.IsocenterToRangeModulatorDistance="300A038A";a.ScanSpotTuneID="300A0390";a.NumberOfScanSpotPositions="300A0392";a.ScanSpotPositionMap="300A0394";a.ScanSpotMetersetWeights="300A0396";a.ScanningSpotSize="300A0398";a.NumberOfPaintings="300A039A";a.IonToleranceTableSequence="300A03A0";a.IonBeamSequence="300A03A2";a.IonBeamLimitingDeviceSequence="300A03A4";a.IonBlockSequence="300A03A6";a.IonControlPointSequence="300A03A8";a.IonWedgeSequence="300A03AA";a.IonWedgePositionSequence="300A03AC";
a.ReferencedSetupImageSequence="300A0401";a.SetupImageComment="300A0402";a.MotionSynchronizationSequence="300A0410";a.ControlPointOrientation="300A0412";a.GeneralAccessorySequence="300A0420";a.GeneralAccessoryID="300A0421";a.GeneralAccessoryDescription="300A0422";a.GeneralAccessoryType="300A0423";a.GeneralAccessoryNumber="300A0424";a.SourceToGeneralAccessoryDistance="300A0425";a.ApplicatorGeometrySequence="300A0431";a.ApplicatorApertureShape="300A0432";a.ApplicatorOpening="300A0433";a.ApplicatorOpeningX=
"300A0434";a.ApplicatorOpeningY="300A0435";a.SourceToApplicatorMountingPositionDistance="300A0436";a.NumberOfBlockSlabItems="300A0440";a.BlockSlabSequence="300A0441";a.BlockSlabThickness="300A0442";a.BlockSlabNumber="300A0443";a.DeviceMotionControlSequence="300A0450";a.DeviceMotionExecutionMode="300A0451";a.DeviceMotionObservationMode="300A0452";a.DeviceMotionParameterCodeSequence="300A0453";a.ReferencedRTPlanSequence="300C0002";a.ReferencedBeamSequence="300C0004";a.ReferencedBeamNumber="300C0006";
a.ReferencedReferenceImageNumber="300C0007";a.StartCumulativeMetersetWeight="300C0008";a.EndCumulativeMetersetWeight="300C0009";a.ReferencedBrachyApplicationSetupSequence="300C000A";a.ReferencedBrachyApplicationSetupNumber="300C000C";a.ReferencedSourceNumber="300C000E";a.ReferencedFractionGroupSequence="300C0020";a.ReferencedFractionGroupNumber="300C0022";a.ReferencedVerificationImageSequence="300C0040";a.ReferencedReferenceImageSequence="300C0042";a.ReferencedDoseReferenceSequence="300C0050";a.ReferencedDoseReferenceNumber=
"300C0051";a.BrachyReferencedDoseReferenceSequence="300C0055";a.ReferencedStructureSetSequence="300C0060";a.ReferencedPatientSetupNumber="300C006A";a.ReferencedDoseSequence="300C0080";a.ReferencedToleranceTableNumber="300C00A0";a.ReferencedBolusSequence="300C00B0";a.ReferencedWedgeNumber="300C00C0";a.ReferencedCompensatorNumber="300C00D0";a.ReferencedBlockNumber="300C00E0";a.ReferencedControlPointIndex="300C00F0";a.ReferencedControlPointSequence="300C00F2";a.ReferencedStartControlPointIndex="300C00F4";
a.ReferencedStopControlPointIndex="300C00F6";a.ReferencedRangeShifterNumber="300C0100";a.ReferencedLateralSpreadingDeviceNumber="300C0102";a.ReferencedRangeModulatorNumber="300C0104";a.OmittedBeamTaskSequence="300C0111";a.ReasonForOmission="300C0112";a.ReasonForOmissionDescription="300C0113";a.ApprovalStatus="300E0002";a.ReviewDate="300E0004";a.ReviewTime="300E0005";a.ReviewerName="300E0008";a.Arbitrary="40000010";a.TextComments="40004000";a.ResultsID="40080040";a.ResultsIDIssuer="40080042";a.ReferencedInterpretationSequence=
"40080050";a.ReportProductionStatusTrial="400800FF";a.InterpretationRecordedDate="40080100";a.InterpretationRecordedTime="40080101";a.InterpretationRecorder="40080102";a.ReferenceToRecordedSound="40080103";a.InterpretationTranscriptionDate="40080108";a.InterpretationTranscriptionTime="40080109";a.InterpretationTranscriber="4008010A";a.InterpretationText="4008010B";a.InterpretationAuthor="4008010C";a.InterpretationApproverSequence="40080111";a.InterpretationApprovalDate="40080112";a.InterpretationApprovalTime=
"40080113";a.PhysicianApprovingInterpretation="40080114";a.InterpretationDiagnosisDescription="40080115";a.InterpretationDiagnosisCodeSequence="40080117";a.ResultsDistributionListSequence="40080118";a.DistributionName="40080119";a.DistributionAddress="4008011A";a.InterpretationID="40080200";a.InterpretationIDIssuer="40080202";a.InterpretationTypeID="40080210";a.InterpretationStatusID="40080212";a.Impressions="40080300";a.ResultsComments="40084000";a.LowEnergyDetectors="40100001";a.HighEnergyDetectors=
"40100002";a.DetectorGeometrySequence="40100004";a.ThreatROIVoxelSequence="40101001";a.ThreatROIBase="40101004";a.ThreatROIExtents="40101005";a.ThreatROIBitmap="40101006";a.RouteSegmentID="40101007";a.GantryType="40101008";a.OOIOwnerType="40101009";a.RouteSegmentSequence="4010100A";a.PotentialThreatObjectID="40101010";a.ThreatSequence="40101011";a.ThreatCategory="40101012";a.ThreatCategoryDescription="40101013";a.ATDAbilityAssessment="40101014";a.ATDAssessmentFlag="40101015";a.ATDAssessmentProbability=
"40101016";a.Mass="40101017";a.Density="40101018";a.ZEffective="40101019";a.BoardingPassID="4010101A";a.CenterOfMass="4010101B";a.CenterOfPTO="4010101C";a.BoundingPolygon="4010101D";a.RouteSegmentStartLocationID="4010101E";a.RouteSegmentEndLocationID="4010101F";a.RouteSegmentLocationIDType="40101020";a.AbortReason="40101021";a.VolumeOfPTO="40101023";a.AbortFlag="40101024";a.RouteSegmentStartTime="40101025";a.RouteSegmentEndTime="40101026";a.TDRType="40101027";a.InternationalRouteSegment="40101028";
a.ThreatDetectionAlgorithmAndVersion="40101029";a.AssignedLocation="4010102A";a.AlarmDecisionTime="4010102B";a.AlarmDecision="40101031";a.NumberOfTotalObjects="40101033";a.NumberOfAlarmObjects="40101034";a.PTORepresentationSequence="40101037";a.ATDAssessmentSequence="40101038";a.TIPType="40101039";a.DICOSVersion="4010103A";a.OOIOwnerCreationTime="40101041";a.OOIType="40101042";a.OOISize="40101043";a.AcquisitionStatus="40101044";a.BasisMaterialsCodeSequence="40101045";a.PhantomType="40101046";a.OOIOwnerSequence=
"40101047";a.ScanType="40101048";a.ItineraryID="40101051";a.ItineraryIDType="40101052";a.ItineraryIDAssigningAuthority="40101053";a.RouteID="40101054";a.RouteIDAssigningAuthority="40101055";a.InboundArrivalType="40101056";a.CarrierID="40101058";a.CarrierIDAssigningAuthority="40101059";a.SourceOrientation="40101060";a.SourcePosition="40101061";a.BeltHeight="40101062";a.AlgorithmRoutingCodeSequence="40101064";a.TransportClassification="40101067";a.OOITypeDescriptor="40101068";a.TotalProcessingTime=
"40101069";a.DetectorCalibrationData="4010106C";a.AdditionalScreeningPerformed="4010106D";a.AdditionalInspectionSelectionCriteria="4010106E";a.AdditionalInspectionMethodSequence="4010106F";a.AITDeviceType="40101070";a.QRMeasurementsSequence="40101071";a.TargetMaterialSequence="40101072";a.SNRThreshold="40101073";a.ImageScaleRepresentation="40101075";a.ReferencedPTOSequence="40101076";a.ReferencedTDRInstanceSequence="40101077";a.PTOLocationDescription="40101078";a.AnomalyLocatorIndicatorSequence="40101079";
a.AnomalyLocatorIndicator="4010107A";a.PTORegionSequence="4010107B";a.InspectionSelectionCriteria="4010107C";a.SecondaryInspectionMethodSequence="4010107D";a.PRCSToRCSOrientation="4010107E";a.MACParametersSequence="4FFE0001";a.CurveDimensions="50000005";a.NumberOfPoints="50000010";a.TypeOfData="50000020";a.CurveDescription="50000022";a.AxisUnits="50000030";a.AxisLabels="50000040";a.DataValueRepresentation="50000103";a.MinimumCoordinateValue="50000104";a.MaximumCoordinateValue="50000105";a.CurveRange=
"50000106";a.CurveDataDescriptor="50000110";a.CoordinateStartValue="50000112";a.CoordinateStepValue="50000114";a.CurveActivationLayer="50001001";a.AudioType="50002000";a.AudioSampleFormat="50002002";a.NumberOfChannels="50002004";a.NumberOfSamples="50002006";a.SampleRate="50002008";a.TotalTime="5000200A";a.AudioSampleData="5000200C";a.AudioComments="5000200E";a.CurveLabel="50002500";a.CurveReferencedOverlaySequence="50002600";a.CurveReferencedOverlayGroup="50002610";a.CurveData="50003000";a.SharedFunctionalGroupsSequence=
"52009229";a.PerFrameFunctionalGroupsSequence="52009230";a.WaveformSequence="54000100";a.ChannelMinimumValue="54000110";a.ChannelMaximumValue="54000112";a.WaveformBitsAllocated="54001004";a.WaveformSampleInterpretation="54001006";a.WaveformPaddingValue="5400100A";a.WaveformData="54001010";a.FirstOrderPhaseCorrectionAngle="56000010";a.SpectroscopyData="56000020";a.OverlayRows="60000010";a.OverlayColumns="60000011";a.OverlayPlanes="60000012";a.NumberOfFramesInOverlay="60000015";a.OverlayDescription=
"60000022";a.OverlayType="60000040";a.OverlaySubtype="60000045";a.OverlayOrigin="60000050";a.ImageFrameOrigin="60000051";a.OverlayPlaneOrigin="60000052";a.OverlayCompressionCode="60000060";a.OverlayCompressionOriginator="60000061";a.OverlayCompressionLabel="60000062";a.OverlayCompressionDescription="60000063";a.OverlayCompressionStepPointers="60000066";a.OverlayRepeatInterval="60000068";a.OverlayBitsGrouped="60000069";a.OverlayBitsAllocated="60000100";a.OverlayBitPosition="60000102";a.OverlayFormat=
"60000110";a.OverlayLocation="60000200";a.OverlayCodeLabel="60000800";a.OverlayNumberOfTables="60000802";a.OverlayCodeTableLocation="60000803";a.OverlayBitsForCodeWord="60000804";a.OverlayActivationLayer="60001001";a.OverlayDescriptorGray="60001100";a.OverlayDescriptorRed="60001101";a.OverlayDescriptorGreen="60001102";a.OverlayDescriptorBlue="60001103";a.OverlaysGray="60001200";a.OverlaysRed="60001201";a.OverlaysGreen="60001202";a.OverlaysBlue="60001203";a.ROIArea="60001301";a.ROIMean="60001302";
a.ROIStandardDeviation="60001303";a.OverlayLabel="60001500";a.OverlayData="60003000";a.OverlayComments="60004000";a.FloatPixelData="7FE00008";a.DoubleFloatPixelData="7FE00009";a.PixelData="7FE00010";a.CoefficientsSDVN="7FE00020";a.CoefficientsSDHN="7FE00030";a.CoefficientsSDDN="7FE00040";a.VariablePixelData="7F000010";a.VariableNextDataGroup="7F000011";a.VariableCoefficientsSDVN="7F000020";a.VariableCoefficientsSDHN="7F000030";a.VariableCoefficientsSDDN="7F000040";a.DigitalSignaturesSequence="FFFAFFFA";
a.DataSetTrailingPadding="FFFCFFFC";a.Item="FFFEE000";a.ItemDelimitationItem="FFFEE00D";a.SequenceDelimitationItem="FFFEE0DD"})(DicomTag||(DicomTag={}));
var DicomHelper=function(){function a(){}a.supportWindowLevel=function(a,d){return a.supportWindowLevel?a.supportWindowLevel(d):!0};a.PreparePresentationInformation=function(a,d){var b=new Models.FramePresentationInfo;b.orientation=null;b.width=100;b.height=100;b.position=[1,1,1];b.instanceNumber=1;b.rowSpacing=0;b.columnSpacing=0;b.cineOptions=a.Cine;if(null==a||a.PagesPresentationInfo.length<=d)return b;d=a.PagesPresentationInfo[d];if(null==d)return b;null!=d.ImageOrientationPatientArray?b.orientation=
d.ImageOrientationPatientArray:null!=d.PatientOrientation&&(b.patientOrientation=d.PatientOrientation);null!=d.Width&&(b.width=d.Width[0]);null!=d.Height&&(b.height=d.Height[0]);b.position=null!=d.ImagePositionPatientArray?d.ImagePositionPatientArray:[1,1,1];null!=a.InstanceNumber&&(b.instanceNumber=parseInt(a.InstanceNumber));null!=d.PixelSpacingPatientArray&&2==d.PixelSpacingPatientArray.length&&(a=d.PixelSpacingPatientArray,b.rowSpacing=parseFloat(a[0]),b.columnSpacing=parseFloat(a[1]));return b};
a.GetBitsPerPixel=function(b){var d=a.getDicomTag(b,DicomTag.SamplesPerPixel);b=a.getDicomTag(b,DicomTag.BitsAllocated);var c;null!=d&&0<d.Value.length&&(c=parseInt(a.GetTagText(d),10));return c*parseInt(a.GetTagText(b),10)};a.GetTagText=function(a){return a?a.Value&&0<a.Value.length?a.Value.join("\\"):"":""};a.TagExists=function(a,d){return"undefined"!==typeof a[d]};a.IsDicomImage=function(a){for(var b=[DicomTag.Columns,DicomTag.Rows,DicomTag.BitsAllocated,DicomTag.BitsStored],c=b.length,e=0;e<c;e++)if(!this.TagExists(a,
b[e]))return!1;return!0};a.GetTagTextValue=function(b,d){b=this.findTag(b,d);if(null!=b&&b.Value&&0<b.Value.length)return a.GetTagText(b)};a.GetDicomImageInformation=function(b,d){var c=new lt.Controls.Medical.DICOMImageInformation,e=b[DicomTag.Columns],f=b[DicomTag.Rows],g=b[DicomTag.WindowWidth],h=b[DicomTag.WindowCenter],k=b[DicomTag.SmallestImagePixelValue],l=b[DicomTag.LargestImagePixelValue],m=b[DicomTag.HighBit],p=b[DicomTag.BitsStored],n=this.findTag(b,DicomTag.RescaleIntercept),r=this.findTag(b,
DicomTag.RescaleSlope),q=this.findTag(b,DicomTag.ViewPosition),t=this.findTag(b,"00200020"),y=this.findTag(b,"00200037"),w=this.findTag(b,"00200032"),x=b["00200052"],u=b["00283010"],A=b["54000100"],G=b["00080008"],I=b["00282110"],D=null,z=null;u&&u.Value&&0<u.Value.length&&(u=u.Value[0])&&!$.isEmptyObject(u)&&(D=u["00283002"],z=u["00283006"]);var E=b["00280103"],M=b["00420012"],L=b["00280004"];u=b["00181164"];var J=this.findTag(b,"00280030"),N=b["00182010"],K=b[DicomTag.PerFrameFunctionalGroupsSequence],
P=0;e=e&&e.Value.length?a.GetTagText(e):0;f=f&&f.Value.length?a.GetTagText(f):0;var F=a.GetBitsPerPixel(b);p=null!=p&&p.Value&&0<p.Value.length?parseInt(a.GetTagText(p),10):F;null!=K&&K.Value&&0<K.Value.length&&(d=K.Value[d],null!=d&&d[DicomTag.PlanePositionSequence]&&(K=d[DicomTag.PlanePositionSequence].Value[0],null!=K&&(w=K[DicomTag.ImagePositionPatient]),d[DicomTag.PlaneOrientationSequence]&&(d=d[DicomTag.PlaneOrientationSequence].Value[0],null!=d&&(y=d[DicomTag.ImageOrientationPatient]))));c.set_width(parseInt(e,
10));c.set_height(parseInt(f,10));c.set_bitsPerPixel(F);null!=m&&m.Value&&0<m.Value.length?(m=parseInt(a.GetTagText(m),10),P=m-p+1):(m=F-1,c.set_lowBit(0));null!=q&&q.Value&&0<q.Value.length&&(c.viewPosition=a.GetTagText(q));c.set_highBit(m);c.set_lowBit(P);n&&n.Value&&0<n.Value.length?(n=parseFloat(a.GetTagText(n)),c.set_modalityIntercept(n)):c.set_modalityIntercept(0);null!=r&&r.Value&&0<r.Value.length?(r=parseFloat(a.GetTagText(r)),c.set_modalitySlope(0==r?1:r)):c.set_modalitySlope(1);if(null!=
z&&z.Value&&z.Value.length){D=a.GetTagText(D).split("\\");c.set_firstStoredPixelValueMapped(D[1]|0);z=a.GetTagText(z).split("\\");for(D=z.length;D--;)z[D]|=0;c.set_lutDescriptor(z)}null!=E&&E.Value&&E.Value.length?(z=1===parseInt(a.GetTagText(E),10)?!0:!1,c.set_signed(z)):c.set_signed(!1);z=(1<<p)-1;null!=k&&k.Value&&k.Value.length?(k=parseInt(a.GetTagText(k),10),k=0>k?0<k?0:k+0:Math.min(k+0,z)):k=0;c.set_minValue(k);null!=l&&l.Value&&l.Value.length?(l=parseInt(a.GetTagText(l),10),l=0>l?0<l?0:l+0:
Math.min(l+0,z)):l=0;c.set_maxValue(l);null==g&&(g=this.findTag(b,DicomTag.WindowWidth));null!=g&&g.Value&&0<g.Value.length?c.set_windowWidth(g.Value[0]>>0):c.set_windowWidth(0);null==h&&(h=this.findTag(b,DicomTag.WindowCenter));null!=h&&h.Value&&0<h.Value.length?c.set_windowCenter(h.Value[0]>>0):c.set_windowCenter(0);null!=M&&M.Value&&0<M.Value.length?c.set_photometricInterpretation("RGB"):null!=L&&L.Value&&0<L.Value.length?c.set_photometricInterpretation(a.GetTagText(L)):c.set_photometricInterpretation("MONOCHROME2");
g=h=null;null!=N&&N.Value&&0<N.Value.length&&(h=a.GetTagText(N),g="detector");null!=u&&u.Value&&0<u.Value.length&&(h=a.GetTagText(u),g="detector");null!=J&&J.Value&&0<J.Value.length&&(h=a.GetTagText(J),g="calibrated",b=b["00280A02"],null!=b&&b.Value&&0<b.Value.length&&(g=a.GetTagText(b)));null!=h?(b=h.split("\\"),c.rowSpacing=parseFloat(b[0]),c.columnSpacing=parseFloat(b[1]),c.spacingType=g):(c.rowSpacing=0,c.columnSpacing=0);null!=y&&y.Value&&0<y.Value.length?(t=a.GetTagText(y),b=t.split("\\"),6==
b.length&&(c.orientation=b)):null!=t&&t.Value&&0<t.Value.length&&(t=a.GetTagText(t),b=t.split("\\"),6==b.length&&(c.orientation=b));null!=w&&w.Value&&0<w.Value.length?(b=a.GetTagText(w).split("\\"),c.position=b):c.position=[1,1,1];c.frameOfReferenceUID=null!=x&&x.Value&&0<x.Value.length?a.GetTagText(x):"";c.isWaveForm=angular.isDefined(A)&&0!=A.Value.length;c.isWaveForm&&(c.set_photometricInterpretation("RGB"),c.backGroundColor="0xffffff");null!=G&&G.Value&&0<G.Value.length?(b=a.GetTagText(G).split("\\"),
c.imageType=b):c.imageType="unknown";null!=I?"01"==a.GetTagText(I)?c.lossyImageCompression=!0:c.lossyImageCompression=!1:c.lossyImageCompression=!1;return c};a.getDicomTag=function(a,d){return a[d]};a.findTag=function(a,d){for(var b in a)if("SQ"!=a[b].vr){if(b==d)return a[b]}else if(a[b].Value&&0<a[b].Value.length)for(var e=a[b].Value.length,f=0;f<e;f++){var g=this.findTag(a[b].Value[0],d);if(null!=g)return g}return null};a.getDicomTagValue=function(b,d,c){b=this.getDicomTag(b,d);c=c||0;if(void 0!=
b&&b.Value&&c<b.Value.length)return c=b.Value[c],"DA"==b.vr&&c&&(c=new Date(a.parseDicomDate(c))),"TM"==b.vr&&c&&(c=Date.today().at(a.parseDicomTime(c))),c;if(b)return""};a.cloneDicomTagValue=function(b,d){return a.getConvertValue(b[d])};a.getStudyDateTime=function(b,d){var c=a.getDicomTagValue(b,DicomTag.StudyDate);b=a.getDicomTagValue(b,DicomTag.StudyTime);null==b||d||(c.addHours(b.getHours()),c.addMinutes(b.getMinutes()),c.addSeconds(b.getSeconds()));return c};a.getStudyDateTimeString=function(a,
d,c){a=this.getStudyDateTime(a,d);d="";null!=a&&(d=0==a.getMonth()&&0==a.getDay()&&0==a.getFullYear()?a.toString("yyyy-MMM-dd"):a.toString("yyyy-MMM-dd HH:mm"),c&&0<d.length&&(d="("+d+")"));return d};a.get_TagValue=function(a,d,c){a=this.getDicomTag(a,d);c=c||0;if(void 0!=a&&a.Value&&c<a.Value.length)return a.Value[c];if(a)return""};a.get_allValues=function(b,d){b=this.getDicomTag(b,d);d=[];if(void 0!=b&&b.Value)for(var c=0;c<b.Value.length;c++){var e=b.Value[c];"DA"==b.vr&&e&&(e=new Date(a.parseDicomDate(e)));
"TM"==b.vr&&e&&(e=Date.today().at(a.parseDicomTime(e)));d.push(e)}return d};a.getConvertValue=function(a){if(void 0!=a&&a.Value&&a.Value.length)return a.Value.join("\\")};a.getStringIfAvailable=function(a,d){return null!=a&&""!=a?d?"="+a:a:""};a.getPatientName=function(a,d,c){a=this.getDicomTag(a,d);d="";c=c||0;void 0!=a&&a.Value&&c<a.Value.length&&(d+=this.getStringIfAvailable(a.Value[c].Alphabetic,!1),d+=this.getStringIfAvailable(a.Value[c].Ideographic,!0),d+=this.getStringIfAvailable(a.Value[c].Phonetic,
!0));return d};a.getPatientNameFromTag=function(a,d){d=d||0;if(void 0!=a&&a.Value&&d<a.Value.length)return a.Value[d].Alphabetic};a.parseDicomDate=function(a){if(!a)return"";if(8==a.length){var b=a.substring(0,4),c=a.substring(4,6);a=a.substring(6);return c+"/"+a+"/"+b}return a};a.parseDicomTime=function(a){-1!=a.indexOf(":")&&(a=a.replace(/:/g,""));if(6<=a.length){var b=parseInt(a.substring(0,2)),c=a.substring(2,4);a=a.substring(4,6);b=(b%=12)?b:12;return b+":"+c+":"+a+" "+(12<=b?"PM":"AM")}return a};
a.getCodeSequenceList=function(a,d,c){var b=[],f=d.split("\\");for(d=0;d<f.length;d++)f[d]=f[d].replace(":","");var g=[],h=null;if(null!=c){g=c.split("\\");c=g.length;for(d=0;d<c;d++)g[d]=parseInt(g[d]);h=g[c-1]}a=a[f[0]];if(f.length==g.length)for(d=1;d<f.length;d++)a=a.Value[g[d]-1][f[d]];if(a&&a.Value&&0<a.Value.length)if(null!=h)h<=a.Value.length&&(f=a.Value[h-1],f=this.get_CodeSequence(f),f.CodeMeaning&&0!=f.CodeMeaning.length&&f.CodeValue&&0!=f.CodeValue.length&&b.push(f));else for(d=0;d<a.Value.length;d++)f=
a.Value[d],f=this.get_CodeSequence(f),f.CodeMeaning&&0!=f.CodeMeaning.length&&f.CodeValue&&0!=f.CodeValue.length&&b.push(f);return b};a.get_CodeSequence=function(a){var b=new Models.CodeSequence;b.CodeValue=a[DicomTag.CodeValue]&&a[DicomTag.CodeValue].Value?a[DicomTag.CodeValue].Value[0]:"";b.CodeMeaning=a[DicomTag.CodeMeaning]&&a[DicomTag.CodeMeaning].Value?a[DicomTag.CodeMeaning].Value[0]:"";b.CodeSchemeDesignator=a[DicomTag.CodingSchemeDesignator]&&a[DicomTag.CodingSchemeDesignator].Value?a[DicomTag.CodingSchemeDesignator].Value[0]:
"";b.CodingSchemeVersion=a[DicomTag.CodingSchemeVersion]&&a[DicomTag.CodingSchemeVersion].Vale?a[DicomTag.CodingSchemeVersion].Value[0]:"";return b};return a}();
directives.directive("leadAudio",["eventService","$timeout",function(a,b){return{restrict:"E",replace:!0,scope:{uiType:"=",audioSource:"="},templateUrl:"views/templates/AudioPlayer.html",link:function(a,b,e){a.$watch("uiType",function(b,c){if(b)switch(b){case "playback":c=document.getElementById("WaveformBasicAudioDiv");var d=document.getElementById("WaveformBasicAudioPlayerDownloadLinkTable");document.getElementById("WaveformBasicAudioPlayerDownloadLink");var e=document.getElementById("WaveformBasicAudioPlayerNoAudio"),
f=document.getElementById("WaveformBasicAudioPlayerWait");b=document.getElementById("WaveformBasicAudioPlayer");if(b.canPlayType&&""!=b.canPlayType("audio/wav")){c.style.display="inherit";b.style.display="inherit";e.style.display="none";d.style.display="none";f.style.display="none";try{for(;b.hasChildNodes();)b.removeChild(b.lastChild)}catch(m){}c=document.createElement("source");c.type="audio/wav";b.appendChild(c)}else a.uiType="download",a.$apply();break;case "download":b=document.getElementById("WaveformBasicAudioDiv");
c=document.getElementById("WaveformBasicAudioPlayerDownloadLinkTable");document.getElementById("WaveformBasicAudioPlayerDownloadLink");d=document.getElementById("WaveformBasicAudioPlayerNoAudio");e=document.getElementById("WaveformBasicAudioPlayerWait");f=document.getElementById("WaveformBasicAudioPlayer");b.style.backgroundColor="#FFFFFF";f.style.display="none";d.style.display="none";b.style.display="inherit";c.style.display="inherit";e.style.display="none";break;case "none":b=document.getElementById("WaveformBasicAudioDiv");
c=document.getElementById("WaveformBasicAudioPlayerDownloadLinkTable");document.getElementById("WaveformBasicAudioPlayerDownloadLink");d=document.getElementById("WaveformBasicAudioPlayerNoAudio");e=document.getElementById("WaveformBasicAudioPlayerWait");f=document.getElementById("WaveformBasicAudioPlayer");b.style.display="inherit";b.style.backgroundColor="#FFFFFF";f.style.display="none";d.style.display="inherit";c.style.display="none";e.style.display="none";break;case "wait":b=document.getElementById("WaveformBasicAudioDiv"),
c=document.getElementById("WaveformBasicAudioPlayerDownloadLinkTable"),document.getElementById("WaveformBasicAudioPlayerDownloadLink"),d=document.getElementById("WaveformBasicAudioPlayerNoAudio"),e=document.getElementById("WaveformBasicAudioPlayerWait"),f=document.getElementById("WaveformBasicAudioPlayer"),b.style.display="inherit",b.style.backgroundColor="#FFFFFF",f.style.display="none",d.style.display="none",c.style.display="none",e.style.display="inherit"}});a.$watch("audioSource",function(b,c){if(b)if("playback"==
a.uiType){if(b=document.getElementById("WaveformBasicAudioPlayer").lastChild)b.src=a.audioSource,b.controls&&(b.controls=!0)}else"download"==a.uiType&&(document.getElementById("WaveformBasicAudioPlayerDownloadLink").href=a.audioSource)})}}}]);
directives.directive("modalWindow",["$timeout",function(a){return{restrict:"EA",link:function(b,d,c){lt.LTHelper.device!=lt.LTDevice.mobile&&$(d).children().first().draggable({handle:".modal-header"});a(function(){var a=d.find("[autofocus]");a.focus();a.is("input")&&a.click()},600)}}}]);
directives.directive("verticalSlider",["eventService","$timeout",function(a,b){return{restrict:"AE",scope:{sliderSteps:"=",sliderPosition:"=",positionChanged:"&"},link:function(a,b,e){var c=new InteractiveVerticalSlider($(b)[0],1);a.$watch("sliderSteps",function(a){angular.isDefined(a)&&c.updateSteps(a)});$(b).parent().resize(function(a,d){a=$(b);d=$(b).parent();var e=a.position();a.height(d.height()-e.top);c.setupSlider()});a.$watch("sliderPosition",function(a){angular.isDefined(a)&&c.set_currentStep(a)});
c.add_stepChanged(function(b,c){b=c.get_newIndex()-1;b!=a.sliderPosition&&(a.sliderPosition=b,a.positionChanged({position:b}))})}}}]);
directives.directive("leadImageProcessing",["eventService","$timeout",function(a,b){return{restrict:"A",scope:{frame:"=",api:"="},link:function(a,b,e){if(angular.isDefined(a.frame)){var c=document.createElement("canvas");b=a.frame.getPreviewCanvas();var d=document.createElement("img"),h=document.getElementById("ipPreviewCanvas").getContext("2d"),k=document.createElement("canvas");a.api=a.api||{};a.api.applyIPCommand=function(a,b){var d=new lt.ImageProcessing,e=c.getContext("2d").getImageData(0,0,
c.width,c.height);d.set_jsFilePath(_jsFileCoreColorPath);d.set_command(a);if(null!=b)for(var f in b)b.hasOwnProperty(f)&&(d.get_arguments()[f]=b[f]);d.set_imageData(e);d.add_completed(function(a,b){h.putImageData(b.get_imageData(),0,0)});d.run()};c.width=128;c.height=128;k.width=b.width;k.height=b.height;a=k.getContext("2d");a.fillStyle="#0";a.fillRect(0,0,b.width,b.height);a.drawImage(b,0,0);d.onload=function(){var a=c.getContext("2d"),b=0,e=0;a.fillStyle="white";a.fillRect(0,0,c.width,c.height);
if(k.width>k.height){var f=128/k.width;e=(128-k.height*f)/2}else f=128/k.height,b=(128-k.width*f)/2;a.scale(f,f);a.drawImage(d,1/f*b,1/f*e);a.scale(1/f,1/f);h.putImageData(a.getImageData(0,0,c.width,c.height),0,0);d=null};d.src=k.toDataURL("image/png")}}}}]);var TimeLineState;(function(a){a.Start="start";a.QueryTimeLine="querytimeline";a.LoadThumbs="loadthumbs";a.ErrorReport="error";a.SuccessReport="success";a.End="end"})(TimeLineState||(TimeLineState={}));var TimeLineTransition;
(function(a){a.Success="success";a.Failure="failure";a.Aborted="aborted"})(TimeLineTransition||(TimeLineTransition={}));
directives.directive("studyTimeline",["eventService","$timeout","queryArchiveService","seriesManagerService","authenticationService","dataService","optionsService",function(a,b,d,c,e,f,g){return{replace:!0,template:"<div></div>",scope:{retrieveUrl:"=",api:"=",replaceCell:"&",appendCell:"&"},link:function(a,b,l){function h(a,b){a.width(b.width());a.height(b.height())}function k(a,d){if(a==TimeLineTransition.Aborted)x=TimeLineState.End,u.empty();else if(x!=TimeLineState.End)if(x==TimeLineState.Start)x=
TimeLineState.QueryTimeLine,n();else if(x==TimeLineState.QueryTimeLine&&TimeLineTransition.Success){x=TimeLineState.LoadThumbs;a=.8*$(b).height();var e=100,f=d.Instances.length,g=d.Series.length,h;u.empty();60>a&&(e=50);a-=5;var k=a/6;var l=a-k;var m=Math.max(k,100);if(g!=f)throw Error("Instances length differ from series length");"relative"!=lt.LTHelper.getElementStyle(u[0],"position")&&(u[0].style.position="relative");lt.LTHelper.supportsTouch?u[0].style.overflow="hidden":(u[0].style.overflow="auto",
u[0].style.overflowY="hidden");q(u[0]);u[0].style.border="0px";u[0].style.padding="0px";u[0].style.padding="0px";u[0].style.margin="0px";g=document.createElement("table");g.id="table_"+UUID.generate();g.border="0px";g.cellSpacing="0px";g.cellPadding="0px";g.width="100%";g.style.width="100%";g.style.height="100%";g.style.padding="0px";g.style.margin="0px";g.style.borderCollapse="separate";g.className="timeLineTable";var p=document.createElement("tr");for(var t=0;t<f;t++)(h=c.get_activeCellFrame())&&
angular.isDefined(h.Instance)&&(h=document.createElement("td"),p.appendChild(h),h.setAttribute("align","center"),$(h).css("width",m+"px"),h.className="timeLineCellClass",h=r(h,d,t,e,a,k,m,l),setTimeout(h,5*t));h=document.createElement("td");$(h).css("width","100%");p.appendChild(h);g.appendChild(p);u.append(g)}}function n(){var a=new Models.QueryOptions;""!=G&&(a.PatientsOptions.PatientID=G);d.ElectStudyTimeLineInstances(a).success(function(a,b){for(b=0;b<a.Series.length;b++)null==f.get_Series(a.Series[b].SeriesInstanceUID)&&
f.add_series(a.Series[b]);k(TimeLineTransition.Success,a)}).error(function(a){k(TimeLineTransition.Failure,a)})}function r(b,d,f,g,h,k,l,m){var n=c.get_activeCellFrame().Instance.SeriesInstanceUID;return function(){var c=Math.floor(h);var g=a.retrieveUrl;g=g+"/GetImage?"+("auth="+encodeURIComponent(e.authenticationCode));g+="&instance="+d.Instances[f].SOPInstanceUID;g=g+"&frame=0"+("&mime="+encodeURIComponent("image/jpeg"));g=g+"&bp=24&qf=10"+("&cx="+c)+("&cy="+c);b.setAttribute("SeriesInstanceUID",
d.Instances[f].SeriesInstanceUID);c=document.createElement("img");c.setAttribute("id","img_"+f.toString());c.src=g;c.alt="loading...";c.title=d.Series[f].Description||d.Series[f].Modality;d.Series[f].InstanceUID==n?(b.style.border="3px solid #5C880C",E=b):b.style.border="3px solid #000000";c.style.maxHeight="100%";c.style.maxWidth="100%";c.setAttribute("SeriesInstanceUID",d.Instances[f].SeriesInstanceUID);c.addEventListener("touchstart",function(a){a.preventDefault?a.preventDefault():event.returnValue=
!1;z=!1;window.clearInterval(D);D=window.setInterval(function(b){z=!0;window.clearInterval(D);w(a.target)},1E3)},!1);c.addEventListener("touchend",function(a){a.preventDefault?a.preventDefault():event.returnValue=!1;window.clearInterval(D);z||(z=!0,y(a.target))});c.addEventListener("MSGestureHold",function(a){a.preventDefault?a.preventDefault():event.returnValue=!1;w(a.target)},!1);c.addEventListener("contextmenu",function(a){a.preventDefault?a.preventDefault():event.returnValue=!1;w(a.target)},!1);
c.addEventListener("click",function(a){y(a.target)},!1);g=document.createElement("div");g.appendChild(c);c=document.createElement("div");c.href="#";c.setAttribute("SeriesInstanceUID",d.Instances[f].SeriesInstanceUID);c.setAttribute("draggable","true");c.appendChild(g);c.addEventListener("dragstart",function(a){a.dataTransfer.effectAllowed="copy";a.dataTransfer.setData("Text",this.getAttribute("SeriesInstanceUID"))},!1);b.appendChild(c);g=document.createElement("div");c=document.createElement("P");
var l=d.Series[f].Date;l&&0!=l.length||!d.Studies||(l=d.Studies[0].Date);l&&0<l.length&&(l=Utils.dateFormatter(l,I));c.style.fontFamily="Arial, Helvetica, sans-serif";c.style.fontSize="xx-small";c.style.verticalAlign="text-top";c.style.textAlign="center";c.style.padding="0px";c.style.margin="0px";c.style.whiteSpace="nowrap";var m="["+d.Series[f].Modality+"]";l&&0<l.length&&(m+=" "+l);l=document.createTextNode(m);c.appendChild(l);g.appendChild(c);g.title=m;g.style.width=h+"px";g.style.height=k+"px";
g.style.color="#FFFFFF";g.style.padding="0px";g.style.margin="0px";g.style.overflow="hidden";g.style.border="0px";b.appendChild(g)}}function q(a){lt.LTHelper.supportsTouch||(a.onselectstart=function(){return!1})}function t(a){$(".timeLineCellClass").each(function(b){a==this.getAttribute("SeriesInstanceUID")?(E=this,this.style.border="3px solid #5C880C"):this.style.border="3px solid #000000"})}function y(a){null!=E&&(E.style.border="3px solid #000000");E=a.parentNode.parentNode.parentNode;E.style.border=
"3px solid #5C880C";lt.LTHelper.browser==lt.LTBrowser.opera&&$(E).fadeOut(0).fadeIn(0);a.getAttribute("SeriesInstanceUID")}function w(b){null!=E&&(E.style.border="3px solid #000000");E=b.parentNode.parentNode.parentNode;E.style.border="3px solid #5C880C";lt.LTHelper.browser==lt.LTBrowser.opera&&$(E).fadeOut(0).fadeIn(0);b=b.getAttribute("SeriesInstanceUID");a.appendCell({seriesInstanceUID:b})}var x=TimeLineState.Start,u=angular.element("<div/>"),A,G,I=g.get(OptionNames.DateFormat);b.append(u);h($(b),
$(b).parent());$(b).parent().resize(function(a,c){h($(b),$(b).parent())});a.api=a.api||{};a.api.toggle=function(a,c,d){G=c;A=a;d?k(TimeLineTransition.Aborted,""):(h($(b),$(b).parent()),k(TimeLineTransition.Aborted,""),x=TimeLineState.Start,k(TimeLineTransition.Success,""))};a.api.refresh=function(a,c,d){var e=b.is(":visible");c==A||a==G?e&&t(d):e&&(A=c,G=a,k(TimeLineTransition.Aborted,""),x=TimeLineState.Start,k(TimeLineTransition.Success,""))};var D=null,z=!1,E=null}}}]);
directives.directive("pwdConfirm",function(){return{restrict:"A",require:"ngModel",link:function(a,b,d,c){var e="#"+d.pwdConfirm;b.add(e).on("keyup",function(){a.$apply(function(){var a=b.val()===$(e).val();c.$setValidity("pwmatch",a)})})}}});
directives.directive("checkList",function(){return{scope:{list:"=checkList",value:"@"},link:function(a,b,d){d=function(c){var d=b.prop("checked"),e=a.list.indexOf(a.value);d&&-1==e?c?b.prop("checked",!1):a.list.push(a.value):d||-1==e||(c?b.prop("checked",!0):a.list.splice(e,1))};var c=d.bind(null,!0),e=d.bind(null,!1);b.bind("change",function(){a.$apply(e)});a.$watch("list",c,!0)}}});
directives.directive("ngEnter",function(){return function(a,b,d){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(d.ngEnter)}),b.preventDefault())})}});function processInput(a,b,d){d=b.replace(d,"");d!==b&&(a.$setViewValue(d),a.$render());return d}directives.directive("onlyDigitsd",function(){return{require:"ngModel",restrict:"A",link:function(a,b,d,c){c.$parsers.push(function(a){if(a)return processInput(c,a,/[^0-9.]/g)})}}});
directives.directive("onlyDigits",function(){return{require:"ngModel",restrict:"A",link:function(a,b,d,c){c.$parsers.push(function(a){if(a)return processInput(c,a,/[^0-9]/g)})}}});directives.directive("forceBlur",function(){return{require:"ngModel",restrict:"A",link:function(a,b,d,c){c&&c.$viewChangeListeners&&c.$viewChangeListeners.push(function(){$(b).blur()})}}});
app.directive("ngDebounce",["$timeout",function(a){return{restrict:"A",require:"ngModel",priority:99,link:function(b,d,c,e){if("radio"!==c.type&&"checkbox"!==c.type){var f=parseInt(c.ngDebounce,10);isNaN(f)&&(f=1E3);d.unbind("input");var g;d.bind("input",function(){a.cancel(g);g=a(function(){b.$apply(function(){e.$setViewValue(d.val())})},f)});d.bind("blur",function(){b.$apply(function(){e.$setViewValue(d.val())})})}}}}]);
app.directive("modalShow",function(){return{restrict:"A",scope:{modalVisible:"="},link:function(a,b,d){a.showModal=function(a){a?b.modal("show"):b.modal("hide")};d.modalVisible?(a.$watch("modalVisible",function(b,d){a.showModal(b)}),b.bind("hide.bs.modal",function(){a.modalVisible=!1;a.$$phase||a.$root.$$phase||a.$apply()})):a.showModal(!0)}}});
app.directive("elheightresize",["$window","$parse",function(a,b){return{link:function(d,c,e){var f=Utils.debounce(function(){d.onResize();d.$apply()},150);d.onResize=function(){var f=c.position();$(c).height(a.innerHeight-(f.top+5));angular.isDefined(e.resize)&&d.$apply(function(){b(e.resize)(d,{})})};f();angular.element(a).bind("resize",function(){setTimeout(function(){f()},350)})}}}]);
directives.directive("resizeToParent",function(){return{restrict:"A",link:function(a,b,d){function c(){$(b).width(e.innerWidth());$(b).height(e.innerHeight())}var e=$(b).parent();null!=e&&e.resize(function(a){c()});$(window).bind("orientationchange",function(){null!=e&&c()})}}});
directives.directive("resizeWidthToParent",function(a){return{restrict:"A",link:function(b,d,c){function e(){a(function(){$(d).width(f.innerWidth())},250)}var f=$(d).parent();null!=f&&f.resize(function(a){e()});$(window).bind("orientationchange",function(){null!=f&&e()})}}});
directives.directive("scroller",["$timeout",function(a){return{restrict:"A",scope:!1,link:function(b,d,c){d=$(d).addClass("scroll-parent");c=document.createElement("div");c.id="scrollLeft_toolbar_button";var e=$(c).addClass("scroll-button scroll-button-left"),f=$(document.createElement("div")).addClass("scroll-button scroll-button-right"),g=$(document.createElement("div")).addClass("scroll-body");c=document.createElement("div");c.id="scrollArea";c=$(c).addClass("toolbarbodyArea");g.append(c);var h=
document.createElement("div");h.id="scrollInner";var k=$(h).addClass("scroll-body-inner"),l=d.children(),m=!1;h.left=0;h.setLeft=function(a){h.style.left=a+"px";h.left=a};h.getLeft=function(){return h.left};e.append($(document.createElement("span")).addClass("fa fa-angle-double-left"));f.append($(document.createElement("span")).addClass("fa fa-angle-double-right"));f.css("float","right");f.css("z-index","3000");g.css("position","absolute");c.append(k);l.detach();k.append(l);k.css("left","0px");k.css("overflow",
"visible");k.css("display","inline");k.css("white-space","nowrap");k.css("position","relative");g.css("overflow","visible");e.css("z-index",1E3);d.append(e).append(g).append(f);d.resize(function(){a(function(){var a=k.width(),b=g.parent().width();a>b?(m=!1,e.removeClass("scroll-button-disabled"),f.removeClass("scroll-button-disabled")):(m=!0,e.addClass("scroll-button-disabled"),f.addClass("scroll-button-disabled"));0!=k.position().left&&k.css({left:h.left+"px"})},850)});e.on("click touchstart",function(a){if(!m&&
!e.hasClass("scroll-button-disabled")){a.stopPropagation();a.preventDefault();a=parseInt(k.css("left"));var b=Math.floor(g.parent().width()/2);a=Math.min(h.left,a+b);k.css({left:a+"px"});0==a&&(e.hasClass("scroll-button-disabled")||e.addClass("scroll-button-disabled"));f.hasClass("scroll-button-disabled")&&f.removeClass("scroll-button-disabled")}});f.on("click touchstart",function(a){var b=0;var c=k.children().last();if(!m&&!f.hasClass("scroll-button-disabled")){if(c[0].hasChildNodes){var d=0;c.children().width(function(a,
b){d+=b})}else d=c.outerWidth(!0);lt.LTHelper.OS==lt.LTOS.iOS&&lt.LTHelper.device==lt.LTDevice.mobile&&(d+=10);c.hasClass("btn-group")||(d+=d);a.stopPropagation();a.preventDefault();b=c.position().left+d;a=parseInt(k.css("left"));c=Math.floor(g.parent().outerWidth(!0)/2);b=Math.floor(g.parent().outerWidth(!0)-b);a=Math.max(b,a-(c+d));k.css({left:a+"px"});a==b&&(f.hasClass("scroll-button-disabled")||f.addClass("scroll-button-disabled"));e.hasClass("scroll-button-disabled")&&e.removeClass("scroll-button-disabled")}});
b.$watch(function(){var a=k.width(),b=g.parent().width();return a>b},function(a){a?(m=!1,e.removeClass("scroll-button-disabled"),f.removeClass("scroll-button-disabled")):(m=!0,e.addClass("scroll-button-disabled"),f.addClass("scroll-button-disabled"),0!=k.position().left&&k.css({left:h.left+"px"}))})}}}]);
directives.directive("verticalScroller",function(a){return{restrict:"A",scope:!1,link:function(b,d,c){d=$(d).addClass("scroll-parent-vertical");var e=$(document.createElement("div")).addClass("scroll-button-vertical scroll-button-up"),f=$(document.createElement("div")).addClass("scroll-button-vertical scroll-button-down"),g=$(document.createElement("div")).addClass("scroll-body-vertical"),h=document.createElement("div"),k=$(h).addClass("scroll-body-inner");c=d.children();var l=!1;e.append($(document.createElement("span")).addClass("fa fa-angle-double-up"));
f.append($(document.createElement("span")).addClass("fa fa-angle-double-down"));f.css("position","fixed");f.css("bottom","0");f.css("z-index","3000");g.css("position","absolute");g.append(k);c.detach();k.append(c);k.css("top","0px");k.css("overflow","visible");k.css("display","inline");k.css("white-space","nowrap");k.css("position","relative");h.setLeft=function(a){h.style.left=a+"px";h.left=a};g.css("overflow","visible");e.css("z-index",1E3);d.append(e).append(g).append(f);d.resize(function(){a(function(){var a=
k.height(),b=g.parent().height();a>b?(l=!1,e.removeClass("scroll-button-disabled"),f.removeClass("scroll-button-disabled")):(l=!0,e.addClass("scroll-button-disabled"),f.addClass("scroll-button-disabled"));0!=k.position().top&&k.css({top:"0px"})},850)});e.on("click touchstart",function(a){if(!l&&!e.hasClass("scroll-button-disabled")){a.stopPropagation();a.preventDefault();a=parseInt(k.css("left"));var b=Math.floor(g.parent().width()/2);a=Math.min(h.left,a+b);k.css({left:a+"px"});0==a&&(e.hasClass("scroll-button-disabled")||
e.addClass("scroll-button-disabled"));f.hasClass("scroll-button-disabled")&&f.removeClass("scroll-button-disabled")}});f.on("click touchstart",function(a){var b=0;var c=k.children().last();if(!l&&!f.hasClass("scroll-button-disabled")){if(c[0].hasChildNodes){var d=0;c.children().width(function(a,b){d+=b})}else d=c.outerWidth(!0);lt.LTHelper.OS==lt.LTOS.iOS&&lt.LTHelper.device==lt.LTDevice.mobile&&(d+=10);a.stopPropagation();a.preventDefault();b=c.position().left+d;a=parseInt(k.css("left"));c=Math.floor(g.parent().outerWidth(!0)/
2);b=Math.floor(g.parent().outerWidth(!0)-b);a=Math.min(h.left,Math.max(b,a-c));k.css({left:a+"px"});a==b&&(f.hasClass("scroll-button-disabled")||f.addClass("scroll-button-disabled"));e.hasClass("scroll-button-disabled")&&e.removeClass("scroll-button-disabled")}});b.$watch(function(){var a=k.height(),b=g.parent().height();return a>b},function(a){a?(l=!1,e.removeClass("scroll-button-disabled"),f.removeClass("scroll-button-disabled")):(l=!0,e.addClass("scroll-button-disabled"),f.addClass("scroll-button-disabled"),
0!=k.position().left&&k.css({left:h.left+" px"}))})}}});
var PatientAccessRightsService=function(){function a(a,d,c){this._http=c;this._authenticationService=d;this._patientAccessRightsUrl=a.urls.serviceUrl+a.urls.patientAccessRightsServiceName}a.prototype.GetUserAccess=function(a,d){return this._http.post(this._patientAccessRightsUrl+"/GetUserAccess",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,user:a,extraOptions:d}))};a.prototype.GrantUserPatients=function(a,d,c){return this._http.post(this._patientAccessRightsUrl+
"/GrantUserPatients",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,user:a,patientIds:d,extraOptions:c}))};a.prototype.GetRoleAccess=function(a,d){return this._http.post(this._patientAccessRightsUrl+"/GetRoleAccess",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,role:a,extraOptions:d}))};a.prototype.GrantRolePatients=function(a,d,c){return this._http.post(this._patientAccessRightsUrl+"/GrantRolePatients",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,
role:a,patientIds:d,extraOptions:c}))};a.prototype.GetRolesAccess=function(a,d){return this._http.post(this._patientAccessRightsUrl+"/GetRolesAccess",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,roles:a,extraOptions:d}))};a.$inject=["app.config","authenticationService","$http"];return a}();services.service("patientAccessRightsService",PatientAccessRightsService);var EventNames;
(function(a){a.SeriesSelected="SearchSeriesSelected";a.SelectedTabChanged="ViewerTabSelectedTabChanged";a.SearchSeriesFailure="SearchSeriesFailure";a.SearchPatientsSuccess="SearchPatientsSuccess";a.LoginSuccess="AuthenticationServiceAuthenticationSuccess";a.LoginFailed="AuthenticationServiceAuthenticationFailed";a.Logout="AuthenticationServiceLogout";a.NorthPaneResized="UiLayout/Pane/Resized/North";a.SouthPaneResized="UiLayout/Pane/Resized/South";a.EastPaneResized="UiLayout/Pane/Resized/East";a.WestPaneResized=
"UiLayout/Pane/Resized/West";a.CenterPaneResized="UiLayout/Pane/Resized/Center";a.LoadSeries="Loader/LoadSeries";a.ActiveSeriesChanged="Viewer/ActiveSeriesChanged";a.OnLoadLayout="DicomLoader/OnLoadLayout";a.OnPresentationInfoLoaded="DicomLoader/PresentationInfoLoaded";a.OnInstancesFound="DicomLoader/InstancesFound";a.OnDicomXmlRetrieved="DicomLoader/OnDicomXmlRetrieved";a.OnDicomJSONRetrieved="DicomLoader/OnDicomJSONRetrieved";a.InstanceOverflow="DicomLoader/InstanceOverflow";a.InstanceOverflowClear=
"DicomLoader/InstanceOverflowClear";a.InstanceOverflowSwap="DicomLoader/InstanceOverflowSwap";a.InstanceOverflowAdd="DicomLoader/InstanceOverflowAdd";a.InstanceOverflowClose="DicomLoader/InstanceOverflowClose";a.ImageInformationReady="DicomLoader/ImageInformationReady";a.ImageDataReady="DicomLoader/ImageDataReady";a.LoadingSeriesFrames="DicomLoader/LoadingSeriesFrames";a.PresentationStateLoaded="DicomLoader/PresentationStateLoaded";a.AnnotationsLoaded="DicomLoader/AnnotationsLoaded";a.CurrentDesignerChanged=
"SeriesViewer/CurrentDesignerChanged";a.DerivedImageCreated="Store/DerivedImageCreated";a.DeleteAnnotation="Annotation/DeleteAnnotation";a.FrameChanged="Cine/FrameChanged";a.PlayerStopped="Cine/PlayerStopped";a.DownloadSeries="UserQueue/DownloadSeries";a.JobUpdated="UserQueue/JobUpdated";a.JobCreated="UserQueue/JobCreated";a.PreviewLoaded="DicomLoader/PreviewLoaded";a.PreviewFailed="DicomLoader/PreviewFailed";a.LoadedDicomXml="DicomLoader/LoadedDicomXml";a.LoadedDicomJSON="DicomLoader/LoadedDicomJSON";
a.DeleteTab="Viewer/DeleteTab";a.NewCellsAdded="Viewer/NewCellsAdded";a.StackChanged="Viewer/StackChanged";a.NewSubCellSelected="Viewer/NewFrameSelected";a.ToolbarCreated="Viewer/ToolbarCreated";a.TemplatesImported="TemplateEditor/TemplatesImported";a.DeleteSeries="Viewer/DeleteSeries";a.MrtiInfoReady="DicomLoader/MrtiInfoReady";a.LinkedChanged="Viewer/LinkedChanged";a.OpenStudyTimeLine="Viewer/OpenStudyTimeLine";a.UpdateToolbarPressed="Viewer/UpdateToolbarPressed";a.LoadStructureDisplay="Viewer/LoadStructureDisplay";
a.StructuredDisplaySelected="Viewer/StructuredDisplaySelected";a.StructuredDisplayUpdated="Viewer/StructuredDisplayUpdated"})(EventNames||(EventNames={}));
var EventService=function(){function a(a,d){this.subscriptions={};this.rootScope=d;this.$q=a}a.prototype.subscribe=function(a,d){return this.rootScope.$on(a,d)};a.prototype.unsubscribe=function(a){angular.isFunction(a)&&a()};a.prototype.publish=function(a,d){if(!this.rootScope.$$listeners[a])return[];for(var b=[],e=0;e<this.rootScope.$$listeners[a].length;e++)b.push(this.$q.defer());this.rootScope.$broadcast(a,{args:d,reject:function(a){b.pop().reject(a)},resolve:function(a){b.pop().resolve(a)}});
return $.map(b,function(a){return a.promise})};a.$inject=["$q","$rootScope"];return a}();services.service("eventService",EventService);
var ExportService=function(){function a(a,d,c,e){this._http=c;this._authenticationService=d;this.exportUrl=a.urls.serviceUrl+a.urls.exportServiceName}a.prototype.ExportAllSeries=function(a,d){return this._http.post(this.exportUrl+"/ExportAllSeries",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,patientID:a,options:d}))};a.prototype.ExportSeries=function(a,d){return this._http.post(this.exportUrl+"/ExportSeries",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,
seriesInstanceUIDs:a,options:d}))};a.prototype.ExportInstances=function(a,d){return this._http.post(this.exportUrl+"/ExportInstances",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,instanceUIDs:a,options:d}))};a.prototype.ExportLayout=function(a,d,c,e,f,g){return this._http.post(this.exportUrl+"/ExportLayout",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,seriesInstanceUID:a,layout:d,compression:f,width:g,annotationFileName:c}))};
a.prototype.GetInstanceLocalPathName=function(a){return this._http.post(this.exportUrl+"/GetInstanceLocalPathName",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,instanceUID:a}))};a.$inject=["app.config","authenticationService","$http"];return a}();services.service("exportService",ExportService);var ExportImagesSource;
(function(a){a.AllPatientImages="AllPatientImages";a.LoadedSeries="LoadedSeries";a.CurrentSeries="CurrentSeries";a.SelectedImages="SelectedImages";a.PrintCurrentView="PrintCurrentView";a.Layout="Layout"})(ExportImagesSource||(ExportImagesSource={}));var PrintImagesSource;
(function(a){a.AllPatientImages="AllPatientImages";a.LoadedSeries="LoadedSeries";a.CurrentSeries="CurrentSeries";a.SelectedImages="SelectedImages";a.PrintCurrentView="PrintCurrentView";a.Layout="Layout"})(PrintImagesSource||(PrintImagesSource={}));
var ExportManagerService=function(){function a(a,d,c,e,f,g,h){this._exportService=d;this._printService=c;this._seriesManagerService=e;this._objectRetrieveService=g;this._objectStoreService=h;this.$q=a;this._tabService=f}a.prototype.Export=function(a,d){if("PDF"==a.FileFormat)return this.Print(a,d);switch(d){case ExportImagesSource.AllPatientImages:return d=this._seriesManagerService.get_activeCellFrame(),d=DicomHelper.getDicomTagValue(d.metadata,DicomTag.PatientID),this._exportService.ExportAllSeries(d,
a);case ExportImagesSource.Layout:d=this._seriesManagerService.get_activeCell().seriesInstanceUID;var b=Utils.get_seriesLayout(this._seriesManagerService.get_activeCell());if(null==b){alert("No layout found to export");break}return this._exportService.ExportLayout(d,b,a.AnnotationsFileName,a.BurnAnnotations,a.ImageCompression,a.LayoutImageWidth);case ExportImagesSource.SelectedImages:return d=this._seriesManagerService.get_activeCellFrame(),this._exportService.ExportInstances([d.Instance.SOPInstanceUID],
a);case ExportImagesSource.PrintCurrentView:a=this._tabService.getActiveViewer();a=document.getElementById(a.divId);html2canvas(a.parentElement,{onrendered:function(a){OpenPrintViewUrl(a.toDataURL())}});break;default:return d=this._seriesManagerService.get_activeCell().get_seriesInstanceUID(),this._exportService.ExportSeries([d],a)}};a.prototype.Print=function(a,d){var b=new Models.PrintOptions;b.BurnAnnotations=a.BurnAnnotations;b.IncludeOverflowImages=a.IncludeOverflowImages;b.LayoutImageWidth=
a.LayoutImageWidth;b.WhiteBackground=a.WhiteBackground;b.PatientInfo=a.PatientInfo;b.ReduceGrayscaleTo8BitsSelected=a.ReduceGrayscaleTo8BitsSelected;b.AnnotationsFileName=a.AnnotationsFileName;try{if(d===PrintImagesSource.AllPatientImages){var e=this._seriesManagerService.get_activeCellFrame(),f=DicomHelper.getDicomTagValue(e.metadata,DicomTag.PatientID);return this._printService.PrintAllSeries(f,b)}if(d===PrintImagesSource.Layout){var g=new Models.Layout,h=this._seriesManagerService.get_activeCell().get_seriesInstanceUID(),
k=this._seriesManagerService.get_activeCell();if(null==k)return;var l=k.viewer,m=l.layout.items.count;for(a=0;a<m;a++){var p=l.layout.items.get_item(a);if(null!=p&&p.visibility){var n=p.bounds;d=null;0!=p.frames.count&&(d=p.frames.get_item(0));e="";null!=d&&(e=d.Instance.SOPInstanceUID.toString());g.Boxes.push(new Models.ImageBox(e,n.x,n.y,n.width+n.x,n.height+n.y))}}return this._printService.PrintLayout(h,g,b)}if(d===PrintImagesSource.SelectedImages)return e=this._seriesManagerService.get_activeCellFrame(),
this._printService.PrintInstances([e.Instance.SOPInstanceUID],b);h=this._seriesManagerService.get_activeCell().get_seriesInstanceUID();return this._printService.PrintSeries([h],b)}catch(r){throw r;}};a.prototype.UploadAnnotations=function(a){try{var b=this.$q.defer();if(!a)return b.resolve(),b.promise;var c=this._seriesManagerService.get_activeCell();if(c){var e=c.get_seriesInstanceUID(),f=this._seriesManagerService.get_cellAnnotations(c);return this._objectStoreService.StoreAnnotations(e,f,"_printing")}b.resolve();
return b.promise}catch(g){throw g;}};a.prototype.buildIpArray=function(a){var b=[],c=a.imageProcessingList.toArray();var e=$.grep(c,function(a){return"UnsharpMask"==a.command||"Perio"==a.command||"Dentin"==a.command||"Endo"==a.command});if(0<e.length)for(var f=0;f<e.length;f++){var g=e[0];g.arguments.MultiscaleEnhancement&&b.push({Name:"MultiscaleEnhancement",Parameters:g.arguments.MultiscaleEnhancement.replace(/=/g,"")});g.arguments.GammaCorrect&&b.push({Name:"GammaCorrect",Parameters:g.arguments.GammaCorrect.replace(/=/g,
"")});g.arguments.UnsharpMask&&b.push({Name:"UnsharpMask",Parameters:g.arguments.UnsharpMask})}e=$.grep(c,function(a){return"ContrastBrightnessIntensity"==a.command});if(0<e.length)for(f=0;f<e.length;f++)g=e[0],b.push({Name:"BrightnessContrast",Parameters:g.arguments.brightness+","+g.arguments.contrast});e=$.grep(c,function(a){return"ChangeHueSaturationIntensity"==a.command});if(0<e.length)for(f=0;f<e.length;f++)g=e[0],b.push({Name:"HSL",Parameters:g.arguments.hue+","+g.arguments.saturation+","+g.arguments.intensity});
e=$.grep(c,function(a){return"StretchHistogram"==a.command});0<e.length&&b.push({Name:"StretchHistogram",Parameters:""});a.flipped&&b.push({Name:"Flip",Parameters:""});a.reversed&&b.push({Name:"Flip",Parameters:"true"});0!=a.rotateAngle&&b.push({Name:"Rotate",Parameters:a.rotateAngle.toString()});a.mrtiInfo.supportWindowLevel?b.push({Name:"WindowLevel",Parameters:a.wlRenderer.windowLevelWidth.toString()+","+a.wlRenderer.windowLevelCenter.toString()+","+("MONOCHROME1"==a.information.photometricInterpretation)}):
a.inverted&&b.push({Name:"Invert",Parameters:""});return b};a.prototype.PopupCapture=function(){var a=this._seriesManagerService.get_activeCell();if(a instanceof lt.Controls.Medical.Cell3D)window.open("","_blank").location.href=a.image.src+".jpg";else if(a instanceof lt.Controls.Medical.PanoramicCell){var d=a.frames.get_item(0);OpenPrintViewUrl(d.lowResImage.canvas.toDataURL())}else{var c=this._seriesManagerService.get_activeCellFrame();d="";var e=new lt.Annotations.Engine.AnnCodecs,f=!1,g=null,h=
this,k=this.buildIpArray(c);if(null!=c){this._seriesManagerService.get_seriesLoaderById(a);var l=a.get_automation();a.get_selectedItem().get_imageViewer().get_imageResolution();if(lt.LTHelper.OS!=lt.LTOS.android||lt.LTHelper.browser!=lt.LTBrowser.android)a=l.get_container(),0<a.get_children().get_count()&&(f=!0,d=e.save(a,1,null,length+1)),lt.LTHelper.OS==lt.LTOS.iOS&&lt.LTHelper.device!=lt.LTDevice.mobile&&(g=window.open("","_blank"),window.focus()),f?this._objectRetrieveService.UploadAnnotations(d).then(function(a){a=
a.data.replace(/"/g,"");var b=254,d=254;0<c.columnSpacing&&(b=25.4/c.columnSpacing);0<c.rowSpacing&&(d=25.4/c.rowSpacing);a=h._objectRetrieveService.DownloadImageUrl(c,a.replace('"',""),0,0,b,d,JSON.stringify(k));lt.LTHelper.OS==lt.LTOS.iOS&&lt.LTHelper.device!=lt.LTDevice.mobile?(g.location.href=a,g.focus()):window.location.href=a},function(a){}):(d=h._objectRetrieveService.DownloadImageUrl(c,null,0,0,150,150,JSON.stringify(k)),lt.LTHelper.OS==lt.LTOS.iOS&&lt.LTHelper.device!=lt.LTDevice.mobile?
(g.location.href=d,g.focus()):window.location.href=d)}}};a.$inject="$q exportService printService seriesManagerService tabService objectRetrieveService objectStoreService seriesManagerService".split(" ");return a}();services.service("exportManagerService",ExportManagerService);
var MonitorCalibrationService=function(){function a(a,d,c,e){this._http=c;this._authenticationService=d;this._monitorCalibrationUrl=a.urls.serviceUrl+a.urls.monitorCalibrationServiceName}a.prototype.GetCalibrations=function(){var a="auth="+encodeURIComponent(this._authenticationService.authenticationCode)+"&cache="+(new Date).toString();return this._http.get(this._monitorCalibrationUrl+"/GetCalibrations?"+a,{cache:!1})};a.prototype.AddCalibration=function(a){return this._http.post(this._monitorCalibrationUrl+
"/AddCalibration",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,calibration:a}))};a.$inject=["app.config","authenticationService","$http"];return a}();services.service("monitorCalibrationService",MonitorCalibrationService);
var AuditLogService=function(){function a(a,d,c,e){this._http=c;this._authenticationService=d;this._optionsService=e;this._auditLogUrl=a.urls.serviceUrl+a.urls.auditLogServiceName}a.prototype.Log=function(a,d,c,e,f,g){return this._http.post(this._auditLogUrl+"/Log",JSON.stringify({authenticationCookie:g||this._authenticationService.authenticationCode,user:a,workstation:d,date:c,details:e,userData:f},function(a,b){return"date"==a?"/Date("+(new Date(b)).getTime()+"-0800)/":b}))};a.prototype.log_launch=
function(){return this._optionsService.get(OptionNames.EnableAuditLog)&&this._optionsService.get(OptionNames.LogUserActivity)?this.Log("?","?",new Date,"Medical Web Viewer Launched",""):null};a.prototype.log_exit=function(){if(this._optionsService.get(OptionNames.EnableAuditLog)&&this._optionsService.get(OptionNames.LogUserActivity))return this.Log("?","?",new Date,"Medical Web Viewer Exited","")};a.prototype.log_logOut=function(a){if(this._optionsService.get(OptionNames.EnableAuditLog)&&this._optionsService.get(OptionNames.LogUserActivity))return this.Log("?",
"?",new Date,"Medical Web Viewer Exited","",a)};a.prototype.log_openPatient=function(a){if(this._optionsService.get(OptionNames.EnableAuditLog)&&this._optionsService.get(OptionNames.LogUserActivity))return this.Log("?","?",new Date,"Opened Patient: "+a.ID+", "+a.Name,"")};a.prototype.log_showSeries=function(a){if(this._optionsService.get(OptionNames.EnableAuditLog)&&this._optionsService.get(OptionNames.LogUserActivity)){var b=$("<XMLDocument />");b.append($("<extra />").append($("<uid />").text(a.InstanceUID)));
return this.Log("?","?",new Date,"View Series: "+a.Description,b.html())}};a.$inject=["app.config","authenticationService","$http","optionsService"];return a}();services.service("auditLogService",AuditLogService);
var ExternalApp=function(){return function(){}}(),ExternalApplicationsService=function(){function a(a,d){this.httpInject=d;this.rootScopeInject=a}a.prototype.addApp=function(a){if(!a.name||!a.path)throw Error("'Name' and 'Path' must be provided");var b=this.getAppList();b[a.name]=a;this.setAppList(b)};a.prototype.setAppList=function(a){a=JSON.stringify(a);$.cookie("externalApps",a,{expires:3650})};a.prototype.getAppList=function(){var a=$.cookie("externalApps");return null!=a?JSON.parse(a):{}};a.prototype.runApp=
function(a){try{var b=new ActiveXObject("Shell.Application");if(!b)throw Error("This feature is supported in Internet Explorer only");if(!a)throw Error("Invalid parameter passed (app)");b.ShellExecute(a.path,a.args,"","open","1")}catch(c){a=c,c.hasOwnProperty("number")&&-2146828218==c.number&&(a+='\n\nIn Internet Explorer, do the followings:\n1. Enable unsigned ActiveX controls for the current zone\nTools > Internet Options > Security > Custom level...\nEnable "ActiveX Controls and plug-ins" > "Initialize and script ActiveX controls not marked as safe for scripting"\n2. Allow Active Content to run filesTools > Internet Options > Advanced > Security Enable "Allow Active Content to run in files on My Computer"'),
alert(a)}};a.prototype.deleteApp=function(a){try{var b=this.getAppList();delete b[a];this.setAppList(b)}catch(c){alert(c)}};a.$inject=["$rootScope","$http"];return a}();services.service("externalApplicationsService",ExternalApplicationsService);
var PrintService=function(){function a(a,d,c,e){this._http=c;this._authenticationService=d;this.printUrl=a.urls.serviceUrl+a.urls.exportServiceName}a.prototype.PrintAllSeries=function(a,d){return this._http.post(this.printUrl+"/PrintAllSeries",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,patientID:a,options:d}))};a.prototype.PrintSeries=function(a,d){return this._http.post(this.printUrl+"/PrintSeries",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,
seriesInstanceUIDs:a,options:d}))};a.prototype.PrintInstances=function(a,d){return this._http.post(this.printUrl+"/PrintInstances",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,instanceUIDs:a,options:d}))};a.prototype.PrintLayout=function(a,d,c){return this._http.post(this.printUrl+"/PrintLayout",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,seriesInstanceUID:a,layout:d,options:c}))};a.$inject=["app.config","authenticationService",
"$http"];return a}();services.service("printService",PrintService);
var QueryPacsService=function(){function a(a,d,c,e,f){this._http=c;this._authenticationService=d;this._queryPacsUrl=a.urls.serviceUrl+a.urls.queryPacsServiceName;this.ReadRemoteConfigs(f)}Object.defineProperty(a.prototype,"remoteConnections",{get:function(){return this._remoteConfig.servers},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"pacsConnections",{get:function(){for(var a=[],d=0;d<this._remoteConfig.servers.length;d++)"pacs"==this._remoteConfig.servers[d].type&&a.push(this._remoteConfig.servers[d]);
return a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"clientAETitle",{get:function(){return this._remoteConfig.client},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"wadoConnections",{get:function(){for(var a=[],d=0;d<this._remoteConfig.servers.length;d++)"wado"==this._remoteConfig.servers[d].type&&a.push(this._remoteConfig.servers[d]);return a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"server",{get:function(){return this._server},
enumerable:!0,configurable:!0});a.prototype.ReadRemoteConfigs=function(a){this._remoteConfig=Models.RemoteConfig.Factory(a.get(OptionNames.RemoteConfig))};a.prototype.FindPatients=function(a,d,c){return this._http.post(this._queryPacsUrl+"/FindPatients",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,server:a,client:{AETitle:d},options:c}))};a.prototype.FindStudies=function(a,d,c){d={authenticationCookie:this._authenticationService.authenticationCode,server:a,client:{AETitle:d},
options:c};this._server=a;return this._http.post(this._queryPacsUrl+"/FindStudies",JSON.stringify(d))};a.prototype.FindSeries=function(a,d,c){d={authenticationCookie:this._authenticationService.authenticationCode,server:a,client:{AETitle:d},options:c};this._server=a;return this._http.post(this._queryPacsUrl+"/FindSeries",JSON.stringify(d))};a.prototype.FindPresentationState=function(a){a="auth="+encodeURIComponent(this._authenticationService.authenticationCode)+"&series="+a;return this._http.get(this._queryPacsUrl+
"/FindPresentationState?"+a)};a.prototype.FindInstances=function(a){return this._http.post(this._queryPacsUrl+"/FindInstances",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,options:a}))};a.prototype.ElectStudyTimeLineInstances=function(a,d){return this._http.post(this._queryPacsUrl+"/ElectStudyTimeLineInstances",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,options:a,userData:d||null}))};a.prototype.VerifyConnection=function(a,
d){return this._http.post(this._queryPacsUrl+"/VerifyConnection",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,server:a,client:{AETitle:d},options:null}))};a.prototype.GetConnectionInfo=function(){return this._http.get(this._queryPacsUrl+"/GetConnectionInfo")};a.$inject=["app.config","authenticationService","$http","eventService","optionsService"];return a}();services.service("queryPacsService",QueryPacsService);
var JobDownloadInfo=function(){return function(){this.SeriesInformation=this.Series=this.Client=this.Server=null}}(),SeriesDownloadQueueService=function(){function a(a,d,c,e){this._loadingJobs=!1;var b=this;this._eventService=d;this._pendingDownloads=[];this._pacsRetrieveService=c;this._timeout=e;this._userJobs=null;this._unfinishedJobs=[];this._jobsUpdater=new JobStatusUpdater(c,d);d.subscribe(EventNames.JobUpdated,function(a,c){c.args.job.Status!=DownloadStatus.Idle&&c.args.job.Status!=DownloadStatus.Started&&
b._unfinishedJobs.splice(c.args.index,1)})}a.prototype.loadUserQueue=function(){var a=this;if(!this._loadingJobs)return this._loadingJobs=!0,this._pacsRetrieveService.loadQueue().success(function(b){a._userJobs=b;a._loadingJobs=!1;a.fillUncompletedJobs();a.processDownloadQueue()}).error(function(){a._loadingJobs=!1;a.processDownloadQueue()})};a.prototype.downloadSeries=function(a,d,c,e){if(this._loadingJobs){var b=new JobDownloadInfo;b.Server=a;b.Client=d;b.Series=c;b.SeriesInformation=e;this._pendingDownloads.push(b)}else{b=
null;var g=this;null!=e&&(e=JSON.stringify(e),b={},b.UserData=e);this._pacsRetrieveService.DownloadImages(a,d,c.PatientID,c.StudyInstanceUID,c.InstanceUID,null,b).success(function(a){null==g._userJobs?g.loadJobs([a]):(g.updateJobSeriesInfo(a),g._userJobs.push(a),a.Status!=DownloadStatus.Idle&&a.Status!=DownloadStatus.Started||g.markUnfinishedJob(a));g._eventService.publish(EventNames.JobCreated,{job:a})}).error(function(a){})}};a.prototype.deleteJobs=function(a){return this._pacsRetrieveService.DeleteDownloadInfos(a)};
a.prototype.autoRefresh=function(a){if(a){if(null==this._refreshTimer)this.onRefreshQueue()}else null!=this._refreshTimer&&this._timeout.cancel(this._refreshTimer)};a.prototype.onRefreshQueue=function(){null!=this._refreshTimer&&(this._timeout.cancel(this._refreshTimer),this._refreshTimer=null);this.refreshQueueStatus();this._refreshTimer=this._timeout($.proxy(this.onRefreshQueue,this),1E3)};a.prototype.refreshQueueStatus=function(){this._jobsUpdater.isBusy||null==this._userJobs||0==this._unfinishedJobs.length||
this._jobsUpdater.updateJobs(this._unfinishedJobs.slice(0))};a.prototype.loadJobs=function(a){this._loadingJobs=!1;this._userJobs=a};a.prototype.fillUncompletedJobs=function(){for(var a=0;a<this._userJobs.length;a++){var d=this._userJobs[a];this.updateJobSeriesInfo(d);d.Status!==DownloadStatus.Idle&&d.Status!==DownloadStatus.Started||this.markUnfinishedJob(d)}};a.prototype.processDownloadQueue=function(){if(0<this._pendingDownloads.length)for(var a=this._pendingDownloads.length;a--;){var d=this._pendingDownloads.pop();
this.downloadSeries(d.Server,d.Client,d.Series,d.SeriesInformation)}};a.prototype.updateJobSeriesInfo=function(a){if(a.UserData)try{a.SeriesInfo=JSON.parse(a.UserData)}catch(d){}};a.prototype.markUnfinishedJob=function(a){this._unfinishedJobs.push(a)};a.$inject=["app.config","eventService","pacsRetrieveService","$timeout"];return a}();services.service("seriesDownloadQueueService",SeriesDownloadQueueService);
var JobStatusUpdater=function(){function a(a,d){this._pacsRetrieveService=a;this._eventService=d;this._isBusy=!1}Object.defineProperty(a.prototype,"isBusy",{get:function(){return this._isBusy},enumerable:!0,configurable:!0});a.prototype.updateJobs=function(a){this._jobs=a;this._isBusy=!0;this.updateNextJob()};a.prototype.updateNextJob=function(){var a=this;if(0===this._jobs.length)this._isBusy=!1;else{var d=this._jobs.pop();this._pacsRetrieveService.UpdateDownloadInfoStatus(d).success(function(b){a._eventService.publish(EventNames.JobUpdated,
{job:b,index:a._jobs.length});a.updateNextJob()}).error(function(a){})}};return a}(),DownloadStatus;(function(a){a.Idle=0;a.Started=1;a.Completed=2;a.Error=3;a.Aborted=4;a.All=5})(DownloadStatus||(DownloadStatus={}));
var PacsRetrieveService=function(){function a(a,d,c,e){this._http=c;this._authenticationService=d;this._retrievePacsUrl=a.urls.serviceUrl+a.urls.pacsRetrieveServiceName}a.prototype.loadQueue=function(){return this.GetDownloadInfos(null,null,null,null,null,null,DownloadStatus.All,null)};a.prototype.GetDownloadInfos=function(a,d,c,e,f,g,h,k){return this._http.post(this._retrievePacsUrl+"/GetDownloadInfos",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,server:a,client:d,
patientID:c,studyInstanceUID:e,seriesInstanceUID:f,sopInstanceUID:g,status:h,extraOptions:k}))};a.prototype.DownloadImages=function(a,d,c,e,f,g,h){return this._http.post(this._retrievePacsUrl+"/DownloadImages",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,server:a,client:d,studyInstanceUID:e,seriesInstanceUID:f,sopInstanceUID:g,extraOptions:h}))};a.prototype.DeleteDownloadInfos=function(a){return this._http.post(this._retrievePacsUrl+"/DeleteDownloadInfos",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,
jobIds:a,extraOptions:null}))};a.prototype.UpdateDownloadInfoStatus=function(a){return this._http.post(this._retrievePacsUrl+"/UpdateDownloadInfoStatus",JSON.stringify({authenticationCookie:this._authenticationService.authenticationCode,info:a,extraOptions:null}))};a.$inject=["app.config","authenticationService","$http"];return a}();services.service("pacsRetrieveService",PacsRetrieveService);
(function(a){var b=function(){function a(a,b,d){a.item=d||new Models.ToolbarItem;a.isFormValid=function(){return void 0!=a.item.id&&0!=a.item.id.length&&void 0!=a.item.action&&0!=a.item.action.length};a.ok=function(){a.item.type="button";b.close(a.item)};a.cancel=function(){b.dismiss("cancel")}}a.$inject=["$scope","$modalInstance","item"];return a}();a.AddToolbarItemController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function b(b,d,f,g,h,k,l,m){this._roleToolbars={};this._previousRole="";var c=this;this._previousRole="";this._roleToolbars={};this._optionsService=k;this._toolbarService=f;this._hasSaved=!1;b.toolbars=[];b.config={extensions:["table"],selectMode:3,autoActivate:!1,autoSetHeight:!1,keyboard:!0,autoScroll:!0,table:{indentation:20,nodeColumnIdx:1,checkboxColumnIdx:0},checkbox:!0,icons:!1,renderColumns:function(a,b){var c=b.node.data;a=$(b.node.tr).find(">td");var d=lt.LTHelper.device==
lt.LTDevice.desktop?50:25;c.cssIconClass&&!b.node.hasChildren()&&(b="<div class='"+c.cssIconClass+"' style='width: "+d+"px; height: "+d+"px;vertical-align:middle;margin-left;auto;margin-right:auto'></div>",a.eq(2).html(b))}};b.toolbars=f.getToolbars();b.selectedToolbar=b.toolbars[0];b.buttons=b.toolbars[0].items;b.activeNode=null;b.treeApi={};b.disabledItems=f.getDisabledItems(b.selectedToolbar.name);b.roles=[];b.role={};b.close=function(){d.close(c._hasSaved)};b.itemDeactivated=function(a,c){b.activeNode=
null};b.itemActivated=function(a,c){b.activeNode=c.node};b.deleteToolbarItem=function(){b.activeNode.remove()};b.save=function(){var a=[],d=[],e="DisabledToolbarItems_"+b.selectedToolbar.name,f="Toolbar_"+b.selectedToolbar.name,g={};c.getToolbarInfo(b,a,d);g[e]=JSON.stringify(a);g[f]=JSON.stringify({name:b.selectedToolbar.name,items:d});null==b.role.name?k.saveDefaultOptions(g).success(function(){c._hasSaved=!0;l.notify(c._notificationTitle,c._optionsSuccessMsg)}).error(function(a,b){l.error(c._optionsFailureMsg+
": "+b)}):k.saveRoleOptions(b.role.name,g).success(function(){c._hasSaved=!0;l.notify(c._notificationTitle,c._optionsSuccessMsg)}).error(function(a,b){l.error(c._optionsFailureMsg+": "+b)})};b.roleChanged=function(){var a=null==c._previousRole||""==c._previousRole?"default":c._previousRole,d=[],e=[];c._roleToolbars[b.selectedToolbar.name]||(c._roleToolbars[b.selectedToolbar.name]={});c._roleToolbars[b.selectedToolbar.name][a]||(c._roleToolbars[b.selectedToolbar.name][a]={});c.getToolbarInfo(b,d,e);
c._roleToolbars[b.selectedToolbar.name][a].disabledItems=d;c._roleToolbars[b.selectedToolbar.name][a].items=e;b.treeApi.clear();c.loadRoleToolbar(b,b.role.name);c._previousRole=b.role.name};b.addToolbarItem=function(){g.open({templateUrl:"views/dialogs/AddToolbarItem.html",controller:a.AddToolbarItemController,backdrop:"static",resolve:{item:function(){}}}).result.then(function(a){a=b.treeApi.addNode(b.activeNode,a);null!=a&&b.treeApi.activateNode(a)})};b.addRootToolbarItem=function(){g.open({templateUrl:"views/dialogs/AddToolbarItem.html",
controller:a.AddToolbarItemController,backdrop:"static",resolve:{item:function(){}}}).result.then(function(a){a=b.treeApi.addNode(null,a);null!=a&&b.treeApi.activateNode(a)})};b.editToolbarItem=function(){g.open({templateUrl:"views/dialogs/AddToolbarItem.html",controller:a.AddToolbarItemController,backdrop:"static",resolve:{item:function(){return b.activeNode.data}}}).result.then(function(a){var c=b.activeNode;c.setTitle(a.id);c.tooltip=a.tooltip})};h.getRolesNames().success(function(a){b.roles=a;
b.role.name=a[0]}).error(function(a){});m("DIALOGS_TOOLBAR_SAVED").then(function(a){c._optionsSuccessMsg=a});m("DIALOGS_TOOLBAR_SAVED_FAILURE").then(function(a){c._optionsFailureMsg=a});m("DIALOGS_NOTIFICATION").then(function(a){c._notificationTitle=a})}b.prototype.getToolbarInfo=function(a,b,d){a.treeApi.visit(function(a){if(!a.selected&&a.hasChildren()){var c=!0;a.visit(function(a){return a.selected?c=!1:!0});c&&b.push(a.data.id)}else a.selected||b.push(a.data.id);if(void 0==a.parent||"root"==a.parent.title)d.push(a.data),
a.data.items&&a.data.items.clear();else{var e=$.grep(d,function(b){return b.id==a.parent.data.id});1==e.length&&(e[0].items.push(a.data),a.data.items&&a.data.items.clear())}})};b.prototype.loadRoleToolbar=function(a,b){var c=this;b=null==b||""==b?"default":b;if("default"==b){var d=c._toolbarService.getToolbars()[0].items,e=c._toolbarService.getDisabledItems(a.selectedToolbar.name);if(d)for(var k=0;k<d.length;k++)a.treeApi.addData(null,d[k]);a.treeApi.setDisabledItems(e)}else{var l=a.selectedToolbar.name;
this._optionsService.getRoleOption(b,OptionNames.Toolbar+"_"+l).success(function(d){c._optionsService.getRoleOption(b,OptionNames.DisabledToolbarItems+"_"+l).success(function(b){if(d&&0<d.length){d=d.replace(/(\r\n|\n|\r|\t|\\)/gm,"");var e=JSON.parse(d).items}else e=c._toolbarService.getToolbars()[0].items;if(e)for(var f=0;f<e.length;f++)a.treeApi.addData(null,e[f]);a.treeApi.setDisabledItems(b)}).error(function(a){})}).error(function(a){})}};b.$inject="$scope $modalInstance toolbarService $modal authenticationService optionsService dialogs $translate".split(" ");
return b}();a.AdminToolbarSettingsController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function b(b,d,f){b.types=[{name:"Window Level",id:0},{name:"Instance Number",id:1},{name:"User Data",id:2},{name:"Image Quality",id:3},{name:"Frame Number",id:4},{name:"Left Orientation",id:5},{name:"Right Orientation",id:6},{name:"Top Orientation",id:7},{name:"Bottom Orientation",id:8}];b.overlay={};if(null==f)b.tag=new a.OverlayTag,b.overlay.item=b.types[0];else{void 0==f.overlayType&&(f.overlayType=2);var c=$.grep(b.types,function(a,b){return a.id==f.overlayType});
b.tag=f;b.overlay.item=c[0]}b.ok=function(){null!=f?(b.tag.overlayType=b.overlay.item.id,b.tag.id=UUID.generate()):b.tag.overlayType=b.overlay.item.id;d.close(b.tag)};b.cancel=function(){d.dismiss("cancel")};b.isUserData=function(a){return a==lt.Controls.Medical.OverlayTextType.userData}}b.$inject=["$scope","$modalInstance","tag"];return b}();a.AddTagController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d){a.info={workstation:"",comments:""};a.isWorkstationEmpty=function(){return 0==a.info.workstation.length};a.cancel=function(){b.dismiss("cancel")};a.ok=function(){b.close({workstation:a.info.workstation,comments:a.info.comments})}}a.$inject=["$scope","$modalInstance","optionsService"];return a}();a.GetWorkstationController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g,h){function c(b,c,d,e,f,g,h){var k=new PropertyGridItem;k.groupName=b;k.rowType=c;k.cssName=d;k.dropFields=e;k.isSubGroup=f;k.value=g;k.propertyName=h;a.items.push(k)}this._changes={};this._saved=!1;var e=this;a.items=[];c("Behavior","num","","","",h.get(OptionNames.DefaultSeriesRowCount),"DefaultSeriesRowCount");c("Behavior","num","","","",h.get(OptionNames.DefaultSeriesColumnCount),"DefaultSeriesColumnCount");c("Behavior","cdrop","","true|false",
"",h.get(OptionNames.DentalMode),"DentalMode");c("Behavior","cdrop","","true|false","",h.get(OptionNames.SinglePatientMode),"SinglePatientMode");c("Behavior","cdrop","","true|false","",h.get(OptionNames.SingleSeriesMode),"SingleSeriesMode");c("Behavior","cdrop","","true|false","",h.get(OptionNames.ShowFrameBorder),"ShowFrameBorder");c("Behavior","cdrop","","true|false","",h.get(OptionNames.EnablePatientRestriction),"EnablePatientRestriction");c("Thumbnails","cdrop","","true|false","",h.get(OptionNames.ShowSearchThumbnails),
"ShowSearchThumbnails");c("Thumbnails","num","","","",h.get(OptionNames.SeriesThumbnailWidth),"SeriesThumbnailWidth");c("Thumbnails","num","","","",h.get(OptionNames.SeriesThumbnailHeight),"SeriesThumbnailHeight");c("Color","color","","","",h.get(OptionNames.EmptyCellBackgroundColor),"EmptyCellBackgroundColor");c("Color","color","","","",h.get(OptionNames.SelectedBorderColor),"SelectedBorderColor");c("Autocomplete","cdrop","","true|false","",h.get(OptionNames.EnablePatientIdAutoComplete),"EnablePatientIdAutoComplete");
c("Autocomplete","cdrop","","true|false","",h.get(OptionNames.EnablePatientNameAutoComplete),"EnablePatientNameAutoComplete");c("Derived Series","input","","","",h.get(OptionNames.Derived3DSeriesDescriptionText),"Derived 3dSeriesDescriptionText");c("Derived Series","input","","","",h.get(OptionNames.DerivedSeriesDescriptionText),"DerivedSeriesDescriptionText");c("Derived Series","input","","","",h.get(OptionNames.DerivedPanoramicSeriesDescriptionText),"DerivedPanoramicSeriesDescriptionText");c("Derived Series",
"cdrop","","true|false","",h.get(OptionNames.EnableSeriesNumberEdit),"EnableSeriesNumberEdit");c("Derived Series","cdrop","","true|false","",h.get(OptionNames.EnableProtocolNameEdit),"EnableProtocolNameEdit");c("Audit Log","input","","","",h.get(OptionNames.EnableAuditLog),"EnableAuditLog");c("Audit Log","cdrop","","true|false","",h.get(OptionNames.LogUserActivity),"LogUserActivity");c("Audit Log","cdrop","","true|false","",h.get(OptionNames.LogUserSecurity),"LogUserSecurity");c("Audit Log","cdrop",
"","true|false","",h.get(OptionNames.LogSettingChanges),"LogSettingChanges");c("Audit Log","cdrop","","true|false","",h.get(OptionNames.LogSecuritySettingChanges),"LogSecuritySettingChanges");c("Annotations","color","","","",h.get(OptionNames.AnnotationStrokeColor),"AnnotationStrokeColor");c("Annotations","color","","","",h.get(OptionNames.AnnotationTextColor),"AnnotationTextColor");c("Annotations","color","","","",h.get(OptionNames.AnnotationHiliteColor),"AnnotationHiliteColor");c("Timeout","cdrop",
"","true|false","",h.get(OptionNames.EnableIdleTimeout),"EnableIdleTimeout");c("Timeout","num","","","",h.get(OptionNames.IdleTimeout),"IdleTimeout");c("Timeout","num","","","",h.get(OptionNames.IdleWarningDuration),"IdleWarningDuration");c("Query Results","num","","","",h.get(OptionNames.MaxStudyResults),"MaxStudyResults");c("Query Results","num","","","",h.get(OptionNames.MaxSeriesResults),"MaxSeriesResults");c("Query Results","cdrop","","true|false","",h.get(OptionNames.SearchOtherPatientIds),
"SearchOtherPatientIds");c("Template Editor","color","","","",h.get(OptionNames.TemplateBackgroundColor),"TemplateBackgroundColor");c("Template Editor","color","","","",h.get(OptionNames.TemplateForeColor),"TemplateForeColor");c("Template Editor","color","","","",h.get(OptionNames.TemplateBorderColor),"TemplateBorderColor");c("Template Editor","num","","","",h.get(OptionNames.TemplateBorderSize),"TemplateBorderSize");c("Template Editor","cdrop","","true|false","",h.get(OptionNames.TemplateBoundsNotification),
"TemplateBoundsNotification");c("Template Editor","input","","","",h.get(OptionNames.DefaultScript),"DefaultScript");c("Lazy Loading","num","","","",h.get(OptionNames.LazyLoadingThreshold),"LazyLoadingThreshold");c("Lazy Loading","num","","","",h.get(OptionNames.LazyLoadingMobileThreshold),"LazyLoadingMobileThreshold");c("Lazy Loading","num","","","",h.get(OptionNames.LazyLoadingBuffer),"LazyLoadingBuffer");c("Miscellaneous","cdrop","","true|false","",h.get(OptionNames.ShowPacsQuery),"ShowPacsQuery");
c("Miscellaneous","input","","","",h.get(OptionNames.DateFormat),"DateFormat");c("Miscellaneous","input","","","",h.get(OptionNames.TimeFormat),"TimeFormat");c("Miscellaneous","cdrop","","true|false","",h.get(OptionNames.HideOverlays),"HideOverlays");c("Miscellaneous","cdrop","","true|false","",h.get(OptionNames.HideCustomLayouts),"HideCustomLayouts");c("Miscellaneous","cdrop","","true|false","",h.get(OptionNames.ShowStudyTimeLine),"ShowStudyTimeLine");c("Miscellaneous","cdrop","","true|false","",
h.get(OptionNames.LinkImages),"LinkImages");c("Miscellaneous","cdrop","","true|false","",h.get(OptionNames.StackSingleFrames),"StackSingleFrames");c("Capture","num","","","",h.get(OptionNames.CaptureSize),"CaptureSize");c("Capture","cdrop","","true|false","",h.get(OptionNames.CaptureLayout),"CaptureLayout");c("3D","cdrop","","Server Side|Client Side","",h.get(OptionNames.MPRRenderSide),"MprRenderSide");c("3D","cdrop","","Hardware Software|Software Only","",h.get(OptionNames.RenderingMethod),"RenderingMethod");
c("Sign-in","cdrop","","true|false","",h.get(OptionNames.EnableOkta),OptionNames.EnableOkta);c("Caching","cdrop","","true|false","",h.get(OptionNames.EnableCaching),OptionNames.EnableCaching);a.onPropertyChanged=function(a,b){e._changes[a]=b};a.hasChanges=function(){for(var a in e._changes)return!0;return!1};a.close=function(){b.close(e._saved)};a.save=function(){h.saveDefaultOptions(e._changes).success(function(){for(var a in e._changes)h.set(a,e._changes[a]);e._changes={};d.notify(e._notificationTitle,
e._optionsSuccessMsg);e._saved=!0}).error(function(a,b){})};g("DIALOGS_OPTIONS_SAVED").then(function(a){e._optionsSuccessMsg=a});g("DIALOGS_NOTIFICATION").then(function(a){e._notificationTitle=a})}a.$inject=["$scope","$modalInstance","dialogs","$translate","optionsService"];return a}();a.GlobalOptionsController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g,h,k){var c=this;this._scope=a;a.Copyright=b.copyright;a.authenticationMessage="";a.Invalid=!1;a.RememberMe=!1;a.Username=b.defaultUserName;a.Password=b.defaultPassword;this.auth=d;a.submit=function(){c.auth.login(a.Username,a.Password,a.RememberMe)};a.loginOkta=function(){window.location.replace(b.urls.idpServiceUrl+"Account/LoginOkta")};a.loginShibboleth=function(){window.location.replace(b.urls.idpServiceUrl+"Account/LoginShibboleth")};a.loginOktaHelp=
function(){window.location.href=b.urls.oktaHelpUrl};"undefined"!=typeof b.urls.oktaHelpUrl&&b.urls.oktaHelpUrl&&(a.oktaHelpIsEnabled=!0);a.loginShibbolethHelp=function(){window.location.href=b.urls.loginShibbolethHelpUrl};a.oktaIsEnabled=k.get(OptionNames.EnableOkta);a.shibbolethIsEnabled=k.get(OptionNames.EnableShibboleth);h.subscribe("AuthenticationService/AuthenticationFailed",function(b,c){a.authenticationMessage=c.args;a.Invalid=!0})}a.prototype.init=function(a){this._scope.oktaIsEnabled=a.get(OptionNames.EnableOkta);
this._scope.shibbolethIsEnabled=a.get(OptionNames.EnableShibboleth)};a.$inject="$scope app.config authenticationService $location eventService optionsService".split(" ");return a}();a.LoginController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function b(b,d,f,g,h,k,l,m,p,n,r,q,t,y,w,x,u,A,G,I,D,z,E,M,L,J,N){function c(){b.warning&&(b.warning.close(),b.warning=null);b.timedout&&(b.timedout.close(),b.timedout=null)}function e(a,b){var c=new Image;c.onload=function(){b(!0)};c.onerror=function(){b(!1)};c.src=a}function F(a,b){for(var c,d=arguments,e=d.length,f;1<e&&a.length;)for(c=d[--e];-1!==(f=a.indexOf(c));)a.splice(f,1);return a}function Q(a,b){b=Math.min(b.length,a.layout.items.count);for(var c=a.get_emptyDivs().items.count,
d=0;d<c;d++)a.get_emptyDivs().get_items().get_item(d).set_position(d+b)}function B(a,b,c){var d=a.emptyDivs.items.count;a.layout.beginUpdate();for(var e=0;e<d;e++){var f=e+1;if(0==$.grep(b.Series,function(a){return a.ImageBoxNumber==f}).length){var g=a.emptyDivs.items.item(e),h=c[e];h=Utils.createLeadRect(h.Position.leftTop.x,h.Position.leftTop.y,h.Position.rightBottom.x,h.Position.rightBottom.y);g.bounds=h}}a.layout.endUpdate()}var H=this,O=g.get(OptionNames.DentalMode);this._eventService=d;D.put("template/tabs/tabset.html",
'\n<div>\n  <ul class="nav nav-{{type || \'tabs\'}}" ng-class="{\'nav-stacked\': vertical, \'nav-justified\': justified}" ng-transclude></ul>\n  <div class="vbox boxItem tab-content">\n    <div class="vbox boxItem tab-pane" \n         ng-repeat="tab in tabs" \n         ng-class="{active: tab.active}"\n         tab-content-transclude="tab">\n    </div>\n  </div>\n</div>\n');0==k.get_allTabs().length&&(A.GetExternalControlMode()||(D=O?k.add_tab(UUID.generate(),"Search","views/DentalSearchView.html",
a.DentalSearchViewController):k.add_tab(UUID.generate(),"Search","views/SearchView.html",a.SearchViewController),D.type=TabTypes.Search),null!=y&&window.addEventListener("keydown",function(a){13==a.keyCode&&y.dispatch("ToggleFullScreen")},!1),!A.GetExternalControlMode()&&f.hasPermission(PermissionNames.CanDownloadImages)&&g.get(OptionNames.ShowPacsQuery)&&(D=k.add_tab(UUID.generate(),"User Queue","views/UserQueueView.html",a.UserQueueController),D.type=TabTypes.UserQueue));h.Initialize();N.Initialize();
b.tabs=k.get_allTabs();b.user=f.user;b.countdown=g.get(OptionNames.IdleWarningDuration);b.idleWait=g.get(OptionNames.IdleWarningDuration);d.publish("ViewerTabAddTabs",{tabs:b.tabs});b.$watch("activeTab",function(a,b){if(a!=b){if(a.type==TabTypes.Viewer){var c=k.get_tabData(a.id,TabDataKeys.ViewController);if(c){var e=c.getViewer();c=e.layout.get_selectedItem();angular.isDefined(c)&&r.set_activeCell(c.divID);I(function(){e.onSizeChanged()},500)}}k.activeTab=k.get_allTabs().indexOf(a);d.publish(EventNames.SelectedTabChanged,
{previousTab:b,currentTab:a})}},!0);b.tabSelected=function(a){b.activeTab=a};b.logout=function(){f.logout();h.LogoutNotify("User Logout");N.LogoutNotify("User Logout")};b.findTab=function(a){var c;$.each(b.tabs,function(b,d){if(d.id==a)return c=d,!1});return c};d.subscribe(EventNames.DeleteTab,function(a,c){b.deleteTab(c.args.id)});b.deleteTab=function(a,b){b=k.find_tab(a);r.get_anyCell();if(b&&b.type==TabTypes.Viewer)for(var c=r.get_allSeries(),e=0;e<c.length;e++)r.get_seriesTab(c[e])==b&&(r.set_seriesTab(c[e],
null),r.dispose_seriesCell(c[e]),d.publish(EventNames.DeleteSeries,{seriesInstanceUID:c[e]}));c=k.get_tabData(b.id,TabDataKeys.PatientId);k.set_tabData(b.id,TabDataKeys.PatientId,"");var f=k.findTabByKey(TabDataKeys.PatientId,c);null==f&&(f=k.find_tabsByType(TabTypes.Search));I(function(){null!=f&&angular.isDefined(f)&&0<f.length&&(f[0].active=!0);k.delete_tab(a)},200,!0)};b.$on("$idleStart",function(){c();b.warning=m.open({templateUrl:"warning-dialog.html",windowClass:"modal-danger"})});b.$on("$idleEnd",
function(){c()});b.$on("$idleTimeout",function(){c();p.unwatch();f.logout()});b.$on("$keepaliveResponse",function(a,b,c){});b.openAdminOverlay=function(){m.open({templateUrl:"views/dialogs/OverlaySettings.html",controller:a.OverlaySettingsController,backdrop:"static"})};b.openAdminGlobal=function(){m.open({templateUrl:"views/dialogs/GlobalOptions.html",controller:a.GlobalOptionsController,backdrop:"static"}).result.then(function(a){a&&(sessionStorage.setItem("AuthCode",f.authenticationCode),x.location.reload())})};
b.openAdminToolbar=function(){m.open({templateUrl:"views/dialogs/ToolbarSettings.html",controller:a.AdminToolbarSettingsController,backdrop:"static"}).result.then(function(a){a&&(sessionStorage.setItem("AuthCode",f.authenticationCode),x.location.reload())})};b.aboutDialog=function(){var a="images/mipacsAboutDark.jpg";switch(window.localStorage.getItem("leadmedicalwebviewertheme")){case "dark":a="images/mipacsAboutDark.jpg";break;case "light":a="images/mipacsAboutLight.jpg"}e(a,function(b){b?J.notify("About",
"<center><img src="+a+' width=600 height=400  align="middle"></img></center> <center><br><b>MiPACS HTML5 Web Viewer</b></br>  -  Version 3.0.0.5<br/><br/>Copyright (c) 1991-2019 LEAD Technologies, Inc.<center>',{size:"lg"}):J.notify("About","<b>Medical Web Viewer</b>  -  Version 20.0.0.5<br/><br/>Copyright (c) 1991-2019 LEAD Technologies, Inc.")})};b.themeDialog=function(){m.open({templateUrl:"views/dialogs/UISettings.html",controller:a.UISettingsController,backdrop:"static"})};b.clearCachedObjects=
function(){L.ClearCache().then(function(a){angular.isDefined(a.data)&&angular.isDefined(a.data.Message)?J.error("Cache",a.data.Message):J.notify("Cache","Cached objects were cleared.")},function(a){J.error("Cache",a)})};b.openAdminCalibration=function(){n.GetCalibrations().success(function(b){m.open({templateUrl:"views/dialogs/MonitorCalibration.html",controller:a.MonitorCalibrationController,backdrop:"static",resolve:{calibrations:function(){return b}}})}).error(function(a,b){})};b.openRemotePacs=
function(){var b=m.open({templateUrl:"views/dialogs/RemotePacs.html",controller:a.RemotePacsController,backdrop:"static"});g.get(OptionNames.ShowPacsQuery)&&b.result.then(function(a){a&&(sessionStorage.setItem("AuthCode",f.authenticationCode),x.location.reload())})};b.openRemoteWado=function(){var b=m.open({templateUrl:"views/dialogs/RemoteWado.html",controller:a.RemoteWadoController,backdrop:"static"});g.get(OptionNames.ShowPacsQuery)&&b.result.then(function(a){a&&(sessionStorage.setItem("AuthCode",
f.authenticationCode),x.location.reload())})};b.openTemplateEditor=function(){E.path("/templateeditor")};b.openChangePassword=function(){m.open({templateUrl:"views/dialogs/PasswordChange.html",controller:a.PermissionsManagementController,backdrop:"static"}).result.then(function(a){var b=H.get_activeTabId();H._authenticationService.refreshPermissions().then(function(a){var c=H._authenticationService.hasPermission(PermissionNames.CanSaveHangingProtocol);q.enable("HangingProtocol"+b,function(){return c})})})};
b.openPermissionsManagement=function(){m.open({templateUrl:"views/dialogs/PermissionsManagement.html",controller:a.PermissionsManagementController,backdrop:"static"}).result.then(function(a){var b=H.get_activeTabId();H._authenticationService.refreshPermissions().then(function(a){var c=H._authenticationService.hasPermission(PermissionNames.CanSaveHangingProtocol);q.enable("HangingProtocol"+b,function(){return c})})})};b.openRolePatientsAccessManagement=function(){m.open({templateUrl:"views/dialogs/RolePatientsAccess.html",
controller:a.RolePatientsAccessController,backdrop:"static",resolve:{roles:function(){var a=z.defer();f.getRolesNames().success(function(b){angular.isArray(b)&&F(b,"Administrators");a.resolve(b)}).error(function(){a.resolve([])});return a.promise}}})};b.openUserPatientsAccessManagement=function(){m.open({templateUrl:"views/dialogs/UserPatientsAccess.html",controller:a.UserPatientsAccessController,backdrop:"static",resolve:{users:function(){var a=z.defer();f.getAllUsers().success(function(b){var c=
[];if(b&&0<b.length)for(var d=0;d<b.length;d++){var e=b[d];e.UserName?c.push(e.UserName):c.push(e)}a.resolve(c)}).error(function(){a.resolve([])});return a.promise}}})};b.doUpload=function(b){m.open({templateUrl:"views/dialogs/UploadFiles.html",controller:a.UploadFileController,backdrop:"static"})};b.canStore=function(){return f.hasPermission(PermissionNames.CanStore)};d.subscribe(EventNames.Logout,function(a,b){t.log_logOut(b.args.authenticationCode);h.LogoutNotify("User Logout");N.LogoutNotify("User Logout")});
d.subscribe(EventNames.ImageDataReady,$.proxy(this.onImageDataReady,this));d.subscribe(EventNames.CurrentDesignerChanged,$.proxy(this.onCurrentDesignerChanged,this));d.subscribe(EventNames.AnnotationsLoaded,$.proxy(this.onAnnotationsLoaded,this));d.subscribe(EventNames.LoadingSeriesFrames,$.proxy(this.onLoadingSeriesFrames,this));d.subscribe(EventNames.StackChanged,$.proxy(this.onStackChanged,this));d.subscribe(EventNames.NewSubCellSelected,$.proxy(this.onNewSubCellSelected,this));u.bindTo(b).add({combo:"del",
description:"Delete Cell",callback:$.proxy(this.onDelete,this)});d.subscribe(EventNames.StructuredDisplayUpdated,function(a,b){a=k.get_allTabs()[k.activeTab];a=k.get_tabData(a.id,TabDataKeys.ViewController);if(null!=a){a=a.getViewer();a.SDInstances=b.args.InstanceUIDs;a.exploded&&a.explode(a.explodedCell,!1);a.layout.beginUpdate();for(var c=a.layout.items.count,d,e=0;e<c;e++)d=a.layout.items.get_item(e),d.visibility=b.args.InstanceUIDs[d.seriesInstanceUID];a.layout.endUpdate()}});d.subscribe(EventNames.StructuredDisplaySelected,
function(a,b){a=k.get_allTabs()[k.activeTab];a=k.get_tabData(a.id,TabDataKeys.ViewController);a._viewerApi.studyLayout=null;if(null!=a){a=a.getViewer();b=b.args.structureDisplay;b.Boxes&&b.Boxes.sort(function(a,b){return a.ImageBoxNumber-b.ImageBoxNumber});H.ResetViewer(r,d,k);a.cellsArrangement=lt.Controls.Medical.CellsArrangement.random;a.totalCells=b.Boxes.length;Q(a,b.Boxes);B(a,b,b.Boxes);var c=-1,e=0,f=b.Boxes.length;for(e=0;e<f;e++){var g=b.Boxes[e],h=a.emptyDivs.items.get_item(e);null==h&&
(-1==c&&(c=e),h=a.layout.items.get_item(e-c));var l=Utils.createLeadRect(g.Position.leftTop.x,g.Position.leftTop.y,g.Position.rightBottom.x,g.Position.rightBottom.y);h.position=g.ImageBoxNumber;h.bounds=l}}});d.subscribe(EventNames.SeriesSelected,function(c,e){if(e.args.remote){c=k.find_tabsByType(TabTypes.UserQueue);var f=null;f=0==c.length?k.add_tab(UUID.generate(),"User Queue","views/UserQueueView.html",a.UserQueueController,TabTypes.UserQueue):c[0];k.select_tab(f.id);setTimeout(function(){b.$apply()});
e.args.series=d.publish(EventNames.DownloadSeries,{studyInfo:e.args.study,pacsClientInfo:w.server,clientAe:w.clientAETitle,seriesInfo:e.args.series})}else{var h=e.args.structureDisplay;I(function(){var c=O?"views/DentalViewer.html":"views/Viewer.html",f=O?a.DentalViewerController:a.ViewerController;var l=e.args.forCompare;var m=e.args.series;var n=e.args.style;l&&(c="views/CompareView.html",f=a.CompareViewController,m=e.args.series[0]);H._hideOverlay=!1;c=H.get_patientTab(m,e.args.series,c,f,l);n&&
"medicor"===n?g.set(OptionNames.UseMedicoreLogo,!0):g.set(OptionNames.UseMedicoreLogo,!1);if(e.args.studyLoad)c.tab.showStudyTimeLine=!0;else{n=k.get_tabData(c.tab.id,TabDataKeys.ViewController);null!=n&&null!=n._listController&&n._listController._list.parentNode.id!=m.Patient.ID&&n._listController.refreshContent(L,r,m.Patient.ID);if(l){H.log_OpenPatient(c.tab,k,t,m.Patient);k.select_tab(c.tab.id);c.tab.canDelete=!0;c.tab.title=lt.LTHelper.device==lt.LTDevice.mobile?"Compare":"Compare ["+$.tmplParse("<%=Patient.Name.replace(/^/g, ' ')%> - <%=Patient.ID%>",
m)+"]";l=k.get_tabData(c.tab.id,TabDataKeys.ViewController);return}if(null!=n){var p=n.getViewer();if(e.args.resetLayout){p.layout.beginUpdate();p.cellsArrangement=lt.Controls.Medical.CellsArrangement.grid;p.gridLayout.rows=1;p.gridLayout.columns=1;for(var q in p.SDInstances)p.SDInstances[q]=!0;p.layout.endUpdate()}null!=p&&p.exploded&&(p.explode(p.explodedCell,!1),window.setTimeout(function(){p.onSizeChanged()},250))}}H.log_OpenPatient(c.tab,k,t,m.Patient);k.select_tab(c.tab.id);c.setOverlay&&H._hideOverlay&&
k.set_tabData(c.tab.id,TabDataKeys.TagToggle,!1);c.setLinked&&O&&k.set_tabData(c.tab.id,TabDataKeys.Linked,!1);M.StudyInstanceUID&&(k.set_tabData(c.tab.id,TabDataKeys.LaunchingStudy,M.StudyInstanceUID),delete M.StudyInstanceUID);r.set_seriesTab(m.InstanceUID,c.tab);r.set_seriesInfo(m.InstanceUID,m);r.set_activeCell(e.args.id);c.tab.canDelete=!0;c.tab.title=lt.LTHelper.device==lt.LTDevice.mobile?"Viewer":"Viewer ["+$.tmplParse("<%=Patient.Name.replace(/^/g, ' ')%> - <%=Patient.ID%>",m)+"]";l=k.get_tabData(c.tab.id,
TabDataKeys.ViewController);t.log_showSeries(m);null!=l&&angular.isFunction(l.getListController)&&(l=l.getListController(),null!=l&&l.loadSeriesList(m.Patient.ID,m.InstanceUID,e.args.fromList));b.$apply();l=e.args.displaySetNumber;null==l&&(l=m.ImageBoxNumber);d.publish((h?EventNames.LoadStructureDisplay:EventNames.LoadSeries)+c.tab.id,{study:e.args.study,tabid:c.tab.id,series:m,template:e.args.template,view:e.args.view,displaySetNumber:l})})}});d.subscribe(EventNames.ActiveSeriesChanged,function(a,
b){var c=r.get_activeCell();H.checkWindowLevelForSelectedViewer(c,f);H.updateMultiFrame(c);if(!(c instanceof lt.Controls.Medical.Cell3D))H.onAnnotationsLoaded(a,b);H.get_activeTabId();a=H.get_activeTab();d.publish(EventNames.OpenStudyTimeLine,{show:a.showStudyTimeLine})});d.subscribe(EventNames.NewCellsAdded,function(a,b){a=b.args.cells;b=a.length;-1!=k.activeTab&&k.get_allTabs();for(var c=0;c<b;c++){var d=a[c];if(null!=d&&d.get_automation){var e=d.get_automation();if(null!=e){var g=d.get_imageViewer();
e.add_activeContainerChanged(function(a,b){null!=e.activeContainer&&(a=r.get_seriesTab(d.get_seriesInstanceUID()),null!=a&&(a=k.get_tabData(a.id,TabDataKeys.AnnotationVisiblity),void 0==a&&(a=!0),e.activeContainer.set_isVisible(a),e.get_automationControl().automationInvalidate(lt.LeadRectD.empty)))});g.add_itemChanged(function(a,b){b.get_reason()==lt.Controls.ImageViewerItemChangedReason.url&&H.checkWindowLevelForSelectedViewer(d,f)})}}}});b.canCalibrateMonitor=function(){return g.get(OptionNames.DentalMode)&&
f.hasPermission(PermissionNames.CanCalibrateMonitor)};b.canManageRemotePacs=function(){return f.hasPermission(PermissionNames.CanManageRemotePACS)};b.canDeleteCache=function(){return f.hasPermission(PermissionNames.CanDeleteCache)};b.canManagePermissions=function(){return f.hasPermission(PermissionNames.CanManageRoles)||f.hasPermission(PermissionNames.CanManageUsers)};b.canManageAccessRights=function(){return f.hasPermission(PermissionNames.CanManageAccessRight)};b.isAdmin=function(){return f.permissions.isAdmin};
b.canShowTemplates=function(){return f.hasPermission(PermissionNames.CanEditTemplates)};this._seriesManagerService=r;this._toolbarService=q;this._authenticationService=f;this._optionsService=g;this._tabService=k;this._commangular=y;this._dataService=l;this._cinePlayerService=G;this._objectRetrieveService=L;this._dialogs=J}b.prototype.ResetViewer=function(a,b,d){b=d.get_allTabs()[d.activeTab];d=a.get_allSeries();for(var c=0;c<d.length;c++)a.get_seriesTab(d[c])==b&&a.remove_seriesCell(d[c])};b.prototype.get_patientTab=
function(a,b,d,g,h){var c=this._optionsService.get(OptionNames.SinglePatientMode),e=!1,f=!1;h?(a=this._tabService.add_tab(UUID.generate(),"Compare",d,g,TabTypes.Compare),this._tabService.set_tabData(a.id,TabDataKeys.CompareInstances,b),this._tabService.set_tabData(a.id,TabDataKeys.TagToggle,!1),f=e=!0):c?(b=this._tabService.find_tabsByType(TabTypes.Viewer),0==b.length?(a=this._tabService.add_tab(UUID.generate(),"View",d,g,TabTypes.Viewer),this._hideOverlay=this._optionsService.get(OptionNames.HideOverlays),
f=e=!0):a=b[0]):(a=this.getPatientTab(a.Patient.ID,this._tabService),a||(a=this._tabService.add_tab(UUID.generate(),"View",d,g,TabTypes.Viewer),this._hideOverlay=this._optionsService.get(OptionNames.HideOverlays),f=e=!0));return{tab:a,setOverlay:e,setLinked:f}};b.prototype.log_OpenPatient=function(a,b,d,g){var c=b.get_tabData(a.id,TabDataKeys.PatientId),e=!0;c&&(e=c!=g.ID?!0:!1);e&&d.log_openPatient(g);b.set_tabData(a.id,TabDataKeys.PatientId,g.ID)};b.prototype.getPatientTab=function(a,b){b=this._seriesManagerService.get_allSeries();
for(var c=0;c<b.length;c++){var d=this._seriesManagerService.get_seriesInfo(b[c]);if(d&&a==d.Patient.ID)return this._seriesManagerService.get_seriesTab(b[c])}return null};b.prototype.onImageDataReady=function(a,b){var c=this._seriesManagerService.get_seriesCellById(b.args.id);a=this.get_activeTabId();b=CommandManager.LastCommand.Action;this.checkWindowLevelForSelectedViewer(c,this._authenticationService);b==MedicalViewerAction.WindowLevel&&this._toolbarService.isEnabled("WindowLevel"+a);-1!=b&&(c=
"",currentIcon[a]?c=currentIcon[a].id:b==MedicalViewerAction.WindowLevel?c="WindowLevel"+a:b==MedicalViewerAction.Offset?c="Pan"+a:b==MedicalViewerAction.Scale?c="Zoom"+a:b==MedicalViewerAction.Offset?c="Magnify"+a:b==MedicalViewerAction.Stack?c="Stack"+a:b==MedicalViewerAction.ProbeTool&&(c="ProbeTool"+a),""!=c&&SetCurrentInteractiveMode(this._toolbarService,this._tabService,b,c))};b.prototype.EnableButtons=function(a,b,d){var c,e=a.length;for(c=0;c<e;c++)b?this._toolbarService.enable(a[c]+d):this._toolbarService.disable(a[c]+
d)};b.prototype.EnableButtonsFor3D=function(a,b){this.EnableButtons("LayoutCompose MergeCells HangingProtocol DeleteStudyStructuredDisplay Magnify Stack ProbeTool Spyglass OneToOne ClearAllAnnotations ClearAll SaveAnn TrueSizeDisplay Orientation HorizontalAlignment VerticalAlignment ScrollingType SortSeries Endo Perio Dentin Annotations Measurements AnnotationShowHide DeleteAnnotations ClearAnnotations SaveAnn LoadAnn LinkImages Cursor3D ReferenceLine ShowFirstLast SeriesLayouts SynchronizeSeries ToggleCine WaveformBasicAudio LinkCells ShutterObject LineProfile SpyglassGroup FitImage EdgeEnhancment".split(" "),
!a,b)};b.prototype.Enable3DButtons=function(a,b){this.EnableButtons(["Rotate3D","DisplayOrientation","Settings3D"],a,b)};b.prototype.checkWindowLevelForSelectedViewer=function(a,b){var c=this.get_activeTabId();if(null!=a&&a.get_selected()){var d=a instanceof lt.Controls.Medical.Cell3D,e=a instanceof lt.Controls.Medical.MPRCell;""==CommandManager.Last3DCommand.ButtonID&&(CommandManager.Last3DCommand.ButtonID="Rotate3D"+c);""==CommandManager.LastCommand.ButtonID&&(CommandManager.LastCommand.ButtonID=
"WindowLevel"+c);var k=lt.Controls.Medical.Object3DEngine.canDo3D(a);this.EnableButtons(["VolumeType","DentalPanoramic"],a instanceof lt.Controls.Medical.Cell3D||k==lt.Controls.Medical.CanDo3DStatus.ok,c);a.get_seriesInstanceUID();k=a.currentOffset;this.EnableButtonsFor3D(d,c);this.Enable3DButtons(d,c);this.EnableButtons(["EdgeEnhancment"],!d&&!e,c);DicomHelper.supportWindowLevel(a,k)?(this._seriesManagerService.isDataReady(a,k)?(this._toolbarService.enable("WindowLevel"+c),this._toolbarService.enable("WindowLevelCustom"+
c),this._toolbarService.enable("Invert"+c)):(this._toolbarService.enable("WindowLevel"+c),this._toolbarService.enable("WindowLevelCustom"+c),this._toolbarService.disable("Invert"+c)),this._toolbarService.disable("BrightnessContrast"+c),this._toolbarService.disable("StretchHistogram"+c),this._toolbarService.disable("HSL"+c)):(this._toolbarService.enable("WindowLevel"+c),this._toolbarService.enable("WindowLevelCustom"+c),this._toolbarService.enable(["Invert"+c,"BrightnessContrast"+c,"StretchHistogram"+
c,"HSL"+c],function(){return!0}));e=this.get_activeTab();d?PressButton(this._toolbarService,e,CommandManager.Last3DCommand.ButtonID):PressButton(this._toolbarService,e,CommandManager.LastCommand.ButtonID);d&&this.EnableButtons(["WindowLevel","WindowLevelCustom"],a.volumeType!=lt.Controls.Medical.VolumeType.SSD,c);b&&b.hasPermission&&(a=b.hasPermission(PermissionNames.CanSaveStructuredDisplay),b.hasPermission(PermissionNames.CanStore),a||this.EnableButtons(["LayoutCompose"],!1,c))}};b.prototype.onCurrentDesignerChanged=
function(a,b){a=this.get_activeTabId();this._toolbarService.enable("CalibrateRuler"+a,function(){return b.args.selectedObject instanceof lt.Annotations.Engine.AnnPolyRulerObject})};b.prototype.enableShutterObject=function(){var a=this._seriesManagerService.get_activeCell();if(a){this._seriesManagerService.get_activeCellFrame();var b=this._tabService.get_allTabs()[this._tabService.activeTab];if(null==this._tabService.get_tabData(b.id,TabDataKeys.ViewController).getViewer())return!1;a=a.get_automation();
return(b=a.get_currentEditObject())?lt.Controls.Medical.ShutterObject.isValid(b)&&1==a.selectObjects.length:!1}};b.prototype.enableCrossHair=function(a,b){var c=a.parentCell,d=c instanceof lt.Controls.Medical.MPRCell;a=this.get_activeTabId();this._toolbarService.enable("CrossHair"+a,function(){return d||0<c.derivatives.count})};b.prototype.onAnnotationsLoaded=function(a,b){a=this._seriesManagerService.get_annotationIDs(b.args.seriesInstanceUID,b.args.id);b=this.get_activeTabId();var c=this._optionsService.get(OptionNames.DentalMode),
d=this;a&&0<a.length&&this._authenticationService.hasPermission(PermissionNames.CanViewAnnotations)?(this._toolbarService.enable("LoadAnn"+b),c&&this._toolbarService.hilightBorder("LoadAnn"+b,"1px","#ff0000")):(this._toolbarService.disable("LoadAnn"+b),c&&this._toolbarService.unhilightBorder("LoadAnn"+b));this._toolbarService.enable("SaveAnn"+b,function(){return d._authenticationService.hasPermission(PermissionNames.CanStoreAnnotations)});this._toolbarService.disable("DeleteAnn"+b);this._toolbarService.disable("CalibrateRuler"+
b);this._toolbarService.enable("SecondaryCapture"+b,function(){return d._authenticationService.hasPermission(PermissionNames.CanStore)});this._toolbarService.enable("LayoutCompose"+b,function(){return d._authenticationService.hasPermission(PermissionNames.CanStore)})};b.prototype.get_activeTabId=function(){if(-1!=this._tabService.activeTab){var a=this._tabService.get_allTabs()[this._tabService.activeTab];if(angular.isDefined(a))return a.id}return""};b.prototype.get_activeTab=function(){return-1!=
this._tabService.activeTab?this._tabService.get_allTabs()[this._tabService.activeTab]:null};b.prototype.onLoadingSeriesFrames=function(a,b){a=this._seriesManagerService.get_seriesCellById(b.args.id);b=this._tabService.get_allTabs()[this._tabService.activeTab];var c=this._tabService.get_tabData(b.id,TabDataKeys.TagToggle),d=this._tabService.get_tabData(b.id,TabDataKeys.ViewController).getViewer();this.updateMultiFrame(a);this.checkWindowLevelForSelectedViewer(a,this._authenticationService);c||a.set_overlayTextVisible(c);
if(d.showReferenceLine||d.showFirstAndLastReferenceLine){var e=!1,k=!1;d.showReferenceLine?(d.showReferenceLine=!1,e=!0):(d.showFirstAndLastReferenceLine=!1,k=!0);if(e||k)d.invalidate(),setTimeout(function(){e&&(d.showReferenceLine=!0);k&&(d.showFirstAndLastReferenceLine=!0);(e||k)&&d.refreshReferenceLine()},350)}};b.prototype.updateMultiFrame=function(a){var b=1<this._seriesManagerService.get_maxAllowedStackIndex(a);a=this.get_activeTabId();this._toolbarService.enable(["CinePlayer"+a,"Stack"+a],
function(){return b})};b.prototype.onStackChanged=function(a,b){this._cinePlayerService.isPlaying||(a=this._seriesManagerService.get_activeCell())&&this.checkWindowLevelForSelectedViewer(a,this._authenticationService)};b.prototype.onNewSubCellSelected=function(a,b){a=b.args.frame;var c=b.args.subCell.get_parentCell(),d=c.frames.indexOf(a),e=this.get_activeTabId();if(DicomHelper.supportWindowLevel(c,d)&&a.isDataReady)this._toolbarService.enable("WindowLevel"+e),this._toolbarService.enable("WindowLevelCustom"+
e),this._toolbarService.enable("Invert"+e),this._toolbarService.disable("BrightnessContrast"+e),this._toolbarService.disable("StretchHistogram"+e),this._toolbarService.disable("HSL"+e);else{var k=null==a?!1:null!=a.mrtiInfo;this._toolbarService.enable("WindowLevel"+e);this._toolbarService.enable("WindowLevelCustom"+e);this._toolbarService.enable(["Invert"+e,"BrightnessContrast"+e,"StretchHistogram"+e,"HSL"+e],function(){return k});this._toolbarService.enable("Invert"+e)}this.enableCrossHair(b.args.subCell,
b.args.frame)};b.prototype.onDelete=function(a,b){a=this._seriesManagerService.get_activeCell();null!=a&&(a=a.get_automation(),this.get_activeTabId(),null==a?this._commangular.dispatch("DeleteCell"):(b=a.currentDesigner,null!=b&&b.operationStatus?a.cancel():a.canDeleteObjects&&a.currentEditObject?this._commangular.dispatch("OnDeleteAnnotation"):this._commangular.dispatch("DeleteCell")))};b.$inject="$scope eventService authenticationService optionsService externalCommandHandlerService tabService dataService $modal $idle monitorCalibrationService seriesManagerService toolbarService auditLogService $commangular queryPacsService $window hotkeys sharedPropertiesService cinePlayerService $timeout $templateCache $q $location dataCache objectRetrieveService dialogs autoService".split(" ");
return b}();a.MedicalWebViewerController=b})(Controllers||(Controllers={}));
var SearchController=function(){function a(a,d,c,e,f,g,h,k,l,m,p){this._openWith="Open With";this._templatesHasAutoMatch=!1;this._scope=d;this._queryArchiveService=c;this._authenticationService=f;this._templateService=l;this._modalities=m.getModalities();d.showPacsQuery=e.get(OptionNames.ShowPacsQuery)&&f.hasPermission(PermissionNames.CanQueryPACS);d.querySource={};d.querySource.name="database";d.querySource.pacs=null;d.isTabletOrMobile=Utils.isTabletOrMobile();d.getUrl=function(a){return Utils.get_thumbnailUrl(a.entity)};
g.GetConnectionInfo().then(function(a){d.pacsClientInfo=a.data[0];d.storageServerInfo=a.data[1]}.bind(this));f.hasPermission(PermissionNames.CanViewTemplates)&&l.GetAllTemplates().then(function(a){a&&a.data&&(this._templates=a.data,this.updateTemplatesHaveAutoMatch())}.bind(this));k.subscribe(EventNames.SelectedTabChanged,function(a,b){if(h.find_tab(b.args.currentTab.id).type==TabTypes.Search&&d.onSearchTabSelected)d.onSearchTabSelected()});p("OPEN_WITH").then(function(a){this._openWith=a}.bind(this));
p("SD_OPEN_WITH").then(function(a){this._sdOpenWith=a}.bind(this));d.$watch("windowDimensions",function(a,b){if(d.onLayoutChanged)d.onLayoutChanged(a,b)})}a.prototype.get_structuredDisplay=function(){return this._structuredDisplay};a.prototype.set_structuredDisplay=function(a){this._structuredDisplay=a};a.prototype.patientids=function(a){return this._queryArchiveService.AutoComplete("patientid",a).then(function(a){var b=[];angular.forEach(a.data,function(a){b.push(a.Word)});return b})};a.prototype.patientNames=
function(a){a=a.replace(" ","^");return this._queryArchiveService.AutoComplete("patientname",a).then(function(a){var b=[];angular.forEach(a.data,function(a){b.push(a.Word)});return b})};a.prototype.updateTemplatesHaveAutoMatch=function(){if(this._templates)for(var a=0;a<this._templates.length;a++)if(this._templates[a].AutoMatching){this._templatesHasAutoMatch=!0;return}this._templatesHasAutoMatch=!1};a.prototype.createStructuredDisplayFromTemplate=function(a){var b={},c,e=a.Frames.length;b.Boxes=
[];b.Rows=-1;b.Columns=-1;b.Name=a.Name;b.OtherStudies=[];b.Series=[];for(c=0;c<e;c++){var f=a.Frames[c];var g={ColumnPosition:-1,FirstFrame:{}};g.HorizontalJustification=f.HorizontalJustification;g.ImageBoxLargeScrollAmount=null;g.ImageBoxLargeScrollType=0;g.ImageBoxLayoutType=4;g.ImageBoxNumber=f.FrameNumber;g.ImageBoxScrollDirection=null;g.ImageBoxSmallScrollAmount=null;g.ImageBoxSmallScrollType=null;g.ImageBoxTileHorizontalDimension=1;g.ImageBoxTileVerticalDimension=1;g.NumberOfColumns=0;g.NumberOfRows=
0;g.Position={leftTop:{x:f.Position.leftTop.x,y:f.Position.leftTop.y},rightBottom:{x:f.Position.rightBottom.x,y:f.Position.rightBottom.y}};g.PreferredPlaybackSequencing=null;g.RecommendedDisplayFrameRate=null;g.ReferencedPresentationStateSOP="";g.RowPosition=-1;g.VerticalJustification=f.VerticalJustification;g.WindowCenter=-1;g.WindowWidth=-1;g.referencedSOPInstanceUID=null;b.Boxes[c]=g}return b};a.prototype.getTemplateMenu=function(a){var b={};if(this._templates){for(var c=[],e=0;e<this._templates.length;e++){var f=
this._templates[e];this.isTemplateMatch(a,f)?b[f.Id]={name:f.Name}:c.push(f)}!$.isEmptyObject(b)&&0<c.length&&(b.seperator="-----");if(0<c.length)for(b.nonmatching={name:"Other Templates",items:{}},e=0;e<c.length;e++)f=c[e],b.nonmatching.items[f.Id]={name:f.Name}}return b};a.prototype.isTemplateMatch=function(a,d){var b=d.Modality.split("|");if(0==b.length)return!1;d=1==b.length?$.grep(this._modalities,function(a,c){return a.classType==b[0]}):$.grep(this._modalities,function(a,c){return a.classType==
b[0]&&a.description==b[1]});return 0<d.length?d[0].name==a:!1};a.prototype.getTemplate=function(a){return Utils.findFirst(this._templates,function(b){return a==b.Id})};a.prototype.getAutoMatchTemplates=function(){return Utils.findAll(this._templates,function(a){return a.AutoMatching})};a.prototype.isAnyTemplateAutoMatch=function(){return this._templatesHasAutoMatch};a.$inject="$rootScope $scope queryArchiveService optionsService authenticationService queryPacsService tabService eventService templateService templateEditorService $translate".split(" ");
return a}();
(function(a){var b=function(a){function b(b,c,d,h,k,l,m,p,n,r,q,t,y,w,x,u){d=this;h=m.get(OptionNames.DateFormat);m.get(OptionNames.TimeFormat);var e=d=a.call(this,b,c,l,m,n,r,t,k,y,w,u)||this;d._$scope=c;d._seriesManagerService=q;d._eventService=k;d._queryArchiveService=l;d._queryPacsService=r;d._optionsService=m;d._tabService=t;d._dataService=p;d._objectRetrieveService=x;d._viewStudy=!1;d._rowIndexPrevious=-1;c.hpContextMenu=d.hpContextMenu.bind(d);c.handleCellClicked=d.handleCellClicked.bind(d);c.patientids=
$.proxy(d.patientids,d);c.patientNames=$.proxy(d.patientNames,d);d._tabService.set_tabData(d._tabService.tabs[0].id,TabDataKeys.searchViewerController,d);c.gridOptions={rowSelection:"single",rowClass:"patientContext",groupHeaders:!0,suppressNoRowsOverlay:!0,columnDefs:[{headerName:"Patients",children:[{headerName:"",cellRenderer:Utils.countRenderer,width:29,onCellContextMenu:d.hpContextMenu.bind(d),suppressSizeToFit:!0},{headerName:"Patient ID",field:"ID",onCellContextMenu:d.hpContextMenu.bind(d)},
{headerName:"Name",onCellContextMenu:d.hpContextMenu.bind(d),valueGetter:function(a){return Utils.nameFormatter(a.data.Name)}},{headerName:"Sex",onCellContextMenu:d.hpContextMenu.bind(d),field:"Sex"},{headerName:"Birth Date",onCellContextMenu:d.hpContextMenu.bind(d),field:"BirthDate",cellRenderer:Utils.dateRenderer}]}],onRowSelected:d.patientSelected.bind(d),rowData:null,onGridReady:function(){c.gridOptions.api.hideOverlay();setTimeout(function(){c.gridOptions.api.sizeColumnsToFit()},500);$.contextMenu({selector:".patientContext",
trigger:"none",className:"data-title",build:function(a,b){return{callback:function(a,b){e._seriesManagerService.currentPatientSeries=e._$scope.gridOptionsSeries.rowData;var c=e._localStructuredDisplay.length;for(b=0;b<c;b++)if(e._localStructuredDisplay[b].Name==a){e._seriesManagerService.currentLoadingSeries=e.getSelectedSeries(e._localStructuredDisplay[b]);e._seriesManagerService.structuredDisplayList=e._localStructuredDisplay;e._seriesManagerService._currentStructuredDisplay=e._localStructuredDisplay[b];
e.loadselectedStructureDisplay(e._localStructuredDisplay[b]);break}},items:e.get_PatientStructuredDisplayItems()}}})}};c.gridOptionsSeries={rowSelection:"single",suppressNoRowsOverlay:!0,groupHeaders:!0,rowClass:"seriesContext",rowHeight:parseInt(m.get(OptionNames.SeriesThumbnailHeight)),overlayNoRowsTemplate:'<span style="padding: 10px; border: 2px solid #444; background: lightgoldenrodyellow;">No Series Found</span>',columnDefs:[{headerName:"Series",children:[{headerName:"",cellRenderer:Utils.has_mrtiRenderer,
width:29,suppressSizeToFit:!0,onCellContextMenu:d.contextMenu.bind(d)},{headerName:"",cellRenderer:Utils.thumbnailRenderer,hide:!m.get(OptionNames.ShowSearchThumbnails),width:parseInt(m.get(OptionNames.SeriesThumbnailWidth)),onCellContextMenu:d.contextMenu.bind(d)},{headerName:"Number",field:"Number",onCellContextMenu:d.contextMenu.bind(d)},{headerName:"Series Date",field:"Date",cellRenderer:Utils.dateRenderer,onCellContextMenu:d.contextMenu.bind(d)},{headerName:"Description",field:"Description",
onCellContextMenu:d.contextMenu.bind(d)},{headerName:"Modality",field:"Modality",onCellContextMenu:d.contextMenu.bind(d)},{headerName:"Instances",field:"NumberOfRelatedInstances",onCellContextMenu:d.contextMenu.bind(d)}]}],onRowSelected:d.seriesSelected.bind(d),rowData:null,onGridReady:function(){c.gridOptionsSeries.api.hideOverlay();$.contextMenu({selector:".seriesContext",trigger:"none",className:"data-title",build:function(a,b){return{callback:function(a,b){a=e.createStructuredDisplayFromTemplate(e.getTemplate(a));
e._seriesManagerService.currentLoadingSeries=e.getSelectedSeries(a);e._seriesManagerService.structuredDisplayList=e._localStructuredDisplay;e._seriesManagerService._currentStructuredDisplay=a;e.loadselectedStructureDisplay(a)},items:e.getTemplateMenu(e._selectedSeries.Modality)}}});setTimeout(function(){c.gridOptionsSeries.api.sizeColumnsToFit()},500)}};c.queryOptions=new Models.QueryOptions;c.queryOptions.PatientsOptions.PatientID="";c.pacsConnections=r.remoteConnections;c.dateFormat=h;c.dateOptions=
{"show-weeks":!1};c.datePicker={};c.datePicker.dateStartOpened=!1;c.datePicker.dateEndOpened=!1;b=c.pacsConnections.filter(function(a,b,c){return a.isDefault});0<b.length&&(c.querySource.pacs=b[0]);c.doSearch=function(){var a=angular.copy(c.queryOptions);if(angular.isDefined(a.PatientsOptions.PatientName)){var b=a.PatientsOptions.PatientName.match(/"(.*?)"/);a.PatientsOptions.PatientName=null==b?a.PatientsOptions.PatientName.replace(" ","^"):b[1].replace(/"/g,"")}e._selectedSeries=null;this.gridOptions.api.setRowData([]);
this.gridOptionsSeries.api.setRowData([]);this.gridOptionsSeries.api.hideOverlay();switch(c.querySource.name){case "database":l.FindPatients(a).then(function(a){a.data.FaultType?a.data.Message&&(e._$scope.gridOptionsSeries.api.hideOverlay(),alert(a.data.Message)):(k.publish(EventNames.SearchPatientsSuccess,a.data),c.gridOptions.api.setRowData(a.data))},function(a){});break;case "pacs":r.FindPatients(c.querySource.pacs,r.clientAETitle,a).then(function(a){a.data.FaultType?a.data.Message&&(e._$scope.gridOptionsSeries.api.hideOverlay(),
alert(a.data.Message)):(k.publish(EventNames.SearchPatientsSuccess,a.data),c.gridOptions.api.setRowData(a.data))},function(a){k.publish("Search/Study/Failure",{error:a})})}};c.clear=function(){c.queryOptions=new Models.QueryOptions;this.gridOptions.api.setRowData([]);this.gridOptionsSeries.api.setRowData([]);this._selectedSeries=null};c.OnSeriesSearchError=function(a,b){k.publish(EventNames.SearchSeriesFailure,{data:a,status:b})};c.openDateStart=function(a){a.preventDefault();a.stopPropagation();
c.datePicker.dateStartOpened=!c.datePicker.dateStartOpened};c.openDateEnd=function(a){a.preventDefault();a.stopPropagation();c.datePicker.dateEndOpened=!c.datePicker.dateEndOpened};c.queryModeChanged=function(){c.clear()};c.onLayoutChanged=function(a,b){setTimeout(function(){try{c.gridOptions.api.sizeColumnsToFit(),c.gridOptionsSeries.api.sizeColumnsToFit()}catch(D){}},250)};c.onSearchTabSelected=function(){setTimeout(function(){var a=c.gridOptions.api.getSelectedNodes(),b=c.gridOptions.api.getSelectedNodes();
c.gridOptions.api.sizeColumnsToFit();c.gridOptionsSeries.api.sizeColumnsToFit();c.gridOptions.api.refreshView();c.gridOptionsSeries.api.refreshView();0<a.length&&c.gridOptions.api.ensureNodeVisible(a[0]);0<b.length&&c.gridOptionsSeries.api.ensureNodeVisible(b[0])},225)};c.$watch("windowDimensions",function(a,b){c.gridOptions.api&&setTimeout(function(){c.gridOptions.api.sizeColumnsToFit();c.gridOptionsSeries.api.sizeColumnsToFit()},500)});k.subscribe(EventNames.MrtiInfoReady,function(a,b){Utils.clearMrti(this._$scope.gridOptionsSeries.api,
this._$scope.gridOptionsSeries.rowData,b.args.seriesInstanceUID)}.bind(d));return d}__extends(b,a);b.prototype.getSelectedSeries=function(a){a=a.Series[0].StudyInstanceUID;var b,c=this._$scope.gridOptionsSeries.rowData,d=c.length;for(b=0;b<d;b++)if(c[b].StudyInstanceUID==a)return c[b]};b.prototype.get_PatientStructuredDisplayItems=function(){for(var a={},b=0;b<this._localStructuredDisplay.length;b++){var c=this._localStructuredDisplay[b];a[c.Name]={name:c.Name}}return a};b.prototype.handleCellClicked=
function(a){lt.LTHelper.OS==lt.LTOS.iOS&&lt.LTHelper.device!=lt.LTDevice.desktop&&(this._rowIndexPrevious==a.rowIndex&&0==this._viewStudy&&this._$scope.hpContextMenu(a),this._rowIndexPrevious=a.rowIndex)};b.prototype.queryForSeries=function(a,b,c,d,k){var e=new Models.QueryOptions;e.SeriesOptions.SeriesInstanceUID=b;switch(a._$scope.querySource.name){case "database":a._queryArchiveService.FindSeries(e,1).then(function(b){b.data.FaultType?b.data.Message&&alert(b.data.Message):b.data&&0<b.data.length&&
(b.data[0].ImageBoxNumber=c,b.data[0].SopInstanceUIDs=d,a.loadSeries({InstanceUID:b.data[0].StudyInstanceUI},b.data[0],k))});break;case "pacs":a._queryPacsService.FindSeries(a._$scope.querySource.pacs,a._queryPacsService.clientAETitle,e).then(function(b){b.data.FaultType?b.data.Message&&alert(b.data.Message):b.data&&0<b.data.length&&(b.data[0].SopInstanceUIDs=d,a.loadSeries({InstanceUID:b.data[0].StudyInstanceUID},b.data[0],k))})}};b.prototype.loadSeries=function(a,b,c){this._eventService.publish(EventNames.SeriesSelected,
{study:a,series:b,remote:"pacs"==this._$scope.querySource.name,structureDisplay:c,studyLoad:!0,dentalSearchController:this})};b.prototype.loadselectedStructureDisplay=function(a){var b=this,c=null;c=a;b._templateService.currentHangingProtocol=null;if(""==a){var d=a=0,e=b._$scope.gridOptionsSeries.rowData.length;for(d=0;d<e;d++)b._$scope.gridOptionsSeries.rowData[d].CompleteMRTI&&a++}b._templateService.currentStudyLayout=c;b._seriesManagerService.cleanupSeries=!0;angular.isDefined(c.Series)?(c.studyInstanceUID=
b._selectedStudy.InstanceUID,$.each(c.Series,function(a,d){b._seriesManagerService.get_seriesInfo(d.SeriesInstanceUID);c.Boxes[b.getImageBox(d.ImageBoxNumber,c.Boxes)]&&b.queryForSeries(b,d.SeriesInstanceUID,d.ImageBoxNumber,c.Boxes[b.getImageBox(d.ImageBoxNumber,c.Boxes)].referencedSOPInstanceUID,!0)}),$.each(c.OtherStudies,function(a,d){$.each(d.Series,function(a,d){b._seriesManagerService.get_seriesInfo(d.SeriesInstanceUID);c.Boxes[b.getImageBox(d.ImageBoxNumber,c.Boxes)]&&b.queryForSeries(b,d.SeriesInstanceUID,
d.ImageBoxNumber,c.Boxes[b.getImageBox(d.ImageBoxNumber,c.Boxes)].referencedSOPInstanceUID,!0)})})):b.loadSeries(b._selectedStudy,b._$scope.gridOptionsSeries.rowData[0],!0);this._viewStudy=!1};b.prototype.getImageBox=function(a,b){var c,d=b.length;for(c=0;c<d;c++)if(b[c].ImageBoxNumber==a)return c;return-1};b.prototype.waitForStructuredDisplayData=function(a,b){var c=this;1==c._loadingPatientSeries?setTimeout(function(){c.waitForStructuredDisplayData(a)},100):(new Models.HangingProtocolQuery,this._loadingStructuredDisplay=
!0,this._localStructuredDisplay=[],this.showStructuredDisplayMenu(a,b),this._objectRetrieveService.GetPatientStructuredDisplay(a.data.ID).then(function(a){c._localStructuredDisplay=a.data;c.set_structuredDisplay(a.data);c._loadingStructuredDisplay=!1}))};b.prototype.showStructuredDisplayMenu=function(a,b){var c=this;if(1==this._loadingStructuredDisplay)setTimeout(function(){c.showStructuredDisplayMenu(a,b)},100);else{try{null!=this._localStructuredDisplay&&0!=this._localStructuredDisplay.length&&
$(".patientContext").contextMenu({x:a.event.pageX,y:a.event.pageY})}catch(h){}0<this._sdOpenWith.length&&$(".data-title").attr("data-menutitle",this._sdOpenWith)}};b.prototype.patientSelected=function(a){var b=this._$scope.gridOptions.api.getSelectedNodes(),c=this;if(1==b.length&&b[0].data!=this._selectedPatient){b=new Models.QueryOptions;var d=this._optionsService.get(OptionNames.MaxSeriesResults);b.PatientsOptions.PatientID=a.node.data.ID;this._selectedPatient=a.node.data;angular.isDefined(this._$scope.queryOptions.SeriesOptions.SeriesDateStart)&&
(b.SeriesOptions.SeriesDateStart=this._$scope.queryOptions.SeriesOptions.SeriesDateStart);angular.isDefined(this._$scope.queryOptions.SeriesOptions.SeriesDateEnd)&&(b.SeriesOptions.SeriesDateEnd=this._$scope.queryOptions.SeriesOptions.SeriesDateEnd);angular.isDefined(this._$scope.queryOptions.SeriesOptions.SeriesDescription)&&(b.SeriesOptions.SeriesDescription=this._$scope.queryOptions.SeriesOptions.SeriesDescription);c._loadingPatientSeries=!0;this._$scope.gridOptionsSeries.api.setRowData([]);this._$scope.gridOptionsSeries.api.hideOverlay();
switch(this._$scope.querySource.name){case "database":this._queryArchiveService.FindSeries(b,d).then(function(a){if(a.data.FaultType)a.data.Message&&(c._$scope.gridOptionsSeries.api.hideOverlay(),alert(a.data.Message));else{var b,d=a.data.length,e=[];for(b=0;b<d;b++)e[b]=a.data[b],e[b].NumericalDate=Utils.getSortableDate(e[b].Date);var f,g;for(b=0;b<d;b++){var h=1;for(g=f=0;g<e.length;g++)e[g].NumericalDate>h&&(h=e[g].NumericalDate,f=g);a.data[b]=e[f];e.splice(f,1)}c._dataService.set_Series(a.data);
c._$scope.gridOptionsSeries.api.setRowData(a.data);0==a.data.length&&(c._$scope.gridOptionsSeries.suppressNoRowsOverlay=!1,c._$scope.gridOptionsSeries.api.showNoRowsOverlay())}c._loadingPatientSeries=!1});break;case "pacs":c._queryPacsService.FindSeries(this._$scope.querySource.pacs,c._queryPacsService.clientAETitle,b).then(function(a){a.data.FaultType?a.data.Message&&(c._$scope.gridOptionsSeries.api.hideLoadingOverlay(),alert(a.data.Message)):(c._dataService.set_Series(a.data),c._$scope.gridOptionsSeries.api.setRowData(a.data),
0==a.data.length&&(c._$scope.gridOptionsSeries.suppressNoRowsOverlay=!1,c._$scope.gridOptionsSeries.api.showNoRowsOverlay()));c._loadingPatientSeries=!1})}}this._selectedSeries=null;this._selectedStudy=a.node.data};b.prototype.matchTemplateForSeries=function(a,b){var c=a.node.data.StudyInstanceUID,d=a.node.data.InstanceUID;c&&d?(c=this._objectRetrieveService.GetDicomJSON(c,d,""),c.success(function(c){var d=null;this.getAutoMatchTemplates().some(function(a){try{if(!d&&Utils.executeScript(a.AutoMatching,
c))return console.log("template auto-match found"),d=a,!0}catch(p){console.log(p)}return!1});this._eventService.publish(EventNames.SeriesSelected,{study:b[0].data,series:a.node.data,remote:"pacs"==this._$scope.querySource.name,template:d})}.bind(this)),c.error(function(c){console.log(c);this._eventService.publish(EventNames.SeriesSelected,{study:b[0].data,series:a.node.data,remote:"pacs"==this._$scope.querySource.name})})):(console.log("failed to read study/series id"),this._eventService.publish(EventNames.SeriesSelected,
{study:b[0].data,series:a.node.data,remote:"pacs"==this._$scope.querySource.name}))};b.prototype.seriesSelected=function(a){this._seriesManagerService.currentStructuredDisplay=null;var b=this._$scope.gridOptions.api.getSelectedNodes();this._templateService.currentStudyLayout=null;if(1==b.length){var c=this._$scope.gridOptionsSeries.api.getSelectedNodes();1==c.length&&(c[0].data!=this._selectedSeries?(this._selectedSeries=a.node.data,this._seriesManagerService.currentLoadingSeries=a.node.data,this._seriesManagerService.currentPatientSeries=
this._$scope.gridOptionsSeries.rowData,this.isAnyTemplateAutoMatch()?this.matchTemplateForSeries(a,b):this._eventService.publish(EventNames.SeriesSelected,{study:b[0].data,series:a.node.data,remote:"pacs"==this._$scope.querySource.name,dentalSearchController:this})):c[0].data==this._selectedSeries&&(c=this._seriesManagerService.get_seriesTab(a.node.data.InstanceUID),null!=c?this._tabService.select_tab(c.id):(this._seriesManagerService.currentLoadingSeries=a.node.data,this._seriesManagerService.currentPatientSeries=
this._$scope.gridOptionsSeries.rowData,this.isAnyTemplateAutoMatch()?this.matchTemplateForSeries(a,b):this._eventService.publish(EventNames.SeriesSelected,{study:b[0].data,series:a.node.data,remote:"pacs"==this._$scope.querySource.name,dentalSearchController:this}))))}};b.prototype.hpContextMenu=function(a){this._$scope.gridOptions.api.selectNode(a.node,!1,!0);this.patientSelected(a);this.waitForStructuredDisplayData(a)};b.prototype.contextMenu=function(a){};b.$inject="$rootScope $scope $modal uiGridConstants eventService queryArchiveService optionsService dataService authenticationService queryPacsService seriesManagerService tabService templateService templateEditorService objectRetrieveService $translate".split(" ");
return b}(SearchController);a.DentalSearchViewController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function b(a,b,d,g,h,k,l,m,p,n){var c=this;this._modal=h;this._scope=a;a.calibrations=g;a.selectedCalibration=null;a.canCalibrate=!0;a.showDialog=!0;a.gridOptions={enableSorting:!0,enableRowSelection:!0,enableRowHeaderSelection:lt.LTHelper.device==lt.LTDevice.mobile||lt.LTHelper.device==lt.LTDevice.tablet,noUnselect:!0,multiSelect:!1,onRegisterApi:function(b){b.selection.on.rowSelectionChanged(a,function(b){a.selectedCalibration=b.entity})},columnDefs:[{name:"Calibration Time",
field:"CalibrationTime",enableHiding:!1,sort:{direction:n.DESC,priority:0}},{name:"Workstation",field:"Workstation",enableHiding:!1},{name:"Username",field:"Username",enableHiding:!1},{name:"Comments",field:"Comments",enableHiding:!1}],data:g};a.calibrate=function(){c.showCalibrationImage("images/calibration.png",function(b){var d={CalibrationTime:(new Date).toString("M/d/yyyy hh:mm:ss tt"),Workstation:b.workstation,Username:k.user,Comments:b.comments};l.AddCalibration(d).success(function(){a.canCalibrate=
!1;a.calibrations.push(d);m.notify(c._notificationTitle,c._calibrationSuccessMsg)}).error(function(a,b){m.error(c._calibrationFailureMsg+": "+b)})})};a.close=function(){$(".modal-backdrop").remove();b.close()};p("DIALOGS_CALIBRATION_SUCCESS").then(function(a){c._calibrationSuccessMsg=a});p("DIALOGS_CALIBRATION_FAILURE").then(function(a){c._calibrationFailureMsg=a});p("DIALOGS_NOTIFICATION").then(function(a){c._notificationTitle=a})}b.prototype.showCalibrationImage=function(a,b){var c=this;0<$("#lightbox").length?
($("#content").html('<img src="'+a+'" />'),c._modal("hide"),$("#lightbox").show()):(c._scope.showDialog=!1,a='<div id="lightbox" style="z-index:3000; position:fixed; top:0; right:0; left:0"><div id="content"><img src="'+a+'" /></div></div>',$("body").append(a),$("#lightbox").on("click",function(){$("#lightbox").hide();$("#lightBox").remove();c._scope.showDialog=!0;c.getWorkstation(b)}))};b.prototype.getWorkstation=function(b){this._modal.open({templateUrl:"views/dialogs/GetWorkstation.html",controller:a.GetWorkstationController,
backdrop:"static"}).result.then(function(a){b&&b(a)},function(a){})};b.$inject="$scope $modalInstance optionsService calibrations $modal authenticationService monitorCalibrationService dialogs $translate uiGridConstants".split(" ");return b}();a.MonitorCalibrationController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){return function(){this.tag=this.id="";this.overlayType=0;this.color="#FFFFFF";this.title=""}}();a.OverlayTag=b;b=function(){return function(){this.topRight=[];this.topLeft=[];this.bottomLeft=[];this.bottomRight=[];this.centerLeft=[];this.centerTop=[];this.centerRight=[];this.centerBottom=[]}}();a.OverlayTags=b;b=function(){function b(b,d,f,g,h,k,l,m,p,n){var c=this;this._overlayManagerService=k;this._scope=b;b.position={value:"topLeft"};b.gridOptions={appScopeProvider:b,
enableSorting:!0,enableRowSelection:!0,enableRowHeaderSelection:lt.LTHelper.device==lt.LTDevice.mobile||lt.LTHelper.device==lt.LTDevice.tablet,noUnselect:!0,multiSelect:!1,onRegisterApi:function(a){a.selection.on.rowSelectionChanged(b,function(a){b.selectedOverlay=a.entity})},columnDefs:[{name:"Type",field:"overlayType",enableHiding:!1,cellFilter:"mapType"},{name:"Title",field:"title",enableHiding:!1},{name:"Tag",field:"tag",enableHiding:!1},{name:"Color",field:"color",enableHiding:!1,enableSorting:!1,
cellTemplate:'<div class="ui-grid-cell-contents" title="TOOLTIP"><div style="background-color:{{COL_FIELD}}; width:inherit; height:inherit"></div></div>'}],data:"overlays[position.value]"};b.overlays=Utils.clone(k.getOverlayTags());b.close=function(){d.close()};b.addTag=function(){l.open({templateUrl:"views/dialogs/AddOverlayTag.html",controller:a.AddTagController,backdrop:"static",resolve:{tag:function(){return null}}}).result.then(function(a){angular.isDefined(b.overlays[b.position.value])||(b.overlays[b.position.value]=
[]);b.overlays[b.position.value].push(a);b.hasChanged=!0},function(){})};b.editTag=function(){var c=b.selectedOverlay;null!=c&&l.open({templateUrl:"views/dialogs/AddOverlayTag.html",controller:a.AddTagController,backdrop:"static",resolve:{tag:function(){return c}}}).result.then(function(a){var d=b.overlays[b.position.value].indexOf(c);b.overlays[b.position.value][d]=a;b.hasChanged=!0},function(){})};b.deleteTag=function(){var a=b.selectedOverlay;if(null!=a){var c=$.grep(b.overlays[b.position.value],
function(b,c){return b.id==a.id});0<c.length&&(c=b.overlays[b.position.value].indexOf(c[0]),-1!=c&&(b.overlays[b.position.value].splice(c,1),b.hasChanged=!0))}};b.restore=function(){b.overlays=Utils.clone(k.getOverlayTags());b.hasChanged=!1};b.save=function(){k.saveOverlayTags(b.overlays).success(function(){h.set(OptionNames.OverlaySettings,JSON.stringify(b.overlays));m.notify(c._notificationTitle,c._overlaySuccessMsg);b.hasChanged=!1}).error(function(a,b){})};b.getColor=function(a){};b.hasSelection=
function(){return!angular.isUndefined(b.selectedOverlay)&&null!=b.selectedOverlay};p("DIALOGS_OVERLAY_SAVED").then(function(a){c._overlaySuccessMsg=a});p("DIALOGS_NOTIFICATION").then(function(a){c._notificationTitle=a})}b.$inject="$scope $modalInstance eventService authenticationService optionsService overlayManagerService $modal dialogs $translate $timeout".split(" ");return b}();a.OverlaySettingsController=b})(Controllers||(Controllers={}));
app.filter("mapType",function(){return function(a){var b=angular.element("*[ng-app]").injector().get("overlayManagerService");return angular.isDefined(a)?b.getOverlayTypeName(a):"UserData"}});
(function(a){var b=function(a){function b(b,c,d,h,k,l,m,p,n,r,q,t,y,w,x,u,A){d=this;l.get(OptionNames.DateFormat);l.get(OptionNames.TimeFormat);var e=l.get(OptionNames.MaxStudyResults);UUID.generate();UUID.generate();var f=d=a.call(this,b,c,k,l,n,p,r,h,y,w,x)||this;d._$scope=c;d._queryArchiveService=k;d._queryPacsService=p;d._dataService=m;d._optionsService=l;d._eventService=h;d._tabService=r;d._seriesManagerService=q;d._objectStoreService=t;d._objectRetrieveService=u;d._viewStudy=!1;d._dataCache=
A;d._hpOpenWith="Hanging Protocol";d._sdOpenWith="Structured Display";d._rowIndexPrevious=-1;c.hpContextMenu=d.hpContextMenu.bind(d);c.handleCellClicked=d.handleCellClicked.bind(d);c.gridOptions={rowSelection:"single",suppressNoRowsOverlay:!0,groupHeaders:!0,enableSorting:!0,rowClass:"studyContext",angularCompileRows:!0,columnDefs:[{headerName:"Studies",children:[{headerName:"",cellRenderer:Utils.countRenderer,width:35,suppressSizeToFit:!0,onCellContextMenu:d.hpContextMenu.bind(d),onCellClicked:d.handleCellClicked.bind(d)},
{headerName:"Patient ID",valueGetter:function(a){return Utils.nameFormatter(a.data.Patient.ID)},cellRenderer:Utils.hyperlinkPatientIdRenderer,onCellContextMenu:d.hpContextMenu.bind(d),onCellClicked:d.handleCellClicked.bind(d)},{headerName:"Name",valueGetter:function(a){return Utils.nameFormatter(a.data.Patient.Name)},onCellContextMenu:d.hpContextMenu.bind(d),onCellClicked:d.handleCellClicked.bind(d)},{headerName:"Accession #",field:"AccessionNumber",onCellContextMenu:d.hpContextMenu.bind(d),onCellClicked:d.handleCellClicked.bind(d)},
{headerName:"Study Date",field:"Date",cellRenderer:Utils.dateRenderer,comparator:Utils.dateComparator,onCellContextMenu:d.hpContextMenu.bind(d),onCellClicked:d.handleCellClicked.bind(d)},{headerName:"Refer Dr Name",valueGetter:function(a){return Utils.nameFormatter(a.data.ReferringPhysiciansName)},onCellContextMenu:d.hpContextMenu.bind(d),onCellClicked:d.handleCellClicked.bind(d)},{headerName:"Description",field:"Description",onCellContextMenu:d.hpContextMenu.bind(d),onCellClicked:d.handleCellClicked.bind(d)}]}],
onRowSelected:d.studySelected.bind(d),rowData:null,onGridReady:function(){c.gridOptions.api.hideOverlay();setTimeout(function(){c.gridOptions.api.sizeColumnsToFit()},500);$.contextMenu({selector:".studyContext",trigger:"none",className:"data-title",build:function(a,b){return{callback:function(a,b){b=f._$scope.gridOptions.api.getSelectedNodes();"NoHangingProtocolFound_407B6C09-83C2-4A7F-9643-AA4301F6A67A"!=a&&f.viewHangingProtocol(b[0],a)},items:f.get_hangingProtocols()}}})}};c.gridOptionsSeries={rowSelection:"single",
suppressNoRowsOverlay:!0,enableSorting:!0,rowClass:"seriesContext",groupHeaders:!0,overlayNoRowsTemplate:'<span style="padding: 10px; border: 2px solid #444; background: lightgoldenrodyellow;">No Series Found</span>',rowHeight:parseInt(l.get(OptionNames.SeriesThumbnailHeight)),columnDefs:[{headerName:"Series",children:[{headerName:"",cellRenderer:Utils.has_mrtiRenderer,width:29,suppressSizeToFit:!0,onCellContextMenu:d.contextMenu.bind(d),suppressSorting:!0},{headerName:"",cellRenderer:Utils.thumbnailRenderer,
hide:!l.get(OptionNames.ShowSearchThumbnails),width:parseInt(l.get(OptionNames.SeriesThumbnailWidth)),onCellContextMenu:d.contextMenu.bind(d),suppressSorting:!0},{headerName:"Number",field:"Number",onCellContextMenu:d.contextMenu.bind(d)},{headerName:"Series Date",field:"Date",cellRenderer:Utils.dateRenderer,onCellContextMenu:d.contextMenu.bind(d),comparator:Utils.dateComparator},{headerName:"Description",field:"Description",onCellContextMenu:d.contextMenu.bind(d)},{headerName:"Modality",field:"Modality",
onCellContextMenu:d.contextMenu.bind(d)},{headerName:"Instances",field:"NumberOfRelatedInstances",onCellContextMenu:d.contextMenu.bind(d)}]}],onRowSelected:d.seriesSelected.bind(d),rowData:null,onGridReady:function(){c.gridOptionsSeries.api.hideOverlay();$.contextMenu({selector:".seriesContext",trigger:"none",className:"data-title",build:function(a,b){return{callback:function(a,b){f._eventService.publish(EventNames.SeriesSelected,{study:f._selectedStudy,series:f._selectedSeries,remote:"pacs"==f._$scope.querySource.name,
template:f.getTemplate(a)})},items:f.getTemplateMenu(f._selectedSeries.Modality)}}});setTimeout(function(){c.gridOptionsSeries.api.sizeColumnsToFit()},500)}};c.queryOptions=new Models.QueryOptions;c.studies=[];c.pacsConnections=p.remoteConnections;b=c.pacsConnections.filter(function(a,b,c){return a.isDefault});0<b.length&&(c.querySource.pacs=b[0]);c.doSearch=function(){this._rowIndexPrevious=-1;var a=angular.copy(c.queryOptions);if(angular.isDefined(a.PatientsOptions.PatientName)){var b=a.PatientsOptions.PatientName.match(/"(.*?)"/);
a.PatientsOptions.PatientName=null==b?a.PatientsOptions.PatientName.replace(" ","^"):b[1].replace(/"/g,"")}angular.isDefined(a.StudiesOptions.ReferDoctorName)&&(b=a.StudiesOptions.ReferDoctorName.match(/"(.*?)"/),a.StudiesOptions.ReferDoctorName=null==b?a.StudiesOptions.ReferDoctorName.replace(" ","^"):b[1].replace(/"/g,""));angular.isDefined(a.StudiesOptions.ModalitiesInStudy)&&0<a.StudiesOptions.ModalitiesInStudy.length&&(b=a.StudiesOptions.ModalitiesInStudy,a.StudiesOptions.ModalitiesInStudy=[],
a.StudiesOptions.ModalitiesInStudy.push(b));f._selectedStudy=null;f._selectedSeries=null;c.gridOptions.api.setRowData([]);c.gridOptionsSeries.api.setRowData([]);c.gridOptionsSeries.api.hideOverlay();switch(c.querySource.name){case "database":k.FindStudies(a,e).then(function(a){h.publish("Search/Study/Success",a.data);c.gridOptions.api.setRowData(a.data)},function(a){h.publish("Search/Study/Failure",{error:a})});break;case "pacs":p.FindStudies(c.querySource.pacs,p.clientAETitle,a).then(function(a){h.publish("Search/Study/Success",
a.data);c.gridOptions.api.setRowData(a.data)},function(a){h.publish("Search/Study/Failure",{error:a})})}};c.clear=function(){c.queryOptions=new Models.QueryOptions;c.gridOptions.api.setRowData([]);c.gridOptionsSeries.api.setRowData([]);f._selectedStudy=null;f._selectedSeries=null};c.queryModeChanged=function(){c.studies.length=0};c.patientids=$.proxy(d.patientids,d);c.patientNames=$.proxy(d.patientNames,d);c.onLayoutChanged=function(a,b){setTimeout(function(){c.gridOptions.api&&c.gridOptions.api.sizeColumnsToFit();
c.gridOptionsSeries.api&&c.gridOptionsSeries.api.sizeColumnsToFit()},250)};c.onSearchTabSelected=function(){setTimeout(function(){var a=c.gridOptions.api.getSelectedNodes(),b=c.gridOptions.api.getSelectedNodes();c.gridOptions.api.refreshView();c.gridOptionsSeries.api.refreshView();c.gridOptions.api.sizeColumnsToFit();c.gridOptionsSeries.api.sizeColumnsToFit();0<a.length&&c.gridOptions.api.ensureNodeVisible(a[0]);0<b.length&&c.gridOptionsSeries.api.ensureNodeVisible(b[0])},225)};c.$watch("windowDimensions",
function(a,b){c.gridOptions.api&&setTimeout(function(){c.gridOptions.api.sizeColumnsToFit();c.gridOptionsSeries.api.sizeColumnsToFit()},500)});c.onViewStudy=d.onViewStudy.bind(d);return d}__extends(b,a);b.prototype.onViewStudy=function(a){this._viewStudy=!0};b.prototype.viewHangingProtocol=function(a,b){var c=this;this._objectRetrieveService.GetHangingProtocol(b).then(function(a){var d=a.data;c._templateService.currentStudyLayout=null;c._templateService.currentHangingProtocol=d;c._objectRetrieveService.GetHangingProtocolInstances(b,
c._selectedStudy.Patient.ID,c._selectedStudy.InstanceUID,c._selectedStudy.Date).then(function(a){c.loadHangingProtocol(a.data,d)},function(a){})})};b.prototype.studySelected=function(a,b){b=this._$scope.gridOptions.api.getSelectedNodes();var c=this._viewStudy;this._viewStudy=!1;this._loadingStudySeries=!0;if(1==b.length&&b[0].data!=this._selectedStudy){b=new Models.QueryOptions;var d=this._optionsService.get(OptionNames.MaxSeriesResults),e=this,f=this._$scope.queryOptions.StudiesOptions.ModalitiesInStudy;
this._selectedStudy=a.node.data;this._$scope.gridOptionsSeries.api.setRowData(void 0);this._$scope.gridOptionsSeries.api.showLoadingOverlay();b.StudiesOptions=new Models.StudyQueryOptions;b.StudiesOptions.StudyInstanceUID=a.node.data.InstanceUID;angular.isDefined(f)&&0<f.length&&(b.StudiesOptions.ModalitiesInStudy=[],b.StudiesOptions.ModalitiesInStudy.push(f));switch(this._$scope.querySource.name){case "database":this._queryArchiveService.FindSeries(b,d).then(function(a){a.data.FaultType?a.data.Message&&
(e._$scope.gridOptionsSeries.api.hideOverlay(),alert(a.data.Message)):(e._dataService.set_Series(a.data),e._selectedStudy.InstanceUID==a.data[0].StudyInstanceUID&&(e._$scope.gridOptionsSeries.api.setRowData(a.data),c&&e.loadStudy()));e._loadingStudySeries=!1});break;case "pacs":this._queryPacsService.FindSeries(this._$scope.querySource.pacs,this._queryPacsService.clientAETitle,b).then(function(a){a.data.FaultType?a.data.Message&&(e._$scope.gridOptionsSeries.api.hideLoadingOverlay(),alert(a.data.Message)):
(e._dataService.set_Series(a.data),e._selectedStudy.InstanceUID==a.data[0].StudyInstanceUID&&(e._$scope.gridOptionsSeries.api.setRowData(a.data),c&&e.loadStudy()));e._loadingStudySeries=!1})}}else this._loadingStudySeries=!1,c&&this.loadStudy()};b.prototype.loadHangingProtocol=function(a,b){var c=this;angular.forEach(a,function(a,b){c.loadHangingProtocolSeries({InstanceUID:a.Series.StudyInstanceUID,Patient:a.Series.Patient},a.Series,a)})};b.prototype.queryForSeries=function(a,b,c,d){var e=new Models.QueryOptions;
e.SeriesOptions.SeriesInstanceUID=b;switch(a._$scope.querySource.name){case "database":a._queryArchiveService.FindSeries(e,1).then(function(b){b.data.FaultType?b.data.Message&&alert(b.data.Message):b.data&&0<b.data.length&&(b.data[0].ImageBoxNumber=c,b.data[0].SopInstanceUIDs=d,a.loadSeries({InstanceUID:b.data[0].StudyInstanceUI},b.data[0]))});break;case "pacs":a._queryPacsService.FindSeries(a._$scope.querySource.pacs,a._queryPacsService.clientAETitle,e).then(function(b){b.data.FaultType?b.data.Message&&
alert(b.data.Message):b.data&&0<b.data.length&&(b.data[0].SopInstanceUIDs=d,a.loadSeries({InstanceUID:b.data[0].StudyInstanceUID},b.data[0]))})}};b.prototype.getImageBox=function(a,b){var c,d=b.length;for(c=0;c<d;c++)if(b[c].ImageBoxNumber==a)return c;return-1};b.prototype.loadStudy=function(a){var b=this;this._dataCache.StudyInstanceUID=this._selectedStudy.InstanceUID;var c=null;this._objectRetrieveService.GetStudyLayout(this._selectedStudy.InstanceUID).then(function(a){c=a.data;b._templateService.currentHangingProtocol=
null;if(""==a.data){var d=a=0,e=b._$scope.gridOptionsSeries.rowData.length;for(d=0;d<e;d++)b._$scope.gridOptionsSeries.rowData[d].CompleteMRTI&&a++}b._templateService.currentStudyLayout=c;angular.isDefined(c.Series)?(c.studyInstanceUID=b._selectedStudy.InstanceUID,$.each(c.Series,function(a,d){b._seriesManagerService.get_seriesInfo(d.SeriesInstanceUID)||b.queryForSeries(b,d.SeriesInstanceUID,d.ImageBoxNumber,c.Boxes[b.getImageBox(d.ImageBoxNumber,c.Boxes)].referencedSOPInstanceUID)}),$.each(c.OtherStudies,
function(a,d){$.each(d.Series,function(a,d){b._seriesManagerService.get_seriesInfo(d.SeriesInstanceUID)||b.queryForSeries(b,d.SeriesInstanceUID,d.ImageBoxNumber,c.Boxes[b.getImageBox(d.ImageBoxNumber,c.Boxes)].referencedSOPInstanceUID)})})):b.loadSeries(b._selectedStudy,b._$scope.gridOptionsSeries.rowData[0])});this._viewStudy=!1};b.prototype.autoLoadWithHangingProtocol=function(){var a=this._$scope.gridOptions.api.getSelectedNodes();this.studySelected(a[0]);this.waitForSeries(a[0],!0)};b.prototype.loadSeries=
function(a,b){this._eventService.publish(EventNames.SeriesSelected,{study:a,series:b,remote:"pacs"==this._$scope.querySource.name,studyLoad:!0})};b.prototype.loadHangingProtocolSeries=function(a,b,c){this._eventService.publish(EventNames.SeriesSelected,{study:a,series:b,view:c,remote:"pacs"==this._$scope.querySource.name,displaySetNumber:c.DisplaySetNumber})};b.prototype.matchTemplateForSeries=function(a){var b=a.node.data.StudyInstanceUID,c=a.node.data.InstanceUID;b&&c?(b=this._objectRetrieveService.GetDicomJSON(b,
c,""),b.success(function(b){var c=null;this.getAutoMatchTemplates().some(function(a){try{if(!c&&Utils.executeScript(a.AutoMatching,b))return console.log("template auto-match found"),c=a,!0}catch(m){console.log(m)}return!1});this._eventService.publish(EventNames.SeriesSelected,{study:this._selectedStudy,series:a.node.data,remote:"pacs"==this._$scope.querySource.name,template:c})}.bind(this)),b.error(function(b){console.log(b);this._eventService.publish(EventNames.SeriesSelected,{study:this._selectedStudy,
series:a.node.data,remote:"pacs"==this._$scope.querySource.name})})):(console.log("failed to read study/series id"),this._eventService.publish(EventNames.SeriesSelected,{study:this._selectedStudy,series:a.node.data,remote:"pacs"==this._$scope.querySource.name}))};b.prototype.seriesSelected=function(a){var b=this._$scope.gridOptionsSeries.api.getSelectedNodes();this._templateService.currentStudyLayout=null;1==b.length&&(b[0].data!=this._selectedSeries?(this._selectedSeries=a.node.data,this.isAnyTemplateAutoMatch()?
this.matchTemplateForSeries(a):this._eventService.publish(EventNames.SeriesSelected,{study:this._selectedStudy,series:a.node.data,remote:"pacs"==this._$scope.querySource.name})):b[0].data==this._selectedSeries&&(b=this._seriesManagerService.get_seriesTab(a.node.data.InstanceUID),null!=b?this._tabService.select_tab(b.id):this.isAnyTemplateAutoMatch()?this.matchTemplateForSeries(a):this._eventService.publish(EventNames.SeriesSelected,{study:this._selectedStudy,series:a.node.data,remote:"pacs"==this._$scope.querySource.name})))};
b.prototype.contextMenu=function(a){};b.prototype.hpContextMenu=function(a){this._$scope.gridOptions.api.selectNode(a.node,!1,!0);this.studySelected(a);this.waitForSeries(a)};b.prototype.handleCellClicked=function(a){lt.LTHelper.OS==lt.LTOS.iOS&&lt.LTHelper.device!=lt.LTDevice.desktop&&(this._rowIndexPrevious==a.rowIndex&&0==this._viewStudy&&this._$scope.hpContextMenu(a),this._rowIndexPrevious=a.rowIndex)};b.prototype.waitForSeries=function(a,b){var c=this;1==this._loadingStudySeries?setTimeout(function(){c.waitForSeries(a)},
100):(new Models.HangingProtocolQuery,this.get_ModalitesInActiveStudy(),this._loadingHangingProtocols=!0,this._hangingProtocols=[],this._optionsService.get(OptionNames.DentalMode),this.waitForHangingProtocols(a,b),this._queryArchiveService.FindHangingProtocols(a.data.InstanceUID).then(function(a){c._hangingProtocols=a.data;c._loadingHangingProtocols=!1}))};b.prototype.showStructuredDisplayMenu=function(a,b){var c=this;1==this._loadingHangingProtocols?setTimeout(function(){c.showStructuredDisplayMenu(a,
b)},100):($(".studyContext").contextMenu({x:a.event.pageX,y:a.event.pageY}),0<this._sdOpenWith.length&&$(".data-title").attr("data-menutitle",this._sdOpenWith))};b.prototype.waitForHangingProtocols=function(a,b){var c=this;1==this._loadingHangingProtocols?setTimeout(function(){c.waitForHangingProtocols(a,b)},100):this._hangingProtocols&&0<=this._hangingProtocols.length&&(b?0==this._hangingProtocols.length&&this._objectRetrieveService.GetHangingProtocol(c._hangingProtocols[0].SOPInstanceUID).then(function(a){var b=
a.data;c._templateService.currentStudyLayout=null;c._templateService.currentHangingProtocol=b;c._objectRetrieveService.GetHangingProtocolInstances(c._hangingProtocols[0].SOPInstanceUID,c._selectedStudy.Patient.ID,c._selectedStudy.InstanceUID,null).then(function(a){c.loadHangingProtocol(a.data,b)},function(a){})}):($(".studyContext").contextMenu({x:a.event.pageX,y:a.event.pageY}),0<this._hpOpenWith.length&&$(".data-title").attr("data-menutitle",this._hpOpenWith)))};b.prototype.get_ModalitesInActiveStudy=
function(){for(var a=[],b=this._$scope.gridOptionsSeries.rowData.length,c=0;c<b;c++){var d=this._$scope.gridOptionsSeries.rowData[c];-1==a.indexOf(d.Modality)&&a.push(d.Modality)}return a};b.prototype.get_hangingProtocolsType=function(a){var b={},c=!0,d="";switch(a){case Models.HangingProtocolLevel.Manufacturer:d="fa-gear";break;case Models.HangingProtocolLevel.Site:d="fa-institution";break;case Models.HangingProtocolLevel.UserGroup:d="fa-group";break;case Models.HangingProtocolLevel.SingleUser:d=
"fa-user"}for(var e=0;e<this._hangingProtocols.length;e++){var l=this._hangingProtocols[e];l.Level==a&&(c=!1,b[l.SOPInstanceUID]={name:l.Name,icon:d})}c&&(b=null);return b};b.prototype.addSeparator=function(a,b,c){b&&(a[c]="---------")};b.prototype.get_hangingProtocols=function(){var a={},b=this.get_hangingProtocolsType(Models.HangingProtocolLevel.Manufacturer),c=this.get_hangingProtocolsType(Models.HangingProtocolLevel.Site),d=this.get_hangingProtocolsType(Models.HangingProtocolLevel.UserGroup),
k=this.get_hangingProtocolsType(Models.HangingProtocolLevel.SingleUser),l=!1;null!=b&&(a=jQuery.extend(a,b),l=!0);null!=c&&(this.addSeparator(a,l,"sepSite"),a=jQuery.extend(a,c),l=!0);null!=d&&(this.addSeparator(a,l,"sepUserGroup"),a=jQuery.extend(a,d),l=!0);null!=k&&(this.addSeparator(a,l,"sepSingleUser"),a=jQuery.extend(a,k),l=!0);0==l&&(a={"NoHangingProtocolFound_407B6C09-83C2-4A7F-9643-AA4301F6A67A":{name:"No Hanging Protocols",icon:"fa-exclamation-triangle",className:"context-menu-red-message"}});
return a};b.prototype.get_hangingProtocols_test=function(){return{Manufacturer:{name:"Manufacturer",disabled:!0},edit:{name:"Edit",icon:"edit"},cut:{name:"Cut",icon:"fa-gear"},sepSite:"---------",Site:{name:"Site",disabled:!0},copy:{name:"Copy",icon:"copy"},paste:{name:"Paste",icon:"paste"},stayOpen:{name:"StayOpen",icon:"paste",callback:function(){return!1}},sepUserGroup:"---------",UserGroup:{name:"User Group",disabled:!0}}};b.$inject="$rootScope $scope $modal eventService queryArchiveService optionsService dataService queryPacsService authenticationService tabService seriesManagerService objectStoreService templateService templateEditorService $translate objectRetrieveService dataCache".split(" ");
return b}(SearchController);a.SearchViewController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g,h,k,l,m,p,n,r,q,t){this._objectRetrieveService=this._listController=null;h.get(OptionNames.DateFormat);var c=h.get(OptionNames.SingleSeriesMode),e=this;a=Utils.get_spacingSize();m=2*h.get(OptionNames.SeriesThumbnailWidth);150<m&&(m=150);this._toolbarService=g;this._tabService=p;b.layoutConfig={autoBindCustomButtons:!0,scrollToBookmarkOnLoad:!1,applyDemoStyles:!0,spacing_closed:2*a,spacing_open:2*a,livePaneResizing:!1,west__size:$(window).width()*(Utils.isTabletOrMobile(),
.25),west__resizable:!0,west__togglerLength_closed:21,south__resizable:!1,south__initHidden:!0,south__togglerContent_open:"<span style='vertical-align:top; color:white; vertical-align:middle'>Overflow</span>",south__togglerLength_open:64,south__togglerContent_closed:"<span style='vertical-align:top; color:white'>Overflow</span>",south__togglerLength_closed:64,south__size:m,east__initHidden:!0,east__resizable:!0,east__size:$(window).width()*(Utils.isTabletOrMobile(),.25),north__size:"auto",north__resizable:!1,
north__showOverflowOnHover:!0};b.toolbars=g.getToolbars();b.query=new Models.QueryOptions;b.tabId="";b.viewerId=UUID.generate();b.overflowId=UUID.generate();b.viewerConfig=new MedicalViewerConfig;b.viewerConfig.rows=1;b.viewerConfig.columns=1;b.viewerConfig.splitterSize=Utils.get_splitterSize();b.viewerConfig.studyLayout=q.currentStudyLayout;b.viewerapi={};b.viewerConfig.OnApiReady=function(a){e._viewerApi=a;e._toolbarService.enable("DeleteStudyStructuredDisplay"+e._tabService.selectedTab.id,function(){return a.hasLayout})};
b.layoutApi={};b.seriesList=[];b.autoHideEW=!1;this._objectRetrieveService=l;this._scope=b;this._overflowManager=null;var f=b.$watch("tabId",function(a,m){p.set_tabData(b.tabId,TabDataKeys.ViewController,e);p.set_tabData(b.tabId,TabDataKeys.Linked,!0);f();var n=d.subscribe(EventNames.ToolbarCreated,function(a,c){if(c.args==b.tabId){k.get_activeCell();var d=h.get(OptionNames.LinkImages);g.updateClass("LinkImages"+b.tabId,"Linked","UnLinked",function(){return d});n();angular.isDefined(b.layoutApi.refresh)&&
setTimeout(function(){b.layoutApi.openPane("north");b.layoutApi.refresh()},900)}});d.subscribe(EventNames.LoadSeries+b.tabId,function(a,d){a=new MedicalViewerSeries(d.args.series.InstanceUID,d.args.series.Patient.ID);var f=k.currentLoadingSeries.Patient.ID;a.template=d.args.template;a.dislaySetNumber=d.args.displaySetNumber;a.mrtiCell=d.args.series.mrtiCell;if(c)b.seriesList.length=0;else{var g=1,l=d.args.series;d=$.grep(b.seriesList,function(a,b){return l.Patient.ID!=a.patientID});g=angular.isDefined(b.viewerapi.get_cellCount)?
b.viewerapi.get_cellCount():b.viewerConfig.columns*b.viewerConfig.rows;if(0!=d.length||1>=g)b.seriesList.length=0}null!=e._overflowManager&&e._overflowManager.clear();a.link=h.get(OptionNames.LinkImages);b.seriesList.push(a);b.autoHideEW=2>f.length||lt.LTHelper.device==lt.LTDevice.mobile;b.$apply();angular.isDefined(b.layoutApi.closePane)&&b.layoutApi.closePane("south")});d.subscribe(EventNames.LoadStructureDisplay+b.tabId,function(a,c){var d=k.get_seriesTab(c.args.series.InstanceUID);if(null!=d&&
d.id==b.tabId){var e=new MedicalViewerSeries(c.args.series.InstanceUID,c.args.series.Patient.ID);e.loadSeriesLayout=!1;e.sopInstanceUIDS=c.args.series.SopInstanceUIDs;e.template=c.args.template;e.dislaySetNumber=c.args.displaySetNumber;e.mrtiCell=c.args.series.mrtiCell;k.cleanupSeries&&(b.seriesList.length=0,k.cleanupSeries=!1);var f=c.args.series;0!=$.grep(b.seriesList,function(a,b){return f.Patient.ID!=a.patientID}).length&&(b.seriesList.length=0);angular.isDefined(e.dislaySetNumber)?(null!=b.viewerapi&&
null!=b.viewerapi.getMedicalViewer&&(b.viewerapi.getMedicalViewer(),d.itemCount++),b.seriesList.push(e)):l.GetSeriesStacks(c.args.series.InstanceUID).then(function(a){a=a.data;e.link=h.get(OptionNames.LinkImages);1<a.length&&(e.sopInstanceUIDS=a[0].SopInstanceUIDs);d.itemCount+=0!=a.length?a.length:1;null!=b.viewerapi&&b.viewerapi.getMedicalViewer();b.seriesList.push(e);if(1<a.length)for(var f=1;f<a.length;f++){var g=angular.copy(e);null!=c.args&&(g.view=c.args.view);g.id=UUID.genV4().toString();
g.sopInstanceUIDS=a[f].SopInstanceUIDs;b.seriesList.push(g)}}.bind(this))}b.layoutApi&&b.layoutApi.closePane&&b.layoutApi.closePane("east")})});b.setListController=function(a){e._listController=a};b.getListController=function(){return e._listController};d.subscribe(EventNames.InstanceOverflow,function(a,c){a=k.get_seriesTab(c.args.instance.SeriesInstanceUID);null!=a&&a.id==b.tabId&&(b.layoutApi.openPane("south"),null==e._overflowManager&&(e._overflowManager=new OverflowManager("#"+b.overflowId,n.get_newLoader(),
{api:e._scope.layoutApi,direction:"south"})));e._overflowManager&&(b.layoutApi.openPane("south"),e._overflowManager.add(c.args))});d.subscribe(EventNames.InstanceOverflowClear,function(a,c){a=k.get_seriesTab(c.args.seriesInstanceUID);null!=a&&a.id==b.tabId&&null!=e._overflowManager&&e._overflowManager.clear()});d.subscribe(EventNames.InstanceOverflowClose,function(a,c){a=k.get_seriesTab(c.args.seriesInstanceUID);null!=a&&a.id==b.tabId&&b.layoutApi.closePane("south")});b.previousImage=function(){var a=
k.get_activeCell(),b=a.currentOffset;0!=b&&1<=b&&(a.currentOffset=b-1)};b.nextImage=function(){var a=k.get_activeCell(),b=k.get_maxAllowedStackIndex(a),c=a.currentOffset;-1!=c&&c<b&&(a.currentOffset=c+1)};r.bindTo(b).add({combo:["+","down"],description:"Next Image",callback:b.nextImage}).add({combo:["-","up"],description:"Previous Image",callback:b.previousImage})}a.prototype.getListController=function(){return this._listController};a.prototype.getViewer=function(){return this._scope.viewerapi.getMedicalViewer()};
a.prototype.getOverflowManager=function(){return this._overflowManager};a.prototype.showTimeLine=function(){};a.prototype.isTimeLineShowing=function(){return!1};a.prototype.hideTimeLine=function(){};a.prototype.hasLayout=function(){return this._viewerApi.hasLayout};a.prototype.getStudyLayout=function(){return this._viewerApi.studyLayout};a.prototype.clearLayout=function(){this._viewerApi.clearLayout()};a.prototype.setStudyLayout=function(a){this._viewerApi.studyLayout=a};a.$inject="$rootScope $scope eventService toolbarService optionsService seriesManagerService objectRetrieveService dataService tabService dicomLoaderService hotkeys templateService authenticationService".split(" ");
return a}();a.DentalViewerController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g,h,k,l,m,p,n,r,q){this._templatesHasAutoMatch=!1;h.get(OptionNames.DateFormat);h.get(OptionNames.TimeFormat);var c=l.currentLoadingSeries.Patient.ID,e=this;this._options=h;this._objectRetrieveService=n;this._tabService=r;b.setListController(this);b.activeSeriesInstanceUID=l.currentLoadingSeries.InstanceUID;q.hasPermission(PermissionNames.CanViewTemplates)&&p.GetAllTemplates().then(function(a){a&&a.data&&(this._templates=a.data,this.updateTemplatesHaveAutoMatch())}.bind(this));
this._scope=b;this._seriesManagerService=l;this._eventService=g;this._$commangular=m;this._seriesTemplate={};this._authenticationService=q;this._objectRetrieveService=n;a=$("div.seriesList");a[a.length-1].id=c;this.refreshContent(n,l,c);this._dataService=k;g.subscribe(EventNames.ActiveSeriesChanged,function(a,c){a=l.get_seriesTab(c.args.seriesInstanceUID);null!=a&&a.id==b.tabId&&(b.activeSeriesInstanceUID=c.args.series,e._seriesManagerService.currentStructuredDisplay||e.selectSeries(b.activeSeriesInstanceUID))});
g.subscribe(EventNames.DerivedImageCreated,function(a,b){0==$.grep(e._seriesManagerService.currentPatientSeries,function(a){return a.InstanceUID==b.args.series.InstanceUID}).length&&(l.currentPatientSeries[l.currentPatientSeries.length]=b.args.series,l.currentLoadingSeries=b.args.series,e.refreshContent(n,l,c))});g.subscribe(EventNames.SelectedTabChanged,function(a,b){});b.all={checked:!1};b.doCheckAll=function(a){var b=this.getListController();b.Deselect();if(a){var c=b._list.rows.length;for(a=1;a<
c;a+=2)b._list.rows[a].data&&b._list.rows[a].setAttribute("Selected","1")}a=b.getSelectedSeries();b._compareButton.disabled=2>a.length;b.RefreshList()}}a.prototype.ClearList=function(a){var b=this._list;if(b){b.parentElement.id=a;var c=b.rows.length;for(a=1;a<c;a++)b.deleteRow(1)}};a.prototype.refreshContent=function(a,b,d){var c=this;a.GetPatientStructuredDisplay(d).then(function(a){c.ClearList(b.currentLoadingSeries.Patient.ID);a=c.filterBadStructuredDisplay(a.data);b.structuredDisplayList=a;c._sturctureDisplayList=
a;a=$("div.seriesList");a=c.getTableDiv(a,b.currentLoadingSeries.Patient.ID);c._span=a.children[0];c._list=a.children[1];c._list.parentElement.id=d;c.fillTable(b.currentPatientSeries,b.structuredDisplayList);c.prepareButtons();c.registerEvents();c.selectSeries(b.currentLoadingSeries.InstanceUID)})};a.prototype.getTableDiv=function(a,b){var c,d=a.length;for(c=0;c<d;c++)if(a[c].id==b)return a[c]};a.prototype.filterBadStructuredDisplay=function(a){var b,c=a.length,d=[],h=0;for(b=0;b<c;b++)a[b]&&a[b].Boxes&&
0<a[b].Boxes.length&&(d[h]=a[b],h++);return d};a.prototype.prepareButtons=function(){$("div.seriesList");$("span.ag-header-group-text");this._exportButton=this._span.children[1];this._compareButton=this._span.children[2];$(this._exportButton).click(this.onExport.bind(this));$(this._compareButton).click(this.onCompare.bind(this));this.canDoExport()};a.prototype.fillTable=function(a,b){var c,d=1;if(null!=b){var e=b.length;for(c=0;c<e;c++)this.AddRow(this._list,b[c],"images/SD.jpg",b[c].Name,"Structured Display",
d,!0,parseInt(this._options.get(OptionNames.SeriesThumbnailHeight))),d++}e=a.length;for(c=0;c<e;c++)this.AddRow(this._list,a[c],Utils.get_thumbnailUrl(a[c]),a[c].Date,a[c].Description,d,!0,parseInt(this._options.get(OptionNames.SeriesThumbnailHeight))),d++};a.prototype.UpdateSelection=function(a,b){if(this.selectRow(a,b)&&this.IsRowSelected(a)){this._tabService.get_allTabs();b=this._tabService.get_tabData(this._tabService.tabs[0].id,TabDataKeys.searchViewerController);var c=a.data;c.Boxes?(b.loadselectedStructureDisplay(c),
this._eventService.publish(EventNames.StructuredDisplaySelected,{structureDisplay:a.data})):(a={node:{}},a.node.data=c,b._templateService.currentStudyLayout=null,this.seriesSelected(a))}};a.prototype.RecheckAllSubTree=function(a){a=a.nextElementSibling;if(0!=a.children.length&&0!=a.children[0].children.length){a=a.children[0].children[0];var b,c=a.rows.length;for(b=0;b<c;b++)a.rows[b].setAttribute("Selected","1");this.refreshSubtreeSelection(a);this.RefreshList()}};a.prototype.registerEvents=function(){var a,
b=this,d=this._list.rows.length,g,h=this._list.rows[0].children.length,k=-1;for(a=1;a<d;a++)if(b._list.rows[a].data)for(k++,g=0;g<h;g++)this._list.rows[a].children[g].setAttribute("rowPosition",a.toString()),this._list.rows[a].children[g].setAttribute("colPosition",g),this._list.rows[a].children[g].addEventListener("click",function(a){a=a.currentTarget;var c=parseInt(a.getAttribute("colPosition"));b.IsRowSelected(a.parentElement)&&!b.IsMultipleSelection()?b.RecheckAllSubTree(a.parentElement):(b.UpdateSelection(a.parentElement,
c),a=b.getSelectedSeries(),b._compareButton.disabled=2>a.length,b.canDoExport())})};a.prototype.canDoExport=function(){this._exportButton.disabled=!this._authenticationService.hasPermission(PermissionNames.CanStore)};a.prototype.unregisterEvents=function(){var a,b=this._list.rows.length,d,g=this._list.rows[0].children.length;for(a=1;a<b;a++)for(d=0;d<g;d++)this._list.rows[a].children[d].removeAttribute("rowPosition"),this._list.rows[a].children[d].removeAttribute("colPosition")};a.prototype.GetSubtreeTable=
function(a){return a.cells[0].children[0]};a.prototype.Deselect=function(a){var b,c=this._list.rows.length;for(b=1;b<c;b++)if(this._list.rows[b].data)this._list.rows[b].setAttribute("Selected","0");else if(this._list.rows[b]&&a){var d=this.GetSubtreeTable(this._list.rows[b]),h,k=d.rows.length;for(h=0;h<k;h++){var l=d.rows[h];l.setAttribute("Selected","0")}}};a.prototype.IsMultipleSelection=function(){var a,b=this._list.rows.length,d=0;for(a=1;a<b;a++)this._list.rows[a].data&&(d+=parseInt(this._list.rows[a].getAttribute("Selected")));
return 1<d};a.prototype.getDataFromSeries=function(a,b){var c=$.grep(this._seriesManagerService.currentPatientSeries,function(a){return a.InstanceUID==b})[0];this.AddRow(a,c,Utils.get_thumbnailUrl(c),c.Date,c.Description,0,!1,6*parseInt(this._options.get(OptionNames.SeriesThumbnailHeight))>>3).setAttribute("Selected","1")};a.prototype.refreshSubtreeSelection=function(a){var b={},c,d=a.rows.length;if(0!=d){for(c=0;c<d;c++)b[a.rows[c].data.InstanceUID]="1"==a.rows[c].getAttribute("Selected");this._eventService.publish(EventNames.StructuredDisplayUpdated,
{InstanceUIDs:b})}};a.prototype.findSeriesUsedInStructureDisplay=function(a,b){var c=0,d=b.Series.length,e={};for(c=0;c<d;c++)e[b.Series[c].SeriesInstanceUID]=b.Series[c].SeriesInstanceUID;for(var k in e)e.hasOwnProperty(k)&&this.getDataFromSeries(a,k);var l=this;b=c=0;for(k in e)if(e.hasOwnProperty(k)){for(b=0;4>b;b++)a.rows[c].children[b].setAttribute("colPosition",b),a.rows[c].children[b].addEventListener("click",function(b){var c=b.currentTarget;b=c.parentElement;var d=a.parent;c=parseInt(c.getAttribute("colPosition"));
l.UpdateSelection(d,1);l.selectSubRow(b,c);l.refreshSubtreeSelection(b.parentElement)});c++}};a.prototype.IsRowSelected=function(a){return"1"==a.getAttribute("Selected")};a.prototype.DeselectSubRows=function(a){if(a&&a.rows){var b,c=a.rows.length;for(b=0;b<c;b++)a.rows[b].setAttribute("Selected","0")}};a.prototype.UpdateParentCheckBox=function(a){var b=a.parentRow;b&&(b=b.cells[0].children[0])&&(this.isAllSelected(a)?(b.indeterminate=!1,b.checked=!0):b.indeterminate=!0)};a.prototype.isAllSelected=
function(a){if(!a||!a.rows)return!1;var b,c=a.rows.length;for(b=0;b<c;b++)if("0"==a.rows[b].getAttribute("Selected"))return!1;return!0};a.prototype.selectSubRow=function(a,b){try{0==b?a.setAttribute("Selected",this.IsRowSelected(a)?"0":"1"):(this.DeselectSubRows(a.parentElement),a.setAttribute("Selected","1")),this.RefreshList(),this.UpdateParentCheckBox(a.parentElement)}catch(f){console.log(f)}};a.prototype.selectRow=function(a,b){0!=b&&this.Deselect();var c=this._selectedRow!=a;0==b?a.setAttribute("Selected",
this.IsRowSelected(a)?"0":"1"):a.setAttribute("Selected","1");if(this.IsRowSelected(a)&&c){var d="1"==a.getAttribute("Selected");this._selectedRow=a;d&&(a.data.Boxes?(this._seriesManagerService.currentStructuredDisplay=a.data,d=a.nextElementSibling,d.style.height="100px",""==d.children[0].children[0].innerHTML&&(d.cells[0].children[0].parentRow=a,this.findSeriesUsedInStructureDisplay(d.cells[0].children[0],a.data))):this._seriesManagerService.currentStructuredDisplay=null)}this.RefreshList()||this.selectRow(this._selectedRow?
this._selectedRow:this._list.rows[1],b);return c};a.prototype.RefreshRow=function(a){var b="1"==a.getAttribute("Selected");b?(a.style.background="rgba(128, 128, 128, 0.5)",a=a.children[0].children[0],a.checked=!0):(a.style.background="rgba(0, 0, 0, 0)",a=a.children[0].children[0],a.checked=!1);a.indeterminate=!1;return b};a.prototype.isSubTreeSelected=function(a){var b,c=a.rows.length,d=!1;for(b=0;b<c;b++)this.RefreshRow(a.rows[b])&&(d=!0);return d};a.prototype.RefreshList=function(){var a,b=this._list.rows.length,
d=!1,g=!1;for(a=1;a<b;a++){if(this._list.rows[a].data)d=this.RefreshRow(this._list.rows[a]);else{var h=this._list.rows[a].cells[0].children[0];this.isSubTreeSelected(h);d||(this._list.rows[a].style.height="0px",h.innerHTML="")}d&&(g=!0)}return g};a.prototype.AddRow=function(a,b,d,g,h,k,l,m){if(null!=a){var c=document.createElement("TR");c.setAttribute("Selected","0");c.style.height=m+"px";c.id="row"+k;l||(c.style.fontSize="10px");a.appendChild(c);c.data=b;b=document.createElement("TD");var e=document.createElement("input");
e.type="checkbox";b.appendChild(e);b.style.width="5%";c.appendChild(b);b=document.createElement("TD");e=document.createElement("img");e.style.height=m+"px";e.style.width=m+"px";b.appendChild(e);e.src=d;c.appendChild(b);b=document.createElement("TD");d=document.createTextNode(g?g:"N/A");b.style.width="20%";b.style.textAlign="center";b.style.cursor="default";b.appendChild(d);c.appendChild(b);b=document.createElement("TD");h=document.createTextNode(h?h:"N/A");b.style.width="100%";b.style.textAlign="center";
b.style.cursor="default";b.appendChild(h);c.appendChild(b);l&&(l=document.createElement("TR"),l.style.height="0px",l.style.columnSpan="3",b=document.createElement("TD"),b.colSpan=4,l.appendChild(b),h=document.createElement("TABLE"),h.style.left="10%",h.border="1px",h.style.position="relative",h.cellPadding="4px",h.id="subTree"+k,h.parent=c,a.appendChild(l),b.appendChild(h));return c}return null};a.prototype.updateTemplatesHaveAutoMatch=function(){if(this._templates)for(var a=0;a<this._templates.length;a++)if(this._templates[a].AutoMatching){this._templatesHasAutoMatch=
!0;return}this._templatesHasAutoMatch=!1};a.prototype.isAnyTemplateAutoMatch=function(){return this._templatesHasAutoMatch};a.prototype.getAutoMatchTemplates=function(){return Utils.findAll(this._templates,function(a){return a.AutoMatching})};a.prototype.checkBoxRenderer=function(){return'<input type="checkbox" ng-model="all.checked" ng-change="doCheckAll(all.checked)" >'};a.prototype.loadSeriesList=function(a,b,d){this.selectSeries(b,d)};a.prototype.selectSeries=function(a,b){this._currentSelectedSeries=
a;this._currentSelectedSeries&&""!=this._currentSelectedSeries||(this._currentSelectedSeries=this._seriesManagerService.get_allSeries()[0]);if(this._list)for(b=this._list.rows.length,a=0;a<b;a++){var c=this._list.rows[a];if(c.data)if(c.data.Boxes){if(this._seriesManagerService.currentStructuredDisplay&&this._seriesManagerService.currentStructuredDisplay.Name==this._list.rows[a].data.Name){if(this.IsRowSelected(c))break;this.selectRow(c,1);break}}else if(c.data&&c.data.InstanceUID==this._currentSelectedSeries){if(this.IsRowSelected(c))break;
this.selectRow(c,1);break}}};a.prototype.matchTemplateForSeries=function(a,b,d){var c=a.node.data.StudyInstanceUID;a=a.node.data.InstanceUID;c&&a?(c=this._objectRetrieveService.GetDicomJSON(c,a,""),c.success(function(a){var c=null;this.getAutoMatchTemplates().some(function(b){try{if(!c&&Utils.executeScript(b.AutoMatching,a))return console.log("template auto-match found"),c=b,!0}catch(m){console.log(m)}return!1});this._eventService.publish(EventNames.SeriesSelected,{study:b,series:d,fromList:!0,template:c})}.bind(this)),
c.error(function(a){console.log(a);this._eventService.publish(EventNames.SeriesSelected,{study:b,series:d,fromList:!0,template:void 0})})):(console.log("failed to read study/series id"),this._eventService.publish(EventNames.SeriesSelected,{study:b,series:d,fromList:!0,template:void 0}))};a.prototype.seriesSelected=function(a){var b=this._seriesManagerService.get_activeCell(),c=null==b?"":b.get_seriesInstanceUID();if(b&&b.templateId&&0<c.length){var d=Utils.findFirst(this._templates,function(a){return a.Id==
b.templateId});d?this._seriesTemplate[c]=d:delete this._seriesTemplate[c]}if(c=a.node.data){var h={InstanceUID:c.StudyInstanceUID,Patient:c.Patient};d=void 0;this._scope.activeSeriesInstanceUID=a.node.data.InstanceUID;this._seriesTemplate[c.InstanceUID]&&(d=this._seriesTemplate[c.InstanceUID]);!d&&b&&this.isAnyTemplateAutoMatch()?this.matchTemplateForSeries(a,h,c):this._eventService.publish(EventNames.SeriesSelected,{study:h,series:c,fromList:!0,template:d,resetLayout:!0})}};a.prototype.onExport=
function(){this._$commangular.dispatch("OnSecondaryCapture")};a.prototype.getSelectedSeries=function(){var a,b=this._list.rows.length,d=[];for(a=1;a<b;a++)"1"==this._list.rows[a].getAttribute("Selected")&&this._list.rows[a].data&&(this._list.rows[a].data.Boxes||d.push(this._list.rows[a].data));return d};a.prototype.onCompare=function(){var a=this.getSelectedSeries();2>a.length?alert("structure display comparison is not avaiable yet"):this._$commangular.dispatch("Compare",{series:a})};a.$inject="$rootScope $scope uiGridConstants eventService optionsService dataService seriesManagerService $commangular templateService objectRetrieveService tabService authenticationService".split(" ");
return a}();a.SeriesListController=b})(Controllers||(Controllers={}));
(function(a){var b=function(){function a(a,b,d,g,h,k,l,m,p,n,r,q,t,y,w,x,u){g=Utils.get_spacingSize();var c=k.get(OptionNames.SingleSeriesMode),e=k.get(OptionNames.DefaultSeriesRowCount),f=k.get(OptionNames.DefaultSeriesColumnCount),D=3*k.get(OptionNames.SeriesThumbnailWidth),z=this;this._scope=a;this._seriesManagerService=m;this._dataService=l;this._tabService=h;this._timeoutService=q;this._eventService=b;this._auditLogService=y;this._objectRetrieveService=w;this._toolbarService=d;a.query=new Models.QueryOptions;
a.retrieveUrl=n.urls.serviceUrl+n.urls.objectRetrieveLocalServiceName;a.timelineApi={};150<D&&(D=150);a.layoutConfig={applyDemoStyles:!0,scrollToBookmarkOnLoad:!1,spacing_closed:g,spacing_open:g,livePaneResizing:!1,north__size:lt.LTHelper.device==lt.LTDevice.mobile?"25":"auto",north__resizable:!1,north__initHidden:!1,north__showOverflowOnHover:!0,south__resizable:!1,south__initHidden:!1,south__size:100,south__resizerToggle:!1,south__spacing_closed:0,south__spacing_open:0,east__initHidden:!0,east__size:D,
east__maxSize:D,east__minSize:D,east__resizable:!1,onopen:this.onOpenPane.bind(this)};a.toolbars=d.getToolbars();a.tabId="";a.viewerId=UUID.generate();a.postion=15;a.numberOfFrames=0;a.currentPosition=0;a.hideTimeline=!0;a.overflowId=UUID.generate();a.viewerConfig=new MedicalViewerConfig;a.viewerConfig.rows=c?1:e;a.viewerConfig.columns=c?1:f;a.viewerConfig.splitterSize=Utils.get_splitterSize();a.viewerConfig.OnApiReady=function(a){z._viewerApi=a;z._toolbarService.enable("DeleteStudyStructuredDisplay"+
z._tabService.selectedTab.id,function(){return a.hasLayout})};a.viewerConfig.OnSelectionChanged=this.selectionChanged.bind(this);a.viewerConfig.studyLayout=u.currentStudyLayout;a.viewerConfig.hangingProtocol=u.currentHangingProtocol;u.currentHangingProtocol=null;a.viewerConfig.customLayout=k.get(OptionNames.CustomStudyLayout);a.viewerapi={};a.layoutApi={};a.seriesList=[];var E=a.$watch("tabId",function(e,f){function g(a,b){if(null!=a&&a.gridLayout.rows*a.gridLayout.columns<b){var c=Math.sqrt(b);a.cellsArrangement==
lt.Controls.Medical.CellsArrangement.grid&&(a.layout.beginUpdate(),a.gridLayout.rows=Math.floor(c+.1),a.gridLayout.columns=Math.ceil(b/a.gridLayout.rows),a.layout.endUpdate())}}h.set_tabData(a.tabId,TabDataKeys.ViewController,z);h.set_tabData(a.tabId,TabDataKeys.Linked,!0);E();var l=b.subscribe(EventNames.ToolbarCreated,function(b,c){var e=k.get(OptionNames.LinkImages);d.updateClass("LinkImages"+a.tabId,"Linked","UnLinked",function(){return e});l();angular.isDefined(a.layoutApi.refresh)&&setTimeout(function(){a.layoutApi.openPane("north");
a.layoutApi.refresh()},900)});b.subscribe(EventNames.LoadSeries+a.tabId,function(b,d){var e=m.get_seriesTab(d.args.series.InstanceUID);if(null!=e&&e.id==a.tabId){var f=new MedicalViewerSeries(d.args.series.InstanceUID,d.args.series.Patient.ID);f.sopInstanceUIDS=d.args.series.SopInstanceUIDs;f.template=d.args.template;f.dislaySetNumber=d.args.displaySetNumber;null!=d.args&&(f.view=d.args.view);f.mrtiCell=d.args.series.mrtiCell;null!=z._overflowManager&&z._overflowManager.clear();if(c)a.seriesList.length=
0;else{var h=d.args.series;0!=$.grep(a.seriesList,function(a,b){return h.Patient.ID!=a.patientID}).length&&(a.seriesList.length=0)}angular.isDefined(f.dislaySetNumber)?(null!=a.viewerapi&&null!=a.viewerapi.getMedicalViewer&&(b=a.viewerapi.getMedicalViewer(),e.itemCount++,g(b,e.itemCount)),a.seriesList.push(f)):w.GetSeriesStacks(d.args.series.InstanceUID).then(function(b){b=b.data;f.link=k.get(OptionNames.LinkImages);1<b.length&&(f.sopInstanceUIDS=b[0].SopInstanceUIDs);e.itemCount+=0!=b.length?b.length:
1;var h=e.itemCount;h||(h=0);if(null!=a.viewerapi){var l=a.viewerapi.getMedicalViewer();g(l,h)}a.seriesList.push(f);if(1<b.length&&!c)for(h=1;h<b.length;h++)l=angular.copy(f),null!=d.args&&(l.view=d.args.view),l.id=UUID.genV4().toString(),l.sopInstanceUIDS=b[h].SopInstanceUIDs,a.seriesList.push(l)}.bind(this))}a.layoutApi&&a.layoutApi.closePane&&a.layoutApi.closePane("east")})});a.replaceCell=$.proxy(this.replaceCell,this);a.appendCell=$.proxy(this.appendCell,this);a.seriesDropped=$.proxy(this.seriesDropped,
this);b.subscribe(EventNames.LoadingSeriesFrames,function(b,c){b=m.get_seriesTab(c.args.seriesInstanceUID);null!=b&&b.id==a.tabId&&(z.initializeSlider(a,m,c.args.seriesInstanceUID,c.args.id),z.refreshTimeline(c.args.seriesInstanceUID))});b.subscribe(EventNames.ActiveSeriesChanged,function(b,c){b=m.get_seriesTab(c.args.seriesInstanceUID);var d=m.get_seriesOverflow(c.args.seriesInstanceUID);m.get_seriesCellById(c.args.id);null!=b&&b.id==a.tabId&&(z.initializeSlider(a,m,c.args.seriesInstanceUID,c.args.id),
z.refreshTimeline(c.args.seriesInstanceUID));z._overflowManager&&(z._overflowManager.clear(),0<d.length&&null!=z._overflowManager&&z._overflowManager.addInstances(d))});b.subscribe(EventNames.OpenStudyTimeLine,function(b,c){b=k.get(OptionNames.ShowStudyTimeLine);c.args.show||b?(z.showTimeLine(),setTimeout(function(){a.layoutApi.openPane("north");a.layoutApi.refresh()},900)):setTimeout(function(){a.layoutApi.closePane("south");a.layoutApi.refresh()},900)});b.subscribe(EventNames.InstanceOverflow,function(b,
c){b=m.get_seriesTab(c.args.instance.SeriesInstanceUID);null!=b&&b.id==a.tabId&&(a.layoutApi.openPane("east"),null==z._overflowManager&&(z._overflowManager=new OverflowManager("#"+a.overflowId,x.get_newLoader(),{api:z._scope.layoutApi,direction:"east"},!1)),angular.isDefined(c.args.clear)&&c.args.clear&&z._overflowManager.clear(),z._overflowManager.add(c.args),z._seriesManagerService.add_seriesOverflow(c.args))});b.subscribe(EventNames.InstanceOverflowClear,function(b,c){b=m.get_seriesTab(c.args.seriesInstanceUID);
null!=b&&b.id==a.tabId&&null!=z._overflowManager&&z._overflowManager.clear()});b.subscribe(EventNames.InstanceOverflowClose,function(b,c){b=m.get_seriesTab(c.args.seriesInstanceUID);null!=b&&b.id==a.tabId&&a.layoutApi.closePane("east")});a.positionChanged=function(a){m.get_activeCell().currentOffset=a};a.previousImage=function(){var b=m.get_activeCell(),c=b.currentOffset;0!=c&&1<=c&&(b.currentOffset=c-1,a.currentPosition=c-1)};a.nextImage=function(){var b=m.get_activeCell(),c=m.get_maxAllowedStackIndex(b),
d=b.currentOffset;-1!=d&&d+1<c&&(b.currentOffset=d+1,a.currentPosition=d+2)};a.ondelete=function(){t.dispatch("DeleteCell")};a.stackChanged=function(b,c){if(b=m.get_activeCell()){var d=b.currentOffset;p(a,function(){a.currentPosition=d+1})}};r.bindTo(a).add({combo:["+","down"],description:"Next Image",callback:a.nextImage}).add({combo:["-","up"],description:"Previous Image",callback:a.previousImage}).add({combo:"left",description:"Align Left",callback:function(){m.get_activeCell()}}).add({combo:"right",
description:"Align Right",callback:function(){m.get_activeCell()}}).add({combo:"top",description:"Align Top",callback:function(){m.get_activeCell()}}).add({combo:"bottom",description:"Align Bottom",callback:function(){m.get_activeCell()}})}Object.defineProperty(a.prototype,"isComposing",{get:function(){return this._isComposing},set:function(a){this._isComposing=a},enumerable:!0,configurable:!0});a.prototype.selectionChanged=function(a){if(this.isComposing){var b=this;this._toolbarService.enable("MergeCells"+
this._scope.tabId,function(){return b._viewerApi.canMerge&&1<a})}};a.prototype.refreshTimeline=function(a){if(this._scope.timelineApi.refresh){var b=this._seriesManagerService.get_seriesInfo(a),c=this._scope.layoutApi.get_state("south");null==b&&(b=this._dataService.get_Series(a));c.isVisible&&this._scope.timelineApi.refresh(b.Patient.ID,b.StudyInstanceUID,a)}};a.prototype.getViewer=function(){return this._scope.viewerapi.getMedicalViewer?this._scope.viewerapi.getMedicalViewer():null};a.prototype.getOverflowManager=
function(){return this._overflowManager};a.prototype.refreshLayout=function(){this._scope.layoutApi.refresh()};a.prototype.initializeSlider=function(a,b,d,g){(d=b.get_seriesTab(d))&&d.id==a.tabId&&(g=b.get_seriesCellById(g))&&(a.numberOfFrames=b.get_maxAllowedStackIndex(g))};a.prototype.toggleView=function(a,b,d){switch(a){case "south":if((a=this._seriesManagerService.activeSeriesInstanceUID)&&0<a.length){var c=this._seriesManagerService.get_seriesInfo(a);if(null!=c){var e=this;this._timeoutService(function(){e._scope.hideTimeline=
b?!e._scope.hideTimeline:!d;e._scope.$apply();e._scope.timelineApi.toggle(c.StudyInstanceUID,c.Patient.ID,e._scope.hideTimeline)})}}}};a.prototype.showTimeLine=function(){this._scope.hideTimeline&&this.toggleView("south",!1,!0)};a.prototype.isTimeLineShowing=function(){return!this._scope.hideTimeline};a.prototype.hideTimeLine=function(){if(!this._scope.hideTimeline){var a=this._seriesManagerService.get_seriesInfo(this._seriesManagerService.activeSeriesInstanceUID),b=this;this._timeoutService(function(){b._scope.hideTimeline=
!b._scope.hideTimeline;b._scope.$apply();b._scope.timelineApi.toggle(a.StudyInstanceUID,a.Patient.ID,b._scope.hideTimeline)})}};a.prototype.mergeSelectedCells=function(){this.isComposing&&this._viewerApi.mergeSelectedCells()};a.prototype.hasLayout=function(){return this._viewerApi.hasLayout};a.prototype.getStudyLayout=function(){return this._viewerApi.studyLayout};a.prototype.clearLayout=function(){this._viewerApi.clearLayout()};a.prototype.setStudyLayout=function(a){this._viewerApi.studyLayout=a};
a.prototype.replaceCell=function(a){var b=this.getViewer(),c=b.layout.get_selectedItem(),d=null;var h=this._dataService.get_Series(a);var k=new MedicalViewerSeries(a,h.Patient.ID),l=this._tabService.find_tab(this._scope.tabId);b.exploded&&b.explode(b.explodedCell,!1);if(null!=c){if(a==c.get_seriesInstanceUID())return;var m=c.get_position();var p=c.get_rowPosition();var n=c.get_columnsPosition();d=c.get_bounds()}h=b.get_emptyDivs().get_selectedItem();null!=h&&(m=h.get_position(),p=h.get_rowPosition(),
n=h.get_columnsPosition(),d=h.get_bounds());b=b.get_emptyDivs().get_items();var r=b.get_count();for(var q=0;q<r;q++)if(h=b.get_item(q),document.getElementById(h.get_divID())==this){m=h.get_position();p=h.get_rowPosition();n=h.get_columnsPosition();d=h.get_bounds();h.dispose();break}null!=d&&(this._seriesManagerService.set_seriesTab(a,l),this._objectRetrieveService.GetSeriesStacks(k.seriesInstanceUID).then(function(a){a=a.data;var b=this._seriesManagerService.get_activeCellFrame();1<a.length&&(k.sopInstanceUIDS=
a[0].SopInstanceUIDs);this._scope.viewerapi.replaceSeries(c.get_seriesInstanceUID(),b.Instance.SOPInstanceUID,k,m,p,n,d);if(1<a.length){for(b=1;b<a.length;b++){var e=angular.copy(k);e.id=UUID.genV4().toString();e.sopInstanceUIDS=a[b].SopInstanceUIDs;this._scope.seriesList.push(e)}k.sopInstanceUIDS=a[0].SopInstanceUIDs}}.bind(this)))};a.prototype.appendCell=function(a){var b=this,c=this._dataService.get_Series(a),d=new MedicalViewerSeries(a,c.Patient.ID),h=this._tabService.find_tab(this._scope.tabId),
k=this._eventService.subscribe(EventNames.NewCellsAdded,function(d,e){e.args.cells&&1==e.args.cells.length&&e.args.cells[0].get_seriesInstanceUID()==a&&b._seriesManagerService.set_seriesInfo(a,c);k()});this._seriesManagerService.set_seriesTab(a,h);this._objectRetrieveService.GetSeriesStacks(d.seriesInstanceUID).then(function(a){a=a.data;1<a.length&&(d.sopInstanceUIDS=a[0].SopInstanceUIDs);this._scope.seriesList.push(d);if(1<a.length){for(var b=1;b<a.length;b++){var c=angular.copy(d);c.id=UUID.genV4().toString();
c.sopInstanceUIDS=a[b].SopInstanceUIDs;this._scope.seriesList.push(c)}d.sopInstanceUIDS=a[0].SopInstanceUIDs}}.bind(this))};a.prototype.seriesDropped=function(a,b,d,g,h,k,l){a=this._dataService.get_Series(d);var c=new MedicalViewerSeries(d,a.Patient.ID),e=this._tabService.find_tab(this._scope.tabId);this._auditLogService.log_showSeries(a);this._seriesManagerService.set_seriesTab(d,e);this._seriesManagerService.set_seriesInfo(d,a);this._objectRetrieveService.GetSeriesStacks(c.seriesInstanceUID).then(function(a){a=
a.data;1<a.length&&(c.sopInstanceUIDS=a[0].SopInstanceUIDs);this._scope.viewerapi.replaceSeries(b,"",c,g,h,k,l);if(1<a.length){for(var d=1;d<a.length;d++){var e=angular.copy(c);e.id=UUID.genV4().toString();e.sopInstanceUIDS=a[d].SopInstanceUIDs;this._scope.seriesList.push(e)}c.sopInstanceUIDS=a[0].SopInstanceUIDs}}.bind(this))};a.prototype.onOpenPane=function(a,b,d){};a.$inject="$scope eventService toolbarService $modal tabService optionsService dataService seriesManagerService safeApply app.config hotkeys $timeout $commangular auditLogService objectRetrieveService dicomLoaderService templateService".split(" ");
return a}();a.ViewerController=b})(Controllers||(Controllers={}));
var PropertyGridItem=function(){return function(){this.isSubGroup=this.dropFields=this.cssName=this.rowType=this.groupName="";this.value=null;this.propertyName="";this.enabled=!0}}(),Group=function(){function a(a,d,c){this._Items=[];this._SubGroups=[];this._groupName=a;this._outputDiv=c?"pg1_subgroup_"+d:"pg1_group_"+d}Object.defineProperty(a.prototype,"GroupName",{get:function(){return this._groupName},set:function(a){this._groupName=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"OutputDiv",{get:function(){return this._outputDiv},set:function(a){this._outputDiv=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"SubGroup",{get:function(){return this._subGroup},set:function(a){this._subGroup=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"Items",{get:function(){return this._Items},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"SubGroups",{get:function(){return this._SubGroups},enumerable:!0,configurable:!0});return a}(),
ClassItem=function(){function a(a,d,c,e,f,g,h,k){this._cssId=a;this._outputDiv="pg1_item_"+e;this._Type=d;this._DropFields=c;this._value=f;this.PropertyName=g;this.Enabled=k;h[h.length]=[a,this._outputDiv,d]}Object.defineProperty(a.prototype,"CssId",{get:function(){return this._cssId},set:function(a){this._cssId=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"OutputDiv",{get:function(){return this._outputDiv},set:function(a){this._outputDiv=a},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"Type",{get:function(){return this._Type},set:function(a){this._Type=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"Value",{get:function(){return this._value},set:function(a){this._value=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"DropFields",{get:function(){return this._DropFields},set:function(a){this._DropFields=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"PropertyName",{get:function(){return this._propertyName},
set:function(a){this._propertyName=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"Enabled",{get:function(){return this._enabled},set:function(a){this._enabled=a},enumerable:!0,configurable:!0});return a}(),PropertyGrid=function(){function a(a,d){this._Properties=[];this._PropertiesLookup=[];this.cssItem=this.subGroupCount=this.groupCount=0;this._OutputDivId=a;this._DefaultSizeType=d}Object.defineProperty(a.prototype,"GroupCount",{get:function(){return this._Properties.length},
enumerable:!0,configurable:!0});a.prototype.addProperty=function(a,d,c,e,f,g,h,k,l){var b=!1;for(l=0;l<this._Properties.length;l++)if(this._Properties[l].GroupName==a){if(f){b=!1;for(var p=0;p<this._Properties[l].SubGroups.length;p++)this._Properties[l].SubGroups[p].GroupName==f&&(b=!0,this._Properties[l].SubGroups[p].Items[this._Properties[l].SubGroups[p].Items.length]=new ClassItem(c,d,e,this.cssItem,g,h,this._PropertiesLookup,k),this.cssItem++);b||(this._Properties[l].SubGroups[this._Properties[l].SubGroups.length]=
new Group(f,this.subGroupCount,!0),this._Properties[l].SubGroups[this._Properties[l].SubGroups.length-1].Items[this._Properties[l].SubGroups[this._Properties[l].SubGroups.length-1].Items.length]=new ClassItem(c,d,e,this.cssItem,g,h,this._PropertiesLookup,k),this.cssItem++,this.subGroupCount++)}else this._Properties[l].Items[this._Properties[l].Items.length]=new ClassItem(c,d,e,this.cssItem,g,h,this._PropertiesLookup,k),this.cssItem++;b=!0}b||(this._Properties[this._Properties.length]=new Group(a,
this.groupCount,!1),this._Properties[this._Properties.length-1].Items[this._Properties[this._Properties.length-1].Items.length]=new ClassItem(c,d,e,this.cssItem,g,h,this._PropertiesLookup,k),this.groupCount++,this.cssItem++)};a.prototype.updateStyle=function(a,d){a=a.replace(/^\s*|\s*$/g,"");a=a.toLowerCase();for(var b,e=0;e<this._PropertiesLookup.length;e++)if(this._PropertiesLookup[e][0]==a){b=this._PropertiesLookup[e][1];document.getElementById(b).value=d;if("color"==this._PropertiesLookup[e][2]&&
null!=document.getElementById("color"+this._PropertiesLookup[e][1]))try{document.getElementById("color"+this._PropertiesLookup[e][1]).style.backgroundColor=d}catch(g){}var f=document.getElementById(b).parentNode.parentNode.parentNode;-1!=f.id.indexOf("subgroup")?(f.style.display="block",b=document.getElementById(b).parentNode.parentNode.parentNode.id,b=b.replace("child",""),f.style.display="block",f=f.id,f=f.replace("child",""),$("#image"+b).removeClass("bkExpand").addClass("bkMinimise"),$("#image"+
f).removeClass("bkExpand"),$("#image"+f).removeClass("bkExpandSub").addClass("bkMinimiseSub")):(b=f.id,b=b.replace("child",""),f.style.display="block",$("#image"+b).removeClass("bkExpand").addClass("bkMinimise"))}};a.prototype.selectStyle=function(a){for(var b=0;b<this._PropertiesLookup.length;b++)if(this._PropertiesLookup[b][0]==a)return document.getElementById(this._PropertiesLookup[b][1]).value;return null};a.prototype.clearGrid=function(){$("#propertyGridContainer").remove();this._Properties.length=
0};a.prototype.renderGrid=function(){var a='<div id="propertyGridContainer">',d=this;try{for(var c=0;c<this._Properties.length;c++){var e=this._Properties[c];a+='<div id="'+e.OutputDiv+'" class="pgGroup"><div id="image'+e.OutputDiv+'" class="pgGroupShrink ">&nbsp;</div><div class="pgGroupText">'+e.GroupName+"</div></div>";a+='<div id="child'+e.OutputDiv+'">';for(var f=0;f<e.Items.length;f++)a+=d.RenderGridInput(e.Items[f].Type,e.Items[f].OutputDiv,e.Items[f].CssId,e.Items[f].DropFields,e.Items[f].Value,
e.Items[f].PropertyName,e.Items[f].Enabled,e.Items[f].Enabled);if(0<e.SubGroups.length)for(f=0;f<e.SubGroups.length;f++){a+='<div id="'+e.SubGroups[f].OutputDiv+'" class="pgSubGroup"><div id="image'+e.SubGroups[f].OutputDiv+'" class="pgSubGroupShrink ">&nbsp;</div><div class="pgSubGroupText">'+e.SubGroups[f].GroupName+"</div></div>";a+='<div id="child'+e.SubGroups[f].OutputDiv+'">';for(var g=0;g<e.SubGroups[f].Items.length;g++)a+=d.RenderGridInput(e.SubGroups[g].Items[g].Type,e.SubGroups[f].Items[g].OutputDiv,
e.SubGroups[f].Items[g].CssId,e.SubGroups[f].Items[g].DropFields,e.Value,e.PropertyName);a+="</div>"}a+="</div>"}}catch(h){alert(h)}document.getElementById(this._OutputDivId).innerHTML=a+"</div>";d=this;$("input[id^=pg1_]").change(function(a){var b=$(a.currentTarget).data("propname");d.PropertyChanged&&d.PropertyChanged(b,$(a.currentTarget).val())});$("button[id^=pg1_]").click(function(a){var b=$(a.currentTarget).data("propname");d.PropertyClicked&&d.PropertyClicked(b,$(a.currentTarget).val())});
$(".pgInputColor").colorpicker({format:"hex",horizontal:!0});$(".pgInputColor").colorpicker().on("changeColor",function(a){var b=$(a.currentTarget).attr("id");b=$("#color"+b);var c=b.data("propname");a=a.color.toHex();b.css("background-color",a);d.PropertyChanged&&d.PropertyChanged(c,a)});$("select[id^=pg1_]").change(function(a){var b=$(a.currentTarget).data("propname");d.PropertyChanged&&d.PropertyChanged(b,$(a.currentTarget).val())});$("input[class*='pgInputNum']").keydown(function(a){var b=a.which||
a.keyCode;return!a.shiftKey&&!a.altKey&&!a.ctrlKey&&48<=b&&57>=b||96<=b&&105>=b||190==b||188==b||109==b||110==b||8==b||9==b||13==b||35==b||36==b||37==b||39==b||46==b||45==b?!0:!1})};a.prototype.splitCamelCaseToString=function(a){return a.split(/(?=[A-Z])/).join(" ")};a.prototype.RenderGridInput=function(a,d,c,e,f,g,h,k){c=this.splitCamelCaseToString(g);switch(a){case "input":return'<div id="hold'+d+'" class="pgGroupItem"><div class="pgGroupItemText">'+c+'</div><div class="pgInputHolder"><input id="'+
d+'" class="pgInput" data-propname=\''+g+"' value='"+f+"'"+this.getDisabled(h)+'"></input></div></div>';case "color":return'<div id="hold'+d+'" class="pgGroupItem"><div class="pgGroupItemText">'+c+'</div><div class="pgInputHolder"><input id="'+d+'" class="pgInputColor"\' value=\''+f+"'></input><span data-propname='"+g+"' id=\"color"+d+'" class="pgBtnColor" style=\'background-color:'+f+"'><i></i></span></div></div>";case "dialog":return'<div id="hold'+d+'" class="pgGroupItem"><div class="pgGroupItemText">'+
c+'</div><div class="pgInputHolder"><input id="'+d+'" class="pgInputDialog" data-propname=\''+g+"' value='"+f+"'"+this.getDisabled(!1)+'"></input><button id="'+d+"\" data-propname='"+g+'\' class="pgDialog">&hellip;</button></div></div></div>';case "num":return'<div id="hold'+d+'" class="pgGroupItem"><div class="pgGroupItemText">'+c+'</div><div class="pgInputHolder"><input data-propname=\''+g+this.getDisabled(h)+"' id=\""+d+'" class="pgInputNum"'+this.getDisabled(h)+" value='"+f+"'\" type='number'></input></div></div>";
case "drop":return'<div id="hold'+d+'" class="pgGroupItem"><div class="pgGroupItemText">'+c+'</div><div class="pgInputHolder"><select id="'+d+'" class="pgInputDrop"><option value=\'none\''+this.getDisabled(h)+">none</option><option value='solid'>solid</option><option value='ridge'>ridge</option><option value='dashed'>dashed</option><option value='dotted'>dotted</option><option value='double'>double</option><option value='groove'>groove</option><option value='inset'>inset</option></select></div></div>";
case "cdrop":a='<div id="hold'+d+'" class="pgGroupItem"><div class="pgGroupItemText">'+c+'</div><div class="pgInputHolder"><select id="'+d+'" class="pgInputDrop" data-propname=\''+g+"'"+this.getDisabled(h)+">";e=e.split("|");for(d=0;d<e.length;d++)a=angular.isDefined(f)&&e[d].toString()===f.toString()?a+('<option value="'+e[d]+'" selected>'+e[d]+"</option>"):a+('<option value="'+e[d]+'">'+e[d]+"</option>");return a+"</select></div></div>";default:return'<div id="hold'+d+'" class="pgGroupItem"><div class="pgGroupItemText">'+
c+'</div><div class="pgInputHolder"><input id="'+d+'" class="pgInput"'+this.getDisabled(h)+"></input></div></div>"}};a.prototype.getDisabled=function(a){return a?"":" disabled "};a.prototype.clearValues=function(){for(var a=0;a<this._PropertiesLookup.length;a++)document.getElementById(this._PropertiesLookup[a][1]).Value=""};a.prototype.emptyGrid=function(){this._Properties=[];this._PropertiesLookup=[];this.cssItem=this.subGroupCount=this.groupCount=0};a.prototype.hideItems=function(){$("div[id*=childpg1_group_]").css("display",
"none");$("div[id*=childpg1_subgroup_]").css("display","none");$("div[id*=imagepg1_group_]").removeClass("bkMinimise").addClass("bkExpand");$("div[id*=imagepg1_subgroup_]").removeClass("bkMinimiseSub").addClass("bkExpandSub")};a.prototype.expand=function(a,d){""==document.getElementById("child"+a).style.display||"block"==document.getElementById("child"+a).style.display?(document.getElementById("child"+a).style.display="none","true"==d?$("#image"+a).removeClass("bkMinimiseSub").addClass("bkExpandSub"):
$("#image"+a).removeClass("bkMinimise").addClass("bkExpand")):(document.getElementById("child"+a).style.display="block","true"==d?$("#image"+a).removeClass("bkExpandSub").addClass("bkMinimiseSub"):$("#image"+a).removeClass("bkExpand").addClass("bkMinimise"))};a.prototype.AttachColorPicker=function(a,d){var b=$("#color"+d),e=this;b.colorpicker({onSubmit:function(b,c,d,k){b=$(k);b.css("backgroundColor","#"+c);b.ColorPickerHide();e.PropertyChanged&&e.PropertyChanged(a,"#"+c)},onChange:function(a,c,e){b.css("backgroundColor",
"#"+c);$("input[id='"+d+"']").val("#"+c)},onBeforeShow:function(){$("input[id='"+d+"']").val();$(this).ColorPickerSetColor($("input[id='"+d+"']").val())}})};a.prototype.retrieveCSSName=function(){return this._PropertiesLookup};return a}();
(function(a){(function(b){(function(b){var c=function(b){function c(){var d=b.call(this)||this;d.automationId=c.userModeId;d._id=d.automationId;d.interactiveService_DragStarted=function(b,c){if(d.canStartWork(c)&&(d.onWorkStarted(a.LeadEventArgs.empty),b=a.Annotations.JavaScript.AutomationInteractiveMode.convertPointerEventArgs(c,!1),!c.isHandled&&(d.workAutomationControl.onAutomationPointerDown(b),c.isHandled=b.isHandled,!c.isHandled)))d.onWorkCompleted(a.LeadEventArgs.empty)};d.interactiveService_DragDelta=
function(b,c){d.isWorking&&(b=a.Annotations.JavaScript.AutomationInteractiveMode.convertPointerEventArgs(c,!1),c.isHandled||(d.workAutomationControl.onAutomationPointerMove(b),c.isHandled=b.isHandled))};d.interactiveService_DragCompleted=function(b,c){d.isWorking&&(b=a.Annotations.JavaScript.AutomationInteractiveMode.convertPointerEventArgs(c,!1),c.isHandled||(d.workAutomationControl.onAutomationPointerUp(b),c.isHandled=b.isHandled,d.onWorkCompleted(a.LeadEventArgs.empty)))};d.interactiveService_Tap=
function(b,c){!d.isWorking&&d.canStartWork(c)&&(b=a.Annotations.JavaScript.AutomationInteractiveMode.convertPointerEventArgs(c,!0),c.isHandled||(d.workAutomationControl.onAutomationPointerUp(b),c.isHandled=b.isHandled))};d.interactiveService_DoubleTap=function(b,c){d.canStartWork(c)&&(b=a.Annotations.JavaScript.AutomationInteractiveMode.convertPointerEventArgs(c,!0),c.isHandled||(d.onWorkStarted(a.LeadEventArgs.empty),d.workAutomationControl.onAutomationDoubleClick(b),c.isHandled=b.isHandled,d.onWorkCompleted(a.LeadEventArgs.empty)))};
d.interactiveService_Move=function(b,c){null!=d.workAutomationControl&&(b=a.Annotations.JavaScript.AutomationInteractiveMode.convertPointerEventArgs(c,!1),d.workAutomationControl.onAutomationPointerMove(b))};d.mouseButtons=a.Controls.MouseButtons.left;d.autoItemMode=a.Controls.ImageViewerAutoItemMode.autoSet;d.itemPart=a.Controls.ImageViewerItemPart.image;d.workOnBounds=!1;d.isDragMouseWheelEnabled=!1;return d}__extends(c,b);c.prototype.get_id=function(){return this._id};c.prototype.setId=function(a){this._id=
a};Object.defineProperty(c.prototype,"automationControl",{get:function(){return this._automationControl},set:function(a){this._automationControl=a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"workAutomationControl",{get:function(){return null!=this._automationControl?this._automationControl:this.imageViewer},enumerable:!0,configurable:!0});c.prototype.get_name=function(){return"AutomationInteractiveMode"};c.prototype.canStartWork=function(a){return b.prototype.canStartWork.call(this,
a)&&null!=this.workAutomationControl};c.prototype.start=function(a){b.prototype.start.call(this,a);a=this.interactiveService;this._dragStartedHandler=a.dragStarted.add(this.interactiveService_DragStarted);this._dragDeltaHandler=a.dragDelta.add(this.interactiveService_DragDelta);this._dragCompletedHandler=a.dragCompleted.add(this.interactiveService_DragCompleted);this._tapHandler=a.tap.add(this.interactiveService_Tap);this._doubleTapHandler=a.doubleTap.add(this.interactiveService_DoubleTap);this._moveHandler=
a.move.add(this.interactiveService_Move)};c.prototype.stop=function(a){if(this.isStarted){var c=b.prototype.get_interactiveService.call(this);c.dragStarted.remove(this._dragStartedHandler);c.dragDelta.remove(this._dragDeltaHandler);c.dragCompleted.remove(this._dragCompletedHandler);c.tap.remove(this.interactiveService_Tap);c.doubleTap.remove(this._doubleTapHandler);c.move.remove(this._moveHandler);b.prototype.stop.call(this,a)}};c.convertPointerEventArgs=function(b,c){var d=a.LeadPointD.create(b.position.x,
b.position.y),e=a.Annotations.Engine.AnnMouseButton.none;c?e=a.Annotations.Engine.AnnMouseButton.left:(b.mouseButton==a.Controls.MouseButtons.left&&(e=a.Annotations.Engine.AnnMouseButton.left),b.mouseButton==a.Controls.MouseButtons.right&&(e=a.Annotations.Engine.AnnMouseButton.right));c=a.Annotations.Engine.AnnPointerEventArgs.create(e,d);c.isHandled=b.isHandled;return c};return c}(a.Controls.ImageViewerInteractiveMode);b.AutomationInteractiveMode=c})(b.JavaScript||(b.JavaScript={}))})(a.Annotations||
(a.Annotations={}))})(lt||(lt={}));
(function(a){(function(b){(function(b){var c;(function(a){a[a.selectObject=0]="selectObject";a[a.selectedObject=1]="selectedObject";a[a.controlPoint=2]="controlPoint";a[a.controlPointNWSE=3]="controlPointNWSE";a[a.controlPointNS=4]="controlPointNS";a[a.controlPointNESW=5]="controlPointNESW";a[a.controlPointWE=6]="controlPointWE";a[a.selectRectangle=7]="selectRectangle";a[a.run=8]="run";a[a.rotateCenterControlPoint=9]="rotateCenterControlPoint";a[a.rotateGripperControlPoint=10]="rotateGripperControlPoint";
a[a.Default=11]="Default";a[a.count=12]="count"})(c=b.AnnCursorType||(b.AnnCursorType={}));var d=function(){function b(d,e){this._resourcesPath="../Resources";this._drawCursors={};this._objectsImages={};null==d&&alert("Error, AnnAutomationManager is null");this._manager=d;null==this._manager.renderingEngine&&(this._manager.renderingEngine=new a.Annotations.Rendering.AnnHtml5RenderingEngine);b._automationCursors[c.controlPoint]="url('##RESOURCES_PATH##/Cursors/Edit/ControlPoint.cur'),default";b._automationCursors[c.rotateCenterControlPoint]=
"url('##RESOURCES_PATH##/Cursors/Edit/Anchor.cur'), default";b._automationCursors[c.rotateGripperControlPoint]="url('##RESOURCES_PATH##/Cursors/Edit/Rotate.cur'),default";b._automationCursors[c.selectObject]="url('##RESOURCES_PATH##/Cursors/Edit/SelectObject.cur'), default";b._automationCursors[c.selectedObject]="url('##RESOURCES_PATH##/Cursors/Edit/SelectedObject.cur'),default";b._automationCursors[c.run]="pointer";this.updateResourcePaths(e);a.LTHelper.supportsMouse&&(a.Controls.InteractiveService.registerGlobalModifierKeys(),
a.Annotations.Automation.AnnAutomationManager.platformCallbacks.checkModifier=b.checkModifierKey);this.updateAutomationObjects()}Object.defineProperty(b.prototype,"automationManager",{get:function(){return this._manager},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"drawCursors",{get:function(){return this._drawCursors},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"automationCursors",{get:function(){return b._automationCursors},enumerable:!0,configurable:!0});
b.prototype.updateResourcePaths=function(a){for(var d in b._drawCursorsTemplate){var e=b._drawCursorsTemplate[d];e=e.replace(b._resourcesTamplate,a);this._drawCursors[d]=e}for(d in b._objectsImagesTemplate)e=b._objectsImagesTemplate[d],e=e.replace(b._resourcesTamplate,a),this._objectsImages[d]=e;b._automationCursors[c.controlPoint]=b._automationCursors[c.controlPoint].replace(b._resourcesTamplate,a);b._automationCursors[c.rotateCenterControlPoint]=b._automationCursors[c.rotateCenterControlPoint].replace(b._resourcesTamplate,
a);b._automationCursors[c.rotateGripperControlPoint]=b._automationCursors[c.rotateGripperControlPoint].replace(b._resourcesTamplate,a);b._automationCursors[c.selectObject]=b._automationCursors[c.selectObject].replace(b._resourcesTamplate,a);b._automationCursors[c.selectedObject]=b._automationCursors[c.selectedObject].replace(b._resourcesTamplate,a)};b.prototype.updateAutomationObjects=function(){if(null!=this._manager)for(var a=0;a<this._manager.objects.count;a++){var c=this._manager.objects.item(a);
b.updateAutomationObject(c)}};b.updateAutomationObject=function(b){null!=b.objectTemplate&&b.objectTemplate.supportsFill&&null==b.objectTemplate.fill&&(b.objectTemplate.fill=a.Annotations.Engine.AnnSolidColorBrush.create("transparent"))};b.prototype.getAutomationObjectCursor=function(b){return b==a.Annotations.Engine.AnnObject.imageObjectId?null:b==a.Annotations.Engine.AnnObject.textHiliteObjectId||b==a.Annotations.Engine.AnnObject.textStrikeoutObjectId||b==a.Annotations.Engine.AnnObject.textUnderlineObjectId||
b==a.Annotations.Engine.AnnObject.textRedactionObjectId?"text":b==a.Annotations.Engine.AnnObject.stickyNoteObjectId?"crosshair":null!=this._manager.findObjectById(b)?this._drawCursors[b.toString()]:null};b.prototype.getAutomationObjectImage=function(a){return null!=this._manager.findObjectById(a)?this._objectsImages[a.toString()]:null};b.checkModifierKey=function(b){var c=a.Annotations.Engine.AnnKeys,d=a.Controls.Keys,e=a.Controls.InteractiveService.modifierKeys;return(b&c.shift)==c.shift?(e&d.shift)===
d.shift:(b&a.Annotations.Engine.AnnKeys.control)==a.Annotations.Engine.AnnKeys.control?(e&d.control)===d.control:(b&a.Annotations.Engine.AnnKeys.alt)==a.Annotations.Engine.AnnKeys.alt?(e&d.alt)===d.alt:!1};b.prototype.LoadPackage=function(c){if(null!=c){var d=this._manager.objects.collectionChanged.add(function(c,d){if(d.action==a.NotifyLeadCollectionChangedAction.add){for(c=0;c<d.newItems.length;c++)var e=d.newItems[c];b.updateAutomationObject(e)}});this._manager.loadPackage(c,c.get_friendlyName());
this._manager.objects.collectionChanged.remove(d)}};b._resourcesTamplate="##RESOURCES_PATH##";b._drawCursorsTemplate={"-2":"url('##RESOURCES_PATH##/Cursors/Draw/ToolLine.cur'),default","-3":"url('##RESOURCES_PATH##/Cursors/Draw/ToolRectangle.cur'),default","-4":"url('##RESOURCES_PATH##/Cursors/Draw/ToolEllipse.cur'),default","-5":"url('##RESOURCES_PATH##/Cursors/Draw/ToolPolyline.cur'),default","-6":"url('##RESOURCES_PATH##/Cursors/Draw/ToolPolygon.cur'),default","-7":"url('##RESOURCES_PATH##/Cursors/Draw/ToolCurve.cur'),default",
"-8":"url('##RESOURCES_PATH##/Cursors/Draw/ToolClosedCurve.cur'),default","-9":"url('##RESOURCES_PATH##/Cursors/Draw/ToolPointer.cur'),default","-10":"url('##RESOURCES_PATH##/Cursors/Draw/ToolFreehand.cur'),default","-11":"url('##RESOURCES_PATH##/Cursors/Draw/ToolHilite.cur'),default","-12":"url('##RESOURCES_PATH##/Cursors/Draw/ToolText.cur'),default","-14":"url('##RESOURCES_PATH##/Cursors/Draw/ToolTextPointer.cur'),default","-15":"url('##RESOURCES_PATH##/Cursors/Draw/ToolNote.cur'),default","-16":"url('##RESOURCES_PATH##/Cursors/Draw/ToolStamp.cur'),default",
"-17":"url('##RESOURCES_PATH##/Cursors/Draw/ToolRubberStamp.cur'),default","-18":"url('##RESOURCES_PATH##/Cursors/Draw/ToolHotspot.cur'),default","-19":"url('##RESOURCES_PATH##/Cursors/Draw/ToolFreehandHotspot.cur'),default","-21":"url('##RESOURCES_PATH##/Cursors/Draw/ToolPoint.cur'),default","-22":"url('##RESOURCES_PATH##/Cursors/Draw/ToolRedaction.cur'),default","-23":"url('##RESOURCES_PATH##/Cursors/Draw/ToolRuler.cur'),default","-24":"url('##RESOURCES_PATH##/Cursors/Draw/ToolPolyruler.cur'),default",
"-25":"url('##RESOURCES_PATH##/Cursors/Draw/ToolProtractor.cur'),default","-26":"url('##RESOURCES_PATH##/Cursors/Draw/ToolCrossProduct.cur'),default","-13":"url('##RESOURCES_PATH##/Cursors/Draw/ToolTextRollup.cur'),default","-28":"url('##RESOURCES_PATH##/Cursors/Draw/ToolAudio.cur'),default","-30":"url('##RESOURCES_PATH##/Cursors/Draw/ToolVideo.cur'),default","-27":"url('##RESOURCES_PATH##/Cursors/Draw/ToolEncrypt.cur'),default"};b._objectsImagesTemplate={"-2":"##RESOURCES_PATH##/Images/Icons/Line.png",
"-3":"##RESOURCES_PATH##/Images/Icons/Rectangle.png","-4":"##RESOURCES_PATH##/Images/Icons/Circle.png","-5":"##RESOURCES_PATH##/Images/Icons/Polyline.png","-6":"##RESOURCES_PATH##/Images/Icons/Polygon.png","-7":"##RESOURCES_PATH##/Images/Icons/SCurve.png","-8":"##RESOURCES_PATH##/Images/Icons/BSpline.png","-9":"##RESOURCES_PATH##/Images/Icons/Pointer.png","-10":"##RESOURCES_PATH##/Images/Icons/Pen.png","-11":"##RESOURCES_PATH##/Images/Icons/Highlight.png","-12":"##RESOURCES_PATH##/Images/Icons/A.png",
"-14":"##RESOURCES_PATH##/Images/Icons/AArrow.png","-15":"##RESOURCES_PATH##/Images/Icons/Note.png","-16":"##RESOURCES_PATH##/Images/Icons/Image.png","-17":"##RESOURCES_PATH##/Images/Icons/Stamp.png","-18":"##RESOURCES_PATH##/Images/Icons/H.png","-19":"##RESOURCES_PATH##/Images/Icons/HSquiggles.png","-21":"##RESOURCES_PATH##/Images/Icons/RoundX.png","-22":"##RESOURCES_PATH##/Images/Icons/Redact.png","-23":"##RESOURCES_PATH##/Images/Icons/Ruler.png","-24":"##RESOURCES_PATH##/Images/Icons/90DegreeRuler.png",
"-25":"##RESOURCES_PATH##/Images/Icons/Protractor.png","-26":"##RESOURCES_PATH##/Images/Icons/Intersect.png","-13":"##RESOURCES_PATH##/Images/Icons/Pin.png","-28":"##RESOURCES_PATH##/Images/Icons/Sound.png","-30":"##RESOURCES_PATH##/Images/Icons/Video.png","-27":"##RESOURCES_PATH##/Images/Icons/Lock.png","-33":"##RESOURCES_PATH##/Images/Icons/THighlight.png","-34":"##RESOURCES_PATH##/Images/Icons/Strikethrough.png","-35":"##RESOURCES_PATH##/Images/Icons/Underline.png","-36":"##RESOURCES_PATH##/Images/Icons/TRedact.png",
"-32":"##RESOURCES_PATH##/Images/Icons/StickyNotes.png"};b._undoImageUrlTemplate="url('##RESOURCES_PATH##/Images/Icons/Undo.png')";b._automationCursors={};return b}();b.AutomationManagerHelper=d})(b.JavaScript||(b.JavaScript={}))})(a.Annotations||(a.Annotations={}))})(lt||(lt={}));
directives.directive("ltFancyTree",["$rootScope",function(a){return{restrict:"A",scope:{config:"=",data:"=",disabledItems:"=",select:"&",activate:"&",deactivate:"&",api:"="},link:function(b,d,c,e){b.$watch("config",function(c){$(d).parent().height(.25*a.windowDimensions.height);c.select=function(a,c){b.select({event:a,data:c})};c.activate=function(a,c){b.activate({event:a,data:c})};c.deactivate=function(a,c){b.deactivate({event:a,data:c})};d.fancytree(c)});b.api=b.api||{};b.api.addNode=function(a,
b){null==a&&(a=d.fancytree("getRootNode"));return a.addChildren({title:b.id,tooltip:b.tooltip,data:b,folder:b.items&&0<b.items.length})};b.api.visit=function(a){d.fancytree("getTree").visit(a)};b.api.activateNode=function(a){null!=a&&(a.setActive(),a.setFocus(!0),a.scrollIntoView())};b.api.clear=function(){d.fancytree("getRootNode").removeChildren()};b.api.addData=function(a,c){null==a&&(a=d.fancytree("getRootNode"));var e=a.addChildren({title:c.id,tooltip:c.tooltip,data:c,folder:c.items&&0<c.items.length,
selected:-1==b.disabledItems.indexOf(c.id)});angular.forEach(c.items,function(a,c){b.api.addData(e,a)})};b.api.setDisabledItems=function(a){d.fancytree("getTree").visit(function(b){b.setSelected(-1==a.indexOf(b.data.id))})};b.api.clearActive=function(){d.fancytree("getTree").visit(function(a){a.setActive(!1)})};b.$watch("data",function(a){if(a){for(var c=d.fancytree("getRootNode"),e=0;e<a.length;e++)b.api.addData(c,a[e]);b.api.clearActive()}});b.$watch(function(){return a.windowDimensions.height},
function(a,b){a!=b&&$(d).parent().height(.25*a)})}}}]);var Directives;
(function(a){var b=function(){function a(a,b){this._viewer=a;this._config=b}Object.defineProperty(a.prototype,"selectedItems",{get:function(){return this._viewer.emptyDivs.selectedItems},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"cellCount",{get:function(){return this._viewer.get_gridLayout().get_rows()*this._viewer.get_gridLayout().get_columns()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"canMerge",{get:function(){return this._viewer.canMerge()},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"hasLayout",{get:function(){return!!this._config.studyLayout},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"studyLayout",{get:function(){return this._config.studyLayout},set:function(a){this._config.studyLayout=a},enumerable:!0,configurable:!0});a.prototype.mergeSelectedCells=function(){this._viewer.mergeSelected()};a.prototype.clearLayout=function(){delete this._config.studyLayout};return a}();a.MedicalViewerApi=b})(Directives||
(Directives={}));
var MedicalViewerAction={Offset:0,Scale:1,Magnify:2,WindowLevel:3,Stack:4,AnnRectangle:5,AnnEllipse:6,AnnPointer:7,AnnCurve:8,AnnLine:9,AnnText:10,AnnHighlight:11,AnnRuler:12,AnnPolyRuler:13,AnnProtractor:14,AnnSelect:15,AnnFreeHand:16,SpyGlass:17,ProbeTool:18,AnnPoint:19,AnnPolyline:20,AnnPolygon:21,AnnTextPointer:22,AnnNote:23,CrossHair:24,DragItem:25,LineProfile:26,Cursor3D:27,ShutterRect:28,ShutterEllipse:29,ShutterPolygon:30,ShutterFreeHand:31,Rotate3D:32,PanoramicPolygon:33},Spyglass={Default:0,
Invert:1,CLAHE:2,Equalization:3},CommandManager;
(function(a){function b(b,c,e,f){if(b.getCommand){if(c==MedicalViewerAction.Rotate3D)return!1;var d=b.getCommand(c);var h,k=b.viewer.layout.items.count;d.linked.clear();for(h=0;h<k;h++){var l=b.viewer.layout.items.get_item(h);l.tickBoxes&&l.tickBoxes[0].checked&&d.linked.add(l)}d.button=e;b.runCommand(c);e==lt.Controls.MouseButtons.left&&(a.LastCommand.ButtonID=f,a.LastCommand.Action=c)}else{switch(c){case MedicalViewerAction.Offset:c=lt.Controls.Medical.Interactive3DAction.offset;break;case MedicalViewerAction.WindowLevel:c=
lt.Controls.Medical.Interactive3DAction.windowLevel;break;case MedicalViewerAction.Scale:c=lt.Controls.Medical.Interactive3DAction.scale;break;case MedicalViewerAction.Rotate3D:c=lt.Controls.Medical.Interactive3DAction.rotate3D;break;default:return!1}e==lt.Controls.MouseButtons.left&&(a.Last3DCommand.ButtonID=f,a.Last3DCommand.Action=c);b.actions[e]=c}return!0}a.LastCommand={Action:MedicalViewerAction.WindowLevel,ButtonID:""};a.Last3DCommand={Action:MedicalViewerAction.Rotate3D,ButtonID:""};a.RunCommand=
function(a,c,e){if(b(a,c,lt.Controls.MouseButtons.left,e)){switch(c){case MedicalViewerAction.WindowLevel:b(a,MedicalViewerAction.Offset,lt.Controls.MouseButtons.right,e);b(a,MedicalViewerAction.Scale,lt.Controls.MouseButtons.middle,e);break;case MedicalViewerAction.Scale:b(a,MedicalViewerAction.WindowLevel,lt.Controls.MouseButtons.right,e);b(a,MedicalViewerAction.Offset,lt.Controls.MouseButtons.middle,e);break;default:b(a,MedicalViewerAction.WindowLevel,lt.Controls.MouseButtons.right,e),b(a,MedicalViewerAction.Scale,
lt.Controls.MouseButtons.middle,e)}a.invalidate()}}})(CommandManager||(CommandManager={}));
var cellNameCounter=0,SpyglassEffect=Spyglass.Default,stretchIntensityLow=0,stretchIntensityHigh=0,MedicalViewerConfig=function(){return function(){this.rows=1;this.columns=2;this.splitterSize=Utils.get_splitterSize();this.hangingProtocol=this.customLayout=this.studyLayout=null}}(),MedicalViewerCellConfig=function(){return function(){}}(),MedicalViewerSeries=function(){return function(a,b,d,c){this.seriesInstanceUID=a;this.patientID=b;this.rows=d||1;this.columns=c||1;this.forCompare=!1;this.link=
!0;this.id=UUID.genV4().toString();this.sopInstanceUIDS=[];this.template=null;this.dislaySetNumber=void 0;this.loadSeriesLayout=!0}}();
directives.directive("medicalviewer",["eventService","$timeout","$parse","objectRetrieveService","queryArchiveService","optionsService","dicomLoaderService","seriesManagerService","overlayManagerService","dataService","cinePlayerService","tabService",function(a,b,d,c,e,f,g,h,k,l,m,p){return{restrict:"A",scope:{viewerConfig:"=",series:"=",viewerapi:"=",cellClicked:"&",stackChanged:"&",seriesDropped:"&",cellSelected:"&"},link:function(b,d,q){function n(a,b,c){return-1!=b&&-1!=c?(a.rows=b,a.columns=
c,v.cellsArrangement=lt.Controls.Medical.CellsArrangement.grid,!0):!1}function r(a,b){if(null!=a){null!=b.NavigationIndicatorSequence&&0<b.NavigationIndicatorSequence.length&&(a.showReferenceLine=!0);for(var c=[],d=0;d<b.DisplaySets.length;d++)null!=b.DisplaySets[d].ReformattingOperationType&&c.push(b.DisplaySets[d].DisplaySetNumber);if(null!=b.SynchronizedScrollingSequence)for(d=0;d<b.SynchronizedScrollingSequence.length;d++){for(var e=!1,f=0;f<b.SynchronizedScrollingSequence[d].DisplaySetScrollingGroup.length;f++)if(-1!=
c.indexOf(b.SynchronizedScrollingSequence[d].DisplaySetScrollingGroup[f])){e=!0;break}if(!e){a.enableSynchronization=!0;break}}}}function w(a,b,c){v.cellsArrangement=lt.Controls.Medical.CellsArrangement.random;v.totalCells=b.length;v.layout.beginUpdate();$.each(b,function(a,b){var c=v.emptyDivs.items.item(a),d=Utils.createLeadRect(b.Position.leftTop.x,b.Position.leftTop.y,b.Position.rightBottom.x,b.Position.rightBottom.y);c.set_position(a);c.bounds=d;c.displaySetNumber=b.displaySetNumber});v.layout.endUpdate()}
function x(a){a.addEventListener("dragover",I,!1);a.addEventListener("dragenter",z,!1);a.addEventListener("dragleave",z,!1);a.addEventListener("drop",D,!1)}function u(a){a.removeEventListener("dragover",I,!1);a.removeEventListener("dragenter",z,!1);a.removeEventListener("dragleave",z,!1);a.removeEventListener("drop",D,!1)}function A(a,b){if(b.mouseButton==lt.Controls.MouseButtons.right){var c=a.drawables.Panoramic;if(null!=c&&c.hitTest(a.selectedItem,b.position.x,b.position.y)){switch(c.hitTestResult){case lt.Controls.Medical.PolygonPart.handle:var d=
new lt.Controls.Medical.Menu("Panoramic");d.items.add(new lt.Controls.Medical.MenuItem("Delete Point",null,c.hitTestIndex));d.items.add(new lt.Controls.Medical.MenuItem("Delete Polygon",null,c));break;case lt.Controls.Medical.PolygonPart.line:d=new lt.Controls.Medical.Menu("Panoramic");d.items.add(new lt.Controls.Medical.MenuItem("Add Point",null,{index:c.hitTestIndex,x:b.position.x,y:b.position.y}));d.items.add(new lt.Controls.Medical.MenuItem("Add Paraxial Slice",null,{index:c.hitTestIndex,x:b.position.x,
y:b.position.y}));d.items.add(new lt.Controls.Medical.MenuItem("Add (5) Paraxial Slices",null,{index:c.hitTestIndex,x:b.position.x,y:b.position.y}));d.items.add(new lt.Controls.Medical.MenuItem("Delete Polygon",null,c));break;default:return}d.show(a,b.position.x,b.position.y,lt.LeadRectD.empty);d.add_menuItemSelected(function(b,d){switch(d.item.text){case "Delete Point":if(b=c.get_points(),b.removeAt(d.item.userData),a.invalidate(),1<b.length)break;case "Delete Polygon":c.userData instanceof lt.Controls.Medical.PanoramicCell&&
c.userData.dispose();delete a.drawables.Panoramic;a.invalidate();break;case "Add Point":b=c.get_points();var e=lt.Controls.Medical.Tools.physicalToLogical(a.selectedItem,lt.LeadPointD.create(d.item.userData.x,d.item.userData.y));b.insert(d.item.userData.index+1,e);a.invalidate();break;case "Add Paraxial Slice":c.createSlice(a.selectedItem,lt.LeadPointD.create(d.item.userData.x,d.item.userData.y),10,d.item.userData.index),a.invalidate()}})}else G(a,b.position.x,b.position.y)}}function G(a,b,c){var d=
new lt.Controls.Medical.Menu("Select Series"),e=0,f=v.layout.get_items().count;for(e=0;e<f;e++){var g=v.layout.get_items().get_item(e);d.items.add(new lt.Controls.Medical.MenuItem(g.name,null,g))}d.show(a,b,c,lt.LeadRectD.empty);d.add_menuItemSelected(function(b,c){v.layout.highlightedItems.clear();b=c.item.userData;v.layout.beginUpdate();v.emptyDivs.beginUpdate();if(v.cellsArrangement==lt.Controls.Medical.CellsArrangement.grid){c=b.rowPosition;var d=b.columnsPosition;b.rowPosition=a.rowPosition;
b.columnsPosition=a.columnsPosition;a.rowPosition=c;a.columnsPosition=d}else c=b.position,d=b.bounds,b.bounds=a.bounds,a.bounds=d,b.position=a.position,a.position=c;v.layout.endUpdate();v.emptyDivs.endUpdate();a.selected=!1;b.selected=!0;v.layoutCells()});d.add_menuItemHover(function(a,b){v.layout.highlightedItems.clear();v.layout.highlightedItems.add(b.item.userData)});d.add_menuItemLeave(function(a,b){v.layout.highlightedItems.clear()})}function I(a){a.preventDefault&&a.preventDefault();a.dataTransfer.dropEffect=
"copy";return!1}function D(a){var c=a.dataTransfer.getData("Text");if(-1==c.indexOf("overflow")&&(a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),null!=c)){for(var d=v.layout.get_items().get_count(),e,f=v.layout.get_items(),g,h=v.get_emptyDivs().get_items(),k,l,m,R,n=null,p=0;p<d;p++){g=f.get_item(p);var q=g.get_divID();e=document.getElementById(q);if(e==this){k=g.get_position();l=g.get_rowPosition();m=g.get_columnsPosition();R=g.get_bounds();n=$("#"+q).attr("seriesInstanceUID");
break}}if(void 0==k)for(d=h.get_count(),p=0;p<d;p++)if(g=h.get_item(p),g.div.id==a.target.id){k=g.get_position();l=g.get_rowPosition();m=g.get_columnsPosition();R=g.get_bounds();break}b.seriesDropped({viewer:v,oldSeriesInstanceUID:n,seriesInstanceUID:c,position:k,rowPosition:l,colPosition:m,bounds:R})}return!1}function z(a){}function E(a){for(var b=v.layout.get_items(),c=b.count,d=[],e=0;e<c;e++){var g=b.item(e).get_seriesInstanceUID();0!=$.grep(a,function(a,b){return a.seriesInstanceUID==g}).length&&
d.push(g)}$.each(d,function(a,b){a=v.layout.get_items().get_count();v.layout.beginUpdate();for(var c=0;c<a;c++){var d=v.layout.get_items().get_item(c);if(d.get_seriesInstanceUID()==b){var e=!1;if(angular.isDefined(void 0)){var g=d.get_selectedItems();0<g.get_count()&&d.get_imageViewer().get_items().indexOf(g.get_item(0));d.get_currentOffset();void 0==d.get_frames().get_item(c).Instance.SOPInstanceUID&&(e=!0)}else e=!0;if(f.get(OptionNames.DentalMode)&&e){h.remove_seriesCell(b);break}}}v.layout.endUpdate()})}
function M(a){var b=new lt.Annotations.Engine.AnnResources;b.get_images()[0]=new lt.Annotations.Engine.AnnPicture("images/objects/Point.png");a.set_resources(b)}function L(b,c,d,e,g){var k=b.get_divID();b.beginUpdate();b.set_unselectedBorderColor(f.get(OptionNames.UnSelectedBorderColor));b.set_selectedSubCellBorderColor(f.get(OptionNames.SelectedSubCellBorderColor));b.set_selectedBorderColor(f.get(OptionNames.SelectedBorderColor));b.set_highlightedSubCellBorderColor(f.get(OptionNames.SelectedBorderColor));
b.set_showFrameBorder(f.get(OptionNames.ShowFrameBorder));b.set_seriesInstanceUID(c.seriesInstanceUID);b.add_mouseDown(O);b.add_cellClicked(A);b.endUpdate();b.add_currentOffsetChanged(S);b.set_linked(c.link);b.tickBoxes[0].add_tickBoxClicked(H);b.selectedItems.add_collectionChanged(function(b,c){c.action==lt.NotifyLeadCollectionChangedAction.add&&0<c.newItems.length&&(b=c.newItems[0],angular.isDefined(b)&&(c=b.get_attachedFrame(),a.publish(EventNames.NewSubCellSelected,{subCell:b,frame:c})))});b.automation.add_draw(function(a,
c){if(null!=b.selectedItem)switch(CommandManager.LastCommand.Action){case MedicalViewerAction.ShutterRect:case MedicalViewerAction.ShutterEllipse:case MedicalViewerAction.ShutterFreeHand:case MedicalViewerAction.ShutterPolygon:c.object.id!=lt.Annotations.Engine.AnnObject.selectObjectId&&(a=b.selectedItem.attachedFrame,c.operationStatus==lt.Annotations.Engine.AnnDesignerOperationStatus.end&&(Utils.clearAllShutter(a),a.get_shutter().get_objects().add(c.object),a.get_shutter().fillStyle="rgba(0, 0, 0, 1)"))}});
x($("#"+k)[0]);$("#"+k)[0].addEventListener("dragstart",function(a){a.dataTransfer.effectAllowed="copy";a.dataTransfer.setData("Text","overflow:"+a.target.id)}.bind(this));J(b);d?b.set_position(d):c.dislaySetNumber&&b.set_position(c.dislaySetNumber);e&&b.set_rowPosition(e);g&&b.set_columnsPosition(g);v.layout.get_items().add(b);ba(b);h.add_seriesCell(b);h.set_activeCell(b.get_seriesInstanceUID());$("#"+k).attr("seriesInstanceUID",b.get_seriesInstanceUID());$("#"+k).attr("seriesID",c.id);M(b.get_automationManager())}
function J(a){var b=new lt.Controls.ImageViewerDragInteractiveMode;a.imageViewer.interactiveModes.beginUpdate();a.imageViewer.interactiveModes.add(b);a.imageViewer.interactiveModes.endUpdate()}function N(a,b){for(var c=a.layout.items.count,d=0;d<c;d++){var e=a.layout.items.item(d);if(b==e.displaySetNumber)return e}return null}function K(b,d,e,k){var l=null;if(null!=b.view&&null!=b.view.ReformattingOperationView){var m=N(v,b.view.ParentDisplaySetNumber);a:{switch(b.view.ReformattingOperationView){case 0:var n=
lt.Controls.Medical.CellMPRType.axial;break a;case 1:n=lt.Controls.Medical.CellMPRType.sagittal;break a;case 2:n=lt.Controls.Medical.CellMPRType.coronal;break a}n=void 0}l=createMPRCell(c,null,h,v,m,n,a,!1)}null==l&&(l=new lt.Controls.Medical.Cell(v,b.id,b.rows,b.columns),m=v.SDInstances,l.visibility=m?m[b.seriesInstanceUID]?m[b.seriesInstanceUID]:!0:!0,m=!1,f.has(OptionNames.UseMedicoreLogo)&&(m=f.get(OptionNames.UseMedicoreLogo)),m&&HideTab_And_ShiftToolbarButtons(),l.forCompare=b.forCompare,l.SortOrderAcsending=
!0,l.CurrentSelectedSortOrder="Axis",b.forCompare?l.tickBoxes[0].checked=!0:f.get(OptionNames.DentalMode)&&(l.tickBoxes[0].visible=!1),L(l,b,d,e,k),l.displaySetNumber=b.dislaySetNumber,x($("#"+b.id)[0]),$("#"+b.id).attr("seriesInstanceUID",l.get_seriesInstanceUID()),g.loadSeries(l,b.sopInstanceUIDS,b.template,!1,b.mrtiCell,b.loadSeriesLayout),b.forCompare&&l.runCommand(MedicalViewerAction.Stack),l.add_firstFrameReady(function(a,b){a=l.div.getElementsByClassName("loader"+l.div.id)[0];l.div.removeChild(a);
a.id="";l.viewer.layout.selectedItem=l;CommandManager.RunCommand(l,CommandManager.LastCommand.Action,CommandManager.LastCommand.ButtonID)}),d=document.createElement("div"),d.id="loader",d.className="loader"+l.div.id,l.div.appendChild(d));P(l,b.dislaySetNumber);return l}function P(a,b){if(angular.isDefined(C.hangingProtocol)&&null!=C.hangingProtocol){var c=Utils.findFirst(C.hangingProtocol.DisplaySets,function(a){return a.DisplaySetNumber==b});v.HangingProtocolEnabled=null!=c;if(c){var d=c.Boxes[0];
if(v.cellsArrangement==lt.Controls.Medical.CellsArrangement.random){var e=Utils.findFirst(v.emptyDivs.items.toArray(),function(a){return a.displaySetNumber==d.displaySetNumber});if(e){var f=e.bounds;v.emptyDivs.items.remove(e);a.bounds=f}}else F(d,a);d.ImageBoxLayoutType==Models.ImageBoxLayoutType.Tiled&&(a.beginUpdate(),a.gridLayout.rows=d.ImageBoxTileVerticalDimension,a.gridLayout.columns=d.ImageBoxTileHorizontalDimension,0!=a.arrangement&&(a.arrangement=0),a.endUpdate());e=HangingProtocolHelper.ConvertToScrollType(c);
a.set_scrollType(e);HangingProtocolHelper.ConvertToCellCinePlayer(a,c);m.fps=a.cinePlayer.FPS;m.directionFromPlayingDirection=a.cinePlayer.direction;m.loop=a.cinePlayer.loop;a.frames.add_collectionChanged(function(a,b){if(b.action==lt.NotifyLeadCollectionChangedAction.add){a=FindPresetWindowLevelValue(c.VoiType);for(var d=0;d<b.newItems.length;d++){var e=b.newItems[d];e.horizontalAlignment=HangingProtocolHelper.ConvertToHorizontalAlignmentType(c.DisplaySetHorizontalJustification);e.verticalAlignment=
HangingProtocolHelper.ConvertToVerticalAlignmentType(c.DisplaySetVerticalJustification);e.targetOrientation=c.DisplaySetPatientOrientation;null!=a&&e.setWindowLevel(a.Info.W,a.Info.C);null!=c.ShowGrayscaleInverted&&(e.inverted=c.ShowGrayscaleInverted);null!=c.ShowImageTrueSizeFlag&&c.ShowImageTrueSizeFlag&&e.zoom(lt.Controls.Medical.MedicalViewerSizeMode.trueSize,1)}}})}}else if(angular.isDefined(C.studyLayout)&&null!=C.studyLayout&&angular.isDefined(C.studyLayout.Series)){var g=$.grep(C.studyLayout.Series,
function(b){return a.hasOwnProperty("displaySetNumber")?b.ImageBoxNumber==a.displaySetNumber:b.SeriesInstanceUID==a.seriesInstanceUID});if(0==g.length)for(e=0;e<C.studyLayout.OtherStudies.length&&!(g=$.grep(C.studyLayout.OtherStudies[e].Series,function(b){return b.SeriesInstanceUID==a.seriesInstanceUID}),0<g.length);e++);0<g.length&&(e=$.grep(C.studyLayout.Boxes,function(a){return a.ImageBoxNumber==g[0].ImageBoxNumber}),0<e.length&&(d=e[0],F(d,a),d.ImageBoxLayoutType==Models.ImageBoxLayoutType.Tiled&&
(a.beginUpdate(),a.gridLayout.rows=d.ImageBoxTileVerticalDimension,a.gridLayout.columns=d.ImageBoxTileHorizontalDimension,0!=a.arrangement&&(a.arrangement=0),a.endUpdate()),a.frames.add_collectionChanged(function(a,b){if(b.action==lt.NotifyLeadCollectionChangedAction.add)for(a=0;a<b.newItems.length;a++){var c=b.newItems[a];c.horizontalAlignment=HangingProtocolHelper.ConvertToHorizontalAlignmentType(d.HorizontalJustification);c.verticalAlignment=HangingProtocolHelper.ConvertToVerticalAlignmentType(d.VerticalJustification)}})))}}
function F(a,b){if(-1!=a.ColumnPosition&&-1!=a.RowPosition){if(b.rowPosition=a.RowPosition,b.columnsPosition=a.ColumnPosition,b.numberOfRows=a.NumberOfRows,b.numberOfColumns=a.NumberOfColumns,null!=a.FirstFrame){var c=function(d,e){if(e.action==lt.NotifyLeadCollectionChangedAction.add){d=a.FirstFrame.FrameNumber-1;for(var f=0;f<e.newItems.length;f++)if(b.frames.indexOf(e.newItems[f])==d){b.frames.remove_collectionChanged(c);b.currentOffset=d;break}}};b.frames.add_collectionChanged(c)}}else{var d=
Utils.createLeadRect(a.Position.leftTop.x,a.Position.leftTop.y,a.Position.rightBottom.x,a.Position.rightBottom.y);b.bounds=d}}function Q(a,b,c){var d,e=v.layout.items.count,f=v.cellsArrangement==lt.Controls.Medical.CellsArrangement.grid;for(d=0;d<e;d++){var g=v.layout.items.get_item(d);if(f){if(-1!=a&&-1!=b&&g.rowPosition==a&&g.columnsPosition==b)return g}else if(-1!=c&&g.position==c)return g}return null}function B(a){null!=a&&(a.get_container().get_children().clear(),a.detach())}function H(a,b){a=
a.parent;b=a.viewer;var c,d=a.viewer.layout.get_items().get_count();for(c=0;c<d;c++){var e=b.layout.get_items().get_item(c),f;a:{var g=b,h=g.layout.get_items().get_count();for(f=0;f<h;f++)if(g.layout.get_items().get_item(f).cinePlayer.isPlaying){f=!0;break a}f=!1}f&&(e.tickBoxes[0].checked?e.cinePlayer.isPlaying||e.cinePlayer.play():e.cinePlayer.isPlaying&&e.cinePlayer.stop());for(var k in e.commands)for(f=e.commands[k],f.linked.clear(),h=a.viewer.layout.get_items().get_count(),g=0;g<h;g++){var l=
a.viewer.layout.get_items().get_item(g);l.tickBoxes[0].checked&&f.linked.add(l)}}}function O(c,d){var e=c.get_seriesInstanceUID();l.get_Series(e);var f=!1;angular.isDefined(d)||(f=!0);c!=h.get_activeCell()&&(h.set_activeCell(c.divID),a.publish(EventNames.ActiveSeriesChanged,{seriesInstanceUID:e,id:c.divID}));f&&b.cellClicked({seriesInstanceUID:e});c.getCommandInteractiveMode&&c.getCommandInteractiveMode(MedicalViewerAction.LineProfile).refresh(c)}function S(c,d){var e=c.get_currentOffset(),f=null;
-1!=e&&(f=c.get_frames().item(e));b.stackChanged({sender:c,e:d});a.publish(EventNames.StackChanged,{viewer:v,cell:c,frame:f})}function Z(a,b){var c=a.layout.items.count+b;a.cellsArrangement==lt.Controls.Medical.CellsArrangement.grid&&c>=a.gridLayout.rows*a.gridLayout.columns&&(b=Math.floor(Math.sqrt(c)),c=Math.ceil(c/b),a.layout.beginUpdate(),a.gridLayout.rows=b,a.gridLayout.columns=c,a.layout.endUpdate())}function aa(a){var b=new lt.Controls.Medical.PanoramicAction(a),c=h.get_seriesInfo(a.get_seriesInstanceUID()),
d=p.get_allTabs()[p.activeTab];b.add_panoramicGenerated(function(b,g){g=a.get_seriesInstanceUID();var l=new lt.Controls.Medical.PanoramicCell(a.viewer,a.divID+"_Panoramic");Z(a.viewer,1);l.add_disposing(function(){B(l.get_automation());h.remove_cell(l);l.polygon.dispose()});b.userData=l;l.URI=e.GetPanoramic3DImage();l.frames.get_item(0).JSON=a.frames.get_item(0).JSON;l.frames.get_item(0).Instance=a.frames.get_item(0).Instance;var m=jQuery.extend(!0,{},c);m.InstanceUID=a.seriesInstanceUID;var n=new MedicalViewerSeries(m.InstanceUID,
"",1,1);n.seriesInstanceUID=m.InstanceUID;k.set_cellOverlays(l,l.frames.get_item(0).JSON,!1);l.seriesInstanceUID=a.seriesInstanceUID;l.studyInstanceUID=a.studyInstanceUID+"_Panoramic";n.link=a.get_linked();W.InitializeCell(l,n);m=new Models.QueryOptions;m.SeriesOptions.SeriesInstanceUID=a.seriesInstanceUID;var p=a.frames.get_item(0);l.engine=d.AddnewEngine(l.divID,e,m,p.Instance.SOPInstanceUID,f);l.engine.add_statusChanged(function(a,c){switch(c.status){case lt.Controls.Medical.Object3DStatus.error:l.viewer.layout.get_items().remove(l);
h.remove_cell(l);l.dispose();alert(c.message);break;case lt.Controls.Medical.Object3DStatus.ready:if(100==l.engine.progress){var d={WindowWidth:"",WindowCenter:"",MinimumValue:"",MaximumValue:""};e.Get3DSettings(d,l.engine.id).then(function(a){try{var c=new lt.Controls.Medical.DICOMImageInformation;c.bitsPerPixel=p.information.bitsPerPixel;c.photometricInterpretation=p.information.photometricInterpretation;c.windowWidth=d.WindowWidth;c.windowCenter=d.WindowCenter;c.minValue=d.MinimumValue;c.maxValue=
d.MaximumValue;c.lowBit=p.information.lowBit;c.highBit=p.information.highBit;c.autoScaleSlope=p.information.autoScaleSlope;c.autoScaleIntercept=p.information.autoScaleIntercept;c=p.information.clone();l.frames.get_item(0).set_information(c);l.polygon=b;CommandManager.RunCommand(l,MedicalViewerAction.WindowLevel,"")}catch(ja){}})}}});l.engine.start("",g,a.get_studyInstanceUID())});a.setCommand(MedicalViewerAction.PanoramicPolygon,b)}function ba(a){var b=new lt.Controls.Medical.SpyGlassAction,c=new lt.Controls.Medical.ScaleAction,
d=new lt.Controls.Medical.ProbeToolAction,e=new lt.Controls.Medical.LineProfileAction;a.lineProfile.add_histogramGenerated(da);b.add_imageRequested(ea);b.add_chunkLoaded(fa);b.add_workCompleted(ia);b.add_positionChanged(ha);d.add_probeToolUpdated(V);c.set_button(lt.Controls.MouseButtons.right);a.setCommand(MedicalViewerAction.Offset,new lt.Controls.Medical.OffsetAction);a.setCommand(MedicalViewerAction.ProbeTool,d);d.interactiveObject.backgroundColor="rgba(0, 0, 0, 0.0)";d.interactiveObject.textColor=
"rgba(153, 200, 255, 1)";d.interactiveObject.showBorder=!1;a.setCommand(MedicalViewerAction.ShutterRect,new lt.Controls.Medical.AutomationInteractiveAction(lt.Annotations.Engine.AnnObject.rectangleObjectId));a.setCommand(MedicalViewerAction.ShutterEllipse,new lt.Controls.Medical.AutomationInteractiveAction(lt.Annotations.Engine.AnnObject.ellipseObjectId));a.setCommand(MedicalViewerAction.ShutterFreeHand,new lt.Controls.Medical.AutomationInteractiveAction(lt.Annotations.Engine.AnnObject.freehandObjectId));
a.setCommand(MedicalViewerAction.ShutterPolygon,new lt.Controls.Medical.AutomationInteractiveAction(lt.Annotations.Engine.AnnObject.polygonObjectId));a.setCommand(MedicalViewerAction.Cursor3D,new lt.Controls.Medical.Cursor3DAction);a.setCommand(MedicalViewerAction.DragItem,new lt.Controls.Medical.TransformItemAction(a));a.setCommand(MedicalViewerAction.LineProfile,e);a.setCommand(MedicalViewerAction.Scale,new lt.Controls.Medical.ScaleAction);a.setCommand(MedicalViewerAction.Magnify,new lt.Controls.Medical.MagnifyAction);
a.setCommand(MedicalViewerAction.WindowLevel,new lt.Controls.Medical.WindowLevelAction);a.setCommand(MedicalViewerAction.Stack,new lt.Controls.Medical.StackAction);a.setCommand(MedicalViewerAction.AnnRectangle,new lt.Controls.Medical.AutomationInteractiveAction(lt.Annotations.Engine.AnnObject.rectangleObjectId));a.setCommand(MedicalViewerAction.AnnEllipse,new lt.Controls.Medical.AutomationInteractiveAction(lt.Annotations.Engine.AnnObject.ellipseObjectId));a.setCommand(MedicalViewerAction.AnnPointer,
new lt.Controls.Medical.AutomationInteractiveAction(lt.Annotations.Engine.AnnObject.pointerObjectId));a.setCommand(MedicalViewerAction.AnnCurve,new lt.Controls.Medical.AutomationInteractiveAction(lt.Annotations.Engine.AnnObject.curveObjectId));a.setCommand(MedicalViewerAction.AnnLine,new lt.Controls.Medical.AutomationInteractiveAction(lt.Annotations.Engine.AnnObject.lineObjectId));a.setCommand(MedicalViewerAction.AnnText,new lt.Controls.Medical.AutomationInteractiveAction(lt.Annotations.Engine.AnnObject.textObjectId));
a.setCommand(MedicalViewerAction.AnnHighlight,new lt.Controls.Medical.AutomationInteractiveAction(lt.Annotations.Engine.AnnObject.hiliteObjectId));a.setCommand(MedicalViewerAction.AnnRuler,new lt.Controls.Medical.AutomationInteractiveAction(lt.Annotations.Engine.AnnObject.rulerObjectId));a.setCommand(MedicalViewerAction.AnnPolyRuler,new lt.Controls.Medical.AutomationInteractiveAction(lt.Annotations.Engine.AnnObject.polyRulerObjectId));a.setCommand(MedicalViewerAction.AnnProtractor,new lt.Controls.Medical.AutomationInteractiveAction(lt.Annotations.Engine.AnnObject.protractorObjectId));
a.setCommand(MedicalViewerAction.AnnSelect,new lt.Controls.Medical.AutomationInteractiveAction(lt.Annotations.Engine.AnnObject.selectObjectId));a.setCommand(MedicalViewerAction.AnnFreeHand,new lt.Controls.Medical.AutomationInteractiveAction(lt.Annotations.Engine.AnnObject.freehandObjectId));a.setCommand(MedicalViewerAction.AnnPoint,new lt.Controls.Medical.AutomationInteractiveAction(lt.Annotations.Engine.AnnObject.pointObjectId));a.setCommand(MedicalViewerAction.AnnPolyline,new lt.Controls.Medical.AutomationInteractiveAction(lt.Annotations.Engine.AnnObject.polylineObjectId));
a.setCommand(MedicalViewerAction.AnnPolygon,new lt.Controls.Medical.AutomationInteractiveAction(lt.Annotations.Engine.AnnObject.polygonObjectId));a.setCommand(MedicalViewerAction.AnnNote,new lt.Controls.Medical.AutomationInteractiveAction(lt.Annotations.Engine.AnnObject.noteObjectId));a.setCommand(MedicalViewerAction.AnnTextPointer,new lt.Controls.Medical.AutomationInteractiveAction(lt.Annotations.Engine.AnnObject.textPointerObjectId));a.setCommand(MedicalViewerAction.SpyGlass,b);aa(a);lineProfileInteractiveMode=
a.getCommandInteractiveMode(MedicalViewerAction.LineProfile);a.add_disposing(ca)}function ca(a,b){a=a.getCommandInteractiveMode(MedicalViewerAction.ProbeTool);null!=a&&(a.remove_probeToolUpdated(V),a.dispose())}function V(a,b){a=b.get_target();var c=DicomHelper.getDicomTagValue(a.JSON,DicomTag.Modality);a.get_isDataReady()&&"CT"==c?(a=lt.Controls.Medical.ProbeToolInteractiveMode.getHuValue(a,b.get_position().get_x(),b.get_position().get_y(),-1),b.set_pixelValue("Hu = "+a)):(c=lt.Controls.Medical.ProbeToolInteractiveMode.getPixelValue(a,
b.get_position().get_x(),b.get_position().get_y()),a.get_isDataReady()?b.set_pixelValue("Density = "+c[0]):b.set_pixelValue("RGB = "+c[0]+", "+c[1]+", "+c[2]))}function T(a,b,c){var d=b.getContext("2d");null!=c&&d.drawImage(c,0,0);switch(SpyglassEffect){case Spyglass.Equalization:if(0==stretchIntensityHigh)break;d=b.getContext("2d");var e=d.getImageData(0,0,b.width,b.height);lt.Controls.Medical.ImageProcessing.levelIntensity(e,stretchIntensityLow,stretchIntensityHigh);d.putImageData(e,0,0);break;
case Spyglass.Invert:d=b.getContext("2d");try{c=b;e=c.getContext("2d").getImageData(0,0,c.width,c.height);var f=e.data,g=f.length;for(c=0;c<g;)f[c]=255-f[c],f[c+1]=255-f[c+1],f[c+2]=255-f[c+2],c+=4;d.putImageData(e,0,0)}finally{d=e=f=null}break;case Spyglass.CLAHE:c=b;e=c.getContext("2d").getImageData(0,0,c.width,c.height);d=new lt.ImageProcessing;a.getCommandInteractiveMode(MedicalViewerAction.SpyGlass).set_text("Filter: CLAHE (Loading)");d.set_jsFilePath(_jsFileCorePath);d.set_command("CLAHE");
d.get_arguments().alpha=.65;d.get_arguments().tilesize=6;d.get_arguments().tilehistcliplimit=.08;d.get_arguments().binsnumber=128;d.get_arguments().flags=1;d.get_arguments().useProgress=!1;d.set_imageData(e);d.add_completed(function(c,d){if(b&&1!=b.width){var e=b.getContext("2d");e.putImageData(d.get_imageData(),0,0);c.abort();a.getCommandInteractiveMode(MedicalViewerAction.SpyGlass).get_isWorking()&&(a.getCommandInteractiveMode(MedicalViewerAction.SpyGlass).refresh(),a.getCommandInteractiveMode(MedicalViewerAction.SpyGlass).set_text("Filter: CLAHE"))}});
d.run();break;default:a.getCommandInteractiveMode(MedicalViewerAction.SpyGlass).set_text("")}}function da(a,b){currentLineProfileFrame=b.frame;lineProfileHistogram=b.histogram;colorType=b.type;RenderLineProfileHistogram(0,0,!1);HistogramUpdated()}function ea(a,b){a=a.SubCellAttached;var c=b.get_userData(),d=h.get_activeSubCellIndex(a);a.get_frames().get_item(d);var e=b.get_inputCanvas(),f=e.width,g=e.height;c.spyCanvas||(c.spyCanvas=document.createElement("canvas"),d=c.spyCanvas,d.width=f,d.height=
g);switch(SpyglassEffect){case Spyglass.Equalization:a.getCommandInteractiveMode(MedicalViewerAction.SpyGlass).set_text("Filter: Revealer");break;case Spyglass.Invert:a.getCommandInteractiveMode(MedicalViewerAction.SpyGlass).set_text("Filter: Invert");break;case Spyglass.CLAHE:break;default:a.getCommandInteractiveMode(MedicalViewerAction.SpyGlass).set_text("")}T(a,c.spyCanvas,e);b.set_canvas(b.get_userData().spyCanvas)}function fa(a,b){T(a.SubCellAttached,b.chunk.canvas,b.chunk.backCanvas)}function ha(a,
b){if(SpyglassEffect==Spyglass.Equalization){var c=b.get_displayRect(),d=b.get_subCell(),e=b.get_canvas(),f=b.inputCanvas;a=a.SubCellAttached;if(!c.get_isEmpty()&&0!=c.get_width()&&0!=c.get_height())for(c=d.get_parentCell().get_imageViewer().get_foreCanvas().getContext("2d").getImageData(c.get_left(),c.get_top(),c.get_width(),c.get_height()),c=lt.Controls.Medical.ImageProcessing.getHistogramPoint(c,10),stretchIntensityLow=c.x,stretchIntensityHigh=c.y,T(a,e,f),e=b.chunkList,f=0;f<e.length;f++)a=e[f],
b=a.canvas.getContext("2d"),b.drawImage(a.backCanvas,0,0),c=b.getImageData(0,0,a.rect.width,a.rect.height),lt.Controls.Medical.ImageProcessing.levelIntensity(c,stretchIntensityLow,stretchIntensityHigh),b.putImageData(c,0,0)}}function ia(a,b){b.get_userData().spyCanvas&&(lt.Controls.Medical.Tools.resetCanvas(b.get_userData().spyCanvas),b.get_userData().spyCanvas=null)}q.viewerId&&d.attr("id",q.viewerId);var v=new lt.Controls.Medical.MedicalViewer(d[0],0,0),X=v.get_divId(),C=b.viewerConfig||new MedicalViewerConfig;
lt.LTHelper.device!=lt.LTDevice.mobile||C.studyLayout||C.customLayout||(C.rows=1,C.columns=1);v.get_emptyDivs().get_items().add_collectionChanged(function(a,b){a=0;var c=b.newItems.length,d=null;if(b.get_action()===lt.NotifyLeadCollectionChangedAction.add)for(;a<c;a++){var e=b.newItems[a];d=e.div;e.parent.viewer.cellsArrangement==lt.Controls.Medical.CellsArrangement.random&&(e.backgroundColor="rgba(30, 30, 30, 1)");x(d);$(d).click(function(a){m.isPlaying&&m.stop()});d.addEventListener("mousedown",
function(a){2==a.button&&G(e,a.offsetX,a.offsetY)}.bind(this))}else if(b.get_action()===lt.NotifyLeadCollectionChangedAction.remove)for(;a<c;a++)d=b.newItems[a].get_div(),u(d)});if(C.hangingProtocol){q=Utils.clone(C.hangingProtocol);C.hangingProtocol=q;if(!n(C,q.Rows,q.Columns)){var Y=[];angular.forEach(C.hangingProtocol.DisplaySets,function(a,b){angular.forEach(a.Boxes,function(b,c){b.displaySetNumber=a.DisplaySetNumber;Y.push(b)})});w(C,Y,function(a){return angular.isDefined(a.displaySetNumber)&&
-1!=a.displaySetNumber})}r(v,q)}else if(C.studyLayout)q=Utils.clone(C.studyLayout),C.studyLayout=q,C.studyLayout.Boxes&&C.studyLayout.Boxes.sort(function(a,b){return a.ImageBoxNumber-b.ImageBoxNumber}),n(C,q.Rows,q.Columns)||(v.cellsArrangement=lt.Controls.Medical.CellsArrangement.random,v.totalCells=C.studyLayout.Boxes.length,function(a){a=Math.min(a.length,v.layout.items.count);for(var b=v.get_emptyDivs().items.count,c=0;c<b;c++)v.get_emptyDivs().get_items().get_item(c).set_position(c+a)}(C.studyLayout.Boxes),
function(a){var b=v.emptyDivs.items.count;v.layout.beginUpdate();for(var c=0;c<b;c++){var d=c+1;if(0==$.grep(C.studyLayout.Series,function(a){return a.ImageBoxNumber==d}).length){var e=v.emptyDivs.items.item(c),f=a[c];f=Utils.createLeadRect(f.Position.leftTop.x,f.Position.leftTop.y,f.Position.rightBottom.x,f.Position.rightBottom.y);e.bounds=f}}v.layout.endUpdate()}(C.studyLayout.Boxes),$.each(C.studyLayout.Boxes,function(a,b){a=v.emptyDivs.items.get_item(a);var c=Utils.createLeadRect(b.Position.leftTop.x,
b.Position.leftTop.y,b.Position.rightBottom.x,b.Position.rightBottom.y);a.position=b.ImageBoxNumber;a.bounds=c}));else if(C.customLayout)try{var U=JSON.parse(C.customLayout);v.cellsArrangement=lt.Controls.Medical.CellsArrangement.random;v.layout.beginUpdate();v.totalCells=U.length;Utils.resetSeriesArrangement(v,U);Utils.rearrangeSeries(v,U)}catch(R){v.cellsArrangement=lt.Controls.Medical.CellsArrangement.grid}finally{v.layout.endUpdate()}v.set_emptyCellColor(f.get(OptionNames.EmptyCellBackgroundColor));
v.get_gridLayout().set_rows(C.rows);v.get_gridLayout().set_columns(C.columns);v.get_gridLayout().set_splitterSize(C.splitterSize);v.layout.selectedItems.add_collectionChanged(function(a,b){1==b.newItems.length&&b.action==lt.NotifyLeadCollectionChangedAction.add&&O(b.newItems[0],null)});$(d).resize(function(){$("#"+X).width($(d).width());$("#"+X).height($(d).height());v.onSizeChanged();$(".btn-group>.dropdown-menu").css("max-height",Math.floor(.75*$(window).height())+"px")});v.add_selectionChanged(function(a,
b){C.OnSelectionChanged&&C.OnSelectionChanged(v.layout.selectedItems.count+v.emptyDivs.selectedItems.count)});v.get_emptyDivs();b.viewerapi=b.viewerapi||{};b.viewerapi.getMedicalViewer=function(){return v};b.viewerapi.get_cellCount=function(){return v.get_gridLayout().get_rows()*v.get_gridLayout().get_columns()};b.viewerapi.replaceSeries=function(a,c,d,e,f,g,k){var l=$.grep(b.series,function(b,c){return b.seriesInstanceUID==a});if(0!=l.length){if(1==l.length)var m=l[0];else for(var n=0;n<l.length&&
(!(m=l[n])||!m.sopInstanceUIDS||-1==m.sopInstanceUIDS.indexOf(c));n++);c=b.series.indexOf(m);b.series.splice(c,1)}v.layout.beginUpdate();c=Q(f,g,e);null!=c&&(v.layout.get_items().remove(c),B(c.get_automation()),h.remove_cell(c),c.dispose());c=K(d,e,f,g);-1!=e&&c.set_position(e);c.set_rowPosition(f);c.set_columnsPosition(g);c.set_bounds(k);v.layout.endUpdate();v.layoutCells();b.series.push(d)};b.viewerapi.InitializeCell=L;var W=v;W.InitializeCell=L;C.OnApiReady&&(q=new Directives.MedicalViewerApi(v,
C),C.OnApiReady(q));b.$watch("series",function(a,b){var c=Utils.RemoveDuplicates(a,b);b=Utils.RemoveDuplicates(b,a);if(0==c.length&&0==b.length){if(0==a.length)return;b=a}E(c);a=b;c=a.length;v.exploded&&v.explode(v.explodedCell,!1);v.layout.beginUpdate();for(b=0;b<c;b++){var d=a[b],e=h.get_seriesCellById(d.id);d.forCompare||e?d.forCompare&&K(d):K(d)}v.layout.endUpdate();h.remove_UnusedSeries()},!0);v.layout.get_items().add_collectionChanged(function(c,d){d.action==lt.NotifyLeadCollectionChangedAction.add&&
a.publish(EventNames.NewCellsAdded,{cells:d.newItems});if(d.action==lt.NotifyLeadCollectionChangedAction.remove){c=d.newItems.length;for(var e=0;e<c;e++){var f=$.grep(b.series,function(a,b){return a.id==d.newItems[e].divID});0<f.length&&(f=b.series.indexOf(f[0]),b.series.splice(f,1))}p.get_allTabs()[p.activeTab].DeleteUnusedengine(v)}});v.emptyDivs.selectedItems.add_collectionChanged(function(a,b){b.action==lt.NotifyLeadCollectionChangedAction.add&&h.set_activeCell("")})}}}]);
directives.directive("shakeThat",["$animate",function(a){return{require:"^form",scope:{submit:"&",submitted:"="},link:function(b,d,c,e){d.on("submit",function(){b.$apply(function(){if(e.$valid)return b.submit();b.submitted=!0;a.addClass(d,"shake",function(){a.removeClass(d,"shake")})})})}}}]);
directives.directive("propertygrid",["eventService","$rootScope",function(a,b){return{restrict:"A",scope:{items:"=",onPropertyChanged:"&",onPropertyClicked:"&"},link:function(a,b,e){b=b.attr("id");var c=new PropertyGrid(b,"px");a.$watch("items",function(a){c.clearGrid();a&&angular.forEach(a,function(a,b){c.addProperty(a.groupName,a.rowType,a.cssName,a.dropFields,a.isSubGroup,a.value,a.propertyName,a.enabled)});c.renderGrid()},!0);c.PropertyChanged=function(b,c){a.onPropertyChanged({name:b,value:c})};
c.PropertyClicked=function(b,c){a.onPropertyClicked({name:b,value:c})}}}}]);var Button=function(){return function(){this.tooltip=this.icon=this.action=this.name=this.title=this.type="";this.items=[]}}();directives.directive("toolbar",["toolbarService",function(a){return{restrict:"E",scope:{buttons:"=",name:"="},replace:!0,link:function(b,d,c,e){b.$watch("buttons",function(e){var f=$(d).parent();a.buildToolbar(b,e,f,c.key)})}}}]);var LayoutOptions=function(){return function(){}}();
directives.directive("layout",["eventService","$compile","$timeout",function(a,b,d){return{restrict:"A",scope:{layoutConfig:"=",hideNorth:"=",hideSouth:"=",hideEast:"=",hideWest:"=",eastWest:"=",api:"="},link:function(b,e,f){var c={},h=!0;b.$watch("layoutConfig",function(f){function g(b,c,d,e,f){"north"==b?a.publish(EventNames.NorthPaneResized,{state:d,options:e,element:c}):"south"==b?a.publish(EventNames.SouthPaneResized,{state:d,options:e,element:c}):"east"==b?a.publish(EventNames.EastPaneResized,
{state:d,options:e,element:c}):"west"==b?a.publish(EventNames.WestPaneResized,{state:d,options:e,element:c}):a.publish(EventNames.CenterPaneResized,{state:d,options:e,element:c})}function k(){var a=$(e).position();$(e).css("padding-top");$(e).innerHeight();$(e).innerWidth();$(e).innerHeight($(window).height()-(a.top+1));$(e).innerWidth($(window).innerWidth()-a.left-1);$(e).layout().resizeAll()}var p=f.onopen,n=f.onclose,r=f.onhide,q=f.onshow;f.onresize||(f.onresize=g);f.onopen=function(a,b,d){h?c[a]=
!1:h=!0;p&&p(a)};f.onclose=function(a,b,d){h?c[a]=!0:h=!0;n&&n()};f.onhide=function(a,b,d){h?c[a]=!0:h=!0;r&&r()};f.onshow=function(a,b,d){h?c[a]=!1:h=!0;q&&q()};$(e).layout(f);$(window).resize(function(){k();d(function(){k()},250)});b.api=b.api||{};b.api.get_state=function(a){switch(a.toLowerCase()){case "north":return $(e).layout().state.north;case "south":return $(e).layout().state.south;case "east":return $(e).layout().state.east;case "west":return $(e).layout().state.west}};b.api.has_children=
function(a){var b=$(e).layout();switch(a.toLowerCase()){case "north":return 0<$(b.panes.north[0].childNodes).length;case "south":return 0<$(b.panes.south[0].childNodes).length;case "east":return 0<$(b.panes.east[0].childNodes).length;case "west":return 0<$(b.panes.west[0].childNodes).length}};b.api.switchPanes=function(a,b,c,d){var f=$(e).layout(),g=f.state,h=$("#"+c).find("span:first-child");if(g[a].isHidden){c=a;var l=b;g=d?g[b].layoutHeight:g[b].layoutWidth;d=f.panes[a];a=$(f.panes[b][0].childNodes);
h.removeClass("fa fa-angle-left");h.addClass("fa fa-angle-right")}else c=b,l=a,g=d?g[a].layoutHeight:g[a].layoutWidth,d=f.panes[b],a=$(f.panes[a][0].childNodes),h.removeClass("fa fa-angle-right"),h.addClass("fa fa-angle-left");null!=c&&(f.hide(l),a.appendTo(d),f.sizePane(c,g),f.open(c),k())};b.api.togglePane=function(a,b){var c=$(e).layout();c.state[a].isHidden?c.toggle(b):c.toggle(a)};b.api.openPane=function(a){var b=$(e).layout(),c=b.state;if(c[a].isHidden||c[a].isClosed)b.open(a,!1,!1,!0),k()};
b.api.closePane=function(a){var b=$(e).layout();b.state[a].isClosed||(b.close(a),k())};b.api.refresh=function(){k();d(function(){k()},200)};k();b.$watch(function(){return $(e).is(":visible")},function(a){a&&d(function(){k()},700)});b.$watch("hideNorth",function(a){angular.isDefined(a)&&(a?$(e).layout().close("north"):$(e).layout().open("north"))});b.$watch("hideSouth",function(a){angular.isDefined(a)&&(a?$(e).layout().close("south"):$(e).layout().open("south"))});b.$watch("hideEast",function(a){angular.isDefined(a)&&
(a?$(e).layout().close("east"):$(e).layout().open("east"))});b.$watch("hideWest",function(a){angular.isDefined(a)&&(a?$(e).layout().close("west"):$(e).layout().open("west"))});b.$watch("eastWest",function(a){if(angular.isDefined(a)){var d=b.api.has_children("west")?"west":"east";a?b.api.get_state(d).isClosed||(h=!1,$(e).layout().close(d)):angular.isDefined(c[d])&&c[d]||!b.api.get_state(d).isClosed||(h=!1,$(e).layout().open(d))}})})}}}]);var Filters;
(function(a){var b=function(){function a(){}a.Factory=function(){return function(a,b){if(1==a)return a+" "+b;var c=b;c="us"==b.substr(b.length-2)?c.substr(0,c.length-2)+"i":"ch"==b.substr(b.length-2)||"x"==b.charAt(b.length-1)||"s"==b.charAt(b.length-1)?c+"es":"y"==b.charAt(b.length-1)&&-1==["a","e","i","o","u"].indexOf(b.charAt(b.length-2))?c.substr(0,c.length-1)+"ies":"is"==b.substr(b.length-2)?c.substr(0,c.length-2)+"es":c+"s";return a+" "+c}};return a}();a.PluralizeFilter=b})(Filters||(Filters=
{}));filters.filter("pluralize",Filters.PluralizeFilter.Factory);
(function(a){var b=function(){function a(){this._items=[]}Object.defineProperty(a.prototype,"items",{get:function(){return this._items},set:function(a){this._items=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"name",{get:function(){return this._name},set:function(a){this._name=a},enumerable:!0,configurable:!0});return a}();a.Toolbar=b;b=function(){function a(){this._items=[];this._type=this._tooltip=this._title=this._id=this._cssIconClass=this._action="";this._visible=!0}Object.defineProperty(a.prototype,
"id",{get:function(){return this._id},set:function(a){this._id=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"title",{get:function(){return this._title},set:function(a){this._title=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"tooltip",{get:function(){return this._tooltip},set:function(a){this._tooltip=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"caption",{get:function(){return this._caption},set:function(a){this._caption=a},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"type",{get:function(){return this._type},set:function(a){this._type=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"action",{get:function(){return this._action},set:function(a){this._action=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"shortcut",{get:function(){return this._shortcut},set:function(a){this._shortcut=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"cssIconClass",
{get:function(){return this._cssIconClass},set:function(a){this._cssIconClass=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"visible",{get:function(){return this._visible},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"disabled",{get:function(){return this._disabled},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"items",{get:function(){return this._items},set:function(a){this._items=a},enumerable:!0,configurable:!0});return a}();a.ToolbarItem=
b;b=function(a){function b(){var b=a.call(this)||this;b.type="button";return b}__extends(b,a);return b}(a.ToolbarItem);a.ToolbarButton=b;b=function(a){function b(){var b=a.call(this)||this;b.type="button";return b}__extends(b,a);return b}(a.ToolbarItem);a.ToolbarGroup=b})(Models||(Models={}));
var DicomLoaderService=function(){function a(a,d,c,e,f,g,h,k,l,m,p,n,r){this._eventService=c;this._objectRetrieveService=e;this._queryArchiveService=f;this._objectStoreService=n;this._seriesManagerService=g;this._qService=h;this._overlayManagerService=k;this._optionsService=l;this._timeout=m;this._cinePlayerService=p;this._templateService=r;this._authenticationService=d;this._retrieveLocalUrl=a.urls.serviceUrl+a.urls.objectRetrieveLocalServiceName;this._cellInfo={};this._eventService.subscribe(EventNames.OnLoadLayout,
this.onLoadLayout.bind(this));this._eventService.subscribe(EventNames.OnPresentationInfoLoaded,this.onPresentationInfoLoaded.bind(this));this._eventService.subscribe(EventNames.OnInstancesFound,this.onInstancesFound.bind(this));this._eventService.subscribe(EventNames.OnDicomJSONRetrieved,this.onDicomJSONRetrieved.bind(this));this._eventService.subscribe(EventNames.PresentationStateLoaded,this.onPresentationStateLoaded.bind(this))}a.prototype.loadSeries=function(a,d,c,e,f,g){e=this._seriesManagerService.get_seriesLoaderById(a);
e||(e=new DicomLoader(this._retrieveLocalUrl,this._authenticationService,this._objectRetrieveService,this._eventService,this._queryArchiveService,this._qService,this._seriesManagerService,this._objectStoreService),this._seriesManagerService.set_seriesLoader(a,e));e.loadSeries(a,d,c,!1,f,g)};a.prototype.get_newLoader=function(){return new DicomLoader(this._retrieveLocalUrl,this._authenticationService,this._objectRetrieveService,this._eventService,this._queryArchiveService,this._qService,this._seriesManagerService,
this._objectStoreService)};a.prototype.onLoadLayout=function(a,d){this._seriesManagerService.set_layout(d.args.seriesInstanceUID,d.args.id,d.args.layout,d.args.template)};a.prototype.onPresentationInfoLoaded=function(a,d){this._seriesManagerService.set_presentationInfo(d.args.seriesInstanceUID,d.args.id,d.args.presentationInfo)};a.prototype.onInstancesFound=function(a,d){this._seriesManagerService.set_instances(d.args.seriesInstanceUID,d.args.id,d.args.instances,d.args.stackInstanceUID)};a.prototype.onDicomJSONRetrieved=
function(a,d){null!=this._seriesManagerService.get_seriesCellById(d.args.id)&&this.LoadImages(d.args.seriesInstanceUID,d.args.id,d.args.metadata,d.args.sopInstanceUID)};a.prototype.onPresentationStateLoaded=function(a,d){this._seriesManagerService.set_annotationIDs(d.args.seriesInstanceUID,d.args.id,d.args.annotations);this._eventService.publish(EventNames.AnnotationsLoaded,{seriesInstanceUID:d.args.seriesInstanceUID,id:d.args.id})};a.prototype.getLateralityValue=function(a){var b;return(b=a[DicomTag.Laterality])&&
b.Value&&0<b.Value.length||(b=a[DicomTag.ImageLaterality])&&b.Value&&0<b.Value.length?DicomHelper.GetTagText(b):(b=a[DicomTag.FrameLaterality])&&b.Value&&0<b.Value.length?DicomHelper.GetTagText(b):""};a.prototype.UpdateCineSettings=function(a,d){var b=DicomHelper.getDicomTagValue(d,DicomTag.PreferredPlaybackSequencing);void 0!=b&&(a.cinePlayer.direction=1==b?lt.Controls.Medical.PlayingDirection.sweep:lt.Controls.Medical.PlayingDirection.forward);b=DicomHelper.getDicomTagValue(d,DicomTag.RecommendedDisplayFrameRate);
var e=DicomHelper.getDicomTagValue(d,DicomTag.CineRate);void 0==e&&(e=b);if(void 0!=e)a.cinePlayer.FPS=0==e?30:parseInt(e);else{b=DicomHelper.getDicomTagValue(d,DicomTag.FrameDelay);e=DicomHelper.getDicomTagValue(d,DicomTag.FrameTime);var f=DicomHelper.getDicomTagValue(d,DicomTag.ImageTriggerDelay),g=DicomHelper.getDicomTagValue(d,DicomTag.ActualFrameDuration);void 0==e&&(e=f);void 0==e&&(e=b);void 0==e&&(e=g);void 0!=e?(e=parseFloat(e),a.cinePlayer.FPS=parseInt((1E3/e).toString())):(d=DicomHelper.getDicomTagValue(d,
DicomTag.EffectiveDuration),void 0!=d&&(d=parseFloat(d),a.cinePlayer.FPS=parseInt((1E3*d/a.frames.count).toString())))}};a.prototype.AddTag=function(a,d){var b=new lt.Controls.Medical.OverlayText;b.text=a;b.type=lt.Controls.Medical.OverlayTextType.userData;b.positionIndex=d;b.weight=1;b.alignment=lt.Controls.Medical.OverlayAlignment.topLeft;return b};a.prototype.AddLabels=function(a,d){if(a.forCompare){var b=DicomHelper.getPatientName(d,DicomTag.PatientName),e=DicomHelper.GetTagTextValue(d,DicomTag.StudyDescription),
f=DicomHelper.parseDicomDate(DicomHelper.GetTagTextValue(d,DicomTag.StudyDate)),g=DicomHelper.parseDicomDate(DicomHelper.GetTagTextValue(d,DicomTag.SeriesDate));d=DicomHelper.GetTagTextValue(d,DicomTag.SeriesDescription);0==a.labels.count&&(a.labels.add(this.AddTag(b,0)),a.labels.add(this.AddTag(e,2)),a.labels.add(this.AddTag(f,3)),a.labels.add(this.AddTag(d,5)),a.labels.add(this.AddTag(g,6)))}};a.prototype.updateJSON=function(a,d,c,e,f,g){if(null!=c){var b=d.parentCell;g=DicomHelper.GetDicomImageInformation(c,
g);a.AddLabels(b,c);a.UpdateCineSettings(b,c);e=e||!0;d.set_imagePosition(g.position);g.orientation&&(d.imageOrientation=g.orientation);d.viewPosition=g.viewPosition;d.set_imageType(g.imageType);d.set_lossyCompression(g.lossyImageCompression);d.metadata=c;d.JSON=c;d.isWaveForm=g.isWaveForm;d.set_information(g);b=a.getLateralityValue(c);""!=b&&(d.laterality=b);d.set_rowSpacing(g.rowSpacing);d.set_columnSpacing(g.columnSpacing);d.originalSize={width:g.get_width(),height:g.get_height()};f&&(a._seriesManagerService.map_frame(d)||
a._eventService.publish(EventNames.InstanceOverflow,{instance:d.Instance,metadata:d.metadata,frame:0,parentCell:d.parentCell}));e&&a._eventService.publish(EventNames.ImageInformationReady,{seriesInstanceUID:d.Instance.SeriesInstanceUID,frameIndex:d.FrameIndex});a._eventService.publish(EventNames.LoadedDicomJSON,{seriesInstanceUID:d.Instance.SeriesInstanceUID,cellFrame:d});return{xmlData:c,cellFrame:d}}};a.prototype.loadFrameDicomJSON=function(a,d,c,e,f){var b=this;if(f)b.updateJSON(b,a,f,e,d,c);else return this._objectRetrieveService.GetDicomJSON(a.Instance.StudyInstanceUID,
a.Instance.SeriesInstanceUID,a.Instance.SOPInstanceUID).then(function(c){c=JSON.parse(c.data);return b.updateJSON(b,a,c,e,d)})};a.prototype.LoadImages=function(a,d,c,e){var b=this._seriesManagerService.get_instances(a,d),g=0,h=1==b.length,k=this._seriesManagerService.get_seriesCellById(d),l=this._seriesManagerService.get_seriesLoaderById(k),m=this;this._seriesManagerService.get_presentationInfo(a,d);var p=this._seriesManagerService.get_template(a,d);g=h?b[0].NumberOfFrames:b.length;var n=function(b,
d){if(h){0==k.frames.indexOf(d.frame)&&m.loadFrameDicomJSON(d.frame,p,0,!0,c);k.frames.get_item(0);for(b=1;b<w.NumberOfFrames;b++)m.loadFrameDicomJSON(k.frames.get_item(b),p,b,!0,c);m._eventService.publish(EventNames.ActiveSeriesChanged,{seriesInstanceUID:a,id:k.divID})}else m.loadFrameDicomJSON(d.frame,p)},r=function(a,b){k.remove_imageDownloaded(n);k.remove_progressCompleted(r)},q=function(a,b){a.remove_imageDownloaded(n);a.remove_progressCompleted(r);a.remove_disposing(q)};k.add_imageDownloaded(n);
k.add_progressCompleted(r);k.add_disposing(q);lt.LTHelper.device==lt.LTDevice.mobile?g>=m._optionsService.get(OptionNames.LazyLoadingMobileThreshold)&&(k.fullDownload=!1):g>=m._optionsService.get(OptionNames.LazyLoadingThreshold)&&(k.fullDownload=!1);k.marginFramesCount=m._optionsService.get(OptionNames.LazyLoadingBuffer);var t=DicomHelper.GetTagText(c[DicomTag.Modality]);k.length=Math.min(g,k.get_imageViewer().get_items().count);k.get_progress().set_totalFrames(b.length);k.studyInstanceUID=DicomHelper.GetTagText(c[DicomTag.StudyInstanceUID]);
for(var y=0;y<b.length;y++){var w=b[y];if(null!=w)for(var x=0;x<w.NumberOfFrames;x++){var u=this._seriesManagerService.get_cellFrame(a,d,w.SOPInstanceUID,"IO"!=t);void 0==u&&(this._eventService.publish(EventNames.InstanceOverflow,{instance:w,xml:c,frame:x,parentCell:k}),u=new lt.Controls.Medical.Frame(k),k.get_frames().add(u));var A=function(a){a=u.parentCell;u.remove_imageDataReady(A);m._eventService.publish(EventNames.ImageDataReady,{cellFrame:u,id:a.divID});if(m._templateService.currentStudyLayout&&
u.Instance&&!angular.isDefined(a.LoadedPresentationState)){var b=m._seriesManagerService.get_instances(a.seriesInstanceUID,a.divID);m._templateService.currentStudyLayout.Boxes&&Utils.findFirst(m._templateService.currentStudyLayout.Boxes,function(a){return Utils.findFirst(b,function(b){return b.SOPInstanceUID==a.referencedSOPInstanceUID})&&0<a.ReferencedPresentationStateSOP.length?!0:!1})}};u.add_imageDataReady(A);u.set_instanceNumber(w.InstanceNumber);u.metadata=0==y?c:null;u.Instance=w;u.FrameNumber=
x+1;u.FrameIndex=x;u.SeriesInstanceUID=a;u.enableDraw=!0;w.SOPInstanceUID==e&&(0==x?(g=DicomHelper.GetDicomImageInformation(c,x),u.set_information(g),u.set_imagePosition(g.position),u.set_imageType(g.imageType),u.set_lossyCompression(g.lossyImageCompression),u.isWaveForm=g.isWaveForm,l.SupportWindowLevel=DicomHelper.supportWindowLevel(k,x),u.set_width(g.width),u.set_height(g.height),u.set_rowSpacing(g.rowSpacing),u.set_columnSpacing(g.columnSpacing),u.originalSize={width:g.width,height:g.height},
k.set_patientName(DicomHelper.getPatientName(c,DicomTag.PatientName)),k.set_seriesNumber(DicomHelper.getDicomTagValue(c,DicomTag.SeriesNumber)),k.set_frameOfReferenceUID(g.frameOfReferenceUID),this._overlayManagerService.set_cellOverlays(k,u.metadata,u.isWaveForm)):(g=DicomHelper.GetDicomImageInformation(c),u.set_information(g),u.originalSize={width:g.get_width(),height:g.get_height()},u.set_width(g.width),u.set_height(g.height),u.isWaveForm=g.isWaveForm))}}e=$.grep(k.get_frames().toArray(),function(a){return!angular.isDefined(a.Instance)});
$.each(e,function(a,b){a=b.subCell;b.enableDraw=!1;null!=a&&(a.backColor=m._optionsService.get(OptionNames.EmptyCellBackgroundColor))});this._eventService.publish(EventNames.LoadingSeriesFrames,{seriesInstanceUID:a,id:d});this.updateMPRWithOverlays(k)};a.prototype.updateMPRWithOverlays=function(a){if(0!=a.derivatives.count){var b,c=a.derivatives.count;for(b=0;b<c;b++)copyOverlays(a.derivatives.get_item(b),a)}};a.prototype.getNumberOfFrames=function(a){a=DicomHelper.getDicomTag(a,DicomTag.NumberOfFrames);
return null!=a&&0<a.length?parseInt(a.text()):1};a.$inject="app.config authenticationService eventService objectRetrieveService queryArchiveService seriesManagerService $q overlayManagerService optionsService $timeout cinePlayerService objectStoreService templateService".split(" ");return a}();services.service("dicomLoaderService",DicomLoaderService);
var SeriesManagerService=function(){function a(a,d,c,e,f){var b=this;this._series={};this._eventService=a;this._optionsService=d;this._dialogs=c;this._modal=f;this._overflowImages=[];this._cleanupSeries=!1;a.subscribe(EventNames.LoadingSeriesFrames,$.proxy(this.OnLoadSeriesFrames,this));e("ANNOTATIONS").then(function(a){b._annotations=a});e("LOADED").then(function(a){b._loaded=a});e("DIALOGS_NOTIFICATION").then(function(a){b._notifyTitle=a});e("DIALOGS_ERROR").then(function(a){b._errorTitle=a})}Object.defineProperty(a.prototype,
"cleanupSeries",{get:function(){return this._cleanupSeries},set:function(a){this._cleanupSeries=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"activeSeriesInstanceUID",{get:function(){var a=this.get_activeCell();return a?a.seriesInstanceUID:""},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"currentStructuredDisplay",{get:function(){return this._currentStructuredDisplay},set:function(a){this._currentStructuredDisplay=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"structuredDisplayList",{get:function(){return this._structuredDisplayList},set:function(a){this._structuredDisplayList=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"currentLoadingSeries",{get:function(){return this._currentLoadingSeries},set:function(a){this._currentLoadingSeries=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"currentPatientSeries",{get:function(){return this._currentPatientSeries},set:function(a){this._currentPatientSeries=a},enumerable:!0,
configurable:!0});a.prototype.get_allSeries=function(){var a=[],d;for(d in this._series)this._series.hasOwnProperty(d)&&a.push(d);return a};a.prototype.get_metaData=function(){var a=this.get_activeCell();return a instanceof lt.Controls.Medical.Cell3D?a.JSON:this.get_activeCellFrame().metadata};a.prototype.get_seriesTab=function(a){return this._series[a]?this._series[a].tab:null};a.prototype.set_seriesTab=function(a,d){this._series[a]||(this._series[a]={});this._series[a].tab=d};a.prototype.add_seriesCell=
function(a){var b=a.get_seriesInstanceUID();this._series[b]||(this._series[b]={});this._series[b].cells||(this._series[b].cells=[]);this._series[b].cells.push(a)};a.prototype.dispose_seriesCell=function(a){this._series[a]&&(this._series[a].cells&&angular.forEach(this._series[a].cells,function(a,b){a.dispose()}),this._series[a]=null,delete this._series[a],angular.isDefined(this._overflowImages[a])&&delete this._overflowImages[a])};a.prototype.remove_UnusedSeries=function(){if(this._series){var a=this;
Object.keys(this._series).forEach(function(b){a._series[b].cells&&0!=a._series[b].cells.length||(a._series[b]=null,delete a._series[b])})}};a.prototype.remove_seriesCell=function(a){this._optionsService.get(OptionNames.DentalMode)?this._series[a]&&(this._series[a].cells&&angular.forEach(this._series[a].cells,function(a,b){a.dispose()}),this._series[a].cells=null,this._series[a].instances=null,this._series[a].loaders=null,angular.isDefined(this._overflowImages[a])&&delete this._overflowImages[a]):
this._series[a]&&(this._series[a].cells=null,this._series[a].instances=null,this._series[a].loaders=null,angular.isDefined(this._overflowImages[a])&&delete this._overflowImages[a])};a.prototype.remove_cell=function(a){if(this._series[a.seriesInstanceUID]&&this._series[a.seriesInstanceUID].cells){var b=this._series[a.seriesInstanceUID].cells.indexOf(a);-1!=b&&this._series[a.seriesInstanceUID].cells.splice(b,1)}};a.prototype.set_ShowStudyTimeLine=function(a){this._showStudyTimeLine=a};a.prototype.get_ShowStudyTimeLine=
function(){return this._showStudyTimeLine};a.prototype.get_activeItem=function(){return this._activeCell};a.prototype.set_activeCell=function(a){null==a?this._activeCell=null:(this._activeCell=a=this.get_seriesCellById(a),null!=a&&(a.get_viewer().layout.selectedItems.clear(),a.set_selected(!0)))};a.prototype.get_activeCell=function(){return this._activeCell};a.prototype.get_anyCell=function(){for(var a in this._series)if(this._series.hasOwnProperty(a)&&this._series[a].cells&&0<this._series[a].cells.length)return this._series[a].cells[0];
return null};a.prototype.get_seriesCellById=function(a){for(var b in this._series)if(this._series.hasOwnProperty(b)&&this._series[b].cells)for(var c=this._series[b].cells.length,e=0;e<c;e++){var f=this._series[b].cells[e];if(f.get_divID()==a)return f}return null};a.prototype.set_seriesLoader=function(a,d){var b=a.get_seriesInstanceUID();this._series[b]&&(this._series[b].loaders||(this._series[b].loaders={}),this._series[b].loaders[a.get_divID()]=d)};a.prototype.get_seriesLoaderById=function(a){if(null!=
a&&this._series[a.get_seriesInstanceUID()]&&this._series[a.get_seriesInstanceUID()].loaders){var b=this._series[a.get_seriesInstanceUID()].loaders,c;for(c in b)if(b.hasOwnProperty(c)&&c==a.divID)return b[c]}return null};a.prototype.set_seriesInfo=function(a,d){this._series[a]&&(this._series[a].info=d)};a.prototype.get_seriesInfo=function(a){return this._series[a]?this._series[a].info:null};a.prototype.set_layout=function(a,d,c,e){this._series[a]&&(this._series[a].layouts||(this._series[a].layouts=
{}),this._series[a].templates||(this._series[a].templates={}),c&&0<c.Boxes.length&&(this._series[a].layouts[d]=c),e&&(this._series[a].templates[d]=e))};a.prototype.get_layout=function(a,d){return this._series[a]&&this._series[a].layouts&&this._series[a].layouts[d]?this._series[a].layouts[d]:null};a.prototype.get_template=function(a,d){return this._series[a]&&this._series[a].templates?this._series[a].templates[d]:null};a.prototype.set_presentationInfo=function(a,d,c){this._series[a]&&(this._series[a].presentationInfo||
(this._series[a].presentationInfo={}),this._series[a].presentationInfo[d]=c,this._series[a].instances&&this._series[a].instances[d]&&this.sortImageInformation(a,d,this._series[a].presentationInfo[d]))};a.prototype.get_presentationInfo=function(a,d){return this._series[a]&&this._series[a].presentationInfo&&this._series[a].presentationInfo[d]?this._series[a].presentationInfo[d]:null};a.prototype.set_instances=function(a,d,c,e){if(this._series[a]){this._series[a].instances||(this._series[a].instances=
{});this._series[a].instances[d]=c;c=this._series[a].templates[d];var b=this.get_seriesCellById(d);b.stackInstanceUID=e;c&&0<c.Frames.length?Utils.createViewerLayout(b,c):!b.viewer.HangingProtocolEnabled&&(e=this._series[a].layouts[d])&&(this._series[a].sopMappings||(this._series[a].sopMappings={}),this._series[a].sopMappings[d]=this.buildLayoutMappings(e),this.map_Frames(a,d,e),this.setCustomLayout(this.get_seriesCellById(d),e))}};a.prototype.get_instances=function(a,d){return this._series[a]&&this._series[a].instances&&
this._series[a].instances[d]?this._series[a].instances[d]:[]};a.prototype.set_sopMappings=function(a,d,c,e){this._series[a].sopMappings||(this._series[a].sopMappings={});this._series[a].sopMappings[d]=c;this.map_Frames(a,d,e)};a.prototype.get_sopMappings=function(a,d){return this._series[a]&&this._series[a].sopMappings&&this._series[a].sopMappings[d]?this._series[a].sopMappings[d]:null};a.prototype.delete_sopMappings=function(a){this._series[a]&&delete this._series[a].sopMappings};a.prototype.get_cellFrame=
function(a,d,c,e){if(this._series[a]){a=this.get_sopMappings(a,d);d=this.get_seriesCellById(d);e=e||!1;if(null==a)return c=new lt.Controls.Medical.Frame(d),d.get_frames().add(c),c;if(c in a)return d.get_frames().get_item(a[c]);if(e)return c=new lt.Controls.Medical.Frame(d),d.get_frames().add(c),c}return null};a.prototype.get_cellFrameByIndex=function(a,d,c){if(this._series[a])return this.get_seriesCellById(d).get_frames().item(c)};a.prototype.get_activeSubCellIndex=function(a){if(this._series[a.seriesInstanceUID]){var b=
-1,c=a.get_selectedItems();0<c.get_count()&&(b=a.get_imageViewer().get_items().indexOf(c.get_item(0)));0>b&&(b=0);return b}return-1};a.prototype.get_viewerCount=function(a,d){return this._series[a]?this.get_seriesCellById(d).get_imageViewer().get_items().get_count():-1};a.prototype.get_activeViewer=function(){var a=this.get_activeCell();return a&&(a=a.get_selectedItems(),0<a.get_count())?a.get_item(0):null};a.prototype.get_activeItemForCell=function(a){return a&&(a=a.get_selectedItems(),0<a.get_count())?
a.get_item(0):null};a.prototype.get_activeCellFrame=function(){var a=this.get_activeCell();a instanceof lt.Controls.Medical.Cell3D&&(a=a.referenceCell);if(a){var d=this.get_activeSubCellIndex(a);return a.imageViewer.items.get_item(d).attachedFrame}return null};a.prototype.set_annotationIDs=function(a,d,c){this._series[a]&&(this._series[a].annotations||(this._series[a].annotations={}),this._series[a].annotations[d]=c)};a.prototype.get_annotationIDs=function(a,d){return this._series[a]&&angular.isDefined(this._series[a].annotations)?
this._series[a].annotations[d]:[]};a.prototype.remove_annotationID=function(a,d,c){if(this._series[a]&&this._series[a].annotations){var b=$.grep(this._series[a].annotations[d],function(a,b){return a.SOPInstanceUID==c});0<b.length&&(b=this._series[a].annotations[d].indexOf(b[0]),this._series[a].annotations[d].splice(b,1))}};a.prototype.get_maxAllowedStackIndex=function(a){if(a){if(a instanceof lt.Controls.Medical.Cell3D||!a.frames)return 1;1!=a.get_imageViewer().get_items().count&&a.get_selectedItem();
return Math.max(1,a.get_frames().get_count()-a.get_imageViewer().get_items().get_count()+1)}return-1};a.prototype.add_annotationID=function(a,d,c){this._series[a]&&(this._series[a].annotations||(this._series[a].annotations=[]),this._series[a].annotations[d].push(c))};a.prototype.add_annotations=function(a,d){if(this._series[a.seriesInstanceUID])try{for(var b=a.get_frames().get_count(),e=new lt.Annotations.Engine.AnnCodecs,f={},g=0,h=a.get_frames(),k=e.getInfoFromXmlDocument(d).get_pages(),l=k.length;g<
b;){var m=h.item(g).Instance.SOPInstanceUID;void 0==f[m]&&(f[m]=g);g++}for(;l--;){var p=e.loadFromXmlDocument(d,k[l]);if(p){var n=p.get_children();if(n)for(var r=n.get_count(),q=0;q<r;q++){var t=n.get_item(q);t&&t.set_rotateCenter(lt.LeadPointD.empty)}var y=JSON.parse(p.get_userData()),w=y.ReferencedImageSequence.ReferencedSopInstanceUid,x=y.ReferencedImageSequence.ReferencedFrameNumber,u=x.length,A=a.get_automation();for(b=0;b<u;b++){var G=p.get_children();if(0!=G.count){var I=f[w]+x[b]-1,D=a.get_frames().get_item(I).container,
z=D.get_children(),E=G.get_count();for(q=0;q<E;q++)t=G.get_item(q),z.add(t);D.mapper.calibrate(lt.LeadLengthD.create(1),lt.Annotations.Engine.AnnUnit.unit,lt.LeadLengthD.create(p.mapper.calibrationScale),lt.Annotations.Engine.AnnUnit.unit);A.set_active(!0);A.invalidate(lt.LeadRectD.empty)}}}A.get_automationControl().automationInvalidate(lt.LeadRectD.empty)}}catch(M){this._dialogs.error(this._errorTitle,"Invalid annotations data: "+M)}};a.prototype.capture_currentFrame=function(a){a=a||!1;var b=this.cloneCanvas();
a&&this.burnAnnotations(b);return b.toDataURL("image/png")};a.prototype.get_cellAnnotations=function(a){if(this._series[a.seriesInstanceUID]){var b=a.get_frames(),c=new lt.Annotations.Engine.AnnCodecs,e=b.count,f="";for(a=a.get_automation();e--;){var g=b.item(e),h=g.get_container();if(null!=a){var k=g.Instance;if(angular.isDefined(h)&&0<h.children.count){var l=new Models.AnnUserData,m=new Models.SopInstanceReference;m.ReferencedSopClassUid=k.SOPClassUID;m.ReferencedSopInstanceUid=k.SOPInstanceUID;
m.ReferencedFrameNumber.push(g.FrameNumber);l.ImageSize=this.getImageSize(g);l.ReferencedImageSequence=m;h.userData=JSON.stringify(l);f=c.save(h,lt.Annotations.Engine.AnnFormat.annotations,f,e+1)}}}return f}return""};a.prototype.enumerateFrames=function(a,d,c){if(this._series[a.seriesInstanceUID]&&d){var b=a.viewer,f,g=b.layout.items.count;for(f=0;f<g;f++)if(a=b.layout.items.get_item(f),a instanceof lt.Controls.Medical.Cell3D)c&&c(a);else{var h=a.get_frames();var k=h.count;if(a.tickBoxes[0].checked||
a.selected)for(a=0;a<k;a++)try{d(h.item(a),a)}catch(l){}}}};a.prototype.withinVisibleRange=function(a,d){if(this._series[a.seriesInstanceUID]){if(0>d||d>=a.frames.count)return!1;a.frames.item(d);return a.withinVisibleRange(d)}return!1};a.prototype.isImageDataAvailable=function(a,d){return this._series[a.seriesInstanceUID]?(a=a.frames,0>d||d>=a.count?!1:a.item(d).get_isPNGDataReady()):!1};a.prototype.isDataReady=function(a,d){if(this._series[a.seriesInstanceUID]){if(a instanceof lt.Controls.Medical.Cell3D)return!0;
a=a.frames;return!a||0>d||d>=a.count?!1:a.item(d).get_isDataReady()}return!1};a.prototype.deleteSelectedAnnotations=function(){var a=this.get_activeCell();a&&(a=a.get_automation(),null!=a&&a.canDeleteObjects?null!=a.currentEditObject?a.deleteSelectedObjects():alert("no annotation found to delete"):alert("no annotation found to delete"))};a.prototype.clearAnnotations=function(){var a=this.get_activeCell();if(a){a=this.get_activeCell();a=a.get_automation();var d=this.get_activeCellFrame().get_container().get_children();
0==d.count?alert("no annotation found"):(d.clear(),a.invalidate(lt.LeadRectD.empty))}};a.prototype.clearAllAnnotations=function(){var a=this.get_activeCell();if(a){for(var d=a.get_frames().get_count(),c=a.get_automation(),e=!1,f=0;f<d;f++){var g=a.get_frames().item(f).get_container().get_children();0!=g.count&&(e=!0,g.clear())}e?c.invalidate(lt.LeadRectD.empty):alert("no annotations found")}};a.prototype.buildLayoutMappings=function(a){for(var b=new AssociativeArray,c=a.Boxes?a.Boxes.length:0,e=0;e<
c;e++){var f=a.Boxes[e];b[f.referencedSOPInstanceUID&&0<f.referencedSOPInstanceUID.length?f.referencedSOPInstanceUID[0]:"DUMMY_ID_"+e]=e}return b};a.prototype.map_Frames=function(a,d,c){var b=this.get_sopMappings(a,d);if(b){a=null;this.get_seriesCellById(d);b.Size();d=c.Boxes.length;for(var f=[],g=[],h=0;h<d;h++){var k=c.Boxes[h];k=k.referencedSOPInstanceUID&&k.referencedSOPInstanceUID?k.referencedSOPInstanceUID[0]:null;angular.isDefined(b[k])?(null==a&&(a={}),a[h]=b[k],g.push(b[k])):f.push(h)}if(null!=
a&&0<f.length)for(h=0;h<d;h++)if(-1!=f.indexOf(h))for(c=0;c<d;c++)if(!angular.isDefined(a[c])){a[c]=h;break}}};a.prototype.sortImageInformation=function(a,d,c){new Models.FramePresentationInfo;var b,f=0;if(null!=this.get_seriesCellById(d)){var g=this._series[a].instances[d].length,h=0;this._series[a].imagesInformation||(this._series[a].imagesInformation={});for(this._series[a].imagesInformation[d]=[];h<g;h++){var k=0;var l=this._series[a].instances[d][h];if(null!=l){l=this.findSOP(c,l.SOPInstanceUID);
for(b=c[l].PagesPresentationInfo.length;k<b;k++)this._series[a].imagesInformation[d][k+f]=DicomHelper.PreparePresentationInformation(c[l],k);f+=b}}}};a.prototype.setCustomLayout=function(a,d){var b=d.Boxes.length,e=a.get_imageViewer();this.get_instances(a.get_seriesInstanceUID(),a.get_divID());e.beginUpdate();a.set_arrangement(1);e.items.clear();a.updateSubCellCount(b);a.templateId=d.TemplateId;for(var f=0;f<b;f++){var g=d.Boxes[f],h=e.get_items().get_item(f);g=Utils.createLeadRect(g.Position.leftTop.x,
g.Position.leftTop.y,g.Position.rightBottom.x,g.Position.rightBottom.y);if(!g.isEmpty){var k=new lt.Controls.Medical.Frame(a),l=h;h.set_bounds(g);a.get_frames().add(k);null!=l&&(l.backColor=this._optionsService.get(OptionNames.EmptyCellBackgroundColor))}}a.onSizeChanged();e.endUpdate()};a.prototype.set_framesMapping=function(a,d){d=null;for(var b=a.frames.toArray(),e=a.imageViewer,f=e.items.count,g=0;g<f;g++){var h=e.items.item(g);if(h.templateFrame){var k=Utils.findFirst(b,function(a){return!h.isMapped&&
Utils.isInstanceInFrame(h.templateFrame,a)});null==d&&(d={});if(k){var l=b.indexOf(k);d[g]=a.frames.indexOf(k);b.splice(l,1);h.isMapped=!0}else d[g]=-1}}a.set_framesMappingIndex(d);return b};a.prototype.map_frame=function(a){for(var b,c=a.parentCell.imageViewer,e=c.items.count,f=0;f<e;f++){var g=c.items.item(f);if(b=!g.isMapped&&Utils.isInstanceInFrame(g.templateFrame,a))break}b&&(g.isMapped=!0,g.set_attachedFrame(a));return b};a.prototype.addPostRender=function(a,d){a.add_postRenderItem(function(b,
e){if(e.part==lt.Controls.ImageViewerItemPart.item){b=e.context;var c=e.item,g=d.frames.indexOf(c.attachedFrame);d.get_derivatives().indexOf(a);b.save();e=a.getItemBounds(c,lt.Controls.ImageViewerItemPart.content);if(angular.isDefined(c.attachedFrame)){var h=c.attachedFrame.Instance;c=h.SOPInstanceUID;c=c.substr(c.length-6,5)+": "+h.InstanceNumber}else c=g.toString();c="("+g.toString()+") "+c;b.font="12px serif";b.fillStyle="red";b.textBaseline="top";b.fillText(c,e.left,e.top,e.width);b.restore()}})};
a.prototype.add_seriesOverflow=function(a){var b=a.instance.SeriesInstanceUID;angular.isDefined(this._overflowImages[b])||(this._overflowImages[b]=[]);angular.isDefined(this._overflowImages[b].metadata)||(this._overflowImages[b].metadata=a.metadata);this._overflowImages[b].push(a)};a.prototype.get_seriesOverflow=function(a){return angular.isDefined(this._overflowImages[a])?this._overflowImages[a]:[]};a.prototype.get_seriesOverflowJSON=function(a){return angular.isDefined(this._overflowImages[a])&&
angular.isDefined(this._overflowImages[a].metadata)?this._overflowImages[a].metadata:null};a.prototype.clear_seriesOverflow=function(a){angular.isDefined(this._overflowImages[a])&&(delete this._overflowImages[a].metadata,this._overflowImages[a]=[])};a.prototype.findSOP=function(a,d){for(var b=0,e=a.length;b<e;b++)if(a[b].SOPInstanceUID==d)return b;return-1};a.prototype.OnLoadSeriesFrames=function(a,d){var b=this.get_seriesCellById(d.args.id);if(b){a=b.get_automation();var e=this;a&&(a.add_editText(function(a,
c){e.automation_editText(a,c,b)}),a.add_currentDesignerChanged(function(a,c){e.automation_CurrentDesignerChanged(a,c,b)}),a.add_draw(function(a,b){e.automation_AnnotationDraw(a,b)}),e.setDefaults(a.get_manager()),e.setThumbPreferences(a.get_manager().get_renderingEngine().get_renderers()))}};a.prototype.automation_editText=function(a,d,c){if(lt.LTHelper.device==lt.LTDevice.tablet||lt.LTHelper.device==lt.LTDevice.mobile)this._modal.open({templateUrl:"views/dialogs/Prompt.html",controller:Controllers.PromptController,
backdrop:"static",resolve:{label:function(){return"Text"},text:function(){return d.get_textObject().get_text()}}}).result.then(function(a){var b=c.get_automation();d.get_textObject().set_text(a);b.get_automationControl().automationInvalidate(lt.LeadRectD.empty)});else{var b=document.createElement("textArea"),f=c.get_imageViewer();c.get_automation();var g=f.get_mainDiv().parentNode,h=this;b.id="textObject";b.style.left=d.get_bounds().get_left()+"px";b.style.top=d.get_bounds().get_top()+"px";b.style.position=
"absolute";b.style.zIndex="100";b.style.height=d.get_bounds().get_height()+"px";b.style.width=d.get_bounds().get_width()+"px";b.userData=d.get_textObject();b.value=d.get_textObject().get_text();b.style.color=d.get_textObject().get_textForeground().get_color();b.style.fontFamily=d.get_textObject().get_font().get_fontFamilyName();b.style.fontSize=d.get_textObject().get_font().get_fontSize()+"pt";b.wrap="off";g.appendChild(b);b.focus();b.addEventListener("focusout",function(){f.get_mainDiv();document.getElementById("textObject")&&
h.automation_GotFocus(a,d,c,b.id)});this.moveCaretToEnd(b);window.setTimeout(function(){h.moveCaretToEnd(b)},1)}};a.prototype.moveCaretToEnd=function(a){"number"==typeof a.selectionStart?a.selectionStart=a.selectionEnd=a.value.length:"undefined"!=typeof a.createTextRange&&(a.focus(),a=a.createTextRange,a.collapse(!1),a.select())};a.prototype.automation_GotFocus=function(a,d,c,e){a=c.get_imageViewer();c=c.get_automation();a=a.get_foreCanvas().parentNode;if(e=document.getElementById(e))e.userData.set_text(e.value),
a.removeChild(e),c.get_automationControl().automationInvalidate(lt.LeadRectD.empty)};a.prototype.automation_CurrentDesignerChanged=function(a,d,c){this._eventService.publish(EventNames.CurrentDesignerChanged,{seriesInstanceUID:c.get_seriesInstanceUID,automation:a,selectedObject:a.get_currentEditObject()});a.get_automationControl().automationInvalidate(lt.LeadRectD.empty)};a.prototype.automation_AnnotationDraw=function(a,d){d.operationStatus==lt.Annotations.Engine.AnnDesignerOperationStatus.start&&
(this._stroke||(this._stroke=lt.Annotations.Engine.AnnSolidColorBrush.create(this._optionsService.get(OptionNames.AnnotationStrokeColor))),d.object.stroke.stroke=this._stroke,d.object.tickMarksStroke&&(d.object.tickMarksStroke.stroke=this._stroke),d.object.textForeground&&(this._textColor||(this._textColor=lt.Annotations.Engine.AnnSolidColorBrush.create(this._optionsService.get(OptionNames.AnnotationTextColor))),d.object.textForeground=this._textColor),d.object.hiliteColor&&(this._hilightColor||(this._hilightColor=
this._optionsService.get(OptionNames.AnnotationHiliteColor)),d.object.hiliteColor=this._hilightColor))};a.prototype.setDefaults=function(a){a=$.grep(Array(a.objects.toArray()),function(a){return a.id==lt.Annotations.Engine.AnnObject.rulerObjectId});0<a.length&&a[0].objectTemplate.set_measurementUnit(lt.Annotations.Engine.AnnUnit.millimeter)};a.prototype.setThumbPreferences=function(a){var b=new lt.Annotations.Rendering.AnnRectangleThumbStyle,c=new lt.Annotations.Rendering.AnnEllipseThumbStyle,e=new lt.Annotations.Rendering.AnnEllipseThumbStyle;
lt.LTHelper.device==lt.LTDevice.desktop?b.set_size(lt.LeadSizeD.create(72,72)):b.set_size(lt.LeadSizeD.create(144,144));b.set_stroke(lt.Annotations.Engine.AnnStroke.create(lt.Annotations.Engine.AnnSolidColorBrush.create("black"),lt.LeadLengthD.create(1)));b.set_fill(lt.Annotations.Engine.AnnSolidColorBrush.create("rgba(173, 216, 230, .4)"));c.set_size(lt.LeadSizeD.create(54,54));c.set_stroke(lt.Annotations.Engine.AnnStroke.create(lt.Annotations.Engine.AnnSolidColorBrush.create("black"),lt.LeadLengthD.create(1)));
c.set_fill(lt.Annotations.Engine.AnnSolidColorBrush.create("rgba(144, 238, 144, .4)"));e.set_size(lt.LeadSizeD.create(108,108));e.set_stroke(lt.Annotations.Engine.AnnStroke.create(lt.Annotations.Engine.AnnSolidColorBrush.create("black"),lt.LeadLengthD.create(1)));e.set_fill(lt.Annotations.Engine.AnnSolidColorBrush.create("rgba(144, 238, 144, .4)"));for(var f in a){var g=a[f];g.set_locationsThumbStyle(b);g.set_rotateCenterThumbStyle(c);g.set_rotateGripperThumbStyle(e)}};a.prototype.cloneCanvas=function(a){var b=
this.get_activeCell();if(b instanceof lt.Controls.Medical.Cell3D){var c=b.image;b=lt.LeadRectD.create(0,0,b.image.naturalWidth,b.image.naturalHeight)}else{b=b.get_imageViewer();var e=b.get_activeItem();c=e.getForground();b=b.getItemViewBounds(e,lt.Controls.ImageViewerItemPart.view,!0)}e=document.createElement("canvas");e.width=b.width;e.height=b.height;e.style.left="0px";e.style.top="0px";e.style.width=b.width+"px";e.style.height=b.height+"px";var f=e.getContext("2d");f.fillStyle="#0";f.fillRect(0,
0,b.width,b.height);f.drawImage(c,b.left,b.top,b.width,b.height,0,0,b.width,b.height);a&&f.drawImage(a,0,0);return e};a.prototype.burnAnnotations=function(a){var b=this.get_activeCell().get_automation();if(b){var c=new lt.Annotations.Rendering.AnnHtml5RenderingEngine;c.attach(b.get_activeContainer(),a.getContext("2d"));c.burn()}};a.prototype.getImageSize=function(a){a=a.mrtiInfo.fullSize;return{Width:a.width,Height:a.height}};a.$inject=["eventService","optionsService","dialogs","$translate","$modal"];
return a}();services.service("seriesManagerService",SeriesManagerService);
var CinePlayerService=function(){function a(a,d){this._seriesInstanceUID="";this._updating=!1;this._fps=30;this._maxSkip=10;this._currentFrame=1;this._loop=!0;this._direction="Forward";this._seriesManagerService=a;this._eventService=d}Object.defineProperty(a.prototype,"fps",{get:function(){return this._fps},set:function(a){this._fps=a;this.updatePlayer()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxSkip",{get:function(){return this._maxSkip},set:function(a){this._maxSkip=
a;this.updatePlayer()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isPlaying",{get:function(){return null==this._cinePlayer?!1:this._cinePlayer.isPlaying},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"currentFrame",{get:function(){return this._currentFrame},set:function(a){this._currentFrame=a;this.updatePlayer()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"loop",{get:function(){return this._loop},set:function(a){this._loop=a;this.updatePlayer()},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"direction",{get:function(){return this._direction},set:function(a){this._direction=a;this.updatePlayer()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"directionFromPlayingDirection",{set:function(a){switch(a){case lt.Controls.Medical.PlayingDirection.forward:this.direction="Forward";break;case lt.Controls.Medical.PlayingDirection.backward:this.direction="Backward";break;case lt.Controls.Medical.PlayingDirection.sweep:this.direction=
"Sweep";break;case lt.Controls.Medical.PlayingDirection.shuffle:this.direction="Shuffle"}},enumerable:!0,configurable:!0});a.prototype.set_frameChanged=function(a){angular.isDefined(a)&&(this._frameChanged=a);return this._frameChanged};a.prototype.attachCell=function(a){null!=this._cinePlayer&&this._cinePlayer.isPlaying&&this.stop();this._seriesInstanceUID=a.seriesInstanceUID;this._cell=a;this._cinePlayer=this._cell.cinePlayer};Object.defineProperty(a.prototype,"cell",{get:function(){return this._cell},
enumerable:!0,configurable:!0});a.prototype.start=function(){if(!this._cinePlayer.isPlaying){this.updatePlayer();this._playerStoppedHandle=this._eventService.subscribe(EventNames.PlayerStopped,this.playerStopped.bind(this));this._cinePlayer.add_frameChanged(this.frameChanged.bind(this));var a=this._cell.viewer.layout.items.count,d,c=!1;for(d=0;d<a;d++){var e=this._cell.viewer.layout.items.get_item(d);e.tickBoxes[0].checked&&(c=!0,e.cinePlayer.play())}c||this._cell.cinePlayer.play()}};a.prototype.stop=
function(){var a=this._cell.viewer.layout.items.count,d;for(d=0;d<a;d++){var c=this._cell.viewer.layout.items.get_item(d);c.cinePlayer.isPlaying&&c.cinePlayer.stop()}this._eventService.unsubscribe(this._playerStoppedHandle)};a.prototype.first=function(){this._cinePlayer.isPlaying||this._cell&&this._cell.set_currentOffset(0)};a.prototype.last=function(){this._cinePlayer.isPlaying||this._cell&&this._cell.set_currentOffset(this._seriesManagerService.get_maxAllowedStackIndex(this._cell)-1)};a.prototype.previous=
function(){this._cinePlayer.isPlaying||this._cell&&this._cell.set_currentOffset(Math.max(this._cell.get_currentOffset()-1,0))};a.prototype.next=function(){this._cinePlayer.isPlaying||this._cell&&this._cell.set_currentOffset(Math.min(this._cell.get_currentOffset()+1,this._seriesManagerService.get_maxAllowedStackIndex(this._cell)))};a.prototype.updateCellCine=function(a){var b=this._fps,c=this._maxSkip,e=this._currentFrame;if(!this._updating&&null!=a&&null!=a.cinePlayer){this._updating=!0;this.is_pos_int(b)&&
0!=b||(this._fps=a.cinePlayer.FPS);this.is_pos_int(c)||(this._maxSkip=a.cinePlayer.maxSkip);if(!this.is_pos_int(e)||0>e||e>this._seriesManagerService.get_maxAllowedStackIndex(this._cell))this.currentFrame=this._cell.get_currentOffset()+1;a.cinePlayer.FPS=b;a.cinePlayer.maxSkip=c;a.cinePlayer.loop=this.loop;switch(this.direction){case "Forward":a.cinePlayer.direction=lt.Controls.Medical.PlayingDirection.forward;break;case "Backward":a.cinePlayer.direction=lt.Controls.Medical.PlayingDirection.backward;
break;case "Shuffle":a.cinePlayer.direction=lt.Controls.Medical.PlayingDirection.shuffle;break;case "Sweep":a.cinePlayer.direction=lt.Controls.Medical.PlayingDirection.sweep}this._updating=!1}};a.prototype.updatePlayer=function(){if(null!=this._cell){var a=this._cell.viewer.layout.items.count,d,c=!1;for(d=0;d<a;d++){var e=this._cell.viewer.layout.items.get_item(d);e.tickBoxes[0].checked&&(c=!0,this.updateCellCine(e))}c||this.updateCellCine(this._cell)}};a.prototype.frameChanged=function(a,d){a=d.frameIndex;
this._currentFrame=a=0<=a?a:0;this._frameChanged&&this._frameChanged(a)};a.prototype.playerStopped=function(a,d){this._eventService.unsubscribe(this._playerStoppedHandle)};a.prototype.is_pos_int=function(a){return parseFloat(a)!=parseInt(a,10)||isNaN(a)?!1:0<=parseInt(a,10)};a.$inject=["seriesManagerService","eventService"];return a}();services.service("cinePlayerService",CinePlayerService);
var OverlayManagerService=function(){function a(a,d){this._defaultOverlayTags=null;this._optionsService=a}a.prototype.getOverlayTags=function(){var a=this._optionsService.get(OptionNames.OverlaySettings);null==a||""==a?(null==this._defaultOverlayTags&&(this._defaultOverlayTags=new Controllers.OverlayTags,this.BuildDefaultOverlay(),this._optionsService.set(OptionNames.OverlaySettings,JSON.stringify(this._defaultOverlayTags))),a=this._defaultOverlayTags):a=JSON.parse(a);return a};a.prototype.saveOverlayTags=
function(a){return this._optionsService.saveDefaultOptions({OverlaySettings:JSON.stringify(a)})};a.prototype.getOverlayType=function(a){switch(a){case "Window Level":return lt.Controls.Medical.OverlayTextType.windowLevel;case "Instance Number":return lt.Controls.Medical.OverlayTextType.instanceNumber;case "Image Quality":return lt.Controls.Medical.OverlayTextType.imageQuality;case "Frame Number":return lt.Controls.Medical.OverlayTextType.frameNumber;case "Left Orientation":return lt.Controls.Medical.OverlayTextType.leftOrientation;
case "Right Orientation":return lt.Controls.Medical.OverlayTextType.rightOrientation;case "Top Orientation":return lt.Controls.Medical.OverlayTextType.topOrientation;case "Bottom Orientation":return lt.Controls.Medical.OverlayTextType.bottomOrientation}return lt.Controls.Medical.OverlayTextType.userData};a.prototype.getOverlayTypeName=function(a){switch(a){case lt.Controls.Medical.OverlayTextType.windowLevel:return"WindowLevel";case lt.Controls.Medical.OverlayTextType.instanceNumber:return"InstanceNumber";
case lt.Controls.Medical.OverlayTextType.imageQuality:return"Image Quality";case lt.Controls.Medical.OverlayTextType.frameNumber:return"FrameNumber";case lt.Controls.Medical.OverlayTextType.leftOrientation:return"LeftOrientation";case lt.Controls.Medical.OverlayTextType.rightOrientation:return"RightOrientation";case lt.Controls.Medical.OverlayTextType.topOrientation:return"TopOrientation";case lt.Controls.Medical.OverlayTextType.bottomOrientation:return"BottomOrientation"}return"UserData"};a.prototype.AddTag=
function(a,d,c,e,f,g){var b=new lt.Controls.Medical.OverlayText;b.set_text(d);b.set_alignment(c);b.set_type(e);b.set_positionIndex(f);b.set_color(void 0==g?"#FFFFFF":g);e==lt.Controls.Medical.OverlayTextType.windowLevel&&b.set_weight(10);a instanceof lt.Controls.Medical.Cell3D||a instanceof lt.Controls.Medical.STLCell?a.labels.add(b):a.get_overlays().add(b)};a.prototype.AddDefaultTag=function(a,d,c,e,f){var b=new Controllers.OverlayTag;b.tag=c;b.title=d;b.overlayType=e;b.id=UUID.generate();b.color=
void 0==f?"#FFFFFF":f;a.push(b)};a.prototype.BuildDefaultOverlay=function(){this.AddDefaultTag(this._defaultOverlayTags.topRight,"Name: ",DicomTag.PatientName);this.AddDefaultTag(this._defaultOverlayTags.topRight,"PID: ",DicomTag.PatientID);this.AddDefaultTag(this._defaultOverlayTags.topRight,"Sex: ",DicomTag.PatientSex);this.AddDefaultTag(this._defaultOverlayTags.topRight,"DOB: ",DicomTag.PatientBirthDate);this.AddDefaultTag(this._defaultOverlayTags.topLeft,"",void 0,lt.Controls.Medical.OverlayTextType.frameNumber);
this.AddDefaultTag(this._defaultOverlayTags.topLeft,"Acc#: ",DicomTag.AccessionNumber);this.AddDefaultTag(this._defaultOverlayTags.topLeft,"Study Date: ",DicomTag.StudyDate);this.AddDefaultTag(this._defaultOverlayTags.topLeft,"Study: ",DicomTag.StudyDescription);this.AddDefaultTag(this._defaultOverlayTags.topLeft,"Series: ",DicomTag.SeriesDescription);this.AddDefaultTag(this._defaultOverlayTags.topLeft,"Se#: ",DicomTag.SeriesNumber);this.AddDefaultTag(this._defaultOverlayTags.topLeft,"",void 0,lt.Controls.Medical.OverlayTextType.instanceNumber);
this.AddDefaultTag(this._defaultOverlayTags.topLeft,"",void 0,lt.Controls.Medical.OverlayTextType.windowLevel);this.AddDefaultTag(this._defaultOverlayTags.topRight,"",void 0,lt.Controls.Medical.OverlayTextType.laterality);this.AddDefaultTag(this._defaultOverlayTags.bottomLeft,"",void 0,lt.Controls.Medical.OverlayTextType.imageQuality,"#FF0000");this.AddDefaultTag(this._defaultOverlayTags.centerLeft,"",void 0,lt.Controls.Medical.OverlayTextType.leftOrientation);this.AddDefaultTag(this._defaultOverlayTags.centerTop,
"",void 0,lt.Controls.Medical.OverlayTextType.topOrientation);this.AddDefaultTag(this._defaultOverlayTags.centerRight,"",void 0,lt.Controls.Medical.OverlayTextType.rightOrientation);this.AddDefaultTag(this._defaultOverlayTags.centerBottom,"",void 0,lt.Controls.Medical.OverlayTextType.bottomOrientation);this.AddDefaultTag(this._defaultOverlayTags.bottomRight,"",void 0,lt.Controls.Medical.OverlayTextType.mprType);this.AddDefaultTag(this._defaultOverlayTags.bottomLeft,"",void 0,lt.Controls.Medical.OverlayTextType.fieldOfView)};
a.prototype.set_cellOverlays=function(a,d,c){var b=this.getOverlayTags(),f=function(b,e){g==lt.Controls.Medical.OverlayAlignment.bottomRight&&(b+=1);if(null!=e.tag&&0<e.tag.length){var f=d[e.tag];var h=f&&f.Value&&0<f.Value.length&&"PN"==f.vr?DicomHelper.getPatientName(d,e.tag):f?DicomHelper.get_TagValue(d,e.tag):"";f&&f.Value&&0<f.Value.length&&"DA"==f.vr&&(h=DicomHelper.parseDicomDate(h));f&&f.Value&&0<f.Value.length&&"TM"==f.vr&&(h=DicomHelper.parseDicomTime(h));this.AddTag(a,e.title+h,g,lt.Controls.Medical.OverlayTextType.userData,
b,c?"rgba(0, 0, 0, 1)":e.color)}else null!=e.overlayType&&(c||this.AddTag(a,e.title,g,e.overlayType,b,e.color))};var g=lt.Controls.Medical.OverlayAlignment.topRight;$.each(b.topRight,$.proxy(f,this));g=lt.Controls.Medical.OverlayAlignment.topLeft;$.each(b.topLeft,$.proxy(f,this));a instanceof lt.Controls.Medical.Cell3D||a instanceof lt.Controls.Medical.STLCell||(g=lt.Controls.Medical.OverlayAlignment.bottomRight,$.each(b.bottomRight,$.proxy(f,this)),g=lt.Controls.Medical.OverlayAlignment.bottomLeft,
$.each(b.bottomLeft,$.proxy(f,this)),g=lt.Controls.Medical.OverlayAlignment.centerLeft,$.each(b.centerLeft,$.proxy(f,this)),g=lt.Controls.Medical.OverlayAlignment.centerTop,$.each(b.centerTop,$.proxy(f,this)),g=lt.Controls.Medical.OverlayAlignment.centerRight,$.each(b.centerRight,$.proxy(f,this)),g=lt.Controls.Medical.OverlayAlignment.centerBottom,$.each(b.centerBottom,$.proxy(f,this)))};a.prototype.cell_hasOverlays=function(a){return 0<a.overlays.count};a.$inject=["optionsService","eventService"];
return a}();services.service("overlayManagerService",OverlayManagerService);
var DataService=function(){function a(a,d){this._series=[];this._patients=[];this._eventService=d}a.prototype.set_Series=function(a){this._series=a;this._patients=[];a&&0<a.length?(this.filterPresentationState(),this.extractPatients()):this._patients.length=0};a.prototype.add_series=function(a){this._series||(this._series=[]);null==a.Patient&&null!=this._patients&&0<this._patients.length&&(a.Patient=this._patients[0]);this._series.push(a)};a.prototype.get_Series=function(a){if(this._series&&0<this._series.length){var b=
$.grep(this._series,function(b){return b.InstanceUID==a});if(0<b.length)return b[0]}return null};a.prototype.get_allSeries=function(){return this._series};a.prototype.filterPresentationState=function(){for(var a=this._series.length;a--;)"PR"!=this._series[a].Modality&&"SD"!=this._series[a].Modality||this._series.splice(a,1)};a.prototype.extractPatients=function(){for(var a={},d=this._series.length,c=0;c<d;c++)if(a[this._series[c].Patient.ID])a[this._series[c].Patient.ID].Series.push(this._series[c]);
else{var e={};e.ID=this._series[c].Patient.ID;e.Sex=this._series[c].Patient.Sex;this._series[c].Patient.Name&&(e.Name=this._series[c].Patient.Name.replace("^",", ").replace(/\^/g," "));e.BirthDate=this._series[c].Patient.BirthDate;e.Series=[];e.Series.push(this._series[c]);this._patients.push(e);a[this._series[c].Patient.ID]=e}};a.$inject=["app.config","eventService"];return a}();services.service("dataService",DataService);
var ToolbarService=function(){function a(a,d,c,e){this._optionsService=a;this._disabledToolbarItems=[];this._commangular=d;this._oldCSS={};this._hotkeys=c;this._eventService=e}a.prototype.filterToolbar=function(b){return!a.isNativeMobile||"PopupCapture"!==b.id&&"WaveformBasicAudio"!==b.id?this._dentalMode?"LayoutCompose"===b.id||"HangingProtocol"===b.id||"SaveStructuredDisplay"===b.id||"DeleteStudyStructuredDisplay"===b.id||"StudyLayout"===b.id?!1:!0:!0:!1};a.prototype.load=function(){return null};
a.prototype.getToolbars=function(){if(null==this._toolbars){var a=JSON.parse(this._optionsService.get(OptionNames.Toolbars));0==a.length&&(a=[],a.push("main"));this._toolbars=[];for(var d=0;d<a.length;d++){var c="Toolbar_"+a[d];this._dentalMode=this._optionsService.get(OptionNames.DentalMode);c=this._optionsService.get(c).replace(/(\r\n|\n|\r|\t)/gm,"");c=JSON.parse(c.trim());c.items=c.items.filter(this.filterToolbar);this._toolbars.push(c)}}return this._toolbars};a.prototype.getDisabledItems=function(a){try{var b=
JSON.parse(this._optionsService.get("DisabledToolbarItems_"+a))}catch(c){b=[]}return b};a.prototype.isEnabled=function(a){a=$("#"+a);return 0<a.length&&jQuery.hasData(a[0])?!jQuery.data(a[0],"isDisabled")():!1};a.prototype.switchIcon=function(a,d){this.switchItem(a,d)};a.prototype.enable=function(a,d){var b=!0;void 0!=d&&this.isFunction(d)&&(b=d());if(a instanceof Array)for(d=0;d<a.length;d++)b?this.enableItem(a[d]):this.disableItem(a[d]);else b?this.enableItem(a):this.disableItem(a)};a.prototype.hilightBorder=
function(a,d,c){$();if(a instanceof Array)for(var b=0;b<a.length;b++){var f=$("#"+a[b]);this.hilightItem(a,f,d,c)}else f=$("#"+a),this.hilightItem(a,f,d,c)};a.prototype.unhilightBorder=function(a){$();if(a instanceof Array)for(var b=0;b<a.length;b++){var c=$("#"+a[b]);this.unhilightItem(a,c)}else c=$("#"+a),this.unhilightItem(a,c)};a.prototype.press=function(a){a="#"+a+"_icon";var b=$(a).attr("original-id");$(a).removeClass(b);$(a).addClass(b+"Pressed")};a.prototype.unpress=function(a){a="#"+a+"_icon";
var b=$(a).attr("original-id");$(a).removeClass(b+"Pressed");$(a).addClass(b)};a.prototype.updateClass=function(a,d,c,e){e=e();a="#"+a+"_icon";e?($(a).removeClass(c),$(a).addClass(d)):($(a).removeClass(d),$(a).addClass(c))};a.prototype.hilightItem=function(a,d,c,e){this.saveCss(a,d);d.css("border",c);d.css("border-style","solid");d.css("border-color",e)};a.prototype.saveCss=function(a,d){"undefined"==typeof this._oldCSS[a]&&(this._oldCSS[a]={});this._oldCSS[a].border=d.css("border");this._oldCSS[a].borderStyle=
d.css("border-style");this._oldCSS[a].borderColor=d.css("border-color")};a.prototype.unhilightItem=function(a,d){"undefined"!=typeof this._oldCSS[a]&&(d.css("border",this._oldCSS[a].border),d.css("border-style",this._oldCSS[a].borderStyle),d.css("border-color",this._oldCSS[a].borderColor))};a.prototype.disable=function(a){if(a instanceof Array)for(var b=0;b<a.length;b++)this.disableItem(a[b]);else this.disableItem(a)};a.prototype.hide=function(a){if(a instanceof Array)for(var b=0;b<a.length;b++){var c=
$("#"+a[b]);c.hide()}else c=$("#"+a),c.hide()};a.prototype.show=function(a){if(a instanceof Array)for(var b=0;b<a.length;b++){var c=$("#"+a[b]);c.show()}else c=$("#"+a),c.show()};a.prototype.disableItem=function(a){a=$("#"+a);0<a.length&&jQuery.hasData(a[0])&&(jQuery.data(a[0],"isDisabled")()||jQuery.data(a[0],"disable")())};a.prototype.isFunction=function(a){return"function"===typeof a};a.prototype.enableItem=function(a){a=$("#"+a);0<a.length&&jQuery.hasData(a[0])&&jQuery.data(a[0],"isDisabled")()&&
jQuery.data(a[0],"enable")()};a.prototype.switchItem=function(a,d){a=$("#"+a);0<a.length&&jQuery.hasData(a[0])&&jQuery.data(a[0],"isDisabled")()&&jQuery.data(a[0],"enable")()};a.prototype.loadDefault=function(a){var b=new Models.Toolbar;b.name="Main";a.push(b);this.addToolbarButton(b,"PanZoom","","toolBarItem Pan");this.addToolbarButton(b,"Zoom","","toolBarItem Zoom");this.addToolbarButton(b,"Magnify","","toolBarItem Magnify");this.addToolbarButton(b,"WindowLevel","","toolBarItem WindowLevel");this.addToolbarButton(b,
"Stack","","toolBarItem Stack");this.addToolbarButton(b,"Reload","","toolBarItem Reload");this.addToolbarButton(b,"RotateClock","","toolBarItem RotateClock");this.addToolbarButton(b,"RotateCounterClock","","toolBarItem RotateCounterClock");this.addToolbarButton(b,"Flip","","toolBarItem Flip");this.addToolbarButton(b,"Reverse","","toolBarItem Reverse");this.addToolbarButton(b,"FitImage","","toolBarItem FitImage");this.addToolbarButton(b,"OneToOne","","toolBarItem OneToOne");this.addToolbarButton(b,
"TrueSizeDisplay","","toolBarItem TrueSizeDisplay")};a.prototype.addToolbarButton=function(a,d,c,e){var b=new Models.ToolbarButton;b.action=d;b.tooltip=c;b.cssIconClass=e||"";a.items.push(b)};a.prototype.processItem=function(a,d,c){var b=this;if(-1==$.inArray(a.id,this._disabledToolbarItems))if(a.items&&0<a.items.length){if("group"==a.type){var f=$('<div class="btn-group" style="float: none !important"></div>');$(d).append(f);d=f}else d=b.addDropDown(d,a,c);var g=!0,h=!1;angular.forEach(a.items,function(a,
e){-1==$.inArray(a.id,b._disabledToolbarItems)&&("seperator"!=a.type?(g?(d.append('<li class="menuBar"></li>'),g=!1):(h||d.append('<li class="itemDivider"></li>'),h=!1),b.addOption(d,a,c)):(b.addOption(d,a,c),h=!0))})}else"button"==a.type?b.addButton(d,a,c):"seperator"==a.type&&b.addSeperator(d,a,c)};a.prototype.addShortcut=function(a){var b=this;a.shortcut&&a.shortcut.length&&this._hotkeys.add({combo:a.shortcut,description:a.tooltip,callback:function(){b.runCommand(a.action,a.id)}})};a.prototype.addButton=
function(a,d,c){var b=$('<button onfocus="blur();" class="btn btn-default toolbar-button"></button>');b.tabStop=!1;var f=d.id+c;b.attr("id",f);b.attr("type","button");b.attr("data-toggle","button");d.tooltip&&0<d.tooltip.length&&(b.attr("title",d.tooltip),b.attr("data-container","body"));d.cssIconClass&&(c=$("<div class='toolBarItem "+d.cssIconClass+"'> </div>"),c.attr("id",f+"_icon"),c.attr("original-id",d.id),b.append(c));d.cssIconClass&&(c=$("<i class='toolBarItemText'>"+d.caption+"</i>"),b.append(c));
$.data(b[0],"enable",function(){var a="#"+f+"_icon";b.removeAttr("disabled");b.removeClass("btn-disabled");$(a).removeClass("Disabled"+d.cssIconClass);$(a).addClass(d.cssIconClass)});$.data(b[0],"disable",function(){var a="#"+f+"_icon";b.attr("disabled","disabled");b.addClass("btn-disabled");$(a).removeClass(d.cssIconClass);$(a).addClass("Disabled"+d.cssIconClass)});$.data(b[0],"isDisabled",function(){return void 0!=b.attr("disabled")});var g=this;this.addShortcut(d);if(null!=d.action)b.on("click",
function(a){g.runCommand(d.action,f)});$(a).append(b);angular.isDefined(d.visible)&&0==Utils.toBoolean(d.visible,!0)&&this.hide(f);angular.isDefined(d.disabled)&&1==Utils.toBoolean(d.disabled,!1)&&this.disable(f)};a.prototype.addSeperator=function(a,d,c){d=$('<span style="width:3px"></span>');$(a).append(d)};a.prototype.addDropDown=function(a,d,c){var b=$('<div class="btn-group " style="float: none !important"></div>'),f=$('<ul class="dropdown-menu"></ul>'),g=$('<button class="btn btn-default dropdown-toggle toolbar-button" data-toggle="dropdown"></button>'),
h=$('<button onfocus="blur();" class="btn btn-default toolbar-button"></button>'),k=this,l=d.id+c;if(d.cssIconClass){var m=$("<i class='toolBarItem "+d.cssIconClass+"'> </i>");h.append(m)}if(d.cssIconClass){var p=$("<i class='toolBarItemText'>"+d.caption+"</i>");h.append(p)}h.attr("id",l+"_dropdown");h.attr("type","button");h.data("action",d.action);h.attr("title",d.tooltip);h.attr("data-container","body");h.attr("original-id",d.id);h.on("click",function(){var a=h.data("action");a&&0<a.length&&k.runCommand(a,
l)});g.attr("id",l);$.data(g[0],"enable",function(){h.removeAttr("disabled");g.removeAttr("disabled")});$.data(g[0],"disable",function(){g.attr("disabled","disabled");h.attr("disabled","disabled")});$.data(g[0],"isDisabled",function(){return void 0!=g.attr("disabled")});$.data(f[0],"dropdown",l+"_dropdown");$.data(f[0],"dropDownIcon",m);$.data(f[0],"iconName",d.cssIconClass);$.data(f[0],"iconText",p);b.append(h);g.append('<span class="caret"></span>');b.append(g);b.append(f);a.append(b);return f};
a.prototype.addOption=function(a,d,c){if("seperator"==d.type)a.append('<li class="divider"></li>');else{var b=d.id+c,f=$("<li></li>"),g=$('<a href="javascript:void(0)" target="_self"></a>');if(d.cssIconClass){var h=$("<i class='toolBarItemOption "+d.cssIconClass+"' style='height: 30px; width: 30px;'></i><i class='menuItemText' >"+d.tooltip+"</i>");h.attr("id",b+"_icon");h.attr("original-id",d.id);g.append(h)}g.attr("id",b);g.attr("type","button");d.tooltip&&0<d.tooltip.length&&(g.attr("title",d.tooltip),
g.attr("data-container","body"));$.data(g[0],"enable",function(){var c="#"+b+"_icon";g.removeAttr("disabled");$(c).removeClass("Disabled"+d.cssIconClass);$(c).addClass(d.cssIconClass);if($.hasData(a[0])&&(c=$.data(a[0],"iconName"),c=="Disabled"+d.cssIconClass)){var e=$("#"+$.data(a[0],"dropdown"));c=$.data(a[0],"iconName");var f=$.data(a[0],"dropDownIcon");k.setIcon(d.cssIconClass,c,f,a);0<e.length&&e.removeAttr("disabled")}});$.data(g[0],"switch",function(){var c="#"+b+"_icon";g.attr("disabled",
"disabled");$(c).removeClass(d.cssIconClass);$(c).addClass("Disabled"+d.cssIconClass);if($.hasData(a[0])&&(c=$.data(a[0],"iconName"),c==d.cssIconClass)){var e=$("#"+$.data(a[0],"dropdown"));c=$.data(a[0],"iconName");var f=$.data(a[0],"dropDownIcon");k.setIcon("Disabled"+d.cssIconClass,c,f,a);0<e.length&&e.attr("disabled","disabled")}});$.data(g[0],"disable",function(){var c="#"+b+"_icon";g.attr("disabled","disabled");$(c).removeClass(d.cssIconClass);$(c).addClass("Disabled"+d.cssIconClass);if($.hasData(a[0])&&
(c=$.data(a[0],"iconName"),c==d.cssIconClass)){var e=$("#"+$.data(a[0],"dropdown"));c=$.data(a[0],"iconName");var f=$.data(a[0],"dropDownIcon");k.setIcon("Disabled"+d.cssIconClass,c,f,a);0<e.length&&e.attr("disabled","disabled")}});$.data(g[0],"isDisabled",function(){return void 0!=g.attr("disabled")});f.append(g);a.append(f);var k=this;if(null!=d.action)g.on("click",function(){$(this).attr("id");if($.hasData(a[0])){var e=$("#"+$.data(a[0],"dropdown"));if(0<e.length){var f=$.data(a[0],"dropDownIcon"),
g=$.data(a[0],"iconText");if(f&&0<f.length){var h=$.data(a[0],"iconName"),r=k.isEnabled(d.id+c),q=r?d.cssIconClass:"Disabled"+d.cssIconClass;g[0].innerText=d.caption;k.setIcon(q,h,f,a);r?e.removeAttr("disabled"):e.attr("disabled","disabled");e.data("action",d.action);e.attr("title",d.tooltip)}}}k.runCommand(d.action,b)})}};a.prototype.setIcon=function(a,d,c,e){d&&0<d.length&&c.removeClass(d);c.addClass(a);$.data(e[0],"iconName",a)};a.prototype.runCommand=function(a,d){var b=commangularProvider.findCommand(a);
b&&b.descriptors&&1<=b.descriptors.length&&void 0!=b.descriptors[0].command&&this._commangular.dispatch(a,{buttonId:d})};a.prototype.buildToolbar=function(a,d,c,e){var b=this;e=e||"";this._disabledToolbarItems=this.getDisabledItems(a.name);angular.forEach(d,function(a,d){b.processItem(a,c,e)});this._eventService.publish(EventNames.ToolbarCreated,e)};a.prototype.getCommands=function(){var a=[];this.traverse(this.getToolbars()[0].items,a);return a};a.prototype.traverse=function(a,d){var b=this;angular.forEach(a,
function(a,c){a.action&&d.push(a.action);a.items&&0<a.items.length&&b.traverse(a.items,d)})};a.$inject=["optionsService","$commangular","hotkeys","eventService"];a.isNativeMobile=!1;return a}();services.service("toolbarService",ToolbarService);
